var TaskStatusListPanelJs=new Class.create;
TaskStatusListPanelJs.prototype=Object.extend(new BPCPageJs,{_pageJs:null,_openinFB:!0,initialize:function(b){this._pageJs=b},setOpenInFancyBox:function(b){this._openinFB=b;return this},_getTaskListPage:function(b){var a;a=this;b="/tasks.html?blanklayout=1&nosearch=1&statusIds="+b+("Order"===a.entityName&&a.entity&&a.entity.id?"&orderId="+a.entity.id:"");if(!0!==a._openinFB)return window.location=b,a;jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,
type:"iframe",href:b,beforeClose:function(){a.render()}});return a},_getTaskDetailsPage:function(b){var a,c;a=this;b=b&&b.id?b.id:"new";c="/task/"+b+".html?blanklayout=1";"new"===b&&(c+=a.entity&&a.entity.customer&&a.entity.customer.id?"&customerId="+a.entity.customer.id:"","Order"===a.entityName&&a.entity&&a.entity.id&&(c+="&orderId="+a.entity.id));if(!0!==a._openinFB)return window.location=c,a;jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",
href:c,beforeClose:function(){a.render()}});return a},_getListDiv:function(){var b,a;b=this;a=(new Element("div",{"class":"TaskStatusListPanel alert alert-info"})).setStyle("padding: 8px;").store("data",{entity:b.entity,entityName:b.entityName}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-2"})).setStyle("cursor: pointer").insert({bottom:(new Element("span",{"class":"text-success"})).insert({bottom:new Element("i",{"class":"glyphicon glyphicon-plus-sign"})})}).insert({bottom:" <strong>Tasks:</strong>"}).observe("click",
function(){b._getTaskDetailsPage()})}).insert({bottom:(new Element("div",{"class":"col-sm-10 task-list-wrapper"})).update((new Element("small")).update(b._pageJs.getLoadingImg().removeClassName("fa-5x")))})});b._pageJs._signRandID(a);b._divId=a.id;return a},getDiv:function(b,a){this.entityName=b;this.entity=a;return this._getListDiv()},_formatResult:function(b){var a,c,d,e;a=this;if(!(a._divId&&$(a._divId)&&b&&b.resultData&&b.resultData.items))return a;c={};d=[];b.resultData.items.each(function(a){c[a.status.id]||
(d.push(a.status.id),c[a.status.id]={status:a.status,items:[]});c[a.status.id].items.push(a)});e=new Element("div",{"class":"list-inline order_item item_row"});d.each(function(b){e.insert({bottom:(new Element("li",{order_status:c[b].status.name})).setStyle("padding: 0 4px; margin: 0 10px; cursor: pointer;").insert({bottom:(new Element("small")).update(c[b].status.name+": ")}).insert({bottom:(new Element("strong")).update(c[b].items.size())}).observe("click",function(){c[b].items&&1===c[b].items.size()?
a._getTaskDetailsPage(c[b].items[0]):a._getTaskListPage(c[b].status.id)})})});$(a._divId).down(".task-list-wrapper").update(e);return a},render:function(){var b;b=this;jQuery.getJSON("/ajax/getAll",{entityName:"Task",searchTxt:"fromEntityName = ? and fromEntityId = ? and storeId = ?",searchParams:[b.entityName,b.entity.id,jQuery("#storeId").attr("value")],userId:jQuery("#userId").attr("value")},function(a){b._formatResult(a)});return b}});