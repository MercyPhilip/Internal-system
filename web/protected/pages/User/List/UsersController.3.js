var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_resultDivId:"",_totalUserCountId:"",_pagination:{pageNo:1,pageSize:10},_searchCriteria:"",_roles:[],setResultDiv:function(b){var a={};a.me=this;a.me._resultDivId=b;return a.me},setTotalUserCountDiv:function(a){var b={};b.me=this;b.me._totalUserCountId=a;return b.me},_getEditField:function(c,a){var b={};b.me=this;return new Element("fieldset").insert({bottom:new Element("label").update(c+": ")}).insert({bottom:a})},_showEditPanel:function(b){var a={};a.me=this;jQuery.fancybox({width:"80%",height:"90%",autoScale:false,autoDimensions:false,fitToView:false,autoSize:false,type:"iframe",href:b?"/useraccount/edit/"+b.id+".html":"/useraccount/add.html",beforeClose:function(){if(!$(a.me._resultDivId)){return}if(!$$("iframe.fancybox-iframe").first().contentWindow.pageJs){return}a.userAccount=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._user;if(a.userAccount){a.itemRow=$(a.me._resultDivId).down(".row[useraccount_id="+a.userAccount.id+"]");if(a.itemRow){a.itemRow.replace(a.me._getItemRow(a.userAccount))}else{$(a.me._resultDivId).down(".header").insert({after:a.me._getItemRow(a.userAccount)})}}}});return a.me},deleteUser:function(c,b){var a={};a.me=this;a.me.postAjax(a.me.getCallbackId("deleteUser"),{userId:c.id},{onLoading:function(d,e){if($(b)){$(b).store("originVal",$(b).innerHTML).update("Deleting ...").addClassName("disabled")}},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result){return}a.resultRow=$(a.me._resultDivId).down("[useraccount_id="+a.result.id+"]");if(a.resultRow){a.resultRow.remove()}if($(a.me._totalUserCountId)){$(a.me._totalUserCountId).update($(a.me._totalUserCountId).innerHTML*1-1)}}catch(f){alert(f)}},onComplete:function(d,e){if($(b)){$(b).removeClassName("disabled").update($(b).retrieve("originVal"))}}});return a.me},_getItemRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);b.roles="Roles";b.btnDiv=new Element("div");if(b.isTitle!==true){b.roleNames=[];c.roles.each(function(d){b.roleNames.push(d.name)});b.roles=b.roleNames.join(", ");b.btnDiv.insert({bottom:new Element("span",{"class":"button edit"}).update("Edit").observe("click",function(){b.me._showEditPanel(c)})}).insert({bottom:new Element("span",{"class":"button delete"}).update("Delete").observe("click",function(){if(!confirm("You are trying to delete user: "+c.person.fullname+"\nContinue?")){return}b.me.deleteUser(c,this)})})}b.newDiv=new Element("div",{"class":"row",useraccount_id:c.id}).store("data",c).insert({bottom:new Element("span",{"class":"cell firstName"}).update(c.person.firstName)}).insert({bottom:new Element("span",{"class":"cell lastName"}).update(c.person.lastName)}).insert({bottom:new Element("span",{"class":"cell roles"}).update(b.roles)}).insert({bottom:new Element("span",{"class":"cell username"}).update(c.username)}).insert({bottom:new Element("span",{"class":"cell btns"}).update(b.btnDiv)});return b.newDiv},_getNextPageBtn:function(){var a={};a.me=this;return new Element("div",{"class":"pagination"}).insert({bottom:new Element("span",{"class":"button"}).update("Show More").observe("click",function(){a.me._pagination.pageNo=a.me._pagination.pageNo*1+1;$(this).store("originVal",$(this).innerHTML).update("Fetching more results ...").addClassName("disabled");a.me.getUsers(this)})})},getUsers:function(b,c){var a={};a.me=this;a.btn=(b||null);a.reset=(c||false);a.resultDiv=$(a.me._resultDivId);a.me.postAjax(a.me.getCallbackId("getUsers"),{searchCriteria:a.me._searchCriteria,pagination:a.me._pagination},{onLoading:function(d,e){if(a.reset===true){if(a.resultDiv){a.resultDiv.update("")}if($(a.me._totalUserCountId)){$(a.me._totalUserCountId).update(0)}}},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result){return}if($(a.me._totalUserCountId)){$(a.me._totalUserCountId).update(a.result.pageStats.totalRows)}if(a.resultDiv){if(a.reset===true){a.resultDiv.update(a.me._getItemRow({person:{firstName:"First Name",lastName:"Last Name"},username:"Username"},true).addClassName("header"))}a.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()});a.result.items.each(function(e){a.resultDiv.insert({bottom:a.me._getItemRow(e)})});if(a.result.pageStats.pageNumber<a.result.pageStats.totalPages){a.resultDiv.insert({bottom:a.me._getNextPageBtn().addClassName("paginWrapper")})}}}catch(f){alert(f)}},onComplete:function(d,e){if($(a.btn)){$(a.btn).removeClassName("disabled").update($(a.btn).retrieve("originVal"))}}});return a.me}});