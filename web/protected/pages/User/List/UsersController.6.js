var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_resultDivId:"",_totalUserCountId:"",_pagination:{pageNo:1,pageSize:10},_searchCriteria:"",_roles:[],setResultDiv:function(e){var t={};return t.me=this,t.me._resultDivId=e,t.me},setTotalUserCountDiv:function(e){var t={};return t.me=this,t.me._totalUserCountId=e,t.me},_getEditField:function(e,t){return{}.me=this,new Element("fieldset").insert({bottom:new Element("label").update(e+": ")}).insert({bottom:t})},_showEditPanel:function(e){var t={};return t.me=this,jQuery.fancybox({width:"80%",height:"90%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:e?"/useraccount/edit/"+e.id+".html":"/useraccount/add.html",beforeClose:function(){$(t.me._resultDivId)&&$$("iframe.fancybox-iframe").first().contentWindow.pageJs&&(t.userAccount=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._user,t.userAccount&&(t.itemRow=$(t.me._resultDivId).down(".useraccount_item[useraccount_id="+t.userAccount.id+"]"),t.itemRow?t.itemRow.replace(t.me._getItemRow(t.userAccount)):$(t.me._resultDivId).down(".header").insert({after:t.me._getItemRow(t.userAccount)})))}}),t.me},deleteUser:function(e,t){var n={};return n.me=this,n.me.postAjax(n.me.getCallbackId("deleteUser"),{userId:e.id},{onLoading:function(e,n){$(t)&&jQuery("#"+t.id).button("loading")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;n.resultRow=$(n.me._resultDivId).down("[useraccount_id="+n.result.id+"]"),n.resultRow&&n.resultRow.remove(),$(n.me._totalUserCountId)&&$(n.me._totalUserCountId).update(1*$(n.me._totalUserCountId).innerHTML-1)}catch(e){alert(e)}},onComplete:function(e,n){jQuery("#"+t.id).button("reset")}}),n.me},_getItemRow:function(e,t){var n={};return n.me=this,n.isTitle=t||!1,n.roles="Roles",n.btnDiv=new Element("div",{class:"btn-group"}),!0!==n.isTitle&&(n.roleNames=[],e.roles.each(function(e){n.roleNames.push(e.name)}),n.roles=n.roleNames.join(", "),n.btnDiv.insert({bottom:new Element("span",{id:"edit_btn_"+e.id,class:"btn btn-default edit","data-loading-text":"Loading..."}).update(new Element("span",{class:"glyphicon glyphicon-pencil",title:"Edit this user"})).observe("click",function(){n.me._showEditPanel(e)})}).insert({bottom:new Element("span",{id:"del_btn_"+e.id,class:"btn btn-danger delete","data-loading-text":"Processing..."}).update(new Element("span",{class:"glyphicon glyphicon-trash",title:"Delete this user"})).observe("click",function(){confirm("You are trying to delete user: "+e.person.fullname+"\nContinue?")&&n.me.deleteUser(e,this)})})),n.newDiv=new Element("div",{class:"useraccount_item list-group-item "+(!0===n.isTitle?"disabled header":""),useraccount_id:e.id}).store("data",e).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-2 firstName"}).update(e.person.firstName)}).insert({bottom:new Element("div",{class:"col-xs-2 lastName"}).update(e.person.lastName)}).insert({bottom:new Element("div",{class:"col-xs-2 roles"}).update(n.roles)}).insert({bottom:new Element("div",{class:"col-xs-2 username"}).update(e.username)}).insert({bottom:new Element("div",{class:"col-xs-2 email"}).update(e.email)}).insert({bottom:new Element("div",{class:"col-xs-2 btns"}).update(n.btnDiv)})}),n.newDiv},_getNextPageBtn:function(){var e={};return e.me=this,new Element("div",{class:"pagination"}).insert({bottom:new Element("span",{class:"button"}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,$(this).store("originVal",$(this).innerHTML).update("Fetching more results ...").addClassName("disabled"),e.me.getUsers(this)})})},getUsers:function(e,t){var n={};return n.me=this,n.btn=e||null,n.reset=t||!1,n.resultDiv=$(n.me._resultDivId),n.me.postAjax(n.me.getCallbackId("getUsers"),{searchCriteria:n.me._searchCriteria,pagination:n.me._pagination},{onLoading:function(e,t){!0===n.reset&&(n.resultDiv&&n.resultDiv.update(""),$(n.me._totalUserCountId)&&$(n.me._totalUserCountId).update(0)),n.btn&&jQuery(n.btn.id).button("loading")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;$(n.me._totalUserCountId)&&$(n.me._totalUserCountId).update(n.result.pageStats.totalRows),n.resultDiv&&(!0===n.reset&&n.resultDiv.update(n.me._getItemRow({person:{firstName:"First Name",lastName:"Last Name"},username:"Username",email:"Email"},!0).addClassName("header")),n.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),n.result.items.each(function(e){n.resultDiv.insert({bottom:n.me._getItemRow(e)})}),n.result.pageStats.pageNumber<n.result.pageStats.totalPages&&n.resultDiv.insert({bottom:n.me._getNextPageBtn().addClassName("paginWrapper")}))}catch(e){n.resultDiv.up(".panel").down(".panel-body").insert({bottom:n.me.getAlertBox("Error:",e).addClassName("alert-danger")})}},onComplete:function(e,t){n.btn&&jQuery(n.btn.id).button("reset")}}),n.me}});