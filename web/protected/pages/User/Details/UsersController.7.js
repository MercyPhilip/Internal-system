var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_user:null,_roles:[],_savePanelId:"",_editUrl:"",setHtmlIDs:function(e){return this._savePanelId=e,this},setEditUrl:function(e){return this._editUrl=e,this},_getFieldDiv:function(e,t){return new Element("div",{class:"form-group"}).insert({bottom:new Element("label",{class:"col-sm-2 control-label"}).update(e)}).insert({bottom:t.addClassName("form-control").wrap(new Element("div",{class:"col-sm-10"}))})},_getRoleSelBox:function(){var e={};return e.me=this,e.oldRoleIds=[],e.me._user&&e.me._user.roles.each(function(t){e.oldRoleIds.push(t.id)}),e.selBox=new Element("select"),e.me._roles.each(function(t){e.opt=new Element("option",{value:t.id}).update(t.name),e.oldRoleIds.indexOf(t.id)>=0&&e.opt.writeAttribute("selected",!0),e.selBox.insert({bottom:e.opt})}),e.selBox},_chkPassword:function(e,t){var a={};return a.me=this,$$(".errorMsgDiv.passNotMatch").each(function(e){e.remove()}),a.isSame=$F(e)===$F(t),a.isSame||$(t).insert({after:new Element("div",{class:"passNotMatch msgDiv errorMsgDiv"}).update(new Element("div",{class:"msg"}).update("Password do NOT match!"))}),a.isSame},_collectData:function(e){var t={};return t.me=this,t.data={userid:t.me._user?t.me._user.id:""},t.savePanel=$(t.me._savePanelId),t.savePanel.getElementsBySelector(".msgDiv").each(function(e){e.remove()}),t.hasError=!1,t.savePanel&&(t.hasError=!t.me._chkPassword(t.savePanel.down("[password=new]"),t.savePanel.down("[password=confirm]")),t.savePanel.getElementsBySelector("[save_panel]").each(function(e){t.fieldName=$(e).readAttribute("save_panel"),t.isMand=$(e).readAttribute("mandatory"),t.isMand=!(!t.isMand||1*t.isMand!=1),!0===t.isMand&&$F(e).blank()&&($(e).insert({after:new Element("div",{class:"msgDiv errorMsgDiv"}).update(new Element("div",{class:"msg"}).update(t.fieldName+" is mandatory!"))}),t.hasError=!0),t.data[t.fieldName]=$F(e)})),!0===t.hasError?null:t.data},_saveUser:function(e){var t={};return t.me=this,t.data=t.me._collectData(e),null===t.data?t.me:(t.me.postAjax(t.me.getCallbackId("saveUser"),t.data,{onLoading:function(){jQuery("#"+e.id).button("loading")},onSuccess:function(a,s){try{if(t.result=t.me.getResp(s,!1,!0),!t.result)return;alert("User Saved Successfully"),window.location=t.me._editUrl.replace("{uid}",t.result.id)}catch(a){$(e).insert({before:t.me.getAlertBox("Error:",a).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),t.me)},_getSavePanel:function(){var e={};return e.me=this,e.firstName=e.me._user?e.me._user.person.firstName:"",e.lastName=e.me._user?e.me._user.person.lastName:"",e.username=e.me._user?e.me._user.username:"",e.email=e.me._user?e.me._user.email:"",e.newPanel=new Element("div",{class:"form-horizontal change_form",role:"form"}).insert({bottom:e.me._getFieldDiv("First Name:",new Element("input",{type:"text",save_panel:"firstName",value:e.firstName,mandatory:1}))}).insert({bottom:e.me._getFieldDiv("Last Name:",new Element("input",{type:"text",save_panel:"lastName",value:e.lastName,mandatory:1}))}).insert({bottom:e.me._getFieldDiv("Role:",e.me._getRoleSelBox().writeAttribute("save_panel","roleid").writeAttribute("mandatory",!0))}).insert({bottom:e.me._getFieldDiv("Username:",new Element("input",{type:"text",save_panel:"userName",value:e.username,mandatory:1}))}).insert({bottom:e.me._getFieldDiv("New Password:",new Element("input",{type:"password",save_panel:"newpassword",password:"new",value:"",mandatory:e.me._user?0:1}).observe("change",function(){e.me._chkPassword(this,$(this).up(".change_form").down("[password=confirm]"))}))}).insert({bottom:e.me._getFieldDiv("Confirm Password:",new Element("input",{type:"password",password:"confirm",value:""}).observe("change",function(){e.me._chkPassword($(this).up(".change_form").down("[password=new]"),this)}))}).insert({bottom:e.me._getFieldDiv("Email:",new Element("input",{type:"text",save_panel:"email",value:e.email,mandatory:1}))}).insert({bottom:new Element("div",{class:"form-group"}).insert({bottom:new Element("div",{class:"col-sm-offset-2 col-sm-10"}).insert({bottom:new Element("span",{id:"saveBtn",class:"btn btn-success","data-loading-text":"Saving..."}).update("Save").observe("click",function(){e.me._saveUser(this)})})})}),e.newPanel},load:function(e,t){var a={};return a.me=this,a.me._user=e,a.me._roles=t,$(a.me._savePanelId)&&$(a.me._savePanelId).update(a.me._getSavePanel()),a.me}});