var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_htmlIds:{},setHTMLIDs:function(a,d,c,b){this._htmlIds.itemDiv=a;this._htmlIds.searchPanel=d;this._htmlIds.productsTable=c;this._htmlIds.barcodeInput=b;return this},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.stockOnPOEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnPO",placeholder:"Stock On PO",type:"value",value:b.product.stockOnPO?b.product.stockOnPO:0})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".product-head-row").down('[save-item="stockOnHand"]').select()})}).observe("click",function(d){$(this).down("input").select()});c.stockOnHandEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnHand",placeholder:"Stock On Hand",type:"value",value:b.product.stockOnHand?b.product.stockOnHand:0})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".item_row").down('[save-item="stockOnOrder"]').select()})}).observe("click",function(d){$(this).down("input").select()});c.stockOnOrderEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnOrder",placeholder:"Stock On Order",type:"value",value:b.product.stockOnOrder?b.product.stockOnOrder:0})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".item_row").down('[save-item="stockInRMA"]').select()})}).observe("click",function(d){$(this).down("input").select()});c.stockInRMAEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockInRMA",placeholder:"Stock In RMA",type:"value",value:b.product.stockInRMA?b.product.stockInRMA:0})}).observe("click",function(d){$(this).down("input").select()});c.row=new Element((c.isTitle===true?"strong":"div"),{"class":"item_row list-group-item"}).store("data",b.product).insert({bottom:c.infoRow=new Element("div",{"class":c.isTitle?"row btn-hide-row":"row btn-hide-row product-head-row"}).insert({bottom:new Element("span",{"class":" col-sm-5 productName"}).insert({bottom:b.product.name?b.product.name:b.product.barcode})}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnPO"}).update(b.product.id?c.stockOnPOEl:b.product.stockOnPO)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnHand"}).update(b.product.id?c.stockOnHandEl:b.product.stockOnHand)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnOrder"}).update(b.product.id?c.stockOnOrderEl:b.product.stockOnOrder)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockInRMA"}).update(b.product.id?c.stockInRMAEl:b.product.stockInRMA)}).insert({bottom:c.btns=new Element("span",{"class":"btns col-sm-1"}).update(b.btns?b.btns:"")})});c.infoRow.insert({top:new Element("span",{"class":"col-sm-2 productSku"}).update(b.product.sku?b.product.sku:"")});c.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-10 col-sm-offset-2"}).update(b.scanTable)})});return c.row},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},btns:""};a.newRow=a.me._getProductRow(a.data,false).addClassName("new-order-item-input list-group-item-warning").removeClassName("order-item-row btn-hide-row");return a.newRow},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{id:a.me._htmlIds.barcodeInput,"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"Enter BARCODE for products"}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()});a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9);return false})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a.me._searchProduct(this)})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},_searchProduct:function(b){var a={};a.me=this;a.btn=b;a.me._signRandID(a.btn);a.searchTxtBox=$(a.btn).up(".product-autocomplete").down(".search-txt");a.searchTxt=$F(a.searchTxtBox);if(!a.searchTxt){return}a.currentRow=$(b).up(".new-order-item-input");a.product={name:"",id:"",qty:0,barcode:a.searchTxt};a.data={product:a.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(c){Event.stop(c);if(!confirm("You are about to remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.row.remove()})})};a.currentRow.insert({after:a.lastRow=new Element("div")});a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow);a.inputBox=jQuery("#"+a.me._htmlIds.barcodeInput);a.me.postAjax(a.me.getCallbackId("searchProduct"),{searchTxt:a.searchTxt},{onLoading:function(){jQuery("#"+a.me._htmlIds.barcodeInput).button("loading");a.lastRow.hide()},onSuccess:function(c,f){a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.items||a.result.items.size()===0){a.ModalBoxBody=new Element("div").insert({bottom:new Element("span").update("You are searching for <b>"+a.searchTxt+"</b>")}).insert({bottom:new Element("span",{"class":"btn btn-success btn-md pull-right"}).update("OK").observe("click",function(){a.me.hideModalBox();$(a.me._htmlIds.barcodeInput).focus()})});a.me.showModalBox("Product no found!",a.ModalBoxBody,false);a.lastRow.remove()}a.lastRow.show();if(a.result.items.size()>1){a.searchTxtBox=a.newRow.down(".search-txt");a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;","class":"selectProductPanel"});a.result.items.each(function(e){a.resultList.insert({bottom:a.me._getSearchPrductResultRow(e,a.searchTxtBox,a.lastRow,a.newRow)})});a.resultList.addClassName("list-group");a.me.showModalBox("Products that has: "+a.searchTxt,a.resultList,false)}else{a.data.product=a.result.items[0];if(!a.me._checkProductExist(a.data.product)){a.me._selectProduct(a.data.product,a.lastRow)}else{a.me.showModalBox("Product "+a.data.product.name+" already in the list!","<b>SKU</b>: "+a.data.product.sku+", <b>Name</b>: "+a.data.product.name,false)}$(a.me._htmlIds.barcodeInput).focus()}}catch(d){a.resultList.update(a.me.getAlertBox("Error: ",d).addClassName("alert-danger"))}},onComplete:function(c,d){jQuery("#"+a.me._htmlIds.barcodeInput).button("reset")}});return a.me},_checkProductExist:function(b){var a={};a.me=this;a.ifExist=false;$(a.me._htmlIds.productsTable).select(".item_row:not(.item-title-row, .new-order-item-input)").each(function(c){if(!a.ifExist&&c.retrieve("data").id===b.id){a.ifExist=true}});return a.ifExist},_selectProduct:function(c,b){var a={};a.me=this;a.data=[];a.product=c;a.lastRow=b;a.btn=$("barcode_input");a.me._signRandID(a.btn);a.data={product:a.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(d){Event.stop(d);if(!confirm("You are about to remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.row.remove()})}),qty:0};a.lastRow.replace(a.newRow=a.me._getProductRow(a.data,false));return a.me},_getSearchPrductResultRow:function(e,d,c,a){var b={};b.me=this;b.lastRow=c;b.newRow=a;b.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";b.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:e.images.size()===0?b.defaultImgSrc:e.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(e.name).insert({bottom:new Element("small",{"class":"",style:"padding-left: 10px;"}).update("SKU: "+e.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(e.shortDescription)})})})})}).observe("click",function(){b.inputRow=$(d).up(".new-order-item-input").store("product",e);if(!b.me._checkProductExist(e)){b.me._selectProduct(e,b.lastRow);jQuery("#"+b.me.modalId).modal("hide");$(b.me._htmlIds.barcodeInput).focus()}else{jQuery("#"+b.me.modalId).modal("hide");b.me.showModalBox("Product "+e.name+" already in the list!","<b>SKU</b>: "+e.sku+", <b>Name</b>: "+e.name,false)}});return b.newRow},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("span",{"class":"btn-group pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){a.me._submitQuantities($(this))})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling this Quantity adjustment</strong>','<div>You are about to cancel this quantity adjustment process, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})});return a.newDiv},_submitQuantities:function(b){var a={};a.me=this;a.btn=b;a.data=a.me._collectFormData($(a.me._htmlIds.itemDiv),"save-order");a.data.products=[];$(a.me._htmlIds.productsTable).getElementsBySelector("div.item_row").each(function(c){a.product=c.retrieve("data");a.formData=a.me._collectFormData(c,"save-item");if(a.product.id!==undefined){a.product.stockOnPO=a.formData.stockOnPO;a.product.stockOnHand=a.formData.stockOnHand;a.product.stockOnOrder=a.formData.stockOnOrder;a.product.stockInRMA=a.formData.stockInRMA;a.data.products.push(a.product)}});if(a.data===null){return a.me}if(!a.data.products.length){a.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one item is needed!",true);return a.me}a.me._signRandID(a.btn);a.me.postAjax(a.me.getCallbackId("saveQuantities"),a.data,{onLoading:function(c,d){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.item){return}if(a.result.item.status==="RECEIVING"){a.me.showModalBox('<strong class="text-success">Success!</strong>','<div>The current receiving process is succussed and saved.</div><br /><div><strong>There are more to go, Another One?</strong></div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)}else{a.me.showModalBox('<strong class="text-success">Success!</strong>',"<h3>Saved successfully</h3>",true);window.location=document.URL}}catch(d){a.me.showModalBox("Error!",d,false)}},onComplete:function(c,d){jQuery("#"+a.btn.id).button("reset")}});return a.me},_getProductsTable:function(){var a={};a.me=this;a.productListDiv=new Element("div",{"class":"list-group",id:a.me._htmlIds.productsTable}).insert({bottom:a.newDiv=a.me._getProductRow({product:{sku:"SKU",name:"Product Name",stockOnPO:"PO",stockOnHand:"Hand",stockOnOrder:"Order",stockInRMA:"RMA"}},true).addClassName("item-title-row")});a.newDiv.setStyle({cursor:"pointer"});a.productListDiv.insert({bottom:a.me._getNewProductRow()});return new Element("div",{"class":"panel panel-warning"}).insert({bottom:a.productListDiv})},init:function(){var a={};a.me=this;$(a.me._htmlIds.itemDiv).insert({bottom:a.me._getProductsTable()}).insert({bottom:new Element("div",{"class":"row",style:"padding: 0 15px"}).insert({bottom:new Element("div",{"class":"col-sm-2 pull-right"}).update(a.me._saveBtns())})});$(a.me._htmlIds.itemDiv).down("#"+a.me._htmlIds.barcodeInput).focus()}});