var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_htmlIds:{itemDiv:"",searchPanel:"",paymentPanel:"",supplierInfoPanel:"",partsTable:"",barcodeInput:""},_purchaseOrder:null,setHTMLIDs:function(c,f,b,e,d,a){this._htmlIds.itemDiv=c;this._htmlIds.searchPanel=f;this._htmlIds.paymentPanel=b;this._htmlIds.supplierInfoPanel=e;this._htmlIds.partsTable=d;this._htmlIds.barcodeInput=a;return this},_getPOListPanel:function(){var a={};a.me=this;a.newDiv=new Element("div",{id:a.me._htmlIds.searchPanel,"class":"panel panel-warning search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Searching for PO: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{required:true,"class":"form-control search-txt init-focus",placeholder:"any of PO number, Supplier, Supplier Ref Number ..."}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){if(a.txtBox.hasClassName("search-finished")&&$(pageJs._htmlIds.searchPanel).getElementsBySelector(".item_row .btn").size()===1){$(pageJs._htmlIds.searchPanel).down(".item_row .btn").click()}else{$(a.me._htmlIds.searchPanel).down(".search-btn").click();a.txtBox.addClassName("search-finished")}},function(){$(a.txtBox).removeClassName("search-finished")});return false})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){a.btn=this;if($(a.me._htmlIds.searchPanel).down(".search-txt").value!==""){a.me._searchPO($(a.me._htmlIds.searchPanel).down(".search-txt"))}})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm btn-danger"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){$(a.me._htmlIds.searchPanel).down(".search-txt").clear();a.me._searchPO($(a.me._htmlIds.searchPanel).down(".search-txt"))})})});return a.newDiv},_searchPO:function(a){var b={};b.me=this;b.searchTxt=$F(a).strip();b.searchPanel=$(a).up("#"+b.me._htmlIds.searchPanel);b.me.postAjax(b.me.getCallbackId("searchPO"),{searchTxt:b.searchTxt},{onLoading:function(){if($(b.searchPanel).down(".list-div")){$(b.searchPanel).down(".list-div").remove()}$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getLoadingImg())})},onSuccess:function(c,f){$(b.searchPanel).down(".panel-body").remove();try{b.result=b.me.getResp(f,false,true);if(!b.result||!b.result.items){return}$(b.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:b.me._getPORow({purchaseOrderNo:"PO Number",supplier:{name:"Supplier"},supplierRefNo:"Supplier Ref",orderDate:"Order Date",totalAmount:"Total Amount",totalProdcutCount:"Total Prodcut Count",status:"Status",active:"Active?"},true)})}).insert({bottom:b.listDiv=new Element("tbody")})})});b.result.items.each(function(e){b.listDiv.insert({bottom:b.me._getPORow(e)})})}catch(d){$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getAlertBox("ERROR",d).addClassName("alert-danger"))})}}});return b.me},_getPORow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.tag=(c.isTitle===true?"th":"td");c.newDiv=new Element("tr",{"class":(c.isTitle===true?"item_top_row":"item_row")+(b.active==0?" danger":""),item_id:(c.isTitle===true?"":b.id)}).insert({bottom:new Element(c.tag).insert({bottom:(c.isTitle===true?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){c.me.selectPO(b)}))})}).insert({bottom:new Element(c.tag).update(b.purchaseOrderNo)}).insert({bottom:new Element(c.tag).update(b.supplier.name)}).insert({bottom:new Element(c.tag).update(b.supplierRefNo)}).insert({bottom:new Element(c.tag).update(b.orderDate)}).insert({bottom:new Element(c.tag).update(b.totalAmount)}).insert({bottom:new Element(c.tag).update(b.totalProdcutCount)}).insert({bottom:new Element(c.tag).update(b.status)}).insert({bottom:new Element(c.tag).insert({bottom:(c.isTitle===true?b.active:new Element("input",{type:"checkbox",disabled:true,checked:b.active}))})});return c.newDiv},selectPO:function(a){var b={};b.me=this;b.me._purchaseOrder=a;b.newDiv=b.me._getViewOfPurchaseOrder();$(b.me._htmlIds.itemDiv).update(b.newDiv).down("[new-order-item=product]").focus();b.me._purchaseOrder.purchaseOrderItem.each(function(c){b.currentRow=$$(".new-order-item-input").first();b.product={name:"",id:"",qty:0,barcode:""};b.data={product:b.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(d){Event.stop(d);if(!confirm("You are about to remove this entry.\n\nContinue?")){return}b.row=$(this).up(".item_row");b.row.remove()})})};b.currentRow.insert({after:b.lastRow=b.me._getProductRow(b.data,false)});b.product=c.product;b.product.purchaseOrderItem=c.purchaseOrderItem;b.me._selectProduct(b.product,b.lastRow)});return b.me},_getViewOfPurchaseOrder:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-9"}).update(a.me._getSupplierInfoPanel())}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getPaymentPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getPartsTable())})}).insert({bottom:new Element("div",{"class":"row",style:"padding: 0 15px"}).insert({bottom:new Element("div",{"class":"col-sm-1"}).insert({bottom:new Element("label",{"class":"control-label"}).update("Comment: ")})}).insert({bottom:new Element("div",{"class":"col-sm-9"}).insert({bottom:new Element("textarea",{"save-order":"comments",style:"height:33px; width: 100%;"})})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).update(a.me._saveBtns())})});return a.newDiv},_getSupplierInfoPanel:function(){var a={};a.me=this;a.purchaseOrder=a.me._purchaseOrder;a.supplier=a.purchaseOrder.supplier;a.newDiv=new Element("div",{"class":"panel panel-warning",id:a.me._htmlIds.supplierInfoPanel}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-8"}).insert({bottom:new Element("span").update("Receiving items for PO: ").insert({bottom:new Element("strong").update(a.purchaseOrder.purchaseOrderNo+" ")})})}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).insert({bottom:new Element("span").update("Status: ")}).insert({bottom:new Element("strong").update(a.me._purchaseOrder.status)})})})}).insert({bottom:new Element("div",{"class":"panel-body",style:"padding: 0 10px"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Supplier Name:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.supplier.name?a.supplier.name:"")})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Contact Name:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.purchaseOrder.supplierContact?a.purchaseOrder.supplierContact:a.supplier.contactName)})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Contact Number:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.purchaseOrder.supplierContactNumber?a.purchaseOrder.supplierContactNumber:a.supplier.supplierContactNumber)})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Contact Email:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.supplier.email)})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Order Date:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.me._purchaseOrder.orderDate?a.me.loadUTCTime(a.me._purchaseOrder.orderDate).toLocaleString():"")})}).insert({bottom:new Element("div",{"class":"col-sm-3"}).insert({bottom:new Element("strong").update("Supplier Ref Number:")}).insert({bottom:new Element("div",{style:"padding: 2px 8px"}).update(a.purchaseOrder.supplierRefNo)})})})});return a.newDiv},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},_getPaymentPanel:function(){var a={};a.me=this;a.purchaseOrder=a.me._purchaseOrder;a.supplier=a.purchaseOrder.supplier;a.shippingCostEl=new Element("input",{disabled:true,"class":"text-right",value:a.purchaseOrder.shippingCost?a.purchaseOrder.shippingCost:0});a.handlingCostEl=new Element("input",{disabled:true,"class":"text-right",value:a.purchaseOrder.handlingCost?a.purchaseOrder.handlingCost:0});a.totalAmountExGstEl=new Element("input",{disabled:true,"class":"text-right",value:a.purchaseOrder.totalAmount?a.purchaseOrder.totalAmount:0});a.totalPaidEl=new Element("input",{disabled:true,"class":"text-right",value:a.purchaseOrder.totalPaid?a.purchaseOrder.totalPaid:0});a.totalAmount=(a.purchaseOrder.totalAmount?a.purchaseOrder.totalAmount:0);a.totalPaid=(a.purchaseOrder.totalPaid?a.purchaseOrder.totalPaid:0);a.totalDue=a.totalAmount*1-a.totalPaid*1;a.newDiv=new Element("div",{"class":"panel panel-warning",id:a.me._htmlIds.paymentPanel}).insert({bottom:new Element("div",{"class":"panel-heading text-right"}).insert({bottom:new Element("div").insert({bottom:new Element("strong").update("Payment Due: ")}).insert({bottom:new Element("span",{"class":"badge"}).update(a.me.getCurrency(a.totalDue))})})}).insert({bottom:new Element("div",{"class":"panel-body",style:"padding: 0 10px"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-7 text-right"}).update(new Element("strong").update("Total Inc GST:"))}).insert({bottom:new Element("div",{"class":"col-xs-5"}).update(a.me.getCurrency(a.totalAmount))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-7 text-right"}).update(new Element("strong").update("Total Paid:"))}).insert({bottom:new Element("div",{"class":"col-xs-5"}).update(a.me.getCurrency(a.totalPaid))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-7 text-right"}).update(new Element("strong").update("Total Due:"))}).insert({bottom:new Element("div",{"class":"col-xs-5"}).update(a.me.getCurrency(a.totalDue))})})});return a.newDiv},_getPartsTable:function(){var a={};a.me=this;a.productListDiv=new Element("div",{"class":"list-group",id:a.me._htmlIds.partsTable}).insert({bottom:a.newDiv=a.me._getProductRow({product:{sku:"SKU",name:"Product Name",qty:"Qty",EANcode:"EAN code",UPCcode:"UPC code",wareLocation:"Warehouse Location"}},true)});a.newDiv.setStyle({cursor:"pointer"});a.newDiv.observe("dblclick",function(b){a.allClosed=true;$$(".row.product-content-row").each(function(c){if(c.visible()){a.allClosed=false}});if(a.allClosed){$$(".row.product-content-row").each(function(c){c.show()})}else{$$(".row.product-content-row").each(function(c){c.hide()})}return false});a.productListDiv.insert({bottom:a.newDiv=a.me._getNewProductRow()});return new Element("div",{"class":"panel panel-warning"}).insert({bottom:a.productListDiv})},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.EANcodeEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"EANcode",placeholder:"EAN code",type:"text",value:b.product.codes?(b.product.codes.EAN?b.product.codes.EAN:""):""})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".product-head-row").down('[save-item="UPCcode"]').select()})}).observe("change",function(d){c.txtBox=$(this);c.rowData=c.txtBox.up(".item_row.list-group-item").retrieve("data");c.rowData.EANcode=$F(c.txtBox.down("[save-item]"));if(c.rowData.EANcode){c.txtBox.up(".item_row.list-group-item").store("data",c.rowData)}}).observe("click",function(d){Event.stop(d);$(this).select()});c.UPCcodeEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"UPCcode",placeholder:"UPC code",type:"text",value:b.product.codes?(b.product.codes.UPC?b.product.codes.UPC:""):""})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".item_row").down('[save-item="wareLocation"]').select()})}).observe("change",function(d){c.txtBox=$(this);c.rowData=c.txtBox.up(".item_row.list-group-item").retrieve("data");c.rowData.UPCcode=$F(c.txtBox.down("[save-item]"));if(c.rowData.UPCcode){c.txtBox.up(".item_row.list-group-item").store("data",c.rowData)}}).observe("click",function(d){Event.stop(d);$(this).select()});c.wareLocationEL=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"wareLocation",placeholder:"Warehouse Location",type:"text",value:b.product.locations?(b.product.warehouseLocation?b.product.warehouseLocation:""):""})}).observe("keydown",function(d){c.txtBox=$(this);c.me.keydown(d,function(){c.txtBox.up(".item_row").down('[scanned-item="serialNo"]').select()})}).observe("change",function(d){c.txtBox=$(this);c.rowData=c.txtBox.up(".item_row.list-group-item").retrieve("data");c.rowData.warehouseLocation=$F(c.txtBox.down("[save-item]"));if(c.rowData.UPCcode){c.txtBox.up(".item_row.list-group-item").store("data",c.rowData)}}).observe("click",function(d){Event.stop(d);$(this).select()});if(c.me._canReceive()!==true){c.EANcodeEl.down("input[save-item=EANcode]").disabled=true;c.UPCcodeEl.down("input[save-item=UPCcode]").disabled=true;c.wareLocationEL.down("input[save-item=wareLocation]").disabled=true;b.btns=""}c.row=new Element((c.isTitle===true?"strong":"div"),{"class":"item_row list-group-item"}).store("data",b.product).insert({bottom:c.infoRow=new Element("div",{"class":c.isTitle?"row btn-hide-row":"row btn-hide-row product-head-row"}).insert({bottom:new Element("span",{"class":" col-sm-2 productName"}).insert({bottom:b.product.name?b.product.name:b.product.barcode})}).insert({bottom:new Element("span",{"class":"col-sm-1"}).insert({bottom:new Element("span",{"class":"scannedQty"}).update(c.isTitle===true?"Qty":(!b.product.id?"":(b.product.purchaseOrderItem?b.product.purchaseOrderItem.receivedQty:0)))}).insert({bottom:new Element("span",{"class":"orderedQty"}).update(b.product.purchaseOrderItem?"/"+b.product.purchaseOrderItem.qty:"")})}).insert({bottom:new Element("span",{"class":" col-sm-2 EANcode"}).update(b.product.id?c.EANcodeEl:b.product.EANcode)}).insert({bottom:new Element("span",{"class":" col-sm-2 UPCcode"}).update(b.product.id?c.UPCcodeEl:b.product.UPCcode)}).insert({bottom:new Element("span",{"class":" col-sm-2 wareLocation"}).update(b.product.id?c.wareLocationEL:b.product.wareLocation)}).insert({bottom:c.btns=new Element("span",{"class":"btns col-sm-1"}).update(b.btns?b.btns:"")})});c.infoRow.insert({top:new Element("span",{"class":"col-sm-2 productSku"}).update(b.product.sku?b.product.sku:"")});if(b.scanTable&&c.me._canReceive()===true){c.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-10 col-sm-offset-2"}).update(b.scanTable)})})}return c.row},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},btns:""};a.newRow=a.me._getProductRow(a.data,false).addClassName("new-order-item-input list-group-item-warning").removeClassName("order-item-row btn-hide-row");if(a.me._canReceive()!==true){a.newRow.hide()}return a.newRow},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{id:a.me._htmlIds.barcodeInput,"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"Enter BARCODE for products"}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()});a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9);return false})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a.me._searchProduct(this)})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_getScanTableROW:function(c,a){var b={};b.me=this;b.tag=a===true?"th":"td";b.newDiv=new Element("tr",{"class":a===true?"":"scanned-item-row"}).store("data",c).insert({bottom:new Element(b.tag,{"class":"col-sm-1"}).update(c.qty?c.qty:"")}).insert({bottom:new Element(b.tag).update(c.serialNo?c.serialNo:"")}).insert({bottom:new Element(b.tag).update(c.unitPrice?c.unitPrice:"")}).insert({bottom:new Element(b.tag).update(c.invoiceNo?c.invoiceNo:"")}).insert({bottom:new Element(b.tag).update(c.comments?c.comments:"")}).insert({bottom:new Element(b.tag,{"class":"btns"}).update(c.btns?c.btns:"")});return b.newDiv},_getScanTable:function(b){var a={};a.me=this;a.table=new Element("table",{"class":"table scanTable"}).insert({bottom:new Element("thead").update(a.me._getScanTableROW({qty:"Qty",serialNo:"Serial No.",unitPrice:"Unit Price (Ex)",invoiceNo:"Inv. No.",comments:"Comments",btns:""},true))}).insert({bottom:new Element("tbody").insert({bottom:a.me._getScanTableROW({qty:a.me._getFormGroup("",new Element("input",{"class":"form-control","scanned-item":"qty",type:"text",placeholder:"How many you received.",required:true,value:1}).observe("change",function(){a.serialNoBox=$(this).up(".scanned-item-row").down("[scanned-item=serialNo]");if($F(this)>1){a.serialNoBox.setValue("No S/N, as qty > 1").disabled=true}else{a.serialNoBox.setValue("").disabled=false;a.serialNoBox.select()}})),serialNo:a.me._getFormGroup("",new Element("input",{"class":"form-control","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:",required:true})),unitPrice:a.me._getFormGroup("",new Element("input",{"class":"form-control","scanned-item":"unitPrice",type:"value",placeholder:"Unit Price:",validate_currency:"Invalid currency",value:b.purchaseOrderItem?a.me.getValueFromCurrency(a.me.getCurrency(b.purchaseOrderItem.unitPrice)):""})),invoiceNo:a.me._getFormGroup("",new Element("input",{"class":"form-control","scanned-item":"invoiceNo",type:"text",placeholder:"Inv. No.:"})),comments:a.me._getFormGroup("",new Element("input",{"class":"form-control","scanned-item":"comments",type:"text",placeholder:"Comments:"})),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"scanned-item-save-btn btn btn-primary"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-saved"})}).observe("click",function(){a.currentRow=$(this).up(".scanned-item-row");a.data=a.me._collectFormData(a.currentRow,"scanned-item");if(a.data!==null){a.newRow=a.currentRow.clone(true);a.newDeleteBtn=new Element("td").insert({bottom:new Element("span",{"class":"scanned-item-delte-btn btn btn-danger btn-xs pull-right"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(c){if(!confirm("You are about to remove this entry.\n\nContinue?")){return}$(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML--;if($(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML>b.purchaseOrderItem.qty||!$(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML){$(this).up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"})}else{$(this).up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"inherit"})}if($(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML==0){$(this).up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"})}$(this).up(".scanned-item-row").remove()})});a.newRow.removeClassName("warning new-scan-row").addClassName("btn-hide-row");a.newRow.down(".scanned-item-save-btn").remove();a.newRow.down(".btns").replace(a.newDeleteBtn);a.currentRow.insert({after:a.newRow});a.currentRow.down("input[scanned-item=comments]").clear();a.currentRow.down("input[scanned-item=serialNo]").clear().focus();$(this).up(".item_row").down(".scannedQty").innerHTML++;if($(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML>b.purchaseOrderItem.qty||!$(this).up(".item_row").down(".product-head-row .scannedQty").innerHTML){$(this).up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"})}else{$(this).up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"inherit"})}}})}).insert({bottom:new Element("span",{"class":"scanned-item-delete-btn btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){if(!confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")){return}a.row=$(this).up(".scanned-item-row");a.serialNoBox=a.row.down("input[scanned-item=serialNo]");a.unitPriceBox=a.row.down("input[scanned-item=unitPrice]");a.invoiceNoBox=a.row.down("input[scanned-item=invoiceNo]");a.commentsBox=a.row.down("input[scanned-item=comments]");a.serialNoBox.clear();a.unitPriceBox.clear();a.invoiceNoBox.clear();a.commentsBox.clear();a.serialNoBox.focus()})})}).addClassName("warning")})});return a.table},_searchProduct:function(b){var a={};a.me=this;a.btn=b;a.me._signRandID(a.btn);a.searchTxtBox=$(a.btn).up(".product-autocomplete").down(".search-txt");a.searchTxt=$F(a.searchTxtBox);if(!a.searchTxt){return}a.currentRow=$(b).up(".new-order-item-input");a.product={name:"",id:"",qty:0,barcode:a.searchTxt};a.data={product:a.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(c){Event.stop(c);if(!confirm("You are about to remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.row.remove()})})};a.currentRow.insert({after:a.lastRow=a.me._getProductRow(a.data,false)});a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus();a.inputBox=jQuery("#"+a.me._htmlIds.barcodeInput);a.me.postAjax(a.me.getCallbackId("searchProduct"),{searchTxt:a.searchTxt},{onLoading:function(){jQuery("#"+a.me._htmlIds.barcodeInput).button("loading")},onSuccess:function(c,f){a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.items||a.result.items.size()===0){a.lastRow.down(".productSku").insert({bottom:new Element("strong",{"class":"text-danger"}).update("No Product Found!")});a.lastRow.down(".productName").insert({top:new Element("span",{"class":""}).update("Barcode: ")});throw"Nothing Found for: "+a.searchTxt}if(a.result.items.size()>1){a.searchTxtBox=a.newRow.down(".search-txt");a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;","class":"selectProductPanel"});a.result.items.each(function(e){a.resultList.insert({bottom:a.me._getSearchPrductResultRow(e,a.searchTxtBox,a.lastRow,a.newRow)})});a.resultList.addClassName("list-group");a.me.showModalBox("Products that has: "+a.searchTxt,a.resultList,false);return a.me}a.data.product=a.result.items[0];a.me._selectProduct(a.data.product,a.lastRow,a.newRow)}catch(d){a.resultList.update(a.me.getAlertBox("Error: ",d).addClassName("alert-danger"))}},onComplete:function(c,d){jQuery("#"+a.me._htmlIds.barcodeInput).button("reset")}});return a.me},_selectProduct:function(c,b){var a={};a.me=this;a.data=[];a.product=c;a.lastRow=b;a.btn=$("barcode_input");a.me._signRandID(a.btn);a.data={product:a.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(d){Event.stop(d);if(!confirm("You are about to remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.row.remove()})}),qty:0};a.data.scanTable=a.me._getScanTable(a.data.product);a.lastRow.replace(a.newRow=a.me._getProductRow(a.data,false));a.me._checkProduct(a.product,a.newRow.down(".product-head-row"));a.newRow.down('[save-item="EANcode"]').select();a.me._focusNext(a.newRow,"serialNo","unitPrice");a.me._focusNext(a.newRow,"unitPrice","invoiceNo");a.me._focusNext(a.newRow,"invoiceNo","comments");a.newRow.down(".product-head-row").setStyle({cursor:"pointer"});a.newRow.down(".product-head-row").observe("click",function(d){if(a.newRow.down(".product-content-row")){a.newRow.down(".product-content-row").toggle()}});a.serialNoBox=a.newRow.down("input[scanned-item=serialNo]");if(a.serialNoBox){a.serialNoBox.observe("keydown",function(d){a.me.keydown(d,function(){if(!$F(a.serialNoBox).blank()&&!$F(a.unitPriceBox).blank()&&!$F(a.invoiceNoBox).blank()){a.newRow.down(".scanned-item-save-btn span").click()}});return false});a.serialNoBox.up(".scanned-item-row").addClassName("new-scan-row")}a.unitPriceBox=a.newRow.down("input[scanned-item=unitPrice]");if(a.unitPriceBox){a.unitPriceBox.observe("keydown",function(d){a.me.keydown(d,function(){if(!$F(a.serialNoBox).blank()&&!$F(a.unitPriceBox).blank()&&!$F(a.invoiceNoBox).blank()){a.newRow.down(".scanned-item-save-btn span").click()}});return false})}a.invoiceNoBox=a.newRow.down("input[scanned-item=invoiceNo]");if(a.invoiceNoBox){a.invoiceNoBox.observe("keydown",function(d){a.me.keydown(d,function(){if(!$F(a.serialNoBox).blank()&&!$F(a.unitPriceBox).blank()&&!$F(a.invoiceNoBox).blank()){a.newRow.down(".scanned-item-save-btn span").click()}});return false})}a.commentsBox=a.newRow.down("input[scanned-item=comments]");if(a.commentsBox){a.commentsBox.observe("keydown",function(d){a.me.keydown(d,function(){if(!$F(a.serialNoBox).blank()&&!$F(a.unitPriceBox).blank()&&!$F(a.invoiceNoBox).blank()){a.newRow.down(".scanned-item-save-btn span").click()}});return false})}a.me._scanRowAutoSave(a.newRow);return a.me},_scanRowAutoSave:function(b){var a={};a.me=this;a.row=b;if(a.row.down('[scanned-item="comments"]')){a.row.down('[scanned-item="comments"]').observe("keydown",function(c){a.me.keydown(c,function(){a.row.down(".scanned-item-save-btn").click()});return false})}return a.me},_focusNext:function(b,d,c){var a={};a.me=this;a.row=b;a.from=d;a.to=c;if(a.row.down('[scanned-item="'+a.from+'"]')){a.row.down('[scanned-item="'+a.from+'"]').observe("keydown",function(e){a.me.keydown(e,function(){a.row.down('[scanned-item="'+a.to+'"]').select()});return false})}return a.me},_checkProduct:function(b,c){var a={};a.me=pageJs;a.newRow=c;a.product=b;a.btn=$("barcode_input");a.me._signRandID(a.btn);a.me.postAjax(a.me.getCallbackId("checkProduct"),{product:a.product,purchaseOrder:a.me._purchaseOrder},{onLoading:function(d,e){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(a.result.count==0){a.newRow.down(".productSku").insert({bottom:new Element("strong",{style:"color:red"}).update("  (Not found in PO)")});a.newRow.up(".item_row").addClassName("not-in-po")}}catch(f){a.me.showModalBox("Error!",f,false)}},onComplete:function(d,e){jQuery("#"+a.btn.id).button("reset")}})},_canReceive:function(){var a={};a.me=this;return(a.me._purchaseOrder.status==="RECEIVING"||a.me._purchaseOrder.status==="ORDERED")},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("span",{"class":"btn-group pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){a.me._submitOrder($(this))})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling this PO receiving</strong>','<div>You are about to cancel this receiving process, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})});return a.newDiv},_submitOrder:function(b){var a={};a.me=this;a.btn=b;a.data=a.me._collectFormData($(a.me._htmlIds.itemDiv),"save-order");a.data.purchaseOrder=a.me._purchaseOrder;a.data.products={};a.data.products.matched=[];a.data.products.notMatched=[];$(a.me._htmlIds.partsTable).getElementsBySelector("div.item_row").each(function(c){if(!c.hasClassName("new-order-item-input")){if(c.retrieve("data").id!==""){a.scanData=[];c.getElementsBySelector(".table.scanTable .scanned-item-row").each(function(d){if(!d.hasClassName("new-scan-row")){a.scanData.push(a.me._collectFormData(d,"scanned-item"))}});a.data.products.matched.push({product:c.retrieve("data"),serial:a.scanData})}else{a.data.products.notMatched.push(c.retrieve("data"))}}});if(a.data===null){return a.me}if((a.data.products.matched.size()+a.data.products.notMatched.size())<=0){a.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one item is needed!",true);return a.me}a.me._signRandID(a.btn);a.me.postAjax(a.me.getCallbackId("saveOrder"),a.data,{onLoading:function(c,d){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.item){return}if(a.result.item.status==="RECEIVING"){a.me.showModalBox('<strong class="text-success">Success!</strong>','<div>The current receiving process is succussed and saved.</div><br /><div><strong>There are more to go, Another One?</strong></div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)}else{a.me.showModalBox('<strong class="text-success">Success!</strong>',"<h3>Saved successfully</h3>",true);window.location=document.URL}}catch(d){a.me.showModalBox("Error!",d,false)}},onComplete:function(c,d){jQuery("#"+a.btn.id).button("reset")}});return a.me},_getSearchPrductResultRow:function(e,d,c,a){var b={};b.me=this;b.lastRow=c;b.newRow=a;b.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";b.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:e.images.size()===0?b.defaultImgSrc:e.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(e.name).insert({bottom:new Element("small",{"class":"",style:"padding-left: 10px;"}).update("SKU: "+e.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(e.shortDescription)})})})})}).observe("click",function(){b.inputRow=$(d).up(".new-order-item-input").store("product",e);b.me._selectProduct(e,b.lastRow,b.newRow);jQuery("#"+b.me.modalId).modal("hide");$$('[scanned-item="serialNo"]').first().focus()});return b.newRow},init:function(b){var a={};a.me=this;if(b){a.me.selectPO(b)}else{$(a.me._htmlIds.itemDiv).update(a.me._getPOListPanel()).down(".init-focus").focus()}}});