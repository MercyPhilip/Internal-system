var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_openinFB:!0,manufactures:[],suppliers:[],productCategories:[],_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",supplier:"Supplier",poNumber:"PO Number",unitPrice:"Unit Price(Ex)",qty:"Qty",poDate:"PO Date",eta:"ETA"}},_loadManufactures:function(a){this.manufactures=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.manufacturerIds"]'),b.me.manufactures.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadSuppliers:function(a){this.suppliers=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.supplierIds"]'),b.me.suppliers.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadCategories:function(a){this.categories=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productCategoryIds"]'),b.me.categories.sort(function(a,b){return a.namePath>b.namePath}).each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.namePath)})}),this},_loadChosen:function(){return jQuery(".chosen").select2({minimumResultsForSearch:1/0}),this},_bindSearchKey:function(){var a={};return a.me=this,$$("#searchBtn").first().observe("click",function(b){$$("#showSearch").first().checked?a.me.getSearchCriteria().getResults(!0,a.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(b){a.me.keydown(b,function(){$(a.me.searchDivId).down("#searchBtn").click()})})}),this},_loadDatePicker:function(){return $$(".datepicker").each(function(a){new Prado.WebUI.TDatePicker({ID:a,InputMode:"TextBox",Format:"dd/MM/yyyy",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),this},_getSelection:function(){var a={};return a.me=this,a.customers=[],a.itemList=$("item-list"),a.itemList.getElementsBySelector(".btn-hide-row.item_row").each(function(b){a.checked=b.down('input.customer-selected[type="checkbox"]').checked,a.customerId=b.readAttribute("item_id"),a.checked===!0&&jQuery.isNumeric(a.customerId)===!0&&a.customers.push(b.retrieve("data"))}),$("total-selected-count").update(a.customers.length),a.customers},_getResultRow:function(a,b){var c={};return c.me=this,c.tag=b===!0?"th":"td",c.isTitle=b||!1,c.row=new Element("tr",{class:(c.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==a.active?" danger":""),item_id:c.isTitle===!0?"":a.id}).store("data",a).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"sku col-xs-1"}).update(a.sku):new Element(c.tag,{class:"sku col-xs-1",item:"sku"}).update(a.product.sku).observe("click",function(){})}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"name col-xs-4 truncate"}).update(a.name):new Element(c.tag,{class:"name col-xs-4 truncate",item:"name"}).update(a.product.name)}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"supplier col-xs-2 truncate"}).update(a.supplier):new Element(c.tag,{class:"supplier col-xs-2 truncate",item:"supplier"}).update(a.po.supplier.name)}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"ponumber col-xs-1 truncate"}).update(a.poNumber):new Element(c.tag,{class:"ponumber col-xs-1 truncate",item:"po"}).update(a.po.purchaseOrderNo)}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"unitprice col-xs-1 truncate"}).update(a.unitPrice):new Element(c.tag,{class:"unitprice col-xs-1 truncate",item:"unitprice"}).update(a.item.unitPrice)}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"qty col-xs-1 truncate"}).update(a.qty):new Element(c.tag,{class:"qty col-xs-1 truncate",item:"unitprice"}).update(a.item.qty)}).insert({bottom:new Element(c.tag,{style:"position:relative; left: -60px",class:"col-xs-1"}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"eta col-xs-1 truncate"}).update(a.eta):new Element("input",{class:"datepicker",item:"eta_"+a.id,value:moment(a.eta).format("DD/MM/YYYY")})})}).insert({bottom:c.isTitle===!0?new Element(c.tag,{class:"podate col-xs-1 truncate"}).update(a.poDate):new Element(c.tag,{class:"podate col-xs-1 truncate",item:"unitprice"}).update(a.item.created)}),c.row},_getSaveBtn:function(a){var b={};return b.me=this,b.saveDiv=new Element("div",{class:"row"}).insert({bottom:new Element("span",{id:"saveBtn",class:"btn btn-primary pull-right col-sm-4","data-loading-text":"saving ..."}).update("Save").observe("click",function(){b.me.saveEta(this,a)})}),b.saveDiv},saveEta:function(a,b){var c={};c.me=this;for(var d=b.length;d--;)b[d].eta=jQuery("[item=eta_"+b[d].id).val();return c.me.postAjax(c.me.getCallbackId("saveEta"),{productEta:b},{onSuccess:function(a,b){try{if(c.result=c.me.getResp(b,!1,!0),!c.result||!c.result.item)return;c.me.showModalBox("Success","Save Successfully!",!1)}catch(a){c.me.showModalBox("ERROR",a,!0)}}}),c.me},_getNextPageBtn:function(){var a={};return a.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"8",class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){a.me._pagination.pageNo=1*a.me._pagination.pageNo+1,jQuery(this).button("loading"),a.me.getResults()})})})})}});