var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{_confirm_form_id:"confirm_form_id",bindBtns:function(){var c;c=this;$$(".gen-report-btn").each(function(d){$(d).observe("click",function(){c._showDateSelectPanel(this,d.readAttribute("data-type"))})});return c},_initFormValdation:function(c,d){var b,a,e;b=this;a=jQuery("#"+b._confirm_form_id);a.formValidation({framework:"bootstrap",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{date_from:{validators:{callback:{message:"The from date is needed.",
callback:function(b,a,c){return null!==jQuery(c).data("DateTimePicker").date()}}}},date_to:{validators:{callback:{message:"The to date is needed.",callback:function(b,a,c){return null!==jQuery(c).data("DateTimePicker").date()}}}}}}).on("err.form.fv",function(b){a.data("formValidation").getSubmitButton()&&a.data("formValidation").disableSubmitButtons(!1)}).on("success.form.fv",function(f){f.preventDefault();a.data("formValidation").getSubmitButton()&&a.data("formValidation").disableSubmitButtons(!1);
e={};e.type=d;$(b._confirm_form_id).getElementsBySelector('[report_date="date_from"]').each(function(a){b._signRandID(a);e[a.readAttribute("report_date")]=jQuery("#"+a.id).data("DateTimePicker").date().startOf("day").utc().format()});$(b._confirm_form_id).getElementsBySelector('[report_date="date_to"]').each(function(a){b._signRandID(a);e[a.readAttribute("report_date")]=jQuery("#"+a.id).data("DateTimePicker").date().endOf("day").utc().format()});b.genReport(c,e)});a.find(".datepicker").on("dp.change dp.show",
function(b){a.formValidation("revalidateField","date_from");a.formValidation("revalidateField","date_to")});return b},_showDateSelectPanel:function(c,d){var b,a,e;b=this;a=(new Element("form",{"class":"confirm-div form-horizontal",id:b._confirm_form_id})).insert({bottom:(new Element("div",{"class":"form-group"})).insert({bottom:(new Element("label",{"class":"col-sm-2 control-label"})).update("Date From:")}).insert({bottom:(new Element("div",{"class":"col-sm-10"})).insert({bottom:new Element("input",
{"class":"form-control datepicker",placeholder:"The start of the date range",report_date:"date_from",name:"date_from"})})})}).insert({bottom:(new Element("div",{"class":"form-group"})).insert({bottom:(new Element("label",{"class":"col-sm-2 control-label"})).update("Date To:")}).insert({bottom:(new Element("div",{"class":"col-sm-10"})).insert({bottom:new Element("input",{"class":"form-control datepicker",placeholder:"The end of the date range",report_date:"date_to",name:"date_to"})})})}).insert({bottom:(new Element("div",
{"class":"text-right"})).insert({bottom:(new Element("span",{"class":"btn btn-default pull-left"})).update("CANCEL").observe("click",function(){b.hideModalBox()})}).insert({bottom:(new Element("button",{type:"submit","class":"btn btn-primary submit-btn","data-loading-text":"Generating ..."})).update("Generate The Report")})});b.showModalBox("<strong>Please provide the date range for: "+$(c).innerHTML+"</strong>",a,!1,null,{"shown.bs.modal":function(c){b._signRandID(a);jQuery("#"+a.id).find(".datepicker").datetimepicker({format:"DD/MM/YYYY",
viewMode:"days"});b._initFormValdation(a.down(".submit-btn"),d)},"hide.bs.modal":function(a){(e=jQuery("#"+b._confirm_form_id).data("formValidation"))&&e.destroy()}});return b},genReport:function(c,d){var b,a;b=this;b.postAjax(b.getCallbackId("genReportBtn"),d,{onCreate:function(){b._signRandID(c);jQuery("#"+c.id).button("loading")},onSuccess:function(c,d){try{(a=b.getResp(d,!1,!0))&&a.item&&a.item.id&&(window.open(a.item.url),window.focus(),b.hideModalBox())}catch(g){b.showModalBox('<strong class="text-danger">Error</strong>',
"<h4>"+g+"</h4>")}},onComplete:function(a,b){jQuery("#"+c.id).button("reset")}},6E4);return b}});