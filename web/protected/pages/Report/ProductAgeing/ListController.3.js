var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{}},_loadDataPicker:function(){return jQuery(".datepicker").datetimepicker({format:"DD/MM/YYYY"}),this},_searchProduct:function(){var e={};return e.me=this,jQuery('#searchDiv .select2[search_field="pro.id"]').select2({allowClear:!0,hidden:!0,multiple:!1,ajax:{url:"/ajax/getProducts",dataType:"json",delay:10,data:function(e){return{searchTxt:e,pageNo:1,pageSize:10}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.sku,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?'<div class="row"><div class="col-xs-3">'+e.data.sku+'</div><div class="col-xs-9">'+e.data.name+"</div></div>":""},escapeMarkup:function(e){return e},minimumInputLength:3}),e.me},_searchPO:function(){var e={};return e.me=this,jQuery('#searchDiv .select2[search_field="po.id"]').select2({allowClear:!0,hidden:!0,multiple:!1,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,data:function(e){return{searchTxt:"purchaseOrderNo like ?",entityName:"PurchaseOrder",searchParams:["%"+e+"%"],pageNo:1,pageSize:10}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.purchaseOrderNo,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?'<div class="row po_item"><div class="col-xs-3">'+e.data.purchaseOrderNo+'</div><div class="col-xs-2" order_status="'+e.data.status+'">'+e.data.status+'</div><div class="col-xs-6">'+e.data.supplier.name+"</div></div>":""},escapeMarkup:function(e){return e},minimumInputLength:3}),e.me},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(t){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$(e.me.searchDivId).down("#searchBtn").click()})})}),e.me._searchProduct()._searchPO(),e.me},_highlightSelectedRow:function(e){var t={};t.me=this,t.item=e.down(".glyphicon-plus")?"":$(e).up("[item_id]").retrieve("data"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success")},_getLinkAddress:function(e,t,a){var r={};return r.me=this,r.params=a||[],r.paramTxt="",r.params.length>0&&(r.paramTxt="?",r.params.each(function(e){r.paramTxt=r.paramTxt+$H(e).keys()[0]+"="+$H(e).values()[0]+"&"}),r.paramTxt=r.paramTxt.substring(0,r.paramTxt.length-1)),"/"+e+(jQuery.isNumeric(t)===!0?"/"+t:"")+".html"+r.paramTxt},_getLink:function(e,t,a,r,s){var i={};return i.me=this,i.url=r||null,new Element("a",{target:"_blank",href:null===i.url?i.me._getLinkAddress(e,t,s):i.url}).update(a)},_getResultRow:function(e,t){var a={};return a.me=this,a.tag=a.isTitle===!0?"th":"td",a.isTitle=t||!1,a.row=new Element("tr",{"class":(a.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==e.active?" danger":""),item_id:a.isTitle===!0?"":e.id}).store("data",e).insert({bottom:new Element(a.tag,{"class":"col-xs-1"}).update(a.isTitle===!0?"Product SKU":a.me._getLink("product",e.product.id,e.product.sku))}).insert({bottom:new Element(a.tag).update(a.isTitle===!0?"Product Name":a.me._getLink("product",e.product.id,e.product.name))}).insert({bottom:new Element(a.tag,{"class":"col-xs-2"}).update(a.isTitle===!0?"Last Purchase Date":moment(a.me.loadUTCTime(e.lastPurchaseTime)).format("ll"))}).insert({bottom:new Element(a.tag,{"class":"col-xs-1"}).update(a.isTitle===!0?"Qty":e.receivingItem.id?a.me._getLink("productqtylog",null,e.product.stockOnHand,null,[{productid:e.product.id}]):"N/A")}).insert({bottom:new Element(a.tag,{"class":"col-xs-2"}).update(a.isTitle===!0?"Aged Days":moment().diff(moment(a.me.loadUTCTime(e.lastPurchaseTime)),"days"))}),a.row},_getNextPageBtn:function(){var e={};return e.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"8","class":"text-center"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults()})})})})}});