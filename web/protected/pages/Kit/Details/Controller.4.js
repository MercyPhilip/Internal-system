var PageJs=new Class.create;PageJs.prototype=Object.extend(new DetailsPageJs,{_openinFB:!0,_preSetData:{},setPreSetData:function(e){var t={};return t.me=this,t.me._preSetData=e,t.me},_getValidatingDataFields:function(){var e={};return e.me=this,e.fields={"rowField[productId]":{validators:{notEmpty:{message:"Please select a product"},regexp:{regexp:/^\d+$/,message:"Please select a product"}}},"rowField[qty]":{validators:{notEmpty:{message:"Quantity is required"},integer:{message:"Quantity is not an integer"}}}},e.fields},setOpenInFancyBox:function(e){var t={};return t.me=this,t.me._openinFB=e,t.me},_getUnitPrice:function(e){var t={};return t.me=this,t.unitPrice=0,e&&e.prices&&e.prices.size()>0&&e.prices.each(function(e){e.type&&1===parseInt(e.type.id)&&(t.unitPrice=e.price)}),t.unitPrice},_openURL:function(e){var t={};return t.me=this,t.url=e,t.me._openinFB!==!0?(window.location=t.url,t.me):(jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:t.url}),t.me)},refreshParentWindow:function(e){var t={};t.me=this,window.parent&&(t.parentWindow=window.parent,t.parentWindow&&t.parentWindow.pageJs&&(t.parentWindow.pageJs.refreshTaskRow&&e.task?t.parentWindow.pageJs.refreshTaskRow(e.task):t.parentWindow.pageJs.refreshResultRow&&t.parentWindow.pageJs.refreshResultRow(e)))},_getSummary:function(){var e={};return e.me=this,e.totalExclGst=0,e.rowData=[],$$(".item_data_row").each(function(t){e.rowOriginData=t.retrieve("data"),e.unitCost=e.me.getValueFromCurrency(t.down(".unitCost").innerHTML),e.qty=$F(t.down('[row-field="qty"]')),t.hasClassName("deactivated")||(e.totalExclGst=e.totalExclGst+e.unitCost*e.qty),e.rowData.push({productId:e.rowOriginData.product.id,unitCost:e.unitCost,qty:e.qty,id:e.rowOriginData.id?e.rowOriginData.id:"",active:!t.hasClassName("deactivated")})}),e.totalIncGst=1.1*e.totalExclGst,e.totalGST=1*e.totalIncGst-1*e.totalExclGst,e.result={totalIncGst:e.totalIncGst,totalGST:e.totalGST,totalExclGst:e.totalExclGst,rowData:e.rowData},e.result},_confirmDelRow:function(e){var t={};return t.me=this,t.row=$(e).up(".item_row"),t.row?(t.rowData=t.row.retrieve("data"),t.unitCost=t.rowData.product.unitCost,t.qty=$F(t.row.down('[row-field="qty"]')),t.newDiv=new Element("div").insert({bottom:new Element("div").insert({bottom:new Element("strong").update("You are about to delete this selected row, with information:")}).insert({bottom:new Element("ul").insert({bottom:new Element("li").update("<strong>Product SKU: </strong>"+t.rowData.product.sku)}).insert({bottom:new Element("li").update("<strong>Product Name: </strong>"+t.rowData.product.name)}).insert({bottom:new Element("li").update("<strong>Unit Price: </strong>"+t.me.getCurrency(t.me.getValueFromCurrency(t.unitCost)))}).insert({bottom:new Element("li").update("<strong>Qty: </strong>"+t.qty)}).insert({bottom:new Element("li").update("<strong>Total Price: </strong>"+t.me.getCurrency(t.qty*t.unitCost))})})}).insert({bottom:new Element("div").insert({bottom:new Element("strong").update("Are you sure to continue?")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(new Element("div",{"class":"btn btn-default"}).update("No. Cancel").observe("click",function(){t.me.hideModalBox()}))}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("div",{"class":"btn btn-danger"}).update("Yes. Delete it.").observe("click",function(){t.jQueryForm=jQuery("#"+t.me.getHTMLID("main-form")),t.jQueryFV=t.jQueryForm.data("formValidation"),t.fieldOptions=t.me._getValidatingDataFields(),t.jQueryFV&&t.jQueryFV.addField&&(t.row.getElementsBySelector(".need-validate").each(function(e){t.mapKey=e.readAttribute("form-option"),t.mapKey&&!t.mapKey.blank()&&t.fieldOptions[t.mapKey]&&t.jQueryFV.removeField(e.name)}),t.jQueryFV.resetForm()),t.rowData.id?t.row.addClassName("deactivated").hide():t.row.remove(),t.me._recalculateSummary().hideModalBox()}))})}),t.me.showModalBox("<strong>Confirm Deletion</strong>",t.newDiv),t.me):t.me},_recalculateSummary:function(){var e={};return e.me=this,e.summary=e.me._getSummary(),jQuery('[summary="total-excl-gst"]').html(e.me.getCurrency(e.summary.totalExclGst)).val(e.me.getCurrency(e.summary.totalExclGst)),jQuery('[summary="total-gst"]').html(e.me.getCurrency(e.summary.totalGST)).val(e.me.getCurrency(e.summary.totalGST)),jQuery('[summary="total-inc-gst"]').html(e.me.getCurrency(e.summary.totalIncGst)).val(e.me.getCurrency(e.summary.totalIncGst)),e.me},_getQtyCell:function(e,t){var o={};return o.me=this,o.qty=e||1,o.rowIndex=void 0===t?"":t,o.formOptionName="rowField[qty]",o.cell=o.me.getFormGroup("",new Element("input",{"class":"form-control input-sm input-row-field need-validate","row-field":"qty","form-option":o.formOptionName,name:o.formOptionName+o.rowIndex,placeholder:"Quanity",value:o.qty}).observe("change",function(){o.qtyBox=this,o.newRow=$(o.qtyBox).up(".item_row"),o.qty=$F(this).replace(/\s*/g,""),null!==o.qty.match(/^\d+?$/)&&($(o.qtyBox).setValue(parseInt(o.qty)),jQuery("#"+o.me.getHTMLID("main-form")).formValidation("revalidateField",o.qtyBox.name)),o.newRow.down(".totalCost").update(o.me.getCurrency(o.qty*o.me.getValueFromCurrency(o.newRow.down(".unitCost").innerHTML))),o.me._recalculateSummary()}).observe("keydown",function(e){o.btn=$(this),o.me.keydown(e,function(){o.saveBtn=o.btn.up(".item_row").down(".row-field-save-btn"),o.saveBtn&&o.saveBtn.click()})})),o.cell},_getProductRow:function(e,t,o){var n={};return n.me=this,n.isTitle=e===!0?!0:!1,n.tag="div",n.rowIndex=void 0===o?"":o,n.newDiv=new Element("div",{"class":"list-group-item item_row"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element(n.tag,{"class":"col-xs-8 product"}).update(n.isTitle===!0?new Element("strong").update("Product"):n.me._getProductDetailsDiv(t.product,!0))}).insert({bottom:new Element(n.tag,{"class":"col-xs-4 row-details"}).insert({bottom:new Element(n.tag,{"class":"col-xs-4 unitCost text-right"}).update(n.isTitle===!0?new Element("strong").update("Unit Cost (excl. GST)"):n.me.getCurrency(t.unitCost))}).insert({bottom:new Element(n.tag,{"class":"col-xs-3 qty"}).update(n.isTitle===!0?new Element("strong").update("Qty"):n.me._getQtyCell(t.qty,n.rowIndex))}).insert({bottom:new Element(n.tag,{"class":"col-xs-3 totalCost text-right"}).update(n.isTitle===!0?new Element("strong").update("Total Cost (excl. GST)"):n.me.getCurrency(t.unitCost*t.qty))}).insert({bottom:new Element(n.tag,{"class":"col-xs-2 btns text-right"}).update(n.isTitle===!0?new Element("strong").update("&nbsp;"):t?new Element("span",{"class":"btn btn-danger btn-xs row-del-btn"}).update(new Element("span",{"class":"glyphicon glyphicon-trash"})).observe("click",function(){t&&n.me._confirmDelRow(this)}):"")})})}),t&&(n.newDiv.store("data",t),t.id&&n.newDiv.writeAttribute("item_id",t.id)),n.newDiv},_checkAddNewRow:function(e){var t={};t.me=this,t.inputRow=$(e).up(".item_row_new"),t.jQueryForm=jQuery("#"+t.me.getHTMLID("main-form")),t.formValidator=t.jQueryForm.data("formValidation"),t.validClassName=$(e).readAttribute("valid-target"),jQuery.each(jQuery(".need-validate"),function(e,o){t.fieldName=jQuery(o).attr("name"),t.formValidator.getFieldElements(t.fieldName).length>0&&t.formValidator.enableFieldValidators(t.fieldName,jQuery(o).hasClass(t.validClassName))}),t.formValidator.validate(),t.formValidator.isValid()===!0&&(t.productSelectBox=t.inputRow.down('[row-field="product-id"]'),t.me._signRandID(t.productSelectBox),t.qtyBox=t.inputRow.down('[row-field="qty"]'),t.selectedProduct=jQuery("#"+t.productSelectBox.id).select2("data").data,t.me._addNewRow({product:t.selectedProduct,unitCost:t.selectedProduct.unitCost,qty:$F(t.qtyBox)}),t.formValidator.resetForm(),jQuery("#"+t.productSelectBox.id).select2("val",""),t.qtyBox.setValue(1),t.productSelectBox.up(".product").down(".product-details").remove())},_inputRow:function(){var e={};return e.me=this,e.newRow=e.me._getProductRow(!0).addClassName("list-group-item-info item_row_new"),e.formOptionName="rowField[productId]",e.newRow.down(".product").update(e.me.getFormGroup("",new Element("input",{"class":"form-control select2 input-sm product-search input-row-field need-validate","form-option":e.formOptionName,name:e.formOptionName,"row-field":"product-id",isKit:"0",placeholder:"Search a product",onSelectFunc:"_selectRowProduct"}))),e.newRow.down(".unitCost").update(e.me.getCurrency(0)),e.newRow.down(".qty").update(e.me._getQtyCell()),e.newRow.down(".totalCost").update(e.me.getCurrency(0)),e.newRow.down(".btns").update(new Element("span",{"class":"btn btn-primary btn-sm row-field-save-btn","valid-target":"input-row-field"}).update(new Element("i",{"class":"glyphicon glyphicon-floppy-saved"})).observe("click",function(){e.me._checkAddNewRow(this)})),e.newRow},_addNewRow:function(e){var t={};return t.me=this,t.list=$$(".kit-components-list").first().down(".item_row_footer"),t.list?(t.list.insert({before:t.newRow=t.me._getProductRow(!1,e,$$(".item_data_row").size()).addClassName("item_data_row")}),t.me._recalculateSummary(),t.newRow.getElementsBySelector(".input-row-field").each(function(e){e.removeClassName("input-row-field").addClassName("row-field")}),t.jQueryForm=jQuery("#"+t.me.getHTMLID("main-form")),t.jQueryFV=t.jQueryForm.data("formValidation"),t.fieldOptions=t.me._getValidatingDataFields(),t.jQueryFV&&t.jQueryFV.addField&&t.newRow.getElementsBySelector(".need-validate").each(function(e){t.mapKey=e.readAttribute("form-option"),t.mapKey&&!t.mapKey.blank()&&t.fieldOptions[t.mapKey]&&t.jQueryFV.addField(e.name,t.fieldOptions[t.mapKey])}),t.me):t.me},_save:function(e,t){var o={};return o.me=this,o.btn=e,o.data=t,o.me.saveItem(e,o.data,function(e){e&&(o.me._item=e.item,o.newDiv=new Element("div").insert({bottom:new Element("h4").update("Kit has been "+(e.createdFromNew?"created":"updated")+" successfully!")}),e.createdFromNew===!0&&o.newDiv.insert({bottom:new Element("div").insert({bottom:new Element("strong").update("Do you want to create/clone another kit with same specs?")})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"btn btn-default"}).update("No").observe("click",function(){o.me.hideModalBox()})}).insert({bottom:new Element("a",{"class":"btn btn-primary pull-right",href:"/kit/new.html?clonekitid="+o.me._item.id+("1"===o.me.getUrlParam("blanklayout")?"&blanklayout=1":"")}).update("Yes. Create Another One")})}),o.me.showModalBox('<strong class="text-success">Success</strong>',o.newDiv,!1,null,{"hide.bs.modal":function(){e.url&&!e.url.blank()&&(window.location=e.url)}}),o.me.refreshParentWindow(e.item),e.printUrl&&!e.printUrl.blank()&&(o.printWind=window.open(e.printUrl,"_BLANK","width=800"),o.printWind&&o.printWind.focus()))}),o.me},_preSave:function(e){var t={};return t.me=this,t.jQueryForm=jQuery("#"+t.me.getHTMLID("main-form")),t.formValidator=t.jQueryForm.data("formValidation"),t.validClassName=$(e).readAttribute("valid-target"),jQuery.each(jQuery(".need-validate"),function(e,o){t.fieldName=jQuery(o).attr("name"),t.formValidator.getFieldElements(t.fieldName).length>0&&t.formValidator.enableFieldValidators(t.fieldName,jQuery(o).hasClass(t.validClassName))}),t.formValidator.validate(),t.formValidator.isValid()!==!0?t.me:(t.productId=t.me._item.product&&t.me._item.product.id?t.me._item.product.id:t.me._preSetData.cloneFromKit&&t.me._preSetData.cloneFromKit.id?t.me._preSetData.cloneFromKit.product.id:$F($$('[save-panel="kit-product-id"]').first()),t.productId.blank()?(t.me.showModalBox('<strong class="text-danger">Error:</strong>',new Element("div").update(t.me.getAlertBox("","You need to provide a product for the kit.").addClassName("alert-danger")).insert({bottom:new Element("div",{"class":"row"}).update(new Element("span",{"class":"btn btn-primary col-xs-4 col-xs-offset-4"}).update("OK").observe("click",function(){t.me.hideModalBox()}))})),t.me):(t.summary=t.me._getSummary(),t.hasItems=!1,t.summary.rowData&&t.summary.rowData.each(function(e){e.active===!0&&(t.hasItems=!0)}),t.hasItems!==!0?(t.me.showModalBox('<strong class="text-danger">Error:</strong>',new Element("div").update(t.me.getAlertBox("","Required at least one component to build a kit.").addClassName("alert-danger")).insert({bottom:new Element("div",{"class":"row"}).update(new Element("span",{"class":"btn btn-primary col-xs-4 col-xs-offset-4"}).update("OK").observe("click",function(){t.me.hideModalBox()}))})),t.me):(t.data={items:t.summary.rowData,productId:t.productId},t.taskIdBox=$$('[save-panel="task-id"]').first(),t.taskIdBox&&!$F(t.taskIdBox).blank()&&(t.data.taskId=$F(t.taskIdBox)),t.me._item&&t.me._item.id&&(t.data.id=t.me._item.id),t.kitProduct=$$(".selected-kit-product-view")&&$$(".selected-kit-product-view").first()?$$(".selected-kit-product-view").first().retrieve("data"):null,t.kitProduct&&t.kitProduct.id&&1*t.summary.totalIncGst>1*t.me._getUnitPrice(t.kitProduct)?(t.confirmDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:new Element("div").insert({bottom:new Element("h4").update("You are about to build this kit with a Cost greater than the unit Price:")})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-md-4 text-right"}).update("<strong>Unit Cost inc GST for this KIT</strong>:")}).insert({bottom:new Element("div",{"class":"col-md-8"}).update(t.me.getCurrency(t.me.getValueFromCurrency(t.summary.totalIncGst)))})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-md-4 text-right"}).update("<strong>Unit Price inc GST for this KIT</strong>:")}).insert({bottom:new Element("div",{"class":"col-md-8"}).update(t.me.getCurrency(t.me._getUnitPrice(t.kitProduct)))})}).insert({bottom:new Element("h4").update("Please Provide a reason to continue:")}).insert({bottom:new Element("div").insert({bottom:new Element("textarea",{"class":"form-control","confirm-div":"reason",placeholder:"Some reason for sale under cost."})})}).insert({bottom:new Element("div",{"class":"msg"})})}),t.confirmDivFooter=new Element("div").insert({bottom:new Element("div",{"class":"col-md-6 text-left"}).insert({bottom:new Element("div",{"class":"btn btn-default"}).update("No. Cancel").observe("click",function(){t.me.hideModalBox()})})}).insert({bottom:new Element("div",{"class":"col-md-6 text-right"}).insert({bottom:new Element("div",{"class":"btn btn-danger"}).update("Yes, Go Ahead").observe("click",function(){t.confDiv=$(this).up(".modal-content").down(".confirm-div"),t.confDiv.down(".msg").update(""),t.reason="",t.confDiv.down('[confirm-div="reason"]')&&(t.reason=$F(t.confDiv.down('[confirm-div="reason"]'))),t.reason.blank()?t.confDiv.down(".msg").update(t.me.getAlertBox("ERROR: ","some reason required to continue").addClassName("alert-danger")):(t.data.underCostReason=t.reason,t.me._save(e,t.data))})})}),t.me.showModalBox('<strong class="text-danger">Warning</strong>',t.confirmDiv,!1,t.confirmDivFooter)):t.me._save(e,t.data),t.me)))},_showKitDetails:function(){var e={};return e.me=this,e.detailsDiv=$(e.me.getHTMLID("kitsDetailsDiv")),e.detailsDiv?(e.newTable=new Element("div",{"class":"list-group kit-components-list"}).insert({bottom:e.me._getProductRow(!0).addClassName("item_row_header list-group-item-success")}).insert({bottom:e.inputRow=e.me._inputRow()}).insert({bottom:e.summaryRow=e.me._getProductRow(!0).addClassName("item_row_footer list-group-item-success")}),e.summaryRow.down(".product").update(""),e.summaryRow.down(".row-details").update(new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-8 text-right"}).update("<strong>Total Price(Exc. GST):</strong>")}).insert({bottom:new Element("div",{"class":"col-xs-2 text-right",summary:"total-excl-gst"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-8 text-right"}).update("<strong>Total GST:</strong>")}).insert({bottom:new Element("div",{"class":"col-xs-2 text-right",summary:"total-gst"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-8 text-right"}).update("<strong>Total Price(Inc. GST):</strong>")}).insert({bottom:new Element("div",{"class":"col-xs-2 text-right",summary:"total-inc-gst"}).update(e.me.getCurrency(0))})})),e.detailsDiv.update(new Element("h4").update("List of Parts Inside This Kit:")).insert({bottom:e.newTable}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"col-md-4 col-md-push-8"}).insert({bottom:new Element("span",{"class":"btn btn-primary main-save-btn","valid-target":"row-field"}).update("Save").observe("click",function(){e.me._preSave(this)})})}).insert({bottom:new Element("span",{"class":"col-md-8 col-md-pull-4"}).insert({bottom:e.me._item.id?new Element("div",{"class":"comments-div"}):""})})}),e.me._initProductSearch(),e.inputRow.hasClassName("form-v-loaded")||(e.jQueryForm=jQuery("#"+e.me.getHTMLID("main-form")),e.jQueryFV=e.jQueryForm.data("formValidation"),e.fieldOptions=e.me._getValidatingDataFields(),e.jQueryFV&&e.jQueryFV.addField&&e.inputRow.getElementsBySelector(".need-validate").each(function(t){e.mapKey=t.readAttribute("form-option"),e.mapKey&&!e.mapKey.blank()&&e.fieldOptions[e.mapKey]&&e.jQueryFV.addField(t.name,e.fieldOptions[e.mapKey])}),e.inputRow.addClassName("form-v-loaded")),e.me):e.me},_getExtraInfoDiv:function(){var e={};return e.me=this,e.me._item.id?(e.newDiv=new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-3"}).insert({bottom:e.me.getFormGroup(new Element("label").update("Sold to Customer: "),new Element("div",{"class":"form-control input-sm"}).update(e.me._item.soldToCustomer&&e.me._item.soldToCustomer.id?new Element("a",{href:"javascript:void(0);"}).update(e.me._item.soldToCustomer.name).observe("click",function(){e.me._openURL("/customer/"+e.me._item.soldToCustomer.id+".html?blanklayout=1")}):""))})}).insert({bottom:e.me._item.soldDate?new Element("div",{"class":"col-md-2"}).insert({bottom:e.me.getFormGroup(new Element("label").update("Sold Time: "),new Element("div",{"class":"form-control input-sm"}).update("0001-01-01 00:00:00"===e.me._item.soldDate?"":new Element("div").update(moment(e.me.loadUTCTime(e.me._item.soldDate)).format("lll"))))}):""}).insert({bottom:new Element("div",{"class":"col-md-4"}).insert({bottom:e.me.getFormGroup(new Element("label").update("Sold on Order: "),new Element("div",{"class":"form-control input-sm order_item"}).insert({bottom:e.me._item.soldOnOrder?new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-3"}).insert({bottom:new Element("a",{href:"javascript:void(0);"}).update(e.me._item.soldOnOrder.orderNo).observe("click",function(){e.me._openURL("/orderdetails/"+e.me._item.soldOnOrder.id+".html?blanklayout=1")})})}).insert({bottom:new Element("div",{"class":"col-md-3",order_status:e.me._item.soldOnOrder.status.name}).update(e.me._item.soldOnOrder.status.name)}).insert({bottom:new Element("div",{"class":"col-md-6 truncate",title:e.me._item.soldOnOrder.customer.name}).update(new Element("a",{href:"javascript:void(0);"}).update(e.me._item.soldOnOrder.customer.name).observe("click",function(){e.me._openURL("/customer/"+e.me._item.soldOnOrder.customer.id+".html?blanklayout=1")}))}):""}))})}).insert({bottom:new Element("div",{"class":"col-md-3"}).insert({bottom:e.me.getFormGroup(new Element("label").update("Shipped Via: "),new Element("div",{"class":"form-control input-sm"}).insert({bottom:e.me._item.shippment&&e.me._item.shippment.id?new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-3 truncate",title:e.me._item.shippment.courier.name}).update(e.me._item.shippment.courier.name)}).insert({bottom:new Element("div",{"class":"col-md-3 truncate",title:"Con. No.:"+e.me._item.shippment.conNoteNo}).update(e.me._item.shippment.conNoteNo)}).insert({bottom:new Element("div",{"class":"col-md-6",title:"shipped on date"}).update(moment(e.me.loadUTCTime(e.me._item.shippment.shippingDate)).format("lll"))}):""}))})}),e.newDiv):""},_getItemDiv:function(){var e={};return e.me=this,e.newDiv=new Element("div",{"class":"save-panel"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-2"}).insert({bottom:e.me.getFormGroup(new Element("label").update("For Task: "),new Element("input",{"class":"form-control select2 input-sm task-search","save-panel":"task-id",placeholder:"For Task."}))})}).insert({bottom:new Element("div",{"class":"col-md-4 col-md-offset-2"}).insert({bottom:new Element("h3",{"class":"text-center"}).update(e.me._item.barcode&&!e.me._item.barcode.blank()?'Editing KIT: <img src="/asset/renderBarcode?text='+e.me._item.barcode+'" alt="'+e.me._item.barcode+'" title="'+e.me._item.barcode+'"/>':"Building New Kit")})}).insert({bottom:new Element("div",{"class":"col-md-2 col-md-offset-2"}).insert({bottom:e.me._item&&e.me._item.id?new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6  text-right"}).insert({bottom:new Element("a",{"class":"btn btn-sm btn-warning",href:"/kit/new.html?clonekitid="+e.me._item.id+("1"===e.me.getUrlParam("blanklayout")?"&blanklayout=1":"")}).insert({bottom:new Element("span").update("Clone me")})})}).insert({bottom:new Element("div",{"class":"col-xs-4"}).insert({bottom:new Element("a",{"class":"btn btn-sm btn-primary"}).insert({bottom:new Element("i",{"class":"glyphicon glyphicon-print"})}).observe("click",function(){e.printWind=window.open("/print/kit/"+e.me._item.id+".html?printlater=1","_blank","width=800"),e.printWind&&e.printWind.focus()})})}):""})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"form-horizontal"}).insert({bottom:e.me.getFormGroup(new Element("label").update(e.me._item.id?"Kit Product: ":"Building a kit as: ").addClassName("col-md-1 col-sm-2"),new Element("div",{"class":"col-md-11 col-sm-10 rm-form-control kit-product-div"}).update(e.me._item.id||e.me._preSetData&&e.me._preSetData.cloneFromKit&&e.me._preSetData.cloneFromKit.id?"":new Element("input",{"class":"form-control select2 input-sm product-search","save-panel":"kit-product-id",isKit:"1",onSelectFunc:"_selectKitProduct"})))})})}).insert({bottom:e.me._getExtraInfoDiv()}).insert({bottom:new Element("div",{id:e.me.getHTMLID("kitsDetailsDiv")})}),e.newDiv.getElementsBySelector(".rm-form-control").each(function(e){e.removeClassName("form-control").removeClassName("rm-form-control")}),e.newDiv},_getProductDetailsDiv:function(e,t){var o={};return o.me=this,o.SOHInfo=t===!0?!1:!0,o.newDiv=new Element("div",{"class":"row"}),e&&e.id?(o.defaultImg=new Element("img",{"data-src":"holder.js/100%x64",src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+"}),o.newDiv.store("data",e).insert({bottom:new Element("div",{"class":"col-xs-4 col-sm-3 col-md-2 col-lg-1"}).update(o.defaultImg)}).insert({bottom:new Element("div",{"class":"col-xs-8 col-sm-9 col-md-10 col-lg-11"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-md-3 truncate"}).setStyle("max-width:none;").insert({bottom:new Element("span",{"class":"btn btn-warning btn-xs",title:"SKU: "+e.sku}).update(e.sku).observe("click",function(){o.me._openURL("/product/"+e.id+".html?blanklayout=1")})})}).insert({bottom:new Element("div",{"class":"col-md-3"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong>Brand</strong>:")}).insert({bottom:new Element("div",{"class":"col-xs-8 truncate"}).update(e.manufacturer?e.manufacturer.name:"")})}).insert({bottom:new Element("div",{"class":"col-md-6 truncate",title:e.name}).setStyle("max-width:none;").update(new Element("small").update(e.name))}).insert({bottom:new Element("small",{"class":"col-md-12"}).update("<em>"+e.shortDescription+"</em>")})}).insert({bottom:o.SOHInfo!==!0?"":new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3 col-md-2"}).insert({bottom:new Element("div",{"class":"input-group input-group-sm"}).insert({bottom:new Element("div",{"class":"input-group-addon"}).update("SOH:")}).insert({bottom:new Element("div",{"class":"form-control"}).update(e.stockOnHand)})})}).insert({bottom:new Element("div",{"class":"col-sm-4 col-md-3"}).insert({bottom:new Element("div",{"class":"input-group input-group-sm"}).insert({bottom:new Element("div",{"class":"input-group-addon"}).update("Unit Price (inc GST):")}).insert({bottom:new Element("div",{"class":"form-control"}).update(o.me.getCurrency(o.me._getUnitPrice(e)))})})})})}),o.newDiv):o.newDiv},_selectRowProduct:function(e){var t={};return t.me=this,t.rowDiv=$$(".item_row.item_row_new").first(),t.rowDiv?(t.productDetailsDiv=t.rowDiv.down(".product").down(".product-details"),t.productDetailsDiv||t.rowDiv.down(".product").insert({bottom:t.productDetailsDiv=new Element("div",{"class":"product-details"})}),t.productDetailsDiv.update(t.me._getProductDetailsDiv(e,!0)),t.rowDiv.down('[row-field="qty"]').setValue(1),t.rowDiv.down(".totalCost").update(t.me.getCurrency(e.unitCost)),t.rowDiv.down(".unitCost").update(t.me.getCurrency(e.unitCost)),t.me):t.me},_selectKitProduct:function(e){var t={};return t.me=this,t.kitProductDiv=$$(".kit-product-div").first(),t.kitProductDiv?(t.kitProductDiv.getElementsBySelector(".selected-kit-product-view").each(function(e){e.remove()}),t.kitProductDiv.insert({bottom:t.me._getProductDetailsDiv(e).addClassName("selected-kit-product-view panel-body")}),t.me._showKitDetails(),t.me):t.me},_initProductSearch:function(){var e={};return e.me=this,e.pageSize=10,e.select2=jQuery(".select2.product-search:not(.loaded)").addClass("loaded"),e.select2.select2({placeholder:"Search a product",minimumInputLength:3,data:[],ajax:{url:"/ajax/getAll",dataType:"json",quietMillis:250,data:function(t,o){return{entityName:"Product",searchTxt:"(name like :searchTxt or mageId = :searchTxtExact or sku = :searchTxtExact) and isKit = "+e.select2.attr("isKit"),searchParams:{searchTxt:"%"+t+"%",searchTxtExact:t},pageNo:o,pageSize:e.pageSize}},results:function(t,o){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:"["+t.sku+"] "+t.name,data:t})}),{results:e.result,more:o*e.pageSize<t.resultData.pagination.totalRows}}},formatResult:function(t){return t?e.me._getProductDetailsDiv(t.data):""},escapeMarkup:function(e){return e}}),e.select2.on("select2-selecting",function(t){e.txtBox=$(t.target),e.onSelectFunc=e.txtBox.readAttribute("onSelectFunc"),"function"==typeof e.me[e.onSelectFunc]&&e.me[e.onSelectFunc](t.object.data)}),e.select2.on("change",function(t){jQuery(t.target).hasClass("need-validate")&&jQuery("#"+e.me.getHTMLID("main-form")).formValidation("revalidateField",jQuery(t.target).attr("form-option"))}),e.me},_init:function(){var e={};return e.me=this,e.me},_formatTaskSelection:function(e){return e&&e.data?'<div class="row order_item item_row"><div class="col-xs-8">'+e.data.id+'</div><div class="col-xs-4" order_status="'+e.data.status.name+'">'+e.data.status.name+"</div></div>":""},_initTaskSearch:function(){var e={};return e.me=this,e.pageSize=10,e.select2=jQuery(".select2.task-search:not(.loaded)").addClass("loaded"),e.select2.select2({minimumInputLength:1,allowClear:!0,data:[],ajax:{url:"/ajax/getAll",dataType:"json",quietMillis:250,data:function(t,o){return{entityName:"Task",searchTxt:"(id like :searchTxt)",searchParams:{searchTxt:"%"+t+"%"},pageNo:o,pageSize:e.pageSize}},results:function(t,o){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.id+" ["+t.status.name+"]",data:t})}),{results:e.result,more:o*e.pageSize<t.resultData.pagination.totalRows}}},formatResult:function(t){return e.me._formatTaskSelection(t)},formatSelection:function(t){return e.me._formatTaskSelection(t)}}),e.me._item.task&&e.me._item.task.id?e.select2.select2("data",{id:e.me._item.task.id,text:e.me._item.task.id+" ["+e.me._item.task.status.name+"]",data:e.me._item.task}):e.me._preSetData.task&&e.me._preSetData.task.id&&e.select2.select2("data",{id:e.me._preSetData.task.id,text:e.me._preSetData.task.id+" ["+e.me._preSetData.task.status.name+"]",data:e.me._preSetData.task}),e.me},_initFormValidation:function(){var e={};return e.me=this,e.jQueryForm=jQuery("#"+e.me.getHTMLID("main-form")),e.jQueryForm.hasClass("form-v-loaded")||(e.jQueryForm.bootstrapValidator({message:"This value is not valid",excluded:":disabled",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{}}).on("success.form.bv",function(e){e.preventDefault()}).on("error.field.bv",function(e,t){t.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(e,t){t.bv.disableSubmitButtons(!1)}),e.jQueryForm.addClass("form-v-loaded")),e.me},disableAll:function(){var e={};return e.me=this,jQuery(".form-control").attr("disabled",!0),jQuery(".item_row_new").remove(),jQuery(".row-del-btn").remove(),jQuery(".main-save-btn").remove(),e.me},load:function(){var e={};return e.me=this,e.me._init(),$(e.me.getHTMLID("itemDiv")).update(e.div=e.me._getItemDiv()),e.me._initTaskSearch()._initProductSearch()._initFormValidation(),e.me._item.product&&e.me._item.product.id?(e.me._selectKitProduct(e.me._item.product),e.me._item.components&&e.me._item.components.size()>0&&e.me._item.components.each(function(t){e.me._addNewRow(t,e.newTable)})):e.me._preSetData.cloneFromKit&&e.me._preSetData.cloneFromKit.id&&(e.me._selectKitProduct(e.me._preSetData.cloneFromKit.product),e.me._preSetData.cloneFromKit.components&&e.me._preSetData.cloneFromKit.components.size()>0&&e.me._preSetData.cloneFromKit.components.each(function(t){delete t.id,e.me._addNewRow(t,e.newTable)})),e.me._item&&e.me._item.id&&e.me._item.shippment&&e.me._item.shippment.id&&e.me.disableAll(),e.div.down(".comments-div")&&e.div.down(".comments-div").store("CommentsDivJs",new CommentsDivJs(e.me,"Kit",e.me._item.id)._setDisplayDivId(e.div.down(".comments-div")).render()),e.me}});