var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_htmlIds:{itemDiv:"",searchPanel:"search_panel"},_supplier:null,_item:null,setHTMLIDs:function(a){this._htmlIds.itemDiv=a;return this},setPaymentMethods:function(a){this._paymentMethods=a;return this},setShippingMethods:function(a){this._shippingMethods=a;return this},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},_submitOrder:function(b){var a={};a.me=this;a.loadingDiv=new Element("div",{"class":"text-center",style:"margin-top: 100px;"}).insert({bottom:new Element("h4").update("Saving PO, please do NOT close the window")}).insert({bottom:new Element("span",{"class":"fa fa-refresh fa-spin fa-5x"})});a.me.postAjax(a.me.getCallbackId("saveOrder"),b,{onLoading:function(c,d){a.me.hideModalBox();$(a.me._htmlIds.itemDiv).insert({after:a.loadingDiv}).hide()},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.item){return}a.me._item=a.result.item;a.me.refreshParentWindow();a.newDiv=new Element("div").insert({bottom:new Element("h4").update("Yah! Saved Successfully.")}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-primary pull-right"}).update("Add Another PO").observe("click",function(){window.location=document.URL})}).insert({bottom:new Element("a",{"class":"btn btn-info",href:"/purchase/"+a.result.item.id+".html"}).update("View the details")})});a.me.showModalBox('<strong class="text-success">Success</strong>',a.newDiv,false)}catch(d){a.me.showModalBox('<strong class="text-danger">Error:</strong>',d,false);$(a.me._htmlIds.itemDiv).show();a.loadingDiv.remove()}},onComplete:function(c,d){$(a.me._htmlIds.itemDiv).show();a.loadingDiv.remove()}});return a.me},refreshParentWindow:function(){var a={};a.me=this;if(!window.opener){return}a.parentWindow=window.opener;a.row=$(a.parentWindow.document.body).down("table#item-list tbody");if(a.row){a.row=$(a.parentWindow.document.body).down("table#item-list tbody").insert({top:a.parentWindow.pageJs._getResultRow(a.me._item).addClassName("success")})}},_confirmSubmit:function(b){var a={};a.me=this;a.submitData={};a.submitData.submitToSupplier=(b===true?true:false);a.data=a.me._collectFormData($(a.me._htmlIds.itemDiv),"save-order");if(a.data===null){return a.me}a.submitData.items=[];$$(".order-item-row").each(function(c){a.item=c.retrieve("data");a.item.totalPrice=a.item.totalPrice?a.me.getValueFromCurrency(a.item.totalPrice):"0";a.item.unitPrice=a.item.unitPrice?a.me.getValueFromCurrency(a.item.unitPrice):"0";a.submitData.items.push({productId:a.item.product.id,qtyOrdered:a.item.qtyOrdered,totalPrice:a.item.totalPrice,unitPrice:a.item.unitPrice})});if(a.submitData.items.size()<=0){a.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one order item is needed!",true);return a.me}a.submitData.supplier={};a.submitData.supplier.id=a.me._supplier.id;a.submitData.supplier.contactName=a.data.contactName?a.data.contactName:a.me._supplier.contactName;a.submitData.supplier.contactNo=a.data.contactNo?a.data.contactNo:a.me._supplier.contactNo;a.submitData.supplier.email=a.data.contactEmail?a.data.contactEmail:a.me._supplier.email;a.submitData.supplierRefNum=a.data.supplierRefNum;a.submitData.eta=a.data.ETA.strip();a.submitData.comments=a.data.comments.strip();a.submitData.shippingCost=a.data.shippingCost?a.me.getValueFromCurrency(a.data.shippingCost):0;a.submitData.handlingCost=a.data.handlingCost?a.me.getValueFromCurrency(a.data.handlingCost):0;a.submitData.totalPaymentDue=a.data.totalPaymentDue?a.me.getValueFromCurrency(a.data.totalPaymentDue):0;if(a.submitData.submitToSupplier===true){a.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:a.me._getFormGroup("Do you want to send an email to this address:",new Element("input",{value:a.submitData.supplier.email,"confirm-po":"po_email",required:true,placeholder:"The email to send to. WIll NOT update the supplier's email with this."}))})}).insert({bottom:new Element("div").insert({bottom:new Element("em").insert({bottom:new Element("small").update("The above email will be used to send the email to. WIll NOT update the supplier's email with this.")})})}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-primary pull-right"}).update("Yes, send the PO to this email address").observe("click",function(){a.confirmEmailBox=$(this).up(".confirm-div").down('[confirm-po="po_email"]');if($F(a.confirmEmailBox).blank()){a.me._markFormGroupError(a.confirmEmailBox,"Email Address Required Here");return}if(!/^.+@.+(\..)*$/.test($F(a.confirmEmailBox).strip())){a.me._markFormGroupError(a.confirmEmailBox,"Please provide an valid email address");return}a.submitData.confirmEmail=$F(a.confirmEmailBox).strip();a.me._submitOrder(a.submitData)})}).insert({bottom:new Element("span",{"class":"btn btn-info"}).update("No, push PO status but DO NOT send email").observe("click",function(){a.me._submitOrder(a.submitData)})})});a.me.showModalBox('<strong class="text-info">Confirm</strong>',a.newDiv,false)}else{a.me._submitOrder(a.submitData)}return a.me},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})}).insert({bottom:new Element("span",{"class":"btn-group pull-right visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span").update("save & submit")}).observe("click",function(){a.me._confirmSubmit(true)})}).insert({bottom:new Element("span",{"class":"btn btn-primary dropdown-toggle","data-toggle":"dropdown"}).insert({bottom:new Element("span",{"class":"caret"})})}).insert({bottom:new Element("ul",{"class":"dropdown-menu save-btn-dropdown-menu"}).insert({bottom:new Element("li").insert({bottom:new Element("a",{href:"javascript: void(0);"}).update("Save Only").observe("click",function(){a.me._confirmSubmit()})})})})});return a.newDiv},_getSupplierInfoPanel:function(){var a={};a.me=this;a.supplier=a.me._supplier;a.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("strong").update("Creating PO for: "+a.supplier.name+" ")})}).insert({bottom:new Element("div",{"class":"col-sm-8 text-right"}).insert({bottom:new Element("div",{"class":"col-sm-8 text-right"}).insert({bottom:new Element("span").insert({bottom:new Element("strong",{style:"padding-left: 10px"}).update("ETA: ")}).insert({bottom:new Element("input",{style:"max-height:19px","class":"datepicker","save-order":"ETA",type:"date",value:""})})})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("strong").update("Total Due: ")}).insert({bottom:new Element("span",{"class":"badge total-payment-due"}).update(a.me.getCurrency(0))}).insert({bottom:new Element("input",{type:"hidden","class":"total-payment-due","save-order":"totalPaymentDue",value:a.me.getCurrency(0)})})})})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Name",new Element("input",{"save-order":"contactName",placeholder:"The name of the contact person",type:"text",value:a.supplier.contactName?a.supplier.contactName:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Number",new Element("input",{"save-order":"contactNo",placeholder:"The contact number of the sales person",value:a.supplier.contactNo?a.supplier.contactNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Email",new Element("input",{"save-order":"contactEmail",placeholder:"The email of the supplier",type:"email",value:a.supplier.email?a.supplier.email:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Supplier Ref Num",new Element("input",{required:"required",placeholder:"The supplier invoice number / supplier reference number","save-order":"supplierRefNum",type:"text",value:""})))})})});return a.newDiv},_loadDataPicker:function(){$$(".datepicker").each(function(a){new Prado.WebUI.TDatePicker({ID:a,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})});return this},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.tag=(c.isTitle===true?"th":"td");c.row=new Element("tr",{"class":(c.isTitle===true?"":"item_row order-item-row")}).store("data",b).insert({bottom:new Element(c.tag,{"class":"productName"}).insert({bottom:b.product.name})}).insert({bottom:new Element(c.tag,{"class":"uprice col-xs-2"}).insert({bottom:(b.unitPrice)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".tprice input").value=c.me.getCurrency($(c.txtBox).down("input").value);$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"qty col-xs-1"}).insert({bottom:(b.qtyOrdered)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"tprice col-xs-1"}).insert({bottom:(b.totalPrice)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"btns  col-xs-1"}).update(b.btns?b.btns:"")});if(b.product.sku){c.row.insert({top:new Element(c.tag,{"class":"productSku"}).update(b.product.sku)})}else{c.row.down(".productName").writeAttribute("colspan",2)}return c.row},_getSearchPrductResultRow:function(c,b){var a={};a.me=this;a.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";a.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:c.images.size()===0?a.defaultImgSrc:c.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(c.name).insert({bottom:new Element("small",{"class":"",style:"padding-left: 10px;"}).update("SKU: "+c.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(c.shortDescription)})})}).insert({bottom:new Element("div",{"class":"row",style:(c.minProductPrice||c.lastSupplierPrice||c.minSupplierPrice)?"height: 2px; background-color: brown;":"display:none"}).update("&nbsp;")}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",style:c.minProductPrice?"text-align: left":"display:none"}).update("Minimum product price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.minProductPrice))})}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.minProductPriceId)}).insert({bottom:new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",style:c.lastSupplierPrice?"text-align: left":"display:none"}).update("Last supplier price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.lastSupplierPrice))})}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.lastSupplierPriceId)}).insert({bottom:new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",style:c.minSupplierPrice?"text-align: left":"display:none"}).update("Minimum supplier price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.minSupplierPrice))})}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.minSupplierPriceId)})})})}).observe("click",function(){a.inputRow=$(b).up(".new-order-item-input").store("product",c);b.up(".productName").writeAttribute("colspan",false).update(c.sku).insert({after:new Element("td").update(c.name).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){a.newRow=a.me._getNewProductRow();$(this).up(".new-order-item-input").replace(a.newRow);a.newRow.down("[new-order-item=product]").select()})})});jQuery("#"+a.me.modalId).modal("hide");a.inputRow.down("[new-order-item=totalPrice]").writeAttribute("value",a.me.getCurrency(c.minProductPrice));a.inputRow.down("[new-order-item=qtyOrdered]").writeAttribute("value",1);a.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",a.me.getCurrency(c.minProductPrice)).select()});return a.newRow},_openPOPage:function(b){var a={};a.me=this;a.newWindow=window.open("/purchase/"+b+".html","Product Details","location=no, menubar=no, status=no, titlebar=no, fullscreen=yes, toolbar=no");a.newWindow.focus();return a.me},_searchProduct:function(b){var a={};a.me=this;a.btn=b;a.me._signRandID(a.btn);a.searchTxtBox=$(a.btn).up(".product-autocomplete").down(".search-txt");a.searchTxt=$F(a.searchTxtBox);a.me.postAjax(a.me.getCallbackId("searchProduct"),{searchTxt:a.searchTxt,supplierID:a.me._supplier.id},{onLoading:function(){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(c,f){a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.items||a.result.items.size()===0){throw"Nothing Found for: "+a.searchTxt}a.me._signRandID(a.searchTxtBox);a.result.items.each(function(e){a.resultList.insert({bottom:a.me._getSearchPrductResultRow(e,a.searchTxtBox)})});a.resultList.addClassName("list-group")}catch(d){a.resultList.update(a.me.getAlertBox("Error: ",d).addClassName("alert-danger"))}a.me.showModalBox("Products that has: "+a.searchTxt,a.resultList,false)},onComplete:function(c,d){jQuery("#"+a.btn.id).button("reset")}});return a.me},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()});a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9);return false}).observe("click",function(){$(this).select()})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a.me._searchProduct(this)})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_recalculateSummary:function(){var a={};a.me=this;a.totalExGSTPrice=0;$$(".item_row.order-item-row").each(function(b){a.rowData=b.retrieve("data");a.totalExGSTPrice=a.totalExGSTPrice*1+a.me.getValueFromCurrency(a.rowData.totalPrice)*1});jQuery('[save-order-summary="totalExGST"]').val(a.me.getCurrency(a.totalExGSTPrice)).html(a.me.getCurrency(a.totalExGSTPrice));a.totalGST=a.totalExGSTPrice*0.1;jQuery('[save-order-summary="totalGST"]').val(a.me.getCurrency(a.totalGST)).html(a.me.getCurrency(a.totalGST));a.totalIncGSTPrice=a.totalExGSTPrice*1+a.totalGST*1;jQuery('[save-order-summary="totalInGST"]').val(a.me.getCurrency(a.totalIncGSTPrice)).html(a.me.getCurrency(a.totalIncGSTPrice));a.shippingCost=0;if(jQuery('[save-order-summary="shippingCost"]').length>0){a.shippingCost=a.me.getValueFromCurrency(jQuery('[save-order-summary="shippingCost"]').val())}a.handlingCost=0;if(jQuery('[save-order-summary="handlingCost"]').length>0){a.handlingCost=a.me.getValueFromCurrency(jQuery('[save-order-summary="handlingCost"]').val())}a.totalDue=a.totalIncGSTPrice*1+a.shippingCost*1+a.handlingCost*1;jQuery(".total-payment-due").val(a.me.getCurrency(a.totalDue)).html(a.me.getCurrency(a.totalDue));return a.me},_addNewProductRow:function(b){var a={};a.me=this;a.currentRow=$(b).up(".new-order-item-input");a.product=a.currentRow.retrieve("product");if(!a.product){a.productBox=a.currentRow.down("[new-order-item=product]");if(a.currentRow.down("[new-order-item=product]")){a.me._markFormGroupError(a.productBox,"Select a product first!")}else{a.me.showModalBox("Product Needed","Select a product first!",true)}return}a.unitPriceBox=a.currentRow.down("[new-order-item=unitPrice]");a.unitPrice=a.me.getValueFromCurrency($F(a.unitPriceBox));if(a.unitPrice.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.unitPriceBox,"Invalid value provided!");return}a.qtyOrderedBox=a.currentRow.down("[new-order-item=qtyOrdered]");a.qtyOrdered=a.me.getValueFromCurrency($F(a.qtyOrderedBox));if(a.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.qtyOrderedBox,"Invalid value provided!");return}a.totalPrice=a.me.getValueFromCurrency(a.unitPrice)*a.qtyOrdered;a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(c){$(c).retrieve("clearErrFunc")()});a.data={product:a.product,unitPrice:a.me.getCurrency(a.unitPrice),qtyOrdered:a.qtyOrdered,totalPrice:a.me.getCurrency(a.totalPrice),btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("You remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.me._recalculateSummary();a.row.remove()})})};a.currentRow.insert({after:a.me._getProductRow(a.data).addClassName("btn-hide-row")});a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus();a.newRow.down("[new-order-item=product]").select();a.me._recalculateSummary(a.totalPrice);return a.me},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},unitPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:"Required!",value:a.me.getCurrency(0)}).observe("keyup",function(){a.row=$(this).up(".item_row");a.unitPrice=a.me.getValueFromCurrency($F(this));a.qty=$F(a.row.down("[new-order-item=qtyOrdered]"));$(a.row.down("[new-order-item=totalPrice]")).value=a.me.getCurrency(a.unitPrice*a.qty)}).observe("click",function(b){$(this).select()})),qtyOrdered:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:"Required!",value:"1"}).observe("keyup",function(){a.row=$(this).up(".item_row");a.unitPrice=a.me.getValueFromCurrency($F(a.row.down("[new-order-item=unitPrice]")));a.qty=$F(this);$(a.row.down("[new-order-item=totalPrice]")).value=a.me.getCurrency(a.unitPrice*a.qty)}).observe("click",function(b){$(this).select()})),totalPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:true,"new-order-item":"totalPrice",required:"Required!",value:a.me.getCurrency(0)}).observe("keyup",function(){a.row=$(this).up(".item_row");a.totalPrice=a.me.getValueFromCurrency($F(this));a.qty=$F(a.row.down("[new-order-item=qtyOrdered]"));$(a.row.down("[new-order-item=unitPrice]")).value=a.me.getCurrency(a.totalPrice/a.qty)}).observe("click",function(b){$(this).select()})),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved"})}).observe("click",function(){a.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){if(!confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")){return}a.newRow=a.me._getNewProductRow();a.currentRow=$(this).up(".new-order-item-input");a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(b){$(b).retrieve("clearErrFunc")()});a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus();a.newRow.down("[new-order-item=product]").select()})})};return a.me._getProductRow(a.data,false).addClassName("new-order-item-input info").removeClassName("order-item-row")},_getPartsTable:function(){var a={};a.me=this;a.productListDiv=new Element("table",{"class":"table table-hover table-condensed order_change_details_table"}).insert({bottom:a.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price (Ex GST)",qtyOrdered:"Qty",totalPrice:"Total Price (Ex GST)"},true).wrap(new Element("thead"))});a.productListDiv.insert({bottom:a.tbody=new Element("tbody",{style:"border: 3px #ccc solid;"}).insert({bottom:a.me._getNewProductRow()})});a.productListDiv.insert({bottom:a.tbody=new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,rowspan:6}).insert({bottom:a.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:8}))})}).insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("span").update("Total Excl. GST: "))}).insert({bottom:new Element("td",{"save-order-summary":"totalExGST","class":"active"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active",style:"border-bottom: 1px solid brown"}).update(new Element("span").update("Total GST: "))}).insert({bottom:new Element("td",{"save-order-summary":"totalGST","class":"active",style:"border-bottom: 1px solid brown"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("SubTotal Incl. GST: "))}).insert({bottom:new Element("td",{"save-order-summary":"totalInGST","class":"active"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("span").update("Shipping Cost: "))}).insert({bottom:new Element("td",{"class":"active"}).update(new Element("input",{"save-order":"shippingCost","save-order-summary":"shippingCost",placeholder:a.me.getCurrency(0)}).observe("change",function(){a.me._recalculateSummary()}))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active",style:"border-bottom: 1px solid brown"}).update(new Element("span").update("Handling Cost: "))}).insert({bottom:new Element("td",{"class":"active",style:"border-bottom: 1px solid brown"}).update(new Element("input",{"save-order":"handlingCost","save-order-summary":"handlingCost",placeholder:a.me.getCurrency(0)}).observe("change",function(){a.me._recalculateSummary()}))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("h4").update("Total Due: "))}).insert({bottom:new Element("td",{"class":"active"}).update(new Element("h4",{"save-order-summary":"totalPaymentDue","class":"total-payment-due"}).update(a.me.getCurrency(0)))})})});return new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-body table-responsive"}).insert({bottom:a.productListDiv})})},_getViewOfPurchaseOrder:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getSupplierInfoPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getPartsTable())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._saveBtns())})});return a.newDiv},selectSupplier:function(b){var a={};a.me=this;a.me._supplier=b;a.newDiv=a.me._getViewOfPurchaseOrder();$(a.me._htmlIds.itemDiv).update(a.newDiv);a.newDiv.down('input[save-order="contactName"]').focus();a.newDiv.down('input[save-order="contactName"]').select();a.me._loadDataPicker();return a.me},_getSupplierRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);b.tag=(b.isTitle===true?"th":"td");b.newDiv=new Element("tr",{"class":(b.isTitle===true?"item_top_row":"btn-hide-row item_row")+(c.active==0?" danger":""),item_id:(b.isTitle===true?"":c.id)}).store("data",c).insert({bottom:new Element(b.tag).insert({bottom:(b.isTitle===true?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){b.me.selectSupplier(c)}))})}).insert({bottom:new Element(b.tag).update(c.name)}).insert({bottom:new Element(b.tag).update(c.contactName)}).insert({bottom:new Element(b.tag).update(c.contactNo)}).insert({bottom:new Element(b.tag).update(c.description)}).insert({bottom:new Element(b.tag).insert({bottom:(b.isTitle===true?c.active:new Element("input",{type:"checkbox",disabled:true,checked:c.active}))})});return b.newDiv},_searchSupplier:function(a){var b={};b.me=this;b.searchTxt=$F(a).strip();b.searchPanel=$(a).up("#"+b.me._htmlIds.searchPanel);b.me.postAjax(b.me.getCallbackId("searchSupplier"),{searchTxt:b.searchTxt},{onLoading:function(){if($(b.searchPanel).down(".list-div")){$(b.searchPanel).down(".list-div").remove()}$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getLoadingImg())})},onSuccess:function(c,f){$(b.searchPanel).down(".panel-body").remove();try{b.result=b.me.getResp(f,false,true);if(!b.result||!b.result.items){return}$(b.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:b.me._getSupplierRow({name:"Supplier Name",contactName:"Contact Name",contactNo:"Contact Number",description:"Description",active:"Active?"},true)})}).insert({bottom:b.listDiv=new Element("tbody")})})});b.result.items.each(function(e){b.listDiv.insert({bottom:b.me._getSupplierRow(e)})})}catch(d){$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getAlertBox("ERROR",d).addClassName("alert-danger"))})}}});return b.me},_getSupplierListPanel:function(){var a={};a.me=this;a.newDiv=new Element("div",{id:a.me._htmlIds.searchPanel,"class":"panel panel-info search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Creating a new order for: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{"class":"form-control search-txt init-focus",placeholder:"Supplier name"}).observe("keyup",function(b){if(!document.getElementsByClassName("loading-img").length){a.txtBox=this;$(a.me._htmlIds.searchPanel).down(".search-btn").click()}}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){if(a.txtBox.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")!=undefined&&a.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length===1){a.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click()}});return false})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){a.btn=this;a.txtBox=$(a.me._htmlIds.searchPanel).down(".search-txt");if(!$F(a.txtBox).blank()){a.me._searchSupplier(a.txtBox)}else{if($(a.me._htmlIds.searchPanel).down(".table tbody")){$(a.me._htmlIds.searchPanel).down(".table tbody").innerHTML=null}}})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm btn-danger"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){$(a.me._htmlIds.searchPanel).down(".search-txt").clear().focus();$(a.me._htmlIds.searchPanel).down(".table tbody").innerHTML=null})})});return a.newDiv},init:function(b){var a={};a.me=this;if(b){a.me.selectSupplier(b)}else{$(a.me._htmlIds.itemDiv).update(a.me._getSupplierListPanel())}if($$(".init-focus").size()>0){$$(".init-focus").first().focus()}return a.me}});