})})}),jQuery("#"+n.me.modalId).modal("hide"),n.inputRow.down("[new-order-item=totalPrice]").value=n.me.getCurrency(e.minProductPrice),n.inputRow.down("[new-order-item=qtyOrdered]").value=1,n.inputRow.down("[new-order-item=unitPrice]").value=n.me.getCurrency(e.minProductPrice),n.inputRow.down("[new-order-item=unitPrice]").select()}),n.newRow},_saveBtns:function(){var e={};return e.me=this,e.newDiv=new Element("span",{"class":"btn-group pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){e.me._submitOrder($(this))})}).insert({bottom:new Element("span",{"class":"NEW"===e.me._purchaseorder.status?"btn btn-info":"hidden","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-send"})}).insert({bottom:new Element("span").update(" submit ")}).observe("click",function(){e.selBox=new Element("select",{"save-order":"status"}),e.selBox.insert({bottom:new Element("option").update("ORDERED")}),e.me._statusOptions.each(function(t){"ORDERED"!==e.me._purchaseorder.status&&e.selBox.insert({bottom:new Element("option").update(t)})}),$$('select[save-order="status"]').first().replace(e.selBox),e.me._submitOrder($(this),!0)})}).insert({bottom:new Element("span",{"class":"btn btn-success"}).insert({bottom:new Element("span",{"class":""}).update("Print Order ")}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-print"})}).observe("click",function(){e.me._openOrderPrintPage()})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){e.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})}),e.newDiv=e.newDiv.wrap(new Element("div")),e.newDiv.insert({top:!e.me._purchaseorder.id||"ORDERED"!==e.me._purchaseorder.status&&"RECEIVING"!==e.me._purchaseorder.status||e.me._purchaseorder.active!==!0?"":new Element("a",{"class":"btn btn-success pull-left",title:"Receiving Items",href:"/receiving/"+e.me._purchaseorder.id+".html"}).update("Receiving")}),e.newDiv},_submitOrder:function(e,t){var n={};return n.me=this,n.btn=e,n.isSubmit=t===!0?!0:!1,n.data=n.me._collectFormData($(n.me.getHTMLID("itemDiv")),"save-order"),null===n.data?n.me:(n.data.items=[],$$(".order-item-row").each(function(e){n.item=e.retrieve("data"),n.data.items.push({id:n.item.id,productId:n.item.product.id,qtyOrdered:n.item.qtyOrdered,totalPrice:n.item.totalPrice?n.me.getValueFromCurrency(n.item.totalPrice):"",unitPrice:n.item.unitPrice?n.me.getValueFromCurrency(n.item.unitPrice):"",active:!e.hasClassName("order-item-row-old-removed")})}),n.data.id=n.me._purchaseorder.id,n.data.supplierId=n.me._supplier.id,n.data.totalAmount=n.data.totalAmount?n.me.getValueFromCurrency($(n.me.getHTMLID("totalPriceIncludeGST")).innerHTML):"",n.data.totalPaid=n.data.totalPaid?n.me.getValueFromCurrency(n.data.totalPaid):"",n.data.handlingCost=n.data.handlingCost?n.me.getValueFromCurrency(n.data.handlingCost):"",n.data.shippingCost=n.data.shippingCost?n.me.getValueFromCurrency(n.data.shippingCost):"",n.me._signRandID(n.btn),n.data.isSubmit=n.isSubmit,n.me.postAjax(n.me.getCallbackId("saveOrder"),n.data,{onLoading:function(e,t){jQuery("#"+n.btn.id).button("loading")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result||!n.result.item)return;n.me._item=n.result.item,n.me.refreshParentWindow(),n.me.showModalBox("Success","Saved successfully",!1),location.reload()}catch(o){n.me.showModalBox("Error!",o,!1)}},onComplete:function(e,t){jQuery("#"+n.btn.id).button("reset")}}),n.me)},_openPOPage:function(e){var t={};return t.me=this,t.newWindow=window.open("/purchase/"+e+".html","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),t.newWindow.focus(),t.me},refreshParentWindow:function(){var e={};e.me=this,window.opener&&(e.parentWindow=window.opener,e.row=$(e.parentWindow.document.body).down("#"+e.parentWindow.pageJs.resultDivId+" .item_row[item_id="+e.me._item.id+"]"),e.row&&e.row.replace(e.parentWindow.pageJs._getResultRow(e.me._item)))},_getSummaryDiv:function(e){var t={};return t.me=this,t.item=e,t.statusOptionSel=new Element("select",{"class":"","save-item":"status"}).insert({bottom:new Element("option",{value:t.item.status}).update(t.item.status)}),t.me._statusOptions.each(function(e){e!==t.item.status&&t.statusOptionSel.insert({bottom:new Element("option",{value:e}).update(e)})}),t.newDiv=new Element("div",{"class":"panel panel-default purchaseorder-summary"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(t.item.supplier.name?"Editing: "+t.item.supplier.name+" - "+t.item.id:"Creating new purchase order: ")}).insert({bottom:new Element("small",{"class":"pull-right"}).insert({bottom:new Element("label",{"for":"showOnWeb_"+t.item.id}).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+t.item.id,style:"margin-left:10px;","save-item":"sellOnWeb",type:"checkbox"})})})}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Purchase Order Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseOrderNo"}).update(t.me._getFormGroup("PO Number",new Element("input",{disabled:"disabled",type:"value",value:t.item.purchaseOrderNo?t.item.purchaseOrderNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseRefNo"}).update(t.me._getFormGroup("PO RefNumber",new Element("input",{"save-item":"purchaseRefNo",type:"value",value:t.item.supplierRefNo?t.item.supplierRefNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 status"}).update(t.me._getFormGroup("Status",t.statusOptionSel))}).insert({bottom:new Element("div",{"class":"col-sm-1 active"}).update(t.me._getFormGroup("Active?",new Element("input",{"save-item":"active",type:"checkbox",checked:t.item.active})))}).insert({bottom:new Element("div",{"class":"col-sm-2 orderDate"}).update(t.me._getFormGroup("Ordered Date",new Element("input",{"class":"datepicker","save-item":"orderDate",value:t.item.orderDate?t.item.orderDate:""})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Supplier Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierName"}).update(t.me._getFormGroup("Name",new Element("input",{"save-item":"supplierName",type:"text",value:t.item.supplier.name?t.item.supplier.name:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierId"}).update(t.me._getFormGroup("ID",new Element("input",{"save-item":"supplierId",type:"text",value:t.item.supplier.id?t.item.supplier.id:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierMageId"}).update(t.me._getFormGroup("Mage ID",new Element("input",{"save-item":"supplierMageId",type:"value",value:t.item.supplier.mageId?t.item.supplier.mageId:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierActive"}).update(t.me._getFormGroup("Active?",new Element("input",{"save-item":"supplierActive",type:"checkbox",checked:t.item.supplier.active})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactName"}).update(t.me._getFormGroup("contactName",new Element("input",{"save-item":"supplierContactName",type:"text",value:t.item.supplierContact?t.item.supplierContact:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactNo"}).update(t.me._getFormGroup("Contact No",new Element("input",{"save-item":"supplierContactNo",type:"value",value:t.item.supplierContactNumber?t.item.supplierContactNumber:""})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Finance Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 totalAmount"}).update(t.me._getFormGroup("Total Amount",new Element("input",{"save-item":"totalAmount",type:"value",value:t.item.totalAmount?t.item.totalAmount:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 totalPaid"}).update(t.me._getFormGroup("Total Paid",new Element("input",{style:t.item.totalAmount-t.item.totalPaid?"color: red":"","save-item":"totalPaid",type:"value",value:t.item.totalPaid?t.item.totalPaid:""})))})})}),t.newDiv},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:e?new Element("label",{"class":"control-label"}).update(e):""}).insert({bottom:t.addClassName("form-control")})},bindAllEventNObjects:function(){var e={};return e.me=this,e.me},load:function(){var e={};return e.me=this,e.newDiv=e.me._getItemDiv(),$(e.me.getHTMLID("itemDiv")).update(e.newDiv),"NEW"!==e.me._purchaseorder.status&&($$(".order_change_details_table").first().down(".new-order-item-input ").remove(),e.tableHead=$$(".order_change_details_table").first().down("tr"),e.tableHead.addClassName("info").setStyle({border:"3px solid #ccc"})),$(e.me.getHTMLID("itemDiv")).down('input[save-order="contactName"]').focus(),$(e.me.getHTMLID("itemDiv")).down('input[save-order="contactName"]').select(),("RECEIVED"===e.me._purchaseorder.status||"CLOSED"===e.me._purchaseorder.status)&&($$("input").each(function(e){e.disabled=!0}),$$("select").each(function(e){e.disabled=!0}),"CLOSED"!==e.me._purchaseorder.status&&($("total-paid-amount").disabled=!1,$$('select[save-order="status"]').each(function(e){e.disabled=!1}))),e.me}});