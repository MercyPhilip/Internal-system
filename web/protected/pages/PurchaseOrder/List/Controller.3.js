var PageJs=new Class.create();PageJs.prototype=Object.extend(new CRUDPageJs(),{_getTitleRowData:function(){return{totalAmount:"Total Amount",totalPaid:"Total Paid",purchaseOrderNo:"PO Number",supplier:{name:"Supplier"},status:"Status",supplierRefNo:"Supplier Ref.",orderDate:"Order Date",active:"Active"}},_loadChosen:function(){jQuery(".chosen").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"});jQuery('.chosen-container input[type="text"]').keydown(function(a){if(a.which==13||a.keyCode==13){a.preventDefault();$("searchPanel").down("#searchBtn").click()}});return this},_bindSearchKey:function(){var a={};a.me=this;$$("#searchBtn").first().observe("click",function(b){if(!$$("#showSearch").first().checked){$$("#showSearch").first().click()}else{a.me.getSearchCriteria().getResults(true,a.me._pagination.pageSize)}});$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(c){a.me.keydown(c,function(){$("searchPanel").down("#searchBtn").click()})})});return this},_loadDataPicker:function(){$$(".datepicker").each(function(a){new Prado.WebUI.TDatePicker({ID:a,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})});return this},_setStatusOptions:function(b){var a={};a.me=this;a.selBox=$$("#searchPanel").first().down("#statusSelect");a.me._statusOptions=b;a.me._statusOptions.each(function(c){a.selBox.insert({bottom:new Element("option").update(c)})});return a.me},_loadSuppliers:function(a){var b={};b.me=this;b.me.suppliers=a;b.listBox=$(b.me.searchDivId).down('[search_field="po.supplierIds"]');b.me.suppliers.each(function(c){b.listBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return this},getResults:function(c,a){var b={};b.me=this;b.reset=(c||false);b.resultDiv=$(b.me.resultDivId);if(b.reset===true){b.me._pagination.pageNo=1}b.me._pagination.pageSize=(a||b.me._pagination.pageSize);b.me.postAjax(b.me.getCallbackId("getItems"),{pagination:b.me._pagination,searchCriteria:b.me._searchCriteria},{onLoading:function(){jQuery("#"+b.me.searchDivId+" #searchBtn").button("loading");if(b.reset===true){b.resultDiv.update(new Element("tr").update(new Element("td").update(b.me.getLoadingImg())))}},onSuccess:function(d,g){try{b.result=b.me.getResp(g,false,true);if(!b.result){return}$(b.me.totalNoOfItemsId).update(b.result.pageStats.totalRows);if(b.reset===true){b.resultDiv.update(b.me._getResultRow(b.me._getTitleRowData(),true).wrap(new Element("thead")))}b.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()});b.tbody=$(b.resultDiv).down("tbody");if(!b.tbody){$(b.resultDiv).insert({bottom:b.tbody=new Element("tbody")})}b.result.items.each(function(e){e.item.totalProdcutCount=e.totalProdcutCount;e=e.item;b.tbody.insert({bottom:b.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})});if(b.result.pageStats.pageNumber<b.result.pageStats.totalPages){b.resultDiv.insert({bottom:b.me._getNextPageBtn().addClassName("paginWrapper")})}}catch(f){b.resultDiv.insert({bottom:b.me.getAlertBox("Error",f).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+b.me.searchDivId+" #searchBtn").button("reset")}})},_getResultRow:function(c,a){var b={};b.me=this;b.tag=(b.isTitle===true?"th":"td");b.isTitle=(a||false);b.row=new Element("tr",{"class":(b.isTitle===true?"item_top_row":"btn-hide-row item_row")+(c.active==0?" danger":""),item_id:(b.isTitle===true?"":c.id)}).store("data",c).insert({bottom:new Element(b.tag,{"class":"purchaseOrderNo col-xs-1"}).update(c.purchaseOrderNo)}).observe("dblclick",function(){if(!a){b.me._openEditPage(c)}}).observe("click",function(){b.me._highlightSelectedRow(this.down(".btn"))}).insert({bottom:new Element(b.tag,{"class":"orderDate col-xs-1"}).update(b.me.loadUTCTime(c.orderDate).toLocaleString())}).insert({bottom:new Element(b.tag,{"class":"supplierId col-xs-1"}).update(c.supplier.name?c.supplier.name:"")}).insert({bottom:new Element(b.tag,{"class":"supplierRefNo col-xs-1"}).update(c.supplierRefNo?c.supplierRefNo:"")}).insert({bottom:new Element(b.tag,{"class":"totalProdcutCount col-xs-1"}).update(!b.isTitle?c.totalProdcutCount?c.totalProdcutCount:"":"Total Prodcut Count")}).insert({bottom:new Element(b.tag,{"class":"ETA col-xs-1"}).update(!b.isTitle?c.eta?b.me.loadUTCTime(c.eta).toDateString():"":"ETA")}).insert({bottom:new Element(b.tag,{"class":"totalAmount col-xs-1"}).update(!b.isTitle?b.me.getCurrency(c.totalAmount):"Total Amount")}).insert({bottom:new Element(b.tag,{"class":"totalPaid col-xs-1"}).update(!b.isTitle?c.totalPaid?b.me.getCurrency(c.totalPaid):"":"Total Paid")}).insert({bottom:new Element(b.tag,{"class":"status col-xs-1"}).update(c.status)}).insert({bottom:b.btns=new Element(b.tag,{"class":"col-xs-1 text-right"})});if(b.isTitle!==true){b.btns.insert({bottom:new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-default btn-sm",title:"Edit"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){b.me._openEditPage(c);b.me._highlightSelectedRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-sm",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to delete this item?")){return false}if(c.active){b.me._deactivateItem(this)}b.me._highlightSelectedRow(this)})})})}else{b.btns.insert({bottom:new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary btn-sm",title:"New"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:b.me._openNewPage()})})})})}return b.row},_highlightSelectedRow:function(b){var a={};a.me=this;a.item=b.down(".glyphicon-plus")?"":$(b).up("[item_id]").retrieve("data");jQuery(".item_row.success").removeClass("success");a.selectedRow=jQuery("[item_id="+a.item.id+"]").addClass("success")},_openEditPage:function(b){var a={};a.me=this;a.newWindow=window.open("/purchase/"+(b&&b.id?b.id:"new")+".html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.focus();return a.me},_openNewPage:function(b){var a={};a.me=this;a.newWindow=window.open("/purchase/new.html","PO Details","width=1300px, location=no, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.focus();return a.me},_deactivateItem:function(b){var a={};a.me=this;a.row=$(b).up("[item_id]");a.item=a.row.retrieve("data");a.me.postAjax(a.me.getCallbackId("deactivateItems"),{item_id:a.item.id},{onLoading:function(){if(a.row){a.row.toggleClassName("danger");a.row.hide()}},onSuccess:function(c,f){try{a.row.toggleClassName("danger");a.result=a.me.getResp(f,false,true);if(!a.result.item){throw"errror"}$$('[item_id="'+a.result.item.id+'"]').first().replace(a.me._getResultRow(a.result.item,false));a.me._highlightSelectedRow($$('[item_id="'+a.result.item.id+'"]').first().down(".glyphicon.glyphicon-trash"))}catch(d){a.me.showModalBox('<span class="text-danger">ERROR</span>',d,true)}}})}});