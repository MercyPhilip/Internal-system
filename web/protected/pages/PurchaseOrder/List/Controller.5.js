var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{totalAmount:"Total Amount",totalPaid:"Total Paid",purchaseOrderNo:"PO Number",supplier:{name:"Supplier"},status:"Status",supplierRefNo:"PO Ref.",orderDate:"Order Date",active:"Active"}},_loadChosen:function(){return jQuery(".chosen").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"}),jQuery('.chosen-container input[type="text"]').keydown(function(e){(13==e.which||13==e.keyCode)&&(e.preventDefault(),$("searchPanel").down("#searchBtn").click())}),this},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$("searchPanel").down("#searchBtn").click()})})}),this},_loadDataPicker:function(){return $$(".datepicker").each(function(e){new Prado.WebUI.TDatePicker({ID:e,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),this},_setStatusOptions:function(e){var t={};return t.me=this,t.selBox=$$("#searchPanel").first().down("#statusSelect"),t.me._statusOptions=e,t.me._statusOptions.each(function(e){t.selBox.insert({bottom:new Element("option").update(e)})}),t.me},_loadSuppliers:function(e){var t={};return t.me=this,t.me.suppliers=e,t.listBox=$(t.me.searchDivId).down('[search_field="po.supplierIds"]'),t.me.suppliers.each(function(e){t.listBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},getResults:function(e,t){var o={};o.me=this,o.reset=e||!1,o.resultDiv=$(o.me.resultDivId),o.reset===!0&&(o.me._pagination.pageNo=1),o.me._pagination.pageSize=t||o.me._pagination.pageSize,o.me.postAjax(o.me.getCallbackId("getItems"),{pagination:o.me._pagination,searchCriteria:o.me._searchCriteria},{onLoading:function(){jQuery("#"+o.me.searchDivId+" #searchBtn").button("loading"),o.reset===!0&&o.resultDiv.update(new Element("tr").update(new Element("td").update(o.me.getLoadingImg())))},onSuccess:function(e,t){try{if(o.result=o.me.getResp(t,!1,!0),!o.result)return;$(o.me.totalNoOfItemsId).update(o.result.pageStats.totalRows),o.reset===!0&&o.resultDiv.update(o.me._getResultRow(o.me._getTitleRowData(),!0).wrap(new Element("thead"))),o.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),o.tbody=$(o.resultDiv).down("tbody"),o.tbody||$(o.resultDiv).insert({bottom:o.tbody=new Element("tbody")}),o.result.items.each(function(e){e.item.totalProdcutCount=e.totalProdcutCount,e=e.item,o.tbody.insert({bottom:o.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})}),o.result.pageStats.pageNumber<o.result.pageStats.totalPages&&o.resultDiv.insert({bottom:o.me._getNextPageBtn().addClassName("paginWrapper")})}catch(n){o.resultDiv.insert({bottom:o.me.getAlertBox("Error",n).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+o.me.searchDivId+" #searchBtn").button("reset")}})},_getResultRow:function(e,t){var o={};return o.me=this,o.tag=o.isTitle===!0?"th":"td",o.isTitle=t||!1,o.row=new Element("tr",{"class":(o.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==e.active?" danger":""),item_id:o.isTitle===!0?"":e.id}).store("data",e).insert({bottom:new Element(o.tag,{"class":"purchaseOrderNo col-xs-1"}).update(e.purchaseOrderNo)}).observe("dblclick",function(){t||o.me._openEditPage(e)}).observe("click",function(){o.me._highlightSelectedRow(this.down(".btn"))}).insert({bottom:new Element(o.tag,{"class":"orderDate col-xs-1"}).update(o.me.loadUTCTime(e.orderDate).toLocaleString())}).insert({bottom:new Element(o.tag,{"class":"supplierId col-xs-1"}).update(e.supplier.name?e.supplier.name:"")}).insert({bottom:new Element(o.tag,{"class":"supplierRefNo col-xs-1"}).update(e.supplierRefNo?e.supplierRefNo:"")}).insert({bottom:new Element(o.tag,{"class":"totalProdcutCount col-xs-1"}).update(o.isTitle?"Total Prodcut Count":e.totalProdcutCount?e.totalProdcutCount:"")}).insert({bottom:new Element(o.tag,{"class":"ETA col-xs-1"}).update(o.isTitle?"ETA":e.eta?o.me.loadUTCTime(e.eta).toDateString():"")}).insert({bottom:new Element(o.tag,{"class":"totalAmount col-xs-1"}).update(o.isTitle?"Total Amount":o.me.getCurrency(e.totalAmount))}).insert({bottom:new Element(o.tag,{"class":"totalPaid col-xs-1"}).update(o.isTitle?"Total Paid":e.totalPaid?o.me.getCurrency(e.totalPaid):"")}).insert({bottom:new Element(o.tag,{"class":"status col-xs-1"}).update(e.status)}).insert({bottom:o.btns=new Element(o.tag,{"class":"col-xs-1 text-right"})}),o.btns.insert(o.isTitle!==!0?{bottom:new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-default btn-sm",title:"Edit"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){o.me._openEditPage(e),o.me._highlightSelectedRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-sm",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){return confirm("Are you sure you want to delete this item?")?(e.active&&o.me._deactivateItem(this),void o.me._highlightSelectedRow(this)):!1})})}:{bottom:new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary btn-sm",title:"New"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:o.me._openNewPage()})})})}),o.row},_highlightSelectedRow:function(e){var t={};t.me=this,t.item=e.down(".glyphicon-plus")?"":$(e).up("[item_id]").retrieve("data"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success")},_openEditPage:function(e){var t={};return t.me=this,t.newWindow=window.open("/purchase/"+(e&&e.id?e.id:"new")+".html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),t.newWindow.focus(),t.me},_openNewPage:function(){var e={};return e.me=this,e.newWindow=window.open("/purchase/new.html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),e.newWindow.focus(),e.me},_deactivateItem:function(e){var t={};t.me=this,t.row=$(e).up("[item_id]"),t.item=t.row.retrieve("data"),t.me.postAjax(t.me.getCallbackId("deactivateItems"),{item_id:t.item.id},{onLoading:function(){t.row&&(t.row.toggleClassName("danger"),t.row.hide())},onSuccess:function(e,o){try{if(t.row.toggleClassName("danger"),t.result=t.me.getResp(o,!1,!0),!t.result.item)throw"errror";$$('[item_id="'+t.result.item.id+'"]').first().replace(t.me._getResultRow(t.result.item,!1)),t.me._highlightSelectedRow($$('[item_id="'+t.result.item.id+'"]').first().down(".glyphicon.glyphicon-trash"))}catch(n){t.me.showModalBox('<span class="text-danger">ERROR</span>',n,!0)}}})}});