var PageJs=new Class.create;PageJs.TierLevel={ID_GENERAL:1},PageJs.prototype=Object.extend(new DetailsPageJs,{_customer:{},_tierlevels:[],setPreData:function(a,b){return this._customer=a,this._tierlevels=b,this},_getItemDiv:function(){var a={};return a.me=this,a.newDiv=new Element("div",{class:"customer-editing-container"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:a.me._getCustomerSummaryDiv(a.me._item).wrap(new Element("div",{class:"col-sm-12"}))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:a.me._getCustomerBillingSummaryDiv(a.me._item).wrap(new Element("div",{class:"col-sm-6"}))}).insert({bottom:a.me._getCustomerShippingSummaryDiv(a.me._item).wrap(new Element("div",{class:"col-sm-6"}))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("span",{id:"saveBtn",class:"btn btn-primary pull-right col-sm-4","data-loading-text":"saving ..."}).update("Save").observe("click",function(){a.me._submitSave(this)})})}),a.newDiv},_submitSave:function(a){var b={};return b.me=this,b.data=b.me._collectFormData($(b.me.getHTMLID("itemDiv")),"save-item"),null===b.data?b.me:(b.data.id=b.me._customer.id?b.me._customer.id:"",b.me.saveItem(a,b.data,function(a){b.me.showModalBox('<strong class="text-success">Saved Successfully!</strong>',"Saved Successfully!",!0),b.me._item=a.item,b.me.refreshParentWindow(),window.parent.jQuery.fancybox.close()}),b.me)},_bindSaveKey:function(){var a={};return a.me=this,$$(".customer-editing-container").first().getElementsBySelector("[save-item]").each(function(b){b.observe("keydown",function(b){a.me.keydown(b,function(){$$(".customer-editing-container").first().down("#saveBtn").click()})})}),this},refreshParentWindow:function(){var a={};a.me=this,window.parent&&(a.parentWindow=window.parent,a.row=$(a.parentWindow.document.body).down("#"+a.parentWindow.pageJs.resultDivId+" .item_row[item_id="+a.me._item.id+"]"),a.row?a.row.replace(a.parentWindow.pageJs._getResultRow(a.me._item).addClassName("success")):a.parentWindow.pageJs&&"function"==typeof a.parentWindow.pageJs.getSearchCriteria&&a.parentWindow.pageJs.getSearchCriteria().getResults(!0,a.parentWindow.pageJs._pagination.pageSize))},_getTierSelBox:function(){var a={},b=PageJs.TierLevel.ID_GENERAL;return a.me=this,a.me._customer&&a.me._customer.id&&(b=a.me._customer.tier.id),a.selBox=new Element("select",{"save-item":"tier"}),a.me._tierlevels.each(function(c){a.opt=new Element("option",{value:c.id}).update(c.name),b==c.id&&a.opt.writeAttribute("selected",!0),a.selBox.insert({bottom:a.opt})}),a.selBox},_getCustomerSummaryDiv:function(a){var b={};return b.me=this,b.item=a,b.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(b.item.name?"Editing: "+b.item.name:"Creating new customer: ")})}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-3"}).update(b.me._getFormGroup("Company Name / Customer Name",new Element("input",{required:!0,"save-item":"name",type:"text",value:b.item.name?b.item.name:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Email",new Element("input",{"save-item":"email",type:"email",value:b.item.email?b.item.email:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Contact No?",new Element("input",{"save-item":"contactNo",type:"value",value:b.item.contactNo?b.item.contactNo:""})))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Terms",new Element("input",{"save-item":"terms",type:"value",value:b.item.terms?b.item.terms:""})))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Credit Left",new Element("input",{class:"form-control","save-item":"credit",validate_currency:!0,value:b.item.creditpool?b.me.getCurrency(b.item.creditpool.totalCreditLeft):0})))}).observe("change",function(){b.me._currencyInputChanged(b.newDiv.down("[save-item=credit]"))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Tier Level",b.me._getTierSelBox()))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("IsBlocked?",new Element("input",{"save-item":"isBlocked",type:"checkbox",checked:!!b.item.isBlocked&&b.item.isBlocked})))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Active?",new Element("input",{"save-item":"active",type:"checkbox",checked:!!b.item.active&&b.item.active})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Commercial Group",new Element("input",{"save-item":"groupCom",type:"checkbox",checked:!!b.item.groupCom&&b.item.groupCom})))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Educational Group",new Element("input",{"save-item":"groupEdu",type:"checkbox",checked:!!b.item.groupEdu&&b.item.groupEdu})))}).insert({bottom:new Element("div",{class:"col-sm-1"}).update(b.me._getFormGroup("Gaming Group",new Element("input",{"save-item":"groupGame",type:"checkbox",checked:!!b.item.groupGame&&b.item.groupGame})))})})}),b.newDiv},_getCurrency:function(a,b,c,d,e){var f={};return f.decimal=isNaN(c=Math.abs(c))?2:c,f.dollar=void 0==b?"$":b,f.decimalPoint=void 0==d?".":d,f.thousandPoint=void 0==e?",":e,f.sign=a<0?"-":"",f.Int=parseInt(a=Math.abs(+a||0).toFixed(f.decimal))+"",f.j=(f.j=f.Int.length)>3?f.j%3:0,f.dollar+f.sign+(f.j?f.Int.substr(0,f.j)+f.thousandPoint:"")+f.Int.substr(f.j).replace(/(\d{3})(?=\d)/g,"$1"+f.thousandPoint)+(f.decimal?f.decimalPoint+Math.abs(a-f.Int).toFixed(f.decimal).slice(2):"")},_getValueFromCurrency:function(a){return a?(a+"").replace(/\s*/g,"").replace(/\$/g,"").replace(/,/g,""):""},_markFormGroupError:function(a,b){var c={};return c.me=this,a.up(".form-group")&&(a.store("clearErrFunc",function(b){a.up(".form-group").removeClassName("has-error"),jQuery("#"+a.id).tooltip("hide").tooltip("destroy").show()}).up(".form-group").addClassName("has-error"),c.me._signRandID(a),jQuery("#"+a.id).tooltip({trigger:"manual",placement:"auto",container:"body",placement:"bottom",html:!0,title:b,content:b}).tooltip("show"),$(a).observe("change",function(){c.func=$(a).retrieve("clearErrFunc"),"function"==typeof c.func&&c.func()})),c.me},_currencyInputChanged:function(a){var b={};return b.me=this,!$F(a).blank()&&(b.inputValue=b.me._getValueFromCurrency($F(a)),null===b.inputValue.match(/^(-)?\d+(\.\d{1,4})?$/)?(b.me._markFormGroupError(a,"Invalid currency format provided!"),!1):($(a).value=b.me._getCurrency(b.inputValue),!0))},_copyInfoFields:function(a,b,c,d){var e={};e.me=this,""!==$$(".customer-editing-container").first().down("#"+b+"-info #"+b+d+" input").value&&$(a).up(".panel").down("#"+c+d+" input").writeAttribute("value",$$(".customer-editing-container").first().down("#"+b+"-info #"+b+d+" input").value)},_getCustomerBillingSummaryDiv:function(a){var b={};return b.me=this,b.item=a,b.address=b.item.id&&b.item.address&&b.item.address.billing?b.item.address.billing:{},b.newDiv=new Element("div",{class:"panel panel-default",id:"billing-info"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("strong").update(b.item.name?"Billing Info: "+b.item.name:"Billing Info: new customer")}).insert({bottom:new Element("small",{class:"pull-right"}).insert({bottom:new Element("button",{class:"btn btn-default btn-xs",type:"button"}).update("Copy from Shipping")})}).observe("click",function(){b.me._copyInfoFields($(this),"shipping","billing","CompanyName"),b.me._copyInfoFields($(this),"shipping","billing","Name"),b.me._copyInfoFields($(this),"shipping","billing","ContactNo"),b.me._copyInfoFields($(this),"shipping","billing","Street"),b.me._copyInfoFields($(this),"shipping","billing","City"),b.me._copyInfoFields($(this),"shipping","billing","State"),b.me._copyInfoFields($(this),"shipping","billing","Country"),b.me._copyInfoFields($(this),"shipping","billing","Posecode")})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"billingCompanyName"}).update(b.me._getFormGroup("Company Name",new Element("input",{"save-item":"billingCompanyName",type:"text",value:b.address.companyName?b.address.companyName:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"billingName"}).update(b.me._getFormGroup("Name",new Element("input",{"save-item":"billingName",type:"text",value:b.address.contactName?b.address.contactName:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"billingContactNo"}).update(b.me._getFormGroup("Contact No.",new Element("input",{"save-item":"billingContactNo",type:"value",value:b.address.contactNo?b.address.contactNo:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6",id:"billingStreet"}).update(b.me._getFormGroup("Street",new Element("input",{"save-item":"billingStreet",type:"text",value:b.address.street?b.address.street:""})))}).insert({bottom:new Element("div",{class:"col-sm-6",id:"billingCity"}).update(b.me._getFormGroup("City",new Element("input",{"save-item":"billingCity",type:"text",value:b.address.city?b.address.city:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-4",id:"billingState"}).update(b.me._getFormGroup("State",new Element("input",{"save-item":"billingState",type:"text",value:b.address.region?b.address.region:""})))}).insert({bottom:new Element("div",{class:"col-sm-4",id:"billingCountry"}).update(b.me._getFormGroup("Country",new Element("input",{"save-item":"billingCountry",type:"text",value:b.address.country?b.address.country:""})))}).insert({bottom:new Element("div",{class:"col-sm-4",id:"billingPosecode"}).update(b.me._getFormGroup("Post Code",new Element("input",{"save-item":"billingPosecode",type:"text",value:b.address.postCode?b.address.postCode:""})))})})}),b.newDiv},_getCustomerShippingSummaryDiv:function(a){var b={};return b.me=this,b.item=a,b.address=b.item.id&&b.item.address&&b.item.address.shipping?b.item.address.shipping:{},b.newDiv=new Element("div",{class:"panel panel-default",id:"shipping-info"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("strong").update(b.item.name?"Shipping Info: "+b.item.name:"Shipping Info: new customer")}).insert({bottom:new Element("small",{class:"pull-right"}).insert({bottom:new Element("button",{class:"btn btn-default btn-xs",type:"button"}).update("Copy from Billing")})}).observe("click",function(){b.me._copyInfoFields($(this),"billing","shipping","CompanyName"),b.me._copyInfoFields($(this),"billing","shipping","Name"),b.me._copyInfoFields($(this),"billing","shipping","ContactNo"),b.me._copyInfoFields($(this),"billing","shipping","Street"),b.me._copyInfoFields($(this),"billing","shipping","City"),b.me._copyInfoFields($(this),"billing","shipping","State"),b.me._copyInfoFields($(this),"billing","shipping","Country"),b.me._copyInfoFields($(this),"billing","shipping","Posecode")})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"shippingCompanyName"}).update(b.me._getFormGroup("Company Name",new Element("input",{"save-item":"shippingCompanyName",type:"text",value:b.address.companyName?b.address.companyName:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"shippingName"}).update(b.me._getFormGroup("Name",new Element("input",{"save-item":"shippingName",type:"text",value:b.address.contactName?b.address.contactName:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-12",id:"shippingContactNo"}).update(b.me._getFormGroup("Contact No.",new Element("input",{"save-item":"shippingContactNo",type:"value",value:b.address.contactNo?b.address.contactNo:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6",id:"shippingStreet"}).update(b.me._getFormGroup("Street",new Element("input",{"save-item":"shippingStreet",type:"text",value:b.address.street?b.address.street:""})))}).insert({bottom:new Element("div",{class:"col-sm-6",id:"shippingCity"}).update(b.me._getFormGroup("City",new Element("input",{"save-item":"shippingCity",type:"text",value:b.address.city?b.address.city:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-4",id:"shippingState"}).update(b.me._getFormGroup("State",new Element("input",{"save-item":"shippingState",type:"text",value:b.address.region?b.address.region:""})))}).insert({bottom:new Element("div",{class:"col-sm-4",id:"shippingCountry"}).update(b.me._getFormGroup("Country",new Element("input",{"save-item":"shippingCountry",type:"text",value:b.address.country?b.address.country:""})))}).insert({bottom:new Element("div",{class:"col-sm-4",id:"shippingPosecode"}).update(b.me._getFormGroup("Post Code",new Element("input",{"save-item":"shippingPosecode",type:"text",value:b.address.postCode?b.address.postCode:""})))})})}),b.newDiv},_getFormGroup:function(a,b){return new Element("div",{class:"form-group form-group-sm form-group-sm-label"}).insert({bottom:new Element("label").update(a)}).insert({bottom:b.addClassName("form-control")})},bindAllEventNObjects:function(){var a={};return a.me=this,a.me}});