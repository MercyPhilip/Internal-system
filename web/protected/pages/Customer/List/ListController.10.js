function comparer(a){return function(b,c){var d=getCellValue(b,a),e=getCellValue(c,a);return jQuery.isNumeric(d)&&jQuery.isNumeric(e)?d-e:d.localeCompare(e)}}function getCellValue(a,b){return jQuery(a).children("td").eq(b).text()}var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_tiers:[],_getTitleRowData:function(a){var b={};return b.me=this,a=a||{},a.length>0?{email:"Email",terms:"Terms",tier:{name:"Tier"},name:"Name",contactNo:"Contact Num",description:"Description",message:a,addresses:"Addresses",address:{billing:{full:"Billing Address"},shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?",isBlocked:"IsBlocked",groupCom:"Commercial Group",groupEdu:"Educational Group",groupGame:"Gaming Group"}:{email:"Email",terms:"Terms",tier:{name:"Tier"},name:"Name",contactNo:"Contact Num",description:"Description",addresses:"Addresses",address:{billing:{full:"Billing Address"},shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?",isBlocked:"IsBlocked",groupCom:"Commercial Group",groupEdu:"Educational Group",groupGame:"Gaming Group"}},_loadTiers:function(a){this._tiers=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="cust.tier"]'),b.me._tiers.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadChosen:function(){return jQuery(".chosen").select2({minimumResultsForSearch:1/0}),this},_bindSearchKey:function(){var a={};return a.me=this,$$("#searchBtn").first().observe("click",function(b){$$("#showSearch").first().checked?a.me.getSearchCriteria().getResults(!0,a.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(b){a.me.keydown(b,function(){$(a.me.searchDivId).down("#searchBtn").click()})})}),this},_openEditPage:function(a){var b={};return b.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",frameborder:"0",border:"0",seamless:"seamless",href:"/customer/"+(a&&a.id?a.id:"new")+".html"}),b.me},_highlightSelectedRow:function(a){var b={};b.me=this,b.item=a.down(".glyphicon-plus")?"":$(a).up("[item_id]").retrieve("data"),b.selectedRow=jQuery("[item_id="+b.item.id+"]").addClass("success")},_displaySelectedAddress:function(a){var b={};return b.me=this,b.item=$(a).up("[item_id]").retrieve("data"),b.type=$(a).down("span").classList.contains("address-shipping"),jQuery(".popover-loaded").popover("hide"),jQuery(".item_row.success").removeClass("success"),b.selectedRow=jQuery("[item_id="+b.item.id+"]").addClass("success"),b.me._signRandID(a),jQuery("#"+a.id).hasClass("popover-loaded")||jQuery("#"+a.id).popover({title:'<div class="row"><div class="col-xs-10">Details for: '+b.item.name+'</div><div class="col-xs-2" style="cursor: pointer" href="javascript:void(0);" onclick="jQuery(\'#'+a.id+"').popover('hide');\"><span class=\"pull-right glyphicon glyphicon-remove\" ></span></div></div>",html:!0,placement:function(){return b.type?"left":"right"},container:"body",trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return b.type?"<p>"+b.item.address.shipping.full+"</p>":"<p>"+b.item.address.billing.full+"</p>"},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded"),jQuery("#"+a.id).popover("toggle"),b.me},_bindMergeCustomersBtn:function(a){var b={};return b.me=this,b.btn=a||$("mergeBtn"),b.me.observeClickNDbClick(b.btn,function(){return b.selected=b.me._getSelection(),b.totalQty=$("total-found-count").innerHTML,null!==b.selected&&b.selected.length>1?(confirm("You are about to merge multiple customers to the first selected customer.\n"+(b.selected.length-1)+" customer(s) will be deleted. Continue?")&&b.me.postAjax(b.me.getCallbackId("mergeCustomers"),{item:b.selected},{onLoading:function(){},onSuccess:function(a,c){try{b.me.getSearchCriteria().getResults(!0,b.me._pagination.pageSize)}catch(a){b.me.showModalBox('<span class="text-danger">ERROR:</span>',a,!0)}}}),b.me):void alert("Please select at least two customers that you want to merge!")},null),b.me},_getSelection:function(){var a={};return a.me=this,a.customers=[],a.itemList=$("item-list"),a.itemList.getElementsBySelector(".btn-hide-row.item_row").each(function(b){a.checked=b.down('input.customer-selected[type="checkbox"]').checked,a.customerId=b.readAttribute("item_id"),a.checked===!0&&jQuery.isNumeric(a.customerId)===!0&&a.customers.push(b.retrieve("data"))}),$("total-selected-count").update(a.customers.length),a.customers},_getResultRow:function(a,b){var c={};if(c.me=this,c.tag=b===!0?"th":"td",c.isTitle=b||!1,c.row=new Element("tr",{class:(c.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==a.active?" danger":""),item_id:c.isTitle===!0?"":a.id}).store("data",a).insert({bottom:new Element(c.tag,{class:"name col-xs-1"}).insert({bottom:1==c.isTitle?"":new Element("span").setStyle("margin: 0 5px 0 0").insert({bottom:new Element("input",{type:"checkbox",class:"customer-selected"}).observe("click",function(a){c.checked=this.checked,c.me._getSelection()})})}).insert({bottom:new Element("span").setStyle("margin: 0 5px 0 0").update(a.name).observe("click",function(){c.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")})}).observe("dblclick",function(){$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")}),c.me._openEditPage(a)})})}).insert({bottom:new Element(c.tag,{class:"email col-xs-1",style:"text-decoration: underline;"}).update(a.email).observe("click",function(){c.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")})}).observe("dblclick",function(){$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")}),c.newWindow=window.open("mailto:"+a.email,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),c.newWindow.close()})}).insert({bottom:new Element(c.tag,{class:"tier col-xs-1 truncate"}).update(a.tier.name)}).insert({bottom:new Element(c.tag,{class:"terms col-xs-1 truncate"}).update(a.terms)}).insert({bottom:new Element(c.tag,{class:"isBlocked col-xs-1"}).insert({bottom:c.isTitle===!0?a.isBlocked:new Element("input",{type:"checkbox",disabled:!0,checked:a.isBlocked})})}).insert({bottom:new Element(c.tag,{class:"contact col-xs-1 truncate"}).update(a.contactNo)}).insert({bottom:new Element(c.tag,{class:"description col-xs-1"}).update(a.description)}),a.hasOwnProperty("message"))for(var d=a.message.length;d--;)c.row=c.row.insert({bottom:new Element(c.tag,{class:"message col-xs-1",style:"width: 12%"}).insert({bottom:c.isTitle===!0?new Element("div",{style:"width: 100%"}).insert({bottom:a.message[d].title}).insert({bottom:new Element(c.tag,{class:"message col-xs-1",style:"width: 12%; padding-left:0"}).insert({bottom:new Element("span",{style:"float:left; width: 40%; padding-top:5px"}).insert({bottom:a.message[d].nameOpen})}).insert({bottom:new Element("span",{style:"float:left; width: 60%; padding-top:5px"}).insert({bottom:a.message[d].nameClick})})}):new Element("span",{style:"display: inline-block; padding-left:15px"}).insert({bottom:new Element("span",{style:"display: inline-block; padding-right: 15px"}).update(a.message[d].opened)}).insert({bottom:new Element("span",{style:"display: inline-block; padding-left: 50px"}).update(a.message[d].clicked)})})});return c.row=c.row.insert({bottom:new Element(c.tag,{class:"address col-xs-1"}).insert({bottom:c.isTitle===!0?a.addresses:new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{class:"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plane address-shipping",style:"font-size: 1.3em"})}).observe("click",function(){c.me._displaySelectedAddress(this)})})}).insert({bottom:c.isTitle===!0?"":new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{class:"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-usd address-billing",style:"font-size: 1.3em; padding-left:10%;"})}).observe("click",function(){c.me._displaySelectedAddress(this)})})})}).insert({bottom:new Element(c.tag,{class:"mageId col-xs-1"}).update(a.mageId)}).insert({bottom:new Element(c.tag,{class:"cust_active col-xs-1"}).insert({bottom:c.isTitle===!0?a.active:new Element("input",{type:"checkbox",disabled:!0,checked:a.active})})}).insert({bottom:new Element(c.tag,{class:"grouping col-xs-1"}).insert({bottom:c.isTitle===!0?a.groupCom:new Element("input",{type:"checkbox",disabled:!0,checked:a.groupCom})})}).insert({bottom:new Element(c.tag,{class:"grouping col-xs-1"}).insert({bottom:c.isTitle===!0?a.groupEdu:new Element("input",{type:"checkbox",disabled:!0,checked:a.groupEdu})})}).insert({bottom:new Element(c.tag,{class:"grouping col-xs-1"}).insert({bottom:c.isTitle===!0?a.groupGame:new Element("input",{type:"checkbox",disabled:!0,checked:a.groupGame})})}).insert({bottom:new Element(c.tag,{class:"text-right col-xs-1"}).update(c.isTitle===!0?new Element("span",{class:"btn btn-primary btn-xs",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:c.me._openEditPage()})}):new Element("span",{class:"btn-group btn-group-xs"}).insert({bottom:new Element("span",{class:"btn btn-default",title:"Edit"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-pencil"})}).observe("click",function(){$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")}),c.me._openEditPage(a)})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){return!!confirm("Are you sure you want to deactivate this item?")&&(a.active&&c.me._deactivateItem(this),void $$(".popover-loaded").each(function(a){jQuery(a).popover("hide")}))})})).observe("click",function(){c.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(a){jQuery(a).popover("hide")})})}),c.row},_getNextPageBtn:function(){var a={};return a.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"8",class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){a.me._pagination.pageNo=1*a.me._pagination.pageNo+1,jQuery(this).button("loading"),a.me.getResults()})})})})},_deactivateItem:function(a){var b={};b.me=this,b.row=$(a).up("[item_id]"),b.item=b.row.retrieve("data"),b.me.postAjax(b.me.getCallbackId("deactivateItems"),{item_id:b.item.id},{onLoading:function(){b.row&&(b.row.toggleClassName("danger"),b.row.hide())},onSuccess:function(a,c){try{if(b.row.toggleClassName("danger"),b.result=b.me.getResp(c,!1,!0),!b.result.item)throw"errror";$$('[item_id="'+b.result.item.id+'"]').first().replace(b.me._getResultRow(b.result.item,!1)),b.me._highlightSelectedRow($$('[item_id="'+b.result.item.id+'"]').first().down(".glyphicon.glyphicon-trash"))}catch(a){b.me.showModalBox('<span class="text-danger">ERROR</span>',a,!0)}}})},integrateActon:function(a){var b={};return b.me=this,b.data={},$$("[search_field]").each(function(a){b.data[a.readAttribute("search_field")]=$F(a)}),confirm(" Would you like to create a contact list on Act-On?")&&b.me.postAjax(b.me.getCallbackId("integrateActon"),b.data,{onLoading:function(){jQuery(a).button("loading")},onSuccess:function(c,d){try{if(b.result=b.me.getResp(d,!1,!0),!b.result)return;b.result.errorCode?10056==b.result.errorCode?confirm("The list you selected already exists.\n Would you like to update the exist list?")&&b.me.postAjax(b.me.getCallbackId("updateActon"),{filename:b.result.filename,listname:b.result.listname},{onLoading:function(){jQuery(a).button("loading")},onSuccess:function(a,c){b.result=b.me.getResp(c,!1,!0),b.result&&(b.result.errorCode?b.me.showModalBox("Error",b.result.message+" --"+b.result.errorCode,!1):b.result.status&&b.me.showModalBox("Success",b.result.message,!1))},onComplete:function(){jQuery(a).button("reset")}}):b.me.showModalBox("Error",b.result.message+" --"+b.result.errorCode,!1):b.result.status&&b.me.showModalBox("Success",b.result.message,!1)}catch(a){b.me.showModalBox("<b>Error:</b>",'<b class="text-danger">'+a+"</b>")}},onComplete:function(){jQuery(a).button("reset")}}),b.me},checkboxToggle:function(){var a={};return a.me=this,jQuery("#labelCom").click(function(){jQuery("#groupCom").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelEdu").click(function(){jQuery("#groupEdu").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelGame").click(function(){jQuery("#groupGame").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelGen").click(function(){jQuery("#groupGen").prop("checked",!0),jQuery(".groupCom").prop("checked",!1)}),jQuery(".groupGen").change(function(){jQuery(this).is(":checked")&&jQuery(".groupCom").prop("checked",!1)}),jQuery(".groupCom").change(function(){jQuery(this).is(":checked")&&jQuery(".groupGen").prop("checked",!1)}),a.me},_checkActOnEnable:function(){var a={};return a.me=this,a.me.postAjax(a.me.getCallbackId("checkActOnEnable"),{},{onLoading:function(){},onSuccess:function(b,c){a.result=a.me.getResp(c,!1,!0),a.result&&0==a.result.enable&&jQuery("#integrateActonBtn","#respondingNum").hide()},onComplete:function(){}}),a.me}}),jQuery("#integrateActonBtn").ready(function(){var a=new PageJs;a._checkActOnEnable()}),jQuery(document).on("click","th > div > th > span",function(){var a=jQuery(this).parents("table").eq(0),b=a.find("tr:gt(0):lt(90)").toArray().sort(comparer(jQuery(this).parents("tr > th").index()));this.asc=!this.asc,this.asc||(b=b.reverse()),a.children("tbody").empty().html(b)});