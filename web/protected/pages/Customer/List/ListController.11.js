function comparer(e){return function(t,n){var o=getCellValue(t,e),s=getCellValue(n,e);return jQuery.isNumeric(o)&&jQuery.isNumeric(s)?o-s:o.localeCompare(s)}}function getCellValue(e,t){return jQuery(e).children("td").eq(t).text()}var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_tiers:[],_getTitleRowData:function(e){return{}.me=this,e=e||{},e.length>0?{email:"Email",terms:"Terms",tier:{name:"Tier"},name:"Name",contactNo:"Contact Num",description:"Description",message:e,addresses:"Addresses",address:{billing:{full:"Billing Address"},shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?",isBlocked:"IsBlocked",groupCom:"Commercial Group",groupEdu:"Educational Group",groupGame:"Gaming Group"}:{email:"Email",terms:"Terms",tier:{name:"Tier"},name:"Name",contactNo:"Contact Num",description:"Description",addresses:"Addresses",address:{billing:{full:"Billing Address"},shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?",isBlocked:"IsBlocked",groupCom:"Commercial Group",groupEdu:"Educational Group",groupGame:"Gaming Group"}},_loadTiers:function(e){this._tiers=e;var t={};return t.me=this,t.selectionBox=$(t.me.searchDivId).down('[search_field="cust.tier"]'),t.me._tiers.each(function(e){t.selectionBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},_loadChosen:function(){return jQuery(".chosen").select2({minimumResultsForSearch:1/0}),this},setConfigActon:function(e){return this._actonSetting=e,this},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(t){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$(e.me.searchDivId).down("#searchBtn").click()})})}),this},_openEditPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",frameborder:"0",border:"0",seamless:"seamless",href:"/customer/"+(e&&e.id?e.id:"new")+".html"}),t.me},_highlightSelectedRow:function(e){var t={};t.me=this,t.item=e.down(".glyphicon-plus")?"":$(e).up("[item_id]").retrieve("data"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success")},_displaySelectedAddress:function(e){var t={};return t.me=this,t.item=$(e).up("[item_id]").retrieve("data"),t.type=$(e).down("span").classList.contains("address-shipping"),jQuery(".popover-loaded").popover("hide"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success"),t.me._signRandID(e),jQuery("#"+e.id).hasClass("popover-loaded")||jQuery("#"+e.id).popover({title:'<div class="row"><div class="col-xs-10">Details for: '+t.item.name+'</div><div class="col-xs-2" style="cursor: pointer" href="javascript:void(0);" onclick="jQuery(\'#'+e.id+"').popover('hide');\"><span class=\"pull-right glyphicon glyphicon-remove\" ></span></div></div>",html:!0,placement:function(){return t.type?"left":"right"},container:"body",trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return t.type?"<p>"+t.item.address.shipping.full+"</p>":"<p>"+t.item.address.billing.full+"</p>"},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded"),jQuery("#"+e.id).popover("toggle"),t.me},_bindMergeCustomersBtn:function(e){var t={};return t.me=this,t.btn=e||$("mergeBtn"),t.me.observeClickNDbClick(t.btn,function(){if(t.selected=t.me._getSelection(),t.totalQty=$("total-found-count").innerHTML,null!==t.selected&&t.selected.length>1)return confirm("You are about to merge multiple customers to the first selected customer.\n"+(t.selected.length-1)+" customer(s) will be deleted. Continue?")&&t.me.postAjax(t.me.getCallbackId("mergeCustomers"),{item:t.selected},{onLoading:function(){},onSuccess:function(e,n){try{t.me.getSearchCriteria().getResults(!0,t.me._pagination.pageSize)}catch(e){t.me.showModalBox('<span class="text-danger">ERROR:</span>',e,!0)}}}),t.me;alert("Please select at least two customers that you want to merge!")},null),t.me},_bindAddCustomerBtn:function(e){var t={};return t.me=this,t.btn=e||$("newBtn"),t.me.observeClickNDbClick(t.btn,function(){t.me._openEditPage()},null),t.me},_getSelection:function(){var e={};return e.me=this,e.customers=[],e.itemList=$("item-list"),e.itemList.getElementsBySelector(".btn-hide-row.item_row").each(function(t){e.checked=t.down('input.customer-selected[type="checkbox"]').checked,e.customerId=t.readAttribute("item_id"),!0===e.checked&&!0===jQuery.isNumeric(e.customerId)&&e.customers.push(t.retrieve("data"))}),$("total-selected-count").update(e.customers.length),e.customers},_getResultRow:function(e,t){var n={};if(n.me=this,n.tag=!0===t?"th":"td",n.isTitle=t||!1,n.row=new Element("tr",{class:(!0===n.isTitle?"item_top_row":"btn-hide-row item_row")+(0==e.active?" danger":""),item_id:!0===n.isTitle?"":e.id}).store("data",e).insert({bottom:new Element(n.tag,{class:"name"+n.me._actonSetting==1?"col-xs-1":"col-xs-2"}).insert({bottom:1==n.isTitle?"":new Element("span").setStyle("margin: 0 5px 0 0").insert({bottom:new Element("input",{type:"checkbox",class:"customer-selected"}).observe("click",function(e){n.checked=this.checked,n.me._getSelection()})})}).insert({bottom:new Element("span").setStyle("margin: 0 5px 0 0").update(e.name).observe("click",function(){n.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")})}).observe("dblclick",function(){$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")}),n.me._openEditPage(e)})})}).insert({bottom:new Element(n.tag,{class:"email col-xs-1",style:"text-decoration: underline;"}).update(e.email).observe("click",function(){n.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")})}).observe("dblclick",function(){$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")}),n.newWindow=window.open("mailto:"+e.email,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),n.newWindow.close()})}).insert({bottom:new Element(n.tag,{class:"tier col-xs-1 truncate"}).update(e.tier.name)}).insert({bottom:new Element(n.tag,{class:"terms col-xs-1 truncate"}).update(e.terms)}).insert({bottom:new Element(n.tag,{class:"isBlocked col-xs-1"}).insert({bottom:!0===n.isTitle?e.isBlocked:new Element("input",{type:"checkbox",disabled:!0,checked:e.isBlocked})})}).insert({bottom:new Element(n.tag,{class:"contact col-xs-1 truncate"}).update(e.contactNo)}).insert({bottom:new Element(n.tag,{class:"description col-xs-1"}).update(e.description)}),e.hasOwnProperty("message"))for(var o=e.message.length;o--;)n.row=n.row.insert({bottom:new Element(n.tag,{class:"message col-xs-1",style:"width: 12%"}).insert({bottom:!0===n.isTitle?new Element("div",{style:"width: 100%"}).insert({bottom:e.message[o].title}).insert({bottom:new Element(n.tag,{class:"message col-xs-1",style:"width: 12%; padding-left:0"}).insert({bottom:new Element("span",{style:"float:left; width: 40%; padding-top:5px"}).insert({bottom:e.message[o].nameOpen})}).insert({bottom:new Element("span",{style:"float:left; width: 60%; padding-top:5px"}).insert({bottom:e.message[o].nameClick})})}):new Element("span",{style:"display: inline-block; padding-left:15px"}).insert({bottom:new Element("span",{style:"display: inline-block; padding-right: 15px"}).update(e.message[o].opened)}).insert({bottom:new Element("span",{style:"display: inline-block; padding-left: 50px"}).update(e.message[o].clicked)})})});return n.row=n.row.insert({bottom:new Element(n.tag,{class:"address col-xs-1"}).insert({bottom:!0===n.isTitle?e.addresses:new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{class:"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plane address-shipping",style:"font-size: 1.3em"})}).observe("click",function(){n.me._displaySelectedAddress(this)})})}).insert({bottom:!0===n.isTitle?"":new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{class:"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-usd address-billing",style:"font-size: 1.3em; padding-left:10%;"})}).observe("click",function(){n.me._displaySelectedAddress(this)})})})}).insert({bottom:new Element(n.tag,{class:"mageId col-xs-1"}).update(e.mageId)}).insert({bottom:new Element(n.tag,{class:"cust_active col-xs-1"}).insert({bottom:!0===n.isTitle?e.active:new Element("input",{type:"checkbox",disabled:!0,checked:e.active})})}),1==n.me_actonSetting&&(n.row=n.row.insert({bottom:new Element(n.tag,{class:"grouping col-xs-1"}).insert({bottom:!0===n.isTitle?e.groupCom:new Element("input",{type:"checkbox",disabled:!0,checked:e.groupCom})})}).insert({bottom:new Element(n.tag,{class:"grouping col-xs-1"}).insert({bottom:!0===n.isTitle?e.groupEdu:new Element("input",{type:"checkbox",disabled:!0,checked:e.groupEdu})})}).insert({bottom:new Element(n.tag,{class:"grouping col-xs-1"}).insert({bottom:!0===n.isTitle?e.groupGame:new Element("input",{type:"checkbox",disabled:!0,checked:e.groupGame})})})),n.row=n.row.insert({bottom:new Element(n.tag,{class:"text-center col-xs-1"}).update(!0===n.isTitle?new Element("span",{class:"btn btn-primary btn-xs",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:n.me._openEditPage()})}):new Element("span",{class:"btn-group btn-group-xs"}).insert({bottom:new Element("span",{class:"btn btn-default",title:"Edit",style:0==n.me._actonSetting?"width: 50px":"width: 24px"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-pencil"})}).observe("click",function(){$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")}),n.me._openEditPage(e)})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete",style:0==n.me._actonSetting?"width: 50px":"width: 24px"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to deactivate this item?"))return!1;e.active&&n.me._deactivateItem(this),$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")})})})).observe("click",function(){n.me._highlightSelectedRow(this),$$(".popover-loaded").each(function(e){jQuery(e).popover("hide")})})}),n.row},_getNextPageBtn:function(){var e={};return e.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"8",class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults()})})})})},_deactivateItem:function(e){var t={};t.me=this,t.row=$(e).up("[item_id]"),t.item=t.row.retrieve("data"),t.me.postAjax(t.me.getCallbackId("deactivateItems"),{item_id:t.item.id},{onLoading:function(){t.row&&(t.row.toggleClassName("danger"),t.row.hide())},onSuccess:function(e,n){try{if(t.row.toggleClassName("danger"),t.result=t.me.getResp(n,!1,!0),!t.result.item)throw"errror";$$('[item_id="'+t.result.item.id+'"]').first().replace(t.me._getResultRow(t.result.item,!1)),t.me._highlightSelectedRow($$('[item_id="'+t.result.item.id+'"]').first().down(".glyphicon.glyphicon-trash"))}catch(e){t.me.showModalBox('<span class="text-danger">ERROR</span>',e,!0)}}})},integrateActon:function(e){var t={};return t.me=this,t.data={},$$("[search_field]").each(function(e){t.data[e.readAttribute("search_field")]=$F(e)}),confirm(" Would you like to create a contact list on Act-On?")&&t.me.postAjax(t.me.getCallbackId("integrateActon"),t.data,{onLoading:function(){jQuery(e).button("loading")},onSuccess:function(n,o){try{if(t.result=t.me.getResp(o,!1,!0),!t.result)return;t.result.errorCode?10056==t.result.errorCode?confirm("The list you selected already exists.\n Would you like to update the exist list?")&&t.me.postAjax(t.me.getCallbackId("updateActon"),{filename:t.result.filename,listname:t.result.listname},{onLoading:function(){jQuery(e).button("loading")},onSuccess:function(e,n){t.result=t.me.getResp(n,!1,!0),t.result&&(t.result.errorCode?t.me.showModalBox("Error",t.result.message+" --"+t.result.errorCode,!1):t.result.status&&t.me.showModalBox("Success",t.result.message,!1))},onComplete:function(){jQuery(e).button("reset")}}):t.me.showModalBox("Error",t.result.message+" --"+t.result.errorCode,!1):t.result.status&&t.me.showModalBox("Success",t.result.message,!1)}catch(e){t.me.showModalBox("<b>Error:</b>",'<b class="text-danger">'+e+"</b>")}},onComplete:function(){jQuery(e).button("reset")}}),t.me},checkboxToggle:function(){var e={};return e.me=this,jQuery("#labelCom").click(function(){jQuery("#groupCom").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelEdu").click(function(){jQuery("#groupEdu").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelGame").click(function(){jQuery("#groupGame").prop("checked",!0),jQuery(".groupGen").prop("checked",!1)}),jQuery("#labelGen").click(function(){jQuery("#groupGen").prop("checked",!0),jQuery(".groupCom").prop("checked",!1)}),jQuery(".groupGen").change(function(){jQuery(this).is(":checked")&&jQuery(".groupCom").prop("checked",!1)}),jQuery(".groupCom").change(function(){jQuery(this).is(":checked")&&jQuery(".groupGen").prop("checked",!1)}),e.me},_checkActOnEnable:function(){var e={};return e.me=this,e.me.postAjax(e.me.getCallbackId("checkActOnEnable"),{},{onLoading:function(){},onSuccess:function(t,n){e.result=e.me.getResp(n,!1,!0),e.result&&0==e.result.enable&&jQuery(".grouping").hide()},onComplete:function(){}}),e.me}}),jQuery("#integrateActonBtn").ready(function(){(new PageJs)._checkActOnEnable()}),jQuery(document).on("click","th > div > th > span",function(){var e=jQuery(this).parents("table").eq(0),t=e.find("tr:gt(0):lt(90)").toArray().sort(comparer(jQuery(this).parents("tr > th").index()));this.asc=!this.asc,this.asc||(t=t.reverse()),e.children("tbody").empty().html(t)});