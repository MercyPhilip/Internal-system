var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{_preLoadData:{},_getTitleRowData:function(){return{}},setPreloadData:function(b){this._preLoadData=b;return this},_getResultRow:function(b,d){var a={me:this};a.tag=!0===a.isTitle?"th":"td";a.isTitle=d||!1;a.row=(new Element("tr",{"class":!0===a.isTitle?"":"item_row"})).store("data",b).insert({bottom:(new Element(a.tag,{"class":"col-sm-2"})).update(!0===a.isTitle?"SKU":(new Element("div")).insert({bottom:(new Element("div")).update((new Element("a",{href:"/products/"+
b.product.id+".html",target:"_BLANK"})).update(b.product.sku))}).insert({bottom:(new Element("small")).update(b.product.name)}))}).insert({bottom:(new Element(a.tag,{"class":"col-sm-1 text-center"})).update(!0===a.isTitle?"Qty":b.totalQty)}).insert({bottom:(new Element(a.tag,{"class":"col-sm-1"})).update(!0===a.isTitle?"Unit Price (Ex GST)":a.me.getCurrency(b.totalPrice/b.totalQty))}).insert({bottom:(new Element(a.tag,{"class":"col-sm-1"})).update(!0===a.isTitle?"Total Price (Ex GST)":a.me.getCurrency(b.totalPrice))}).insert({bottom:(new Element(a.tag,
{"class":"col-sm-2"})).update(!0===a.isTitle?"PurchaseOrders":a.poList=new Element("ul",{"class":"list-inline"}))}).insert({bottom:(new Element(a.tag,{"class":"col-sm-5"})).update(!0===a.isTitle?"Serial No.":a.serialNoList=new Element("ul",{"class":"list-inline"}))});b.items&&a.serialNoList&&b.items.each(function(b){a.serialNoList.insert({bottom:(new Element("li")).update(b.serialNo)})});b.purchaseOrders&&a.poList&&b.purchaseOrders.each(function(b){a.poList.insert({bottom:(new Element("li")).update((new Element("a",
{href:"/purchase/"+b.id+".html",target:"_BLANK"})).update(b.purchaseOrderNo))})});return a.row},_getSummaryPanel:function(b,d,a){var c;b=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:(new Element("h3")).update("Invoice No.: "+d)}).insert({bottom:(new Element("div")).update("Supplier: "+b.name)}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2 text-right"})).update("Purchase Order(s): ")}).insert({bottom:(new Element("div",
{"class":"col-xs-10"})).insert({bottom:c=new Element("ul",{"class":"list-inline"})})})})});a&&c&&$H(a).each(function(a){c.insert({bottom:(new Element("li")).update((new Element("a",{href:"/purchase/"+a.value.id+".html",target:"_BLANK"})).update(a.value.purchaseOrderNo))})});return b},getResults:function(b,d){var a,c,f,g,h,e,k;a=this;c=$(a.resultDivId);f={pagination:a._pagination,searchCriteria:{invoiceNo:a._preLoadData.invoiceNo,supplierId:a._preLoadData.supplierId}};a.postAjax(a.getCallbackId("getItems"),
f,{onCreate:function(){c.update((new Element("tr")).update((new Element("td")).update(a.getLoadingImg())))},onSuccess:function(b,d){try{if(g=a.getResp(d,!1,!0))$(a.totalNoOfItemsId).update(g.items.size()),c.update(a._getResultRow(a._getTitleRowData(),!0).wrap(new Element("thead"))),(h=$(c).down("tbody"))||$(c).insert({bottom:h=new Element("tbody")}),e=0,k={},g.items.each(function(b){e+=b.totalPrice;h.insert({bottom:a._getResultRow(b).addClassName("item_row").writeAttribute("item_id",b.id)});b.purchaseOrders.each(function(a){k[a.id]=
a})}),jQuery(".total-price-ex").html(a.getCurrency(e)),jQuery(".total-price-inc").html(a.getCurrency(1.1*e)),jQuery(".summaryPanel").html(a._getSummaryPanel(g.supplier,a._preLoadData.invoiceNo,k))}catch(f){c.insert({bottom:a.getAlertBox("Error",f).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("reset")}})}});