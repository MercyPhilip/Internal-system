var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{}},_openDetailsPage:function(a){jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/bills/"+a.supplier.id+".html?blanklayout=1&invoiceNo="+a.invoiceNo});return this},_getShowInvoiceNoDiv:function(a){var c,b;c=this;return(new Element("div",{"class":"inovice-input-div"})).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update(a.invoiceNo).observe("click",function(){c._openDetailsPage(a)})}).insert({bottom:(new Element("span",
{"class":"btn btn-default btn-xs pull-right"})).update("edit").observe("click",function(){$(this).up(".inovice-input-div").update(b=c._getInvoiceNoInputBox(a));b.select()})})},_getInvoiceNoInputBox:function(a){var c,b,d,e;c=this;return(new Element("div")).insert({bottom:(new Element("input",{"class":"form-control input-sm",value:a&&a.invoiceNo?a.invoiceNo:""})).observe("change",function(){b=$(this);d=$F(b);d.blank()?alert("Invoice No. can NOT be empty!"):c.postAjax(c.getCallbackId("updateInvoiceNo"),
{oldInvoiceNo:a.invoiceNo,newInoviceNo:d,supplierId:a.supplier.id},{onCreate:function(){},onSuccess:function(h,f){try{if(e=c.getResp(f,!1,!0))a.invoiceNo=d,$(b).up(".inovice-input-div").replace(c._getShowInvoiceNoDiv(a))}catch(g){c.showModalBox('<strong class="text-danger">Error</strong>',(new Element("h3")).update(g))}},onComplete:function(){}})})})},_getResultRow:function(a,c){var b={me:this};b.tag=!0===b.isTitle?"th":"td";b.isTitle=c||!1;b.row=(new Element("tr",{"class":!0===b.isTitle?"":"item_row"})).store("data",
a).insert({bottom:(new Element(b.tag,{"class":"col-sm-1"})).update(!0===b.isTitle?"Inv. No.":b.me._getShowInvoiceNoDiv(a))}).insert({bottom:(new Element(b.tag,{"class":"col-sm-1"})).update(!0===b.isTitle?"Created":moment(b.me.loadUTCTime(a.created)).format("ll"))}).insert({bottom:(new Element(b.tag,{"class":"col-sm-2"})).update(!0===b.isTitle?"Supplier":a.supplier.name)}).insert({bottom:(new Element(b.tag,{"class":"col-sm-2"})).update(!0===b.isTitle?"Total Qty":a.totalQty)}).insert({bottom:(new Element(b.tag,
{"class":"col-sm-2"})).update(!0===b.isTitle?"Total Price(ex GST)":b.me.getCurrency(a.totalPrice))}).insert({bottom:(new Element(b.tag,{"class":"col-sm-2"})).update(!0===b.isTitle?"Total Price(inc GST)":b.me.getCurrency(1.1*a.totalPrice))}).insert({bottom:(new Element(b.tag,{"class":"col-sm-4"})).update(!0===b.isTitle?"Purchase Orders":b.purchaseOrderList=new Element("ul",{"class":"list-inline"}))});a.purchaseOrders&&b.purchaseOrderList&&a.purchaseOrders.each(function(a){b.purchaseOrderList.insert({bottom:(new Element("li")).insert({bottom:(new Element("a",
{target:"_BLANK",href:"/purchase/"+a.id+".html"})).update(a.purchaseOrderNo)})})});return b.row},_initSelect2_Supplier:function(){var a;jQuery('.select2[search_field="supplierIds"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getSuppliers",dataType:"json",delay:10,data:function(a){return{searchTxt:a}},results:function(c){a=[];c.resultData.items.each(function(b){a.push({id:b.id,text:b.name,data:b})});return{results:a}},cache:!0},formatResult:function(a){return a?"<div value="+a.data.id+
">"+a.data.name+"</div >":""},escapeMarkup:function(a){return a},minimumInputLength:1});return this},_initSelect2_po:function(){var a;jQuery('.select2[search_field="purchaseOrderIds"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,data:function(a){return{entityName:"PurchaseOrder",searchTxt:"po.purchaseOrderNo like :poNo",searchParams:{poNo:"%"+a+"%"}}},results:function(c){a=[];c.resultData.items.each(function(b){a.push({id:b.id,text:b.purchaseOrderNo,
data:b})});return{results:a}},cache:!0},formatResult:function(a){return a?"<div value="+a.data.id+">"+a.data.purchaseOrderNo+" ("+a.data.supplier.name+")</div >":""},escapeMarkup:function(a){return a},minimumInputLength:1});return this},init:function(){var a;a=this;a._initSelect2_Supplier()._initSelect2_po();$$("#searchBtn").first().observe("click",function(c){$$("#showSearch").first().checked?a.getSearchCriteria().getResults(!0,a._pagination.pageSize):$$("#showSearch").first().click()});return a}});