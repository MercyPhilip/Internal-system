var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_htmlIds:{itemDiv:"",searchPanel:"search_panel"},_customer:null,_order:null,setOrder:function(a){this._order=a;return this},setHTMLIDs:function(a){this._htmlIds.itemDiv=a;return this},setPaymentMethods:function(a){this._paymentMethods=a;return this},setShippingMethods:function(a){this._shippingMethods=a;return this},setOrderTypes:function(a){this._orderTypes=a;return this},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},_redirectOrder:function(b){var a={};a.me=this;a.redirectURL=jQuery(b.target).find('[window="redirec-url"]').val();if(a.redirectURL&&!a.redirectURL.blank()){window.location=a.redirectURL}return a.me},_preConfirmSubmit:function(a){var b={};b.me=this;b.paidAmountBox=$$('[save-order="totalPaidAmount"]').first();b.selectedType=jQuery('[save-order-type="type"]').val();if(!b.paidAmountBox||b.selectedType==="INVOICE"){return b.me._confirmSubmit(a)}b.data=b.me._collectFormData($(b.me._htmlIds.itemDiv),"save-order");if(b.data===null){return b.me}if(b.data.totalPaidAmount&&b.data.totalPaidAmount>0){b.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("h4",{"class":"text-danger"}).update("You are recording a payment with "+b.me.getCurrency(b.data.totalPaidAmount)+" against this "+b.selectedType+", it will be push to an INVOICE.")}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger","data-loading-text":"Pushing..."}).update("OK").observe("click",function(){b.me._confirmSubmit(a,b.newDiv)})})});b.me.showModalBox('<strong class="text-danger">Warning! Payments Provided:</strong>',b.newDiv,false,null,{"hide.bs.modal":function(c){b.me._redirectOrder(c)}})}else{return b.me._confirmSubmit(a)}return b.me},_confirmSubmit:function(a,c){var b={};b.me=this;b.printIt=(a===true?true:false);b.confirmDiv=(c||null);b.data=b.me._collectFormData($(b.me._htmlIds.itemDiv),"save-order");if(b.data===null){return b.me}b.data.printIt=b.printIt;b.data.type=(b.data.totalPaidAmount&&b.data.totalPaidAmount>0)?"INVOICE":jQuery('[save-order-type="type"]').val();b.data.customer={};b.data.customer.id=b.me._customer.id;b.shippAddrPanel=$$(".shipping-address.address-div").first();if(b.shippAddrPanel){b.shippAddr=b.me._collectFormData(b.shippAddrPanel,"address-editable-field");if(b.shippAddr===null){return b.me}b.data.shippingAddr=b.shippAddr}b.data.items=[];b.hasItems=false;$$(".order-item-row").each(function(d){b.itemData=d.retrieve("data");if(!d.hasClassName("deactivated")){b.hasItems=true}b.data.items.push({id:(b.itemData.id?b.itemData.id:""),active:!d.hasClassName("deactivated"),product:{id:b.itemData.product.id},itemDescription:b.itemData.itemDescription,unitPrice:b.itemData.unitPrice,qtyOrdered:b.itemData.qtyOrdered,totalPrice:b.itemData.totalPrice,serials:d.retrieve("serials")})});if(b.hasItems===false){b.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one order item is needed!",true);return b.me}b.data.items.each(function(d){d.totalPrice=b.me.getValueFromCurrency(d.totalPrice);d.unitPrice=b.me.getValueFromCurrency(d.unitPrice)});b.newDiv=new Element("div").insert({bottom:new Element("h4").update("Have all the GOODs deliver / given to the customer?")}).insert({bottom:new Element("ul").insert({bottom:new Element("li").update(" - YES: This "+b.data.type+" will push this order to be an INVOICE and status SHIPPED")}).insert({bottom:new Element("li").update(" - NO: This "+b.data.type+" will be saved as status NEW")})}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-danger",title:"This will push this order to be an INVOICE and status SHIPPED"}).update("YES").observe("click",function(){b.data.type="INVOICE";b.data.shipped=true;b.me._submitOrder(this,b.data)})}).insert({bottom:new Element("span",{"class":"btn btn-primary pull-right",title:"This will push this order to be an INVOICE and status SHIPPED"}).update("NO").observe("click",function(){b.me._submitOrder(this,b.data)})})});if(b.confirmDiv===null){b.me.showModalBox('<strong class="text-info">Confirmation Needed</strong>',b.newDiv,false,null,{"hide.bs.modal":function(d){b.me._redirectOrder(d)}})}else{b.confirmDiv.up(".modal-content").down(".modal-title").update('<strong class="text-info">Confirmation Needed</strong>');b.confirmDiv.replace(b.newDiv)}return b.me},_submitOrder:function(b,c){var a={};a.me=this;a.modalBoxPanel=$(b).up(".modal-content");a.modalBoxTitlePanel=a.modalBoxPanel.down(".modal-title");a.modalBoxBodyPanel=a.modalBoxPanel.down(".modal-body");if(a.me._order&&a.me._order.id){c.orderId=a.me._order.id}else{if(a.me._originalOrder&&a.me._originalOrder.id){c.orderCloneFromId=a.me._originalOrder.id}}a.me.postAjax(a.me.getCallbackId("saveOrder"),c,{onLoading:function(d,e){a.modalBoxTitlePanel.update("Please wait...");a.modalBoxBodyPanel.update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>')},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result||!a.result.item){return}a.me._order=a.me._item=a.result.item;a.redirectURL=a.result.redirectURL;a.modalBoxPanel.insert({bottom:new Element("input",{window:"redirec-url",type:"hidden",value:a.redirectURL})});$extraMsg="";if(a.result.printURL){a.printWindow=window.open(a.result.printURL,"Printing Order","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");if(!a.printWindow){$extraMsg='<h4>Your browser has block the popup window, please enable it for further operations.</h4><a href="'+a.result.printURL+'" target="_BLANK"> click here for now</a>'}}a.modalBoxTitlePanel.update('<strong class="text-success">Success!</strong>');a.modalBoxBodyPanel.update('<h4 class="text-success">Saved Successfully for '+a.result.item.type+": "+a.result.item.orderNo+'</h4><div><a class="btn btn-primary" href="javascript: void(0)" onclick="pageJs.hideModalBox();"> click here to view it</a></div>')}catch(f){a.modalBoxTitlePanel.update('<h4 class="text-danger">Error:</h4>');a.modalBoxBodyPanel.update(f)}},onComplete:function(d,e){}});return a.me},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary save-btn"}).insert({bottom:new Element("span").update(" Save & Print ")}).observe("click",function(){a.me._preConfirmSubmit(true)})})}).insert({bottom:new Element("div",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})});return a.newDiv},_getAddressDiv:function(c,d,b){var a={};a.me=this;a.address=(d||null);a.editable=(b||false);a.newDiv=new Element("div",{"class":"address-div"}).insert({bottom:new Element("strong").update(c)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.editable!==true?d.contactName:new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:a.address.contactName?a.address.contactName:""}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.editable!==true?d.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:a.address.contactNo?a.address.contactNo:""}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.street:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:a.address.street?a.address.street:""}))})}).insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.city+" ":new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:a.address.city?a.address.city:""}))}).insert({bottom:a.editable!==true?d.region+" ":new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:a.address.region?a.address.region:""}))}).insert({bottom:a.editable!==true?d.postCode:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",placeholder:"PostCode",value:a.address.postCode?a.address.postCode:""}))})}).insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.country:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:a.address.country?a.address.country:""}))})})})});if(a.editable===true){a.newDiv.writeAttribute("address-editable",true)}return a.newDiv},_openCustomerDetailsPage:function(b){var a={};a.me=this;jQuery.fancybox({width:"95%",height:"95%",autoScale:false,autoDimensions:false,fitToView:false,autoSize:false,type:"iframe",href:"/customer/"+b.id+".html?blanklayout=1",beforeClose:function(){a.customer=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item;if(a.customer&&a.customer.id){a.me.selectCustomer(a.customer)}}});return a.me},_deactiveOrder:function(b){var a={};a.me=this;a.confirmDiv=$(b).up(".confirm-div");a.confirmDiv.getElementsBySelector(".msg").each(function(c){c.remove()});a.data=a.me._collectFormData(a.confirmDiv,"confirm-panel");if(a.data===null){return}a.data.orderId=a.me._order.id;a.me.postAjax(a.me.getCallbackId("cancelOrder"),a.data,{onLoading:function(){a.me._signRandID(b);jQuery("#"+b.id).button("loading")},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.item||!a.result.item.id){return}a.me._order=a.result.item;a.confirmDiv.update('<h4 class="text-success">This '+a.me._order.type+" has been CANCELLED successfully.</h4>");a.me.disableEverything()}catch(d){a.confirmDiv.insert({top:new Element("h4",{"class":"msg"}).update(new Element("span",{"class":"label label-danger"}).update(d))})}},onComplete:function(){jQuery("#"+b.id).button("reset")}});return a.me},_showConfirmCancelOrderPanel:function(b){var a={};a.me=this;a.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:a.me._getFormGroup("You are about CANCEL this "+a.me._order.type+", please provide some reason:",new Element("input",{value:"","confirm-panel":"reason",required:true,placeholder:"The Reason For CANCELLATION"}))})}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-default pull-left"}).update("CANCEL").observe("click",function(){a.me.hideModalBox()})}).insert({bottom:new Element("span",{"class":"btn btn-danger","data-loading-text":"Sending ..."}).update("Yes, Cancel this "+a.me._order.type).observe("click",function(){a.me._deactiveOrder(this)})})});a.me.showModalBox("<strong>Confirm Cancellation:</strong>",a.newDiv);return a.me},_getCustomerInfoPanel:function(b){var a={};a.me=this;a.customer=b;a.typeSelBox=new Element("select",{"save-order-type":"type"});a.me._orderTypes.each(function(c){a.typeSelBox.insert({bottom:a.option=new Element("option",{value:c,selected:(a.me._order&&a.me._order.type===c)}).update(c)}).observe("change",function(){a.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default");a.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning");if($F(this)==="QUOTE"){a.panels.addClass("panel-warning");a.inputs.addClass("list-group-item-warning")}else{if($F(this)==="ORDER"){a.panels.addClass("panel-success");a.inputs.addClass("list-group-item-success")}else{a.panels.addClass("panel-default")}}})});a.operationBtnsDiv=new Element("div");if(a.me._order&&a.me._order.id){a.operationBtnsDiv.update(new OrderBtnsJs(a.me,a.me._order).getBtnsDiv()).insert({bottom:new Element("btn",{"class":"btn btn-danger btn-xs pull-right"}).update("CANCEL THIS "+a.me._order.type).observe("click",function(){a.me._showConfirmCancelOrderPanel(this)})})}a.newDiv=new Element("div",{"class":"panel customer-info-div"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("strong").update((a.me._order&&a.me._order.id?"Editing":"CREATING")+" A ")}).insert({bottom:a.typeSelBox}).insert({bottom:(a.me._order&&a.me._order.id?new Element("strong").update(" "+a.me._order.orderNo).setStyle("margin-left: 5px; margin-right: 25px;"):"")}).insert({bottom:new Element("strong").update(" FOR:  ")}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(a.customer.name).observe("click",function(){a.me._openCustomerDetailsPage(a.customer)})}).insert({bottom:" <"}).insert({bottom:new Element("a",{href:"mailto:"+a.customer.email}).update(a.customer.email)}).insert({bottom:">"}).insert({bottom:new Element("strong").update(" with PO No.:")}).insert({bottom:new Element("input",{type:"text","save-order":"poNo",placeholder:"Optional - PO No. From Customer",value:a.me._order&&a.me._order.pONo?a.me._order.pONo:""}).setStyle("width: 200px;")}).insert({bottom:!a.me._originalOrder?"":new Element("span").setStyle("margin-left: 8px;").insert({bottom:new Element("strong",{"class":"text-danger"}).update("CLONING FROM: ")}).insert({bottom:new Element("a",{href:"/orderdetails/"+a.me._originalOrder.id+".html",target:"_BLANK"}).update(a.me._originalOrder.orderNo)})})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).update(a.operationBtnsDiv)})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").update(new Element("em").update(a.customer.description))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAddressDiv("Billing Address: ",a.customer.address?a.customer.address.billing:null).addClassName("col-xs-6")}).insert({bottom:a.me._getAddressDiv("Shipping Address: ",a.customer.address?a.customer.address.shipping:null,true).addClassName("col-xs-6").addClassName("shipping-address")})})});return a.newDiv},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.tag=(c.isTitle===true?"strong":"div");c.btns=b.btns?b.btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("You remove this entry.\n\nContinue?")){return}c.row=$(this).up(".item_row");if(c.row){c.orderItem=c.row.retrieve("data");if(c.orderItem.id){c.orderItem.active=false;c.row.store("data",c.orderItem);c.row.hide();c.row.addClassName("deactivated")}else{c.row.remove()}}c.me._recalculateSummary()})});c.row=new Element("div",{"class":" list-group-item "+(c.isTitle===true?"":"item_row order-item-row")}).store("data",b).insert({bottom:new Element("div",{"class":"row"}).store("data",b).insert({bottom:new Element(c.tag,{"class":"productName col-xs-6"}).insert({bottom:b.itemDescription?b.itemDescription:(b.product.shortDescription&&!b.product.shortDescription.blank()?b.product.shortDescription:b.product.name)})}).insert({bottom:new Element(c.tag,{"class":"uprice col-xs-1"}).insert({bottom:c.isTitle===true||typeof(b.unitPrice)==="object"?b.unitPrice:c.me._getFormGroup(null,c.me._getOrderItemInputBox("order-item",c.me.getCurrency(c.me.getValueFromCurrency(b.unitPrice)),{"order-item":"unitPrice",required:true}))})}).insert({bottom:new Element(c.tag,{"class":"col-xs-2"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"qty col-xs-6"}).update((c.isTitle===true||typeof(b.qtyOrdered)==="object")?b.qtyOrdered:c.me._getFormGroup(null,c.me._getOrderItemInputBox("order-item",b.qtyOrdered,{"order-item":"qtyOrdered",required:true})))}).insert({bottom:new Element("div",{"class":"discount col-xs-6"}).update((c.isTitle===true||typeof(b.discount)==="object")?b.discount:c.me._getFormGroup(null,c.me._getOrderItemInputBox("order-item",b.discount,{"order-item":"discount"})))})})}).insert({bottom:new Element(c.tag,{"class":"tprice col-xs-1"}).insert({bottom:(c.isTitle===true||typeof(b.totalPrice)==="object")?b.totalPrice:c.me._getFormGroup(null,c.me._getOrderItemInputBox("order-item",b.totalPrice,{"order-item":"totalPrice",disabled:true,required:true}))})}).insert({bottom:new Element(c.tag,{"class":"margin col-xs-1 text-right"}).update(b.margin)}).insert({bottom:new Element(c.tag,{"class":"btns col-xs-1 text-right"}).update(c.btns)})});if(b.id){c.row.writeAttribute("item-id",b.id)}if(b.product.sku){c.row.down(".productName").removeClassName("col-xs-6").addClassName("col-xs-4").insert({before:new Element(c.tag,{"class":"productSku col-xs-2"}).update(b.product.sku).insert({bottom:new Element("small",{"class":b.product.id?"btn btn-xs btn-info":"hidden"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(d){Event.stop(d);$productId=b.product.id;if($productId){c.me._openProductDetailPage($productId)}})})})}if(b.scanTable){c.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-2 show-tools"}).insert({bottom:new Element("input",{type:"checkbox",checked:false,"class":"show-panel-check"}).observe("click",function(){c.btn=this;c.panel=$(c.btn).up(".product-content-row").down(".serial-no-scan-pane");if(c.btn.checked){c.panel.show()}else{c.panel.hide()}})}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:new Element("span",{"class":"col-sm-10 serial-no-scan-pane",style:"padding-top: 5px; display: none;"}).update(b.scanTable)})})}return c.row},_getSearchPrductResultRow:function(c,b){var a={};a.me=this;a.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";a.newRow=new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"}).store("data",c).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:c.images.size()===0?a.defaultImgSrc:c.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("strong").update(!c.shortDescription.blank()?c.shortDescription:c.name).insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})})}).observe("click",function(d){Event.stop(d);$productId=$(this).up(".search-product-result-row").retrieve("data").id;if($productId){a.me._openProductDetailPage($productId)}}).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+c.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(c.shortDescription)})}).insert({bottom:new Element("div").insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on HAND"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOH:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnHand)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on ORDER"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOO:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnOrder)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on PO"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOP:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnPO)})})})})})}).observe("click",function(){a.inputRow=$(b).up(".new-order-item-input").store("product",c);b.up(".productName").writeAttribute("colspan",false).update(c.sku).removeClassName("col-xs-8").addClassName("col-xs-2").insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(d){Event.stop(d);$productId=c.id;if($productId){a.me._openProductDetailPage($productId)}})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){a.newRow=a.me._getNewProductRow();$(this).up(".new-order-item-input").replace(a.newRow);a.newRow.down("[new-order-item=product]").select()})}).insert({after:new Element("div",{"class":"col-xs-4"}).update(new Element("textarea",{"new-order-item":"itemDescription"}).setStyle("width: 100%").update(!c.shortDescription.blank()?c.shortDescription:c.name))});jQuery("#"+a.me.modalId).modal("hide");a.retailPrice=c.prices.size()===0?0:c.prices[0].price;a.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",a.me.getCurrency(a.retailPrice)).select();a.me._calculateNewProductPrice(a.inputRow,"new-order-item")});return a.newRow},_searchProduct:function(c,a,d){var b={};b.me=this;b.btn=c;b.showMore=$(c).retrieve("showMore")===true?true:false;b.pageNo=(a||1);b.me._signRandID(b.btn);b.searchTxtBox=!$(b.btn).up(".product-autocomplete")||!$(b.btn).up(".product-autocomplete").down(".search-txt")?$($(b.btn).retrieve("searchBoxId")):$(b.btn).up(".product-autocomplete").down(".search-txt");b.me._signRandID(b.searchTxtBox);b.searchTxt=$F(b.searchTxtBox);b.me.postAjax(b.me.getCallbackId("searchProduct"),{searchTxt:b.searchTxt,pageNo:b.pageNo},{onLoading:function(){jQuery("#"+b.btn.id).button("loading");jQuery("#"+b.searchTxtBox.id).button("loading")},onSuccess:function(f,h){if(b.showMore===false){b.resultList=new Element("div",{"class":"search-product-list"})}else{b.resultList=$(c).up(".search-product-list")}try{b.result=b.me.getResp(h,false,true);if(!b.result||!b.result.items||b.result.items.size()===0){throw"Nothing Found for: "+b.searchTxt}b.me._signRandID(b.searchTxtBox);b.result.items.each(function(e){b.resultList.insert({bottom:b.me._getSearchPrductResultRow(e,b.searchTxtBox)})});b.resultList.addClassName("list-group")}catch(g){b.resultList.update(b.me.getAlertBox("Error: ",g).addClassName("alert-danger"))}if(typeof(d)==="function"){d()}if(b.result.pagination.pageNumber<b.result.pagination.totalPages){b.resultList.insert({bottom:new Element("a",{"class":"item-group-item"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."}).update("Show Me More")}).observe("click",function(){b.newBtn=$(this);$(b.newBtn).store("searchBoxId",b.searchTxtBox.id);$(b.newBtn).store("showMore",true);b.me._searchProduct(this,b.pageNo*1+1,function(){$(b.newBtn).remove()})})})}if(b.showMore===false){b.me.showModalBox("Products that has: "+b.searchTxt,b.resultList,false)}},onComplete:function(e,f){jQuery("#"+b.btn.id).button("reset");jQuery("#"+b.searchTxtBox.id).button("reset")}});return b.me},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:true,placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keyup",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){if(!$F($(this).up(".product-autocomplete").down(".search-txt")).blank()){a.me._searchProduct(this)}else{$(this).up(".product-autocomplete").down(".search-txt").focus()}})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_recalculateSummary:function(){var a={};a.me=this;a.totalPriceIncGSTNoDicount=0;a.totalPriceIncGSTWithDiscount=0;a.totalMargin=0;$$(".item_row.order-item-row").each(function(b){a.rowData=b.retrieve("data");if(a.rowData.active===false){return}a.totalPriceIncGSTWithDiscount=a.totalPriceIncGSTWithDiscount*1+(a.me.getValueFromCurrency(a.rowData.totalPrice)*1);a.totalPriceIncGSTNoDicount=a.totalPriceIncGSTNoDicount*1+(a.me.getValueFromCurrency(a.rowData.unitPrice)*a.rowData.qtyOrdered);if(a.rowData.margin){a.totalMargin=a.totalMargin*1+a.me.getValueFromCurrency(a.rowData.margin)*1}});a.totalPriceExcGST=((a.totalPriceIncGSTWithDiscount*1)/1.1);jQuery('[order-price-summary="totalPriceExcludeGST"]').val(a.me.getCurrency(a.totalPriceExcGST)).html(a.me.getCurrency(a.totalPriceExcGST));a.totalGST=(a.totalPriceIncGSTWithDiscount*1-a.totalPriceExcGST*1);jQuery('[order-price-summary="totalPriceGST"]').val(a.me.getCurrency(a.totalGST)).html(a.me.getCurrency(a.totalGST));a.totalDiscount=(a.totalPriceIncGSTNoDicount*1-a.totalPriceIncGSTWithDiscount*1);jQuery('[order-price-summary="totalDiscount"]').val(a.me.getCurrency(a.totalDiscount)).html(a.me.getCurrency(a.totalDiscount));jQuery('[order-price-summary="totalPriceIncludeGST"]').val(a.me.getCurrency(a.totalPriceIncGSTWithDiscount)).html(a.me.getCurrency(a.totalPriceIncGSTWithDiscount));a.totalShipping=(jQuery('[order-price-summary="totalShippingCost"]').length>0?jQuery('[order-price-summary="totalShippingCost"]').val():0);a.subTotal=(a.totalShipping*1+a.totalPriceIncGSTWithDiscount*1);jQuery('[order-price-summary="subTotal"]').val(a.me.getCurrency(a.subTotal)).html(a.me.getCurrency(a.subTotal));a.totalPaid=(jQuery('[order-price-summary="totalPaidAmount"]').length>0?jQuery('[order-price-summary="totalPaidAmount"]').val():0);a.totalDue=(a.subTotal*1-a.totalPaid*1);if(a.totalDue<0){a.me.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>The customer has paid more than the due amount?</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',true)}jQuery('[order-price-summary="total-payment-due"]').val(a.me.getCurrency(a.totalDue)).html(a.me.getCurrency(a.totalDue));jQuery('[order-price-summary="total-margin"]').val(a.me.getCurrency(a.totalMargin)).html(a.me.getCurrency(a.totalMargin));return a.me},_addNewProductRow:function(b){var a={};a.me=this;a.currentRow=$(b).up(".new-order-item-input");a.product=a.currentRow.retrieve("product");if(!a.product){a.productBox=a.currentRow.down("[new-order-item=product]");if(a.currentRow.down("[new-order-item=product]")){a.me._markFormGroupError(a.productBox,"Select a product first!")}else{a.me.showModalBox("Product Needed","Select a product first!",true)}return}a.unitPriceBox=a.currentRow.down("[new-order-item=unitPrice]");a.unitPrice=a.me.getValueFromCurrency($F(a.unitPriceBox));if(a.unitPrice.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.unitPriceBox,"Invalid value provided!");return}a.qtyOrderedBox=a.currentRow.down("[new-order-item=qtyOrdered]");a.qtyOrdered=a.me.getValueFromCurrency($F(a.qtyOrderedBox));if(a.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.qtyOrderedBox,"Invalid value provided!");return}a.discountBox=a.currentRow.down("[new-order-item=discount]");a.discount=a.me.getValueFromCurrency($F(a.discountBox));if(a.discount.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.discountBox,"Invalid value provided!");return}a.totalPriceBox=a.currentRow.down("[new-order-item=totalPrice]");a.totalPrice=a.me.getValueFromCurrency($F(a.totalPriceBox));if(a.totalPrice.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.totalPriceBox,"Invalid value provided!");return}a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(c){$(c).retrieve("clearErrFunc")()});a.itemDescription=$F(a.currentRow.down("[new-order-item=itemDescription]")).replace(/\n/g,"<br />");a.data={product:a.product,itemDescription:a.itemDescription,unitPrice:a.me.getCurrency(a.unitPrice),qtyOrdered:a.qtyOrdered,discount:a.discount,margin:a.me.getCurrency(parseFloat(a.totalPrice)-parseFloat(a.product.unitCost*1.1*a.qtyOrdered)),totalPrice:a.me.getCurrency(a.totalPrice)};a.data.scanTable=a.me._getScanTable(a.data);a.currentRow.up(".list-group").insert({bottom:a.itemRow=a.me._getProductRow(a.data)});a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow).addClassName();a.newRow.down("[new-order-item=product]").focus();a.me._recalculateSummary();return a.me},_getScanTable:function(b){var a={};a.me=this;a.item=b;a.newDiv=new Element("div",{"class":"scanTable"});for(a.i=0;a.i<b.qtyOrdered;a.i++){a.newDiv.insert({bottom:new Element("input",{"class":"form-control","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:"}).observe("change",function(){a.emptyIput=null;a.serials=[];$(this).up(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]').each(function(c){if(!$F(c).blank()){a.serials.push($F(c))}if(a.emptyIput===null&&$F(c).blank()){a.emptyIput=c}});$(this).up(".order-item-row").store("serials",a.serials);if(a.emptyIput!==null){a.emptyIput.select()}}).wrap(new Element("div",{"class":"col-sm-3"}))})}return a.newDiv},_calculateNewProductPrice:function(c,b){var a={};a.me=this;a.row=c;a.unitPrice=a.me.getValueFromCurrency($F(a.row.down("["+b+"=unitPrice]")));a.discount=$F(a.row.down("["+b+"=discount]")).strip().replace("%","");a.qty=$F(a.row.down("["+b+"=qtyOrdered]")).strip();a.totalPrice=a.unitPrice*(1-a.discount/100)*a.qty;$(a.row.down("["+b+"=totalPrice]")).value=a.me.getCurrency(a.totalPrice);a.product=c.retrieve("product")?c.retrieve("product"):(c.retrieve("data")&&c.retrieve("data").product?c.retrieve("data").product:{});if(a.product.id){a.unitCost=a.product.unitCost;a.margin=a.me.getCurrency(a.totalPrice*1-a.unitCost*1.1*a.qty);if(a.row.down(".margin")){$(a.row.down(".margin")).update(a.margin+(parseInt(a.unitCost)===0?'<div><small class="label label-danger">No Cost Yet</small</div>':""))}}a.rowData=a.row.retrieve("data");if(a.rowData&&a.rowData.id){a.rowData.unitPrice=a.unitPrice;a.rowData.discount=a.discount;a.rowData.qtyOrdered=a.qty;a.rowData.totalPrice=a.totalPrice;if(a.margin){a.rowData.margin=a.margin}a.row.store("data",a.rowData)}return a.me},_bindSubmitNewProductRow:function(c,b){var a={};a.me=this;a.txtBox=b;a.me.keydown(c,function(){if($(a.txtBox)&&$(a.txtBox).up(".item_row")&&$(a.txtBox).up(".item_row").down(".save-new-product-btn")){$(a.txtBox).up(".item_row").down(".save-new-product-btn").click()}});return a.me},_getOrderItemInputBox:function(e,f,c,a,b,g){var d={};d.me=this;d.newInput=Element("input",{"class":"input-sm",value:f}).observe("click",function(h){if(typeof(a)==="function"){a(h)}}).observe("keydown",function(h){if(typeof(b)==="function"){b(h)}else{d.me._bindSubmitNewProductRow(h,this)}}).observe("keyup",function(h){if(typeof(g)==="function"){g(h)}else{try{d.me._calculateNewProductPrice($(this).up(".item_row"),e);d.me._recalculateSummary()}catch(i){}}});$H(c).each(function(h){d.newInput.writeAttribute(h.key,h.value)});return d.newInput},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},unitPrice:a.me._getFormGroup(null,a.me._getOrderItemInputBox("new-order-item",a.me.getCurrency(0),{"new-order-item":"unitPrice",required:true})),qtyOrdered:a.me._getFormGroup(null,a.me._getOrderItemInputBox("new-order-item",1,{"new-order-item":"qtyOrdered",required:true})),discount:a.me._getFormGroup(null,a.me._getOrderItemInputBox("new-order-item",0,{"new-order-item":"discount"},function(b){if($F($(this)).blank()||$F($(this))>100){$(this).value=0;$(this).select()}a.me._calculateNewProductPrice($(this).up(".item_row"),"new-order-item")})),totalPrice:a.me._getFormGroup(null,a.me._getOrderItemInputBox("new-order-item",a.me.getCurrency(0),{"new-order-item":"totalPrice",required:true,disabled:true})),margin:a.me.getCurrency(0),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){a.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){if(!confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")){return}a.newRow=a.me._getNewProductRow();a.currentRow=$(this).up(".new-order-item-input");a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(b){$(b).retrieve("clearErrFunc")()});a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus()})})};return a.me._getProductRow(a.data,false).addClassName("new-order-item-input list-group-item-success").removeClassName("order-item-row")},_getPartsTable:function(){var a={};a.me=this;a.productListDiv=new Element("div",{"class":"list-group order_item_list_table"}).insert({bottom:a.me._getProductRow({product:{sku:"SKU",name:"Description",shortDescription:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Qty",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",btns:new Element("div").insert({bottom:new Element("label",{"for":"hide-margin-checkbox"}).update("Show Margin ")}).insert({bottom:new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:true}).observe("click",function(){jQuery(".margin").toggle()})})},true)});a.productListDiv.insert({bottom:a.me._getNewProductRow().addClassName("list-group-item-success")});return a.productListDiv},_getShippingCostBox:function(b){var a={};a.me=this;a.shippingCostBox=new Element("input",{"order-price-summary":"totalShippingCost","class":"form-control input-sm","save-order":"totalShippingCost",placeholder:a.me.getCurrency(0),required:true,validate_currency:"Invalid number provided!",value:b?b:0}).observe("keyup",function(){a.me._recalculateSummary()});return a.shippingCostBox.wrap(new Element("div",{"class":"form-group"}))},_getSummaryFooter:function(){var a={};a.me=this;a.shippingMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"courierId",required:true}).insert({bottom:new Element("option",{value:""}).update("Shipping Via:")});a.shippingMethod=(a.me._order&&a.me._order.infos["9"]?a.me._order.infos[9][0].value:"");a.shippingCost=(a.me._order&&a.me._order.infos["14"]?a.me.getValueFromCurrency(a.me._order.infos[14][0].value):"");a.foundMatchedShippingMethod=false;a.me._shippingMethods.each(function(b){a.sameShippingMethod=(b.name.strip()===a.shippingMethod.strip());a.shippingMethodSel.insert({bottom:new Element("option",{value:b.id,selected:a.sameShippingMethod}).update(b.name)});if(a.foundMatchedShippingMethod===false&&a.sameShippingMethod===true){a.foundMatchedShippingMethod=a.sameShippingMethod}});if(!a.shippingMethod.blank()&&a.foundMatchedShippingMethod===false){a.shippingMethodSel.insert({bottom:new Element("option",{value:a.shippingMethod,selected:true}).update(a.shippingMethod.stripTags())})}a.paymentMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"paymentMethodId"}).insert({bottom:new Element("option",{value:""}).update("Paid Via:")});a.me._paymentMethods.each(function(b){a.paymentMethodSel.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});a.newDiv=new Element("div",{"class":"panel-footer"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:a.me._order&&a.me._order.id?new Element("div",{"class":"comments-div-wrapper"}).store("CommentsDivJs",new CommentsDivJs(a.me,"Order",a.me._order.id)):a.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:"8"}))})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("div",{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceGST","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Discount:"))}).insert({bottom:new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Sub Total Incl. GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceIncludeGST","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(a.me._getFormGroup("",a.shippingMethodSel.observe("change",function(){a.btn=this;$(a.btn).up(".row").down(".input-field").update($F(a.btn).blank()?a.me.getCurrency(0):a.shippingCostBox=a.me._getShippingCostBox());a.me._recalculateSummary();if(a.shippingCostBox){a.shippingCostBox.select()}})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(a.shippingCost===""?a.me.getCurrency(0):a.me._getShippingCostBox(a.shippingCost))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Incl. GST:"))}).insert({bottom:new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update(a.paymentMethodSel.observe("change",function(){a.btn=this;$(a.btn).up(".row").down(".input-field").update($F(a.btn).blank()?a.me.getCurrency(0):new Element("span",{"class":"form-group"}).update(a.paidAmountBox=new Element("input",{value:($F(a.btn).strip()==="5"?"0":""),"order-price-summary":"totalPaidAmount","class":"form-control input-sm","save-order":"totalPaidAmount",placeholder:a.me.getCurrency(0),required:true,validate_currency:"Invalid number provided!"}).observe("keyup",function(){a.me._recalculateSummary()})));a.me._recalculateSummary();if(a.paidAmountBox){a.paidAmountBox.select()}})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("h4",{"class":"col-xs-6 text-right"}).setStyle("color: #d30014 !important").update(new Element("strong").update("DUE:"))}).insert({bottom:new Element("h4",{"class":"col-xs-6","order-price-summary":"total-payment-due"}).setStyle("color: #d30014 !important").update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row margin"}).insert({bottom:new Element("strong",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Margin Total Incl. GST:"))}).insert({bottom:new Element("strong",{"class":"col-xs-6","order-price-summary":"total-margin"}).update(a.me.getCurrency(0))})})})});return a.newDiv},_getViewOfOrder:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getCustomerInfoPanel(a.me._customer))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).insert({bottom:new Element("div",{"class":"panel"}).update(a.me._getPartsTable()).insert({bottom:a.me._getSummaryFooter()})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._saveBtns())})});return a.newDiv},selectCustomer:function(b){var a={};a.me=this;a.resultDiv=$(a.me._htmlIds.itemDiv);a.me._customer=b;a.resultListDiv=a.resultDiv.down(".order_item_list_table");if(a.resultListDiv&&a.resultListDiv.getElementsBySelector(".item_row.order-item-row").size()>0){a.resultDiv.down(".customer-info-div").replace(a.me._getCustomerInfoPanel(b))}else{a.resultListDiv=a.me._getViewOfOrder();a.commentsDiv=a.resultDiv.update(a.resultListDiv).down(".comments-div-wrapper");if(a.commentsDiv){a.commentsDiv.retrieve("CommentsDivJs")._setDisplayDivId(a.commentsDiv).render()}}a.resultListDiv.down('.new-order-item-input [new-order-item="product"]').focus();return a.me},_getCustomerRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);b.tag=(b.isTitle===true?"th":"td");b.newDiv=new Element("tr").store("data",c).insert({bottom:new Element(b.tag).insert({bottom:(b.isTitle===true?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){b.me.selectCustomer(c);b.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-warning");b.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-warning")}))})}).insert({bottom:new Element(b.tag).update(c.name)}).insert({bottom:new Element(b.tag).update(c.email)}).insert({bottom:new Element(b.tag).update(c.address&&c.address.billing?c.address.billing.full:"")});return b.newDiv},_searchCustomer:function(c,a){var b={};b.me=this;b.pageNo=(a||1);b.searchPanel=$(c).up("#"+b.me._htmlIds.searchPanel);b.searchTxt=$F(b.searchPanel.down(".search-txt")).strip();b.me.postAjax(b.me.getCallbackId("searchCustomer"),{searchTxt:b.searchTxt,pageNo:b.pageNo},{onLoading:function(){b.me._signRandID(c);jQuery("#"+c.id).button("loading");if(b.pageNo===1){if($(b.searchPanel).down(".list-div")){$(b.searchPanel).down(".list-div").remove()}$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getLoadingImg())})}},onSuccess:function(d,g){try{b.result=b.me.getResp(g,false,true);if(!b.result||!b.result.items){return}if(b.pageNo===1){$(b.searchPanel).down(".panel-body").remove();$(b.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:b.me._getCustomerRow({name:"Customer Name",email:"Email",address:{billing:{full:"Address"}}},true)})}).insert({bottom:b.listDiv=new Element("tbody")})})})}else{b.listDiv=$(b.searchPanel).down("tbody")}if($(b.searchPanel).down(".get-more-btn-wrapper")){$(b.searchPanel).down(".get-more-btn-wrapper").remove()}b.result.items.each(function(e){b.listDiv.insert({bottom:b.me._getCustomerRow(e)})});if(b.result.pagination.pageNumber<b.result.pagination.totalPages){b.listDiv.insert({bottom:new Element("tr",{"class":"get-more-btn-wrapper"}).insert({bottom:new Element("td").insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting More ..."}).update("Get more").observe("click",function(){b.me._searchCustomer(this,b.pageNo*1+1)})})})})}}catch(f){if(b.pageNo===1){$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getAlertBox("ERROR",f).addClassName("alert-danger"))})}else{b.me.showModalBox('<strong class="text-danger">Error:</strong>',f)}}},onComplete:function(){jQuery("#"+c.id).button("reset")}});return b.me},_getCustomerListPanel:function(){var a={};a.me=this;a.newDiv=new Element("div",{id:a.me._htmlIds.searchPanel,"class":"panel panel-default search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Creating a new order for: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{"class":"form-control search-txt init-focus",placeholder:"customer name or email"}).observe("keyup",function(b){$(a.me._htmlIds.searchPanel).down(".search-btn").click()})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary","data-loading-text":"Searching ..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){a.btn=this;a.me._searchCustomer(a.btn,1)})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" NEW"}).observe("click",function(){a.me._openNewCustomerPage()})})});return a.newDiv},_openNewCustomerPage:function(b){var a={};a.me=this;jQuery.fancybox({width:"95%",height:"95%",autoScale:false,autoDimensions:false,fitToView:false,autoSize:false,type:"iframe",href:"/customer/new.html",beforeClose:function(){a.newCustomer=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item;if(a.newCustomer.id){a.me.selectCustomer(a.newCustomer)}}});return a.me},_openProductDetailPage:function(b){var a={};a.me=this;a.newWindow=window.open("/product/"+b+".html","Product Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.focus();return a.me},setOriginalOrder:function(b){var a={};a.me=this;a.me._originalOrder=b;return a.me},_populateOrderItems:function(a){var b={};b.me=this;if(a.size()>0){b.productListDiv=$(b.me._htmlIds.itemDiv).down(".order_item_list_table");a.each(function(c){b.unitPriceValue=b.me.getValueFromCurrency(c.unitPrice);b.totalPriceValue=b.me.getValueFromCurrency(c.totalPrice);b.data={id:c.id,product:c.product,itemDescription:c.itemDescription,unitPrice:b.me.getCurrency(b.unitPriceValue),qtyOrdered:c.qtyOrdered,discount:b.totalPriceValue===0?0:Math.round(((b.unitPriceValue*c.qtyOrdered-b.totalPriceValue)*100/b.totalPriceValue)),margin:b.me.getCurrency(b.me.getValueFromCurrency(c.margin)),totalPrice:b.me.getCurrency(b.totalPriceValue),scanTable:b.me._getScanTable(c),orderItem:(b.me._order&&b.me._order.id?c:{})};b.productListDiv.insert({bottom:b.me._getProductRow(b.data)})});b.me._recalculateSummary()}return b.me},init:function(b){var a={};a.me=this;a.className="warning";if(a.me._order&&a.me._order.id){a.me.selectCustomer(a.me._order.customer)._populateOrderItems(a.me._order.items);a.className=a.me._order.type==="QUOTE"?"warning":(a.me._order.type==="ORDER"?"success":"default")}else{if(b){a.me.selectCustomer(b)}else{if(a.me._originalOrder){a.me.selectCustomer(a.me._originalOrder.customer)._populateOrderItems(a.me._originalOrder.items);a.className=a.me._originalOrder.type==="QUOTE"?"warning":(a.me._originalOrder.type==="ORDER"?"success":"default")}else{$(a.me._htmlIds.itemDiv).update(a.me._getCustomerListPanel())}}}a.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-"+a.className);a.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-"+a.className);if($$(".init-focus").size()>0){$$(".init-focus").first().focus()}return a.me},disableEverything:function(){var a={};a.me=this;jQuery(".btn").attr("disabled",true);jQuery("input").attr("disabled",true);jQuery(".form-control").attr("disabled",true);return a.me}});