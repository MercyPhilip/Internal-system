var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_htmlIds:{itemDiv:"",searchPanel:"search_panel"},_customer:null,setHTMLIDs:function(a){this._htmlIds.itemDiv=a;return this},setPaymentMethods:function(a){this._paymentMethods=a;return this},setShippingMethods:function(a){this._shippingMethods=a;return this},setOrderTypes:function(a){this._orderTypes=a;return this},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},_confirmSubmit:function(a){var b={};b.me=this;b.printIt=(a===true?true:false);b.data=b.me._collectFormData($(b.me._htmlIds.itemDiv),"save-order");if(b.data===null){return b.me}b.data.printIt=b.printIt;b.data.type=jQuery('[save-order-type="type"]').val();b.data.customer={};b.data.customer.id=b.me._customer.id;b.shippAddrPanel=$$(".shipping-address.address-div").first();if(b.shippAddrPanel){b.shippAddr=b.me._collectFormData(b.shippAddrPanel,"address-editable-field");if(b.shippAddr===null){return b.me}b.data.shippingAddr=b.shippAddr}b.data.items=[];$$(".order-item-row").each(function(c){b.itemData=c.retrieve("data");b.data.items.push({product:{id:b.itemData.product.id},unitPrice:b.itemData.unitPrice,qtyOrdered:b.itemData.qtyOrdered,totalPrice:b.itemData.totalPrice,serials:c.retrieve("serials")})});if(b.data.items.size()<=0){b.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one order item is needed!",true);return b.me}b.data.items.each(function(c){c.totalPrice=b.me.getValueFromCurrency(c.totalPrice);c.unitPrice=b.me.getValueFromCurrency(c.unitPrice)});b.newDiv=new Element("div").insert({bottom:new Element("h4").update("Please confirm whether you want to change it to be an INVOICE.")}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-info"}).update("NO. Save as: "+b.data.type).observe("click",function(){b.me._submitOrder(this,b.data)})}).insert({bottom:new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary",title:"This will push this order to be an INVOICE and status SHIPPED"}).update("YES. GOODs Given to Customer & Push to INVOICE").observe("click",function(){b.data.type="INVOICE";b.data.shipped=true;b.me._submitOrder(this,b.data)})}).insert({bottom:new Element("span",{"class":"btn btn-primary dropdown-toggle","data-toggle":"dropdown"}).insert({bottom:new Element("span",{"class":"caret"})})}).insert({bottom:new Element("ul",{"class":"dropdown-menu save-btn-dropdown-menu"}).insert({bottom:new Element("li").insert({bottom:new Element("a",{href:"javascript: void(0);",title:"This will JUST push this order to be an INVOICE and status NEW"}).update("YES. Push to INVOICE ONLY, goods not given").observe("click",function(){b.data.type="INVOICE";b.data.shipped=false;b.me._submitOrder(this,b.data)})})})})})});b.me.showModalBox('<strong class="text-info">Confirmation Needed</strong>',b.newDiv,false);return b.me},_submitOrder:function(b,c){var a={};a.me=this;a.modalBoxPanel=$(b).up(".modal-content");a.modalBoxTitlePanel=a.modalBoxPanel.down(".modal-title");a.modalBoxBodyPanel=a.modalBoxPanel.down(".modal-body");a.me.postAjax(a.me.getCallbackId("saveOrder"),c,{onLoading:function(d,e){a.modalBoxTitlePanel.update("Please wait...");a.modalBoxBodyPanel.update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>')},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result||!a.result.item){return}a.me._item=a.result.item;a.modalBoxTitlePanel.update('<strong class="text-success">Success!</strong>');a.modalBoxBodyPanel.update('<div>The new order is succussfully added.</div><br /><div></div><div><span class="btn btn-primary" onclick="window.location = \'/orderdetails/'+a.result.item.id+'.html\';"><strong>Go to Order Details Page?</strong></span><span class="btn btn-default pull-right" onclick="window.location = document.URL;">Create another one</span></div>',false);if(a.result.printURL){a.printWindow=window.open(a.result.printURL,"Printing Order","location=no, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no, width=800");a.printWindow.print()}}catch(f){a.modalBoxTitlePanel.update('<h4 class="text-danger">Error:</h4>');a.modalBoxBodyPanel.update(f)}},onComplete:function(d,e){}});return a.me},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary save-btn"}).insert({bottom:new Element("span").update(" Save & Print ")}).observe("click",function(){a.me._confirmSubmit(true)})}).insert({bottom:new Element("span",{"class":"btn btn-primary dropdown-toggle","data-toggle":"dropdown"}).insert({bottom:new Element("span",{"class":"caret"})})}).insert({bottom:new Element("ul",{"class":"dropdown-menu save-btn-dropdown-menu"}).insert({bottom:new Element("li").insert({bottom:new Element("a",{href:"javascript: void(0);"}).update("Save Only").observe("click",function(){a.me._confirmSubmit()})})})})}).insert({bottom:new Element("div",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})});return a.newDiv},_getAddressDiv:function(c,d,b){var a={};a.me=this;a.editable=(b||false);a.newDiv=new Element("div",{"class":"address-div"}).insert({bottom:new Element("strong").update(c)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.editable!==true?d.contactName:new Element("input",{"address-editable-field":"contactName",required:true,"class":"form-control input-sm",placeholder:"The name of contact person",value:d.contactName}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.editable!==true?d.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:d.contactNo}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.street:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",required:true,placeholder:"Street Number and Street name",value:d.street}))})}).insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.city+" ":new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",required:true,placeholder:"City / Suburb",value:d.city}))}).insert({bottom:a.editable!==true?d.region+" ":new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",required:true,placeholder:"State / Province",value:d.region}))}).insert({bottom:a.editable!==true?d.postCode:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",required:true,placeholder:"PostCode",value:d.postCode}))})}).insert({bottom:new Element("div").insert({bottom:a.editable!==true?d.country:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",required:true,placeholder:"Country",value:d.country}))})})})});if(a.editable===true){a.newDiv.writeAttribute("address-editable",true)}return a.newDiv},_getCustomerInfoPanel:function(){var a={};a.me=this;a.customer=a.me._customer;a.typeSelBox=new Element("select",{"save-order-type":"type"});a.me._orderTypes.each(function(b){a.typeSelBox.insert({bottom:a.option=new Element("option",{value:b}).update(b)}).observe("change",function(){a.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-info");a.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning").removeClass("list-group-item-info");if($F(this)==="QUOTE"){a.panels.addClass("panel-warning");a.inputs.addClass("list-group-item-warning")}else{if($F(this)==="ORDER"){a.panels.addClass("panel-success");a.inputs.addClass("list-group-item-success")}else{a.panels.addClass("panel-info");a.inputs.addClass("list-group-item-info")}}});if(b==="ORDER"){a.option.writeAttribute("selected",true)}});a.newDiv=new Element("div",{"class":"panel panel-success"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("strong").update("CREATING A ")}).insert({bottom:a.typeSelBox}).insert({bottom:new Element("strong").update(" FOR:  "+a.customer.name+" ")}).insert({bottom:" <"}).insert({bottom:new Element("a",{href:"mailto:"+a.customer.email}).update(a.customer.email)}).insert({bottom:">"}).insert({bottom:new Element("strong").update(" with PO No.:")}).insert({bottom:new Element("input",{type:"text","save-order":"poNo",placeholder:"Optional - PO No. From Customer"})})}).insert({bottom:new Element("div",{"class":"col-sm-4 text-right"}).insert({bottom:new Element("strong").update("Total Payment Due: ")}).insert({bottom:new Element("span",{"class":"badge","order-price-summary":"total-payment-due"}).update(a.me.getCurrency(0))})})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").update(new Element("em").update(a.customer.description))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getAddressDiv("Billing Address: ",a.customer.address.billing).addClassName("col-xs-6")}).insert({bottom:a.me._getAddressDiv("Shipping Address: ",a.customer.address.shipping,true).addClassName("col-xs-6").addClassName("shipping-address")})})});return a.newDiv},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.tag=(c.isTitle===true?"strong":"div");c.row=new Element("div",{"class":" list-group-item "+(c.isTitle===true?"":"item_row order-item-row")}).store("data",b).insert({bottom:new Element("div",{"class":"row"}).store("data",b).insert({bottom:new Element(c.tag,{"class":"productName col-xs-6"}).insert({bottom:b.product.name}).insert({bottom:new Element("small",{"class":b.product.id?"btn btn-xs btn-info":"hidden"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})})}).observe("click",function(d){Event.stop(d);$productId=b.product.id;if($productId){c.me._openProductDetailPage($productId)}})}).insert({bottom:new Element(c.tag,{"class":"uprice col-xs-1"}).insert({bottom:(b.unitPrice)})}).insert({bottom:new Element(c.tag,{"class":"col-xs-2"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"qty col-xs-6"}).update(b.qtyOrdered)}).insert({bottom:new Element("div",{"class":"discount col-xs-6"}).update(b.discount)})})}).insert({bottom:new Element(c.tag,{"class":"tprice col-xs-1"}).insert({bottom:(b.totalPrice)})}).insert({bottom:new Element(c.tag,{"class":"margin col-xs-1 text-right"}).update(b.margin)}).insert({bottom:new Element(c.tag,{"class":"btns col-xs-1 text-right"}).update(b.btns)})});if(b.product.sku){c.row.down(".productName").removeClassName("col-xs-6").addClassName("col-xs-4").insert({before:new Element(c.tag,{"class":"productSku col-xs-2"}).update(b.product.sku)})}if(b.scanTable){c.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-2 show-tools"}).insert({bottom:new Element("input",{type:"checkbox",checked:true,"class":"show-panel-check"}).observe("click",function(){c.btn=this;c.panel=$(c.btn).up(".product-content-row").down(".serial-no-scan-pane");if(c.btn.checked){c.panel.show()}else{c.panel.hide()}})}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:new Element("span",{"class":"col-sm-10 serial-no-scan-pane",style:"padding-top: 5px"}).update(b.scanTable)})})}return c.row},_getSearchPrductResultRow:function(c,b){var a={};a.me=this;a.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";a.newRow=new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"}).store("data",c).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:c.images.size()===0?a.defaultImgSrc:c.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("strong").update(c.name).insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})})}).observe("click",function(d){Event.stop(d);$productId=$(this).up(".search-product-result-row").retrieve("data").id;if($productId){a.me._openProductDetailPage($productId)}}).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+c.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(c.shortDescription)})}).insert({bottom:new Element("div").insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on HAND"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOH:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnHand)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on ORDER"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOO:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnOrder)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on PO"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOP:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(c.stockOnPO)})})})})})}).observe("click",function(){a.inputRow=$(b).up(".new-order-item-input").store("product",c);b.up(".productName").writeAttribute("colspan",false).update(c.sku).removeClassName("col-xs-8").addClassName("col-xs-2").insert({after:new Element("div",{"class":"col-xs-4"}).update(c.name).insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(d){Event.stop(d);$productId=c.id;if($productId){a.me._openProductDetailPage($productId)}})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){a.newRow=a.me._getNewProductRow();$(this).up(".new-order-item-input").replace(a.newRow);a.newRow.down("[new-order-item=product]").select()})})});jQuery("#"+a.me.modalId).modal("hide");a.retailPrice=c.prices.size()===0?0:c.prices[0].price;a.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",a.me.getCurrency(a.retailPrice)).select();a.me._calculateNewProductPrice(a.inputRow)});return a.newRow},_searchProduct:function(b){var a={};a.me=this;a.btn=b;a.me._signRandID(a.btn);a.searchTxtBox=$(a.btn).up(".product-autocomplete").down(".search-txt");a.me._signRandID(a.searchTxtBox);a.searchTxt=$F(a.searchTxtBox);a.me.postAjax(a.me.getCallbackId("searchProduct"),{searchTxt:a.searchTxt},{onLoading:function(){jQuery("#"+a.btn.id).button("loading");jQuery("#"+a.searchTxtBox.id).button("loading")},onSuccess:function(c,f){a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.items||a.result.items.size()===0){throw"Nothing Found for: "+a.searchTxt}a.me._signRandID(a.searchTxtBox);a.result.items.each(function(e){a.resultList.insert({bottom:a.me._getSearchPrductResultRow(e,a.searchTxtBox)})});a.resultList.addClassName("list-group")}catch(d){a.resultList.update(a.me.getAlertBox("Error: ",d).addClassName("alert-danger"))}a.me.showModalBox("Products that has: "+a.searchTxt,a.resultList,false)},onComplete:function(c,d){jQuery("#"+a.btn.id).button("reset");jQuery("#"+a.searchTxtBox.id).button("reset")}});return a.me},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:true,placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keyup",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){if(!$F($(this).up(".product-autocomplete").down(".search-txt")).blank()){a.me._searchProduct(this)}else{$(this).up(".product-autocomplete").down(".search-txt").focus()}})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_recalculateSummary:function(){var a={};a.me=this;a.totalPriceIncGSTNoDicount=0;a.totalPriceIncGSTWithDiscount=0;a.totalMargin=0;$$(".item_row.order-item-row").each(function(b){a.rowData=b.retrieve("data");a.totalPriceIncGSTWithDiscount=a.totalPriceIncGSTWithDiscount*1+(a.me.getValueFromCurrency(a.rowData.totalPrice)*1);a.totalPriceIncGSTNoDicount=a.totalPriceIncGSTNoDicount*1+(a.me.getValueFromCurrency(a.rowData.unitPrice)*a.rowData.qtyOrdered);a.totalMargin=a.totalMargin*1+a.me.getValueFromCurrency(a.rowData.margin)});a.totalPriceExcGST=((a.totalPriceIncGSTWithDiscount*1)/1.1);jQuery('[order-price-summary="totalPriceExcludeGST"]').val(a.me.getCurrency(a.totalPriceExcGST)).html(a.me.getCurrency(a.totalPriceExcGST));a.totalGST=(a.totalPriceIncGSTWithDiscount*1-a.totalPriceExcGST*1);jQuery('[order-price-summary="totalPriceGST"]').val(a.me.getCurrency(a.totalGST)).html(a.me.getCurrency(a.totalGST));a.totalDiscount=(a.totalPriceIncGSTNoDicount*1-a.totalPriceIncGSTWithDiscount*1);jQuery('[order-price-summary="totalDiscount"]').val(a.me.getCurrency(a.totalDiscount)).html(a.me.getCurrency(a.totalDiscount));jQuery('[order-price-summary="totalPriceIncludeGST"]').val(a.me.getCurrency(a.totalPriceIncGSTWithDiscount)).html(a.me.getCurrency(a.totalPriceIncGSTWithDiscount));a.totalShipping=(jQuery('[order-price-summary="totalShippingCost"]').length>0?jQuery('[order-price-summary="totalShippingCost"]').val():0);a.subTotal=(a.totalShipping*1+a.totalPriceIncGSTWithDiscount*1);jQuery('[order-price-summary="subTotal"]').val(a.me.getCurrency(a.subTotal)).html(a.me.getCurrency(a.subTotal));a.totalPaid=(jQuery('[order-price-summary="totalPaidAmount"]').length>0?jQuery('[order-price-summary="totalPaidAmount"]').val():0);a.totalDue=(a.subTotal*1-a.totalPaid*1);if(a.totalDue<0){a.me.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>The customer has paid more than the due amount?</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',true)}jQuery('[order-price-summary="total-payment-due"]').val(a.me.getCurrency(a.totalDue)).html(a.me.getCurrency(a.totalDue));jQuery('[order-price-summary="total-margin"]').val(a.me.getCurrency(a.totalMargin)).html(a.me.getCurrency(a.totalMargin));return a.me},_addNewProductRow:function(b){var a={};a.me=this;a.currentRow=$(b).up(".new-order-item-input");a.product=a.currentRow.retrieve("product");if(!a.product){a.productBox=a.currentRow.down("[new-order-item=product]");if(a.currentRow.down("[new-order-item=product]")){a.me._markFormGroupError(a.productBox,"Select a product first!")}else{a.me.showModalBox("Product Needed","Select a product first!",true)}return}a.unitPriceBox=a.currentRow.down("[new-order-item=unitPrice]");a.unitPrice=a.me.getValueFromCurrency($F(a.unitPriceBox));if(a.unitPrice.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.unitPriceBox,"Invalid value provided!");return}a.qtyOrderedBox=a.currentRow.down("[new-order-item=qtyOrdered]");a.qtyOrdered=a.me.getValueFromCurrency($F(a.qtyOrderedBox));if(a.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.qtyOrderedBox,"Invalid value provided!");return}a.discountBox=a.currentRow.down("[new-order-item=discount]");a.discount=a.me.getValueFromCurrency($F(a.discountBox));if(a.discount.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.discountBox,"Invalid value provided!");return}a.totalPriceBox=a.currentRow.down("[new-order-item=totalPrice]");a.totalPrice=a.me.getValueFromCurrency($F(a.totalPriceBox));if(a.totalPrice.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.totalPriceBox,"Invalid value provided!");return}a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(c){$(c).retrieve("clearErrFunc")()});a.data={product:a.product,unitPrice:a.me.getCurrency(a.unitPrice),qtyOrdered:a.qtyOrdered,discount:a.discount,margin:a.me.getCurrency(a.totalPrice*1-a.product.unitCost*a.qtyOrdered),totalPrice:a.me.getCurrency(a.totalPrice),btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("You remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.me._recalculateSummary();a.row.remove()})})};a.data.scanTable=a.me._getScanTable(a.data);a.currentRow.insert({after:a.itemRow=a.me._getProductRow(a.data)});a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow).addClassName();a.newRow.down("[new-order-item=product]").focus();a.me._recalculateSummary();return a.me},_getScanTable:function(b){var a={};a.me=this;a.item=b;a.newDiv=new Element("div",{"class":"scanTable"});for(a.i=0;a.i<b.qtyOrdered;a.i++){a.newDiv.insert({bottom:new Element("input",{"class":"form-control","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:"}).observe("change",function(){a.emptyIput=null;a.serials=[];$(this).up(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]').each(function(c){if(!$F(c).blank()){a.serials.push($F(c))}if(a.emptyIput===null&&$F(c).blank()){a.emptyIput=c}});$(this).up(".order-item-row").store("serials",a.serials);if(a.emptyIput!==null){a.emptyIput.select()}}).wrap(new Element("div",{"class":"col-sm-3"}))})}return a.newDiv},_calculateNewProductPrice:function(b){var a={};a.me=this;a.row=b;a.unitPrice=a.me.getValueFromCurrency($F(a.row.down("[new-order-item=unitPrice]")));a.discount=$F(a.row.down("[new-order-item=discount]")).strip().replace("%","");a.qty=$F(a.row.down("[new-order-item=qtyOrdered]")).strip();a.totalPrice=a.unitPrice*(1-a.discount/100)*a.qty;$(a.row.down("[new-order-item=totalPrice]")).value=a.me.getCurrency(a.totalPrice);if(b.retrieve("product")){a.unitCost=b.retrieve("product").unitCost;if(a.row.down(".margin")){$(a.row.down(".margin")).update(a.me.getCurrency(a.totalPrice*1-a.unitCost*a.qty)+(parseInt(a.unitCost)===0?'<div><small class="label label-danger">No Cost Yet</small</div>':""))}}return a.me},_bindSubmitNewProductRow:function(c,b){var a={};a.me=this;a.txtBox=b;a.me.keydown(c,function(){$(a.txtBox).up(".item_row").down(".save-new-product-btn").click()});return a.me},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},unitPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:true,value:a.me.getCurrency(0)}).observe("click",function(){$(this).select()}).observe("keydown",function(b){a.me._bindSubmitNewProductRow(b,this)}).observe("keyup",function(){a.me._calculateNewProductPrice($(this).up(".item_row"))})),qtyOrdered:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:true,value:"1"}).observe("keyup",function(){a.me._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(b){a.me._bindSubmitNewProductRow(b,this)}).observe("click",function(){$(this).select()})),discount:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"discount",value:"0"}).observe("keyup",function(){if($F($(this)).blank()||$F($(this))>100){$(this).value=0;$(this).select()}a.me._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(b){a.me._bindSubmitNewProductRow(b,this)}).observe("click",function(){$(this).select()})),totalPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:true,"new-order-item":"totalPrice",required:true,value:a.me.getCurrency(0)})),margin:a.me.getCurrency(0),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){a.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){if(!confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")){return}a.newRow=a.me._getNewProductRow();a.currentRow=$(this).up(".new-order-item-input");a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(b){$(b).retrieve("clearErrFunc")()});a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus()})})};return a.me._getProductRow(a.data,false).addClassName("new-order-item-input list-group-item-success").removeClassName("order-item-row")},_getPartsTable:function(){var a={};a.me=this;a.productListDiv=new Element("div",{"class":"list-group order_change_details_table"}).insert({bottom:a.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Qty",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",btns:new Element("div").insert({bottom:new Element("label",{"for":"hide-margin-checkbox"}).update("Show Margin ")}).insert({bottom:new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:true}).observe("click",function(){jQuery(".margin").toggle()})})},true)});a.productListDiv.insert({bottom:a.me._getNewProductRow().addClassName("list-group-item-success")});return a.productListDiv},_getSummaryFooter:function(){var a={};a.me=this;a.shippingMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"courierId"}).insert({bottom:new Element("option",{value:""}).update("Shipping Via:")});a.me._shippingMethods.each(function(b){a.shippingMethodSel.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});a.paymentMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"paymentMethodId"}).insert({bottom:new Element("option",{value:""}).update("Paid Via:")});a.me._paymentMethods.each(function(b){a.paymentMethodSel.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});a.newDiv=new Element("div",{"class":"panel-footer"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:a.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:"8"}))})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("div",{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceGST","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Discount:"))}).insert({bottom:new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Incl. GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceIncludeGST","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update(a.shippingMethodSel.observe("change",function(){a.btn=this;$(a.btn).up(".row").down(".input-field").update($F(a.btn).blank()?a.me.getCurrency(0):a.shippingCostBox=new Element("input",{"order-price-summary":"totalShippingCost","class":"form-control input-sm","save-order":"totalShippingCost",placeholder:a.me.getCurrency(0),required:true,validate_currency:"Invalid number provided!"}).observe("keyup",function(){a.me._recalculateSummary()}));a.me._recalculateSummary();if(a.shippingCostBox){a.shippingCostBox.select()}})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Sub-Total:"))}).insert({bottom:new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update(a.paymentMethodSel.observe("change",function(){a.btn=this;$(a.btn).up(".row").down(".input-field").update($F(a.btn).blank()?a.me.getCurrency(0):a.paidAmountBox=new Element("input",{"order-price-summary":"totalPaidAmount","class":"form-control input-sm","save-order":"totalPaidAmount",placeholder:a.me.getCurrency(0),required:true,validate_currency:"Invalid number provided!"}).observe("keyup",function(){a.me._recalculateSummary()}));a.me._recalculateSummary();if(a.paidAmountBox){a.paidAmountBox.select()}})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("h4",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("DUE:"))}).insert({bottom:new Element("h4",{"class":"col-xs-6","order-price-summary":"total-payment-due"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row margin"}).insert({bottom:new Element("strong",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Margin Total:"))}).insert({bottom:new Element("strong",{"class":"col-xs-6","order-price-summary":"total-payment-due"}).update(a.me.getCurrency(0))})})})});return a.newDiv},_getViewOfOrder:function(){var a={};a.me=this;a.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getCustomerInfoPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).insert({bottom:new Element("div",{"class":"panel panel-success"}).update(a.me._getPartsTable()).insert({bottom:a.me._getSummaryFooter()})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._saveBtns())})});return a.newDiv},selectCustomer:function(b){var a={};a.me=this;a.me._customer=b;a.newDiv=a.me._getViewOfOrder();$(a.me._htmlIds.itemDiv).update(a.newDiv);a.newDiv.down('.new-order-item-input [new-order-item="product"]').focus();return a.me},_getCustomerRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);b.tag=(b.isTitle===true?"th":"td");b.newDiv=new Element("tr").store("data",c).insert({bottom:new Element(b.tag).insert({bottom:(b.isTitle===true?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){b.me.selectCustomer(c)}))})}).insert({bottom:new Element(b.tag).update(c.name)}).insert({bottom:new Element(b.tag).update(c.email)}).insert({bottom:new Element(b.tag).update(c.address&&c.address.billing?c.address.billing.full:"")});return b.newDiv},_searchCustomer:function(a){var b={};b.me=this;b.searchTxt=$F(a).strip();b.searchPanel=$(a).up("#"+b.me._htmlIds.searchPanel);b.me.postAjax(b.me.getCallbackId("searchCustomer"),{searchTxt:b.searchTxt},{onLoading:function(){if($(b.searchPanel).down(".list-div")){$(b.searchPanel).down(".list-div").remove()}$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getLoadingImg())})},onSuccess:function(c,f){$(b.searchPanel).down(".panel-body").remove();try{b.result=b.me.getResp(f,false,true);if(!b.result||!b.result.items){return}$(b.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:b.me._getCustomerRow({name:"Customer Name",email:"Email",address:{billing:{full:"Address"}}},true)})}).insert({bottom:b.listDiv=new Element("tbody")})})});b.result.items.each(function(e){b.listDiv.insert({bottom:b.me._getCustomerRow(e)})})}catch(d){$(b.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(b.me.getAlertBox("ERROR",d).addClassName("alert-danger"))})}}});return b.me},_getCustomerListPanel:function(){var a={};a.me=this;a.newDiv=new Element("div",{id:a.me._htmlIds.searchPanel,"class":"panel panel-default search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Creating a new order for: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{"class":"form-control search-txt init-focus",placeholder:"customer name or email"}).observe("keyup",function(b){a.me.keydown(b,function(){$(a.me._htmlIds.searchPanel).down(".search-btn").click()})})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){a.btn=this;a.me._searchCustomer($(a.me._htmlIds.searchPanel).down(".search-txt"))})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" NEW"}).observe("click",function(){a.me._openNewCustomerPage()})})});return a.newDiv},_openNewCustomerPage:function(b){var a={};a.me=this;jQuery.fancybox({width:"95%",height:"95%",autoScale:false,autoDimensions:false,fitToView:false,autoSize:false,type:"iframe",href:"/customer/new.html",beforeClose:function(){a.newCustomer=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item;if(a.newCustomer.id){a.me.selectCustomer(a.newCustomer)}}});return a.me},_openProductDetailPage:function(b){var a={};a.me=this;a.newWindow=window.open("/products/"+b+".html","Product Details","location=no, menubar=no, status=no, titlebar=no, fullscreen=yes, toolbar=no");a.newWindow.focus();return a.me},init:function(b){var a={};a.me=this;if(b){a.me.selectCustomer(b)}else{$(a.me._htmlIds.itemDiv).update(a.me._getCustomerListPanel())}if($$(".init-focus").size()>0){$$(".init-focus").first().focus()}return a.me}});