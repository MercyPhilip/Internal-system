var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_infoTypes:{},orderStatuses:[],_loadChosen:function(){$$(".chosen").each(function(a){a.store("chosen",new Chosen(a,{disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"}))});return this},_bindSearchKey:function(){var a={};a.me=this;$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(c){a.me.keydown(c,function(){$("searchBtn").click()})})});return this},_loadStatuses:function(){var a={};a.me=this;a.statusBox=$(a.me.searchDivId).down("#orderStatusId");a.me.orderStatuses.each(function(b){a.statusBox.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});a.me._loadChosen()._bindSearchKey();return this},getSearchCriteria:function(){var a={};a.me=this;if(a.me._searchCriteria===null){a.me._searchCriteria={}}a.nothingTosearch=true;$(a.me.searchDivId).getElementsBySelector("[search_field]").each(function(b){a.me._searchCriteria[b.readAttribute("search_field")]=$F(b);if(($F(b) instanceof Array&&$F(b).size()>0)||(typeof $F(b)==="string"&&!$F(b).blank())){a.nothingTosearch=false}});if(a.nothingTosearch===true){a.me._searchCriteria=null}return this},getResults:function(c,a){var b={};b.me=this;b.searchBtn=$("searchBtn");b.reset=(c||false);if(b.me._searchCriteria===null){alert("Nothing to search!");return}if(b.reset===true){b.me._pagination.pageNo=1}b.me._pagination.pageSize=(a||b.me._pagination.pageSize);b.me.postAjax(b.me.getCallbackId("getOrders"),{pagination:b.me._pagination,searchCriteria:b.me._searchCriteria},{onLoading:function(){b.searchBtn.store("originValue",$F(b.searchBtn)).addClassName("disabled").setValue("Searching ...").disabled=true},onComplete:function(d,g){try{b.result=b.me.getResp(g,false,true);$(b.me.totalNoOfItemsId).update(b.result.pageStats.totalRows);b.resultDiv=$(b.me.resultDivId);if(b.reset===true){b.titleRow={orderNo:"Order No.",orderDate:"Order Date",custName:"Customer Name",shippingAddr:"Shipping Address",invNo:"Invoice No.",status:{name:"Status"},totalDue:"Total Due",passPaymentCheck:"Payment Cleared?"};b.resultDiv.update(b.me._getResultRow(b.titleRow,true).addClassName("header"))}b.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()});b.result.items.each(function(e){b.resultDiv.insert({bottom:b.me._getResultRow(e)})});if(b.result.pageStats.pageNumber<b.result.pageStats.totalPages){b.resultDiv.insert({bottom:b.me._getNextPageBtn().addClassName("paginWrapper")})}}catch(f){alert(f)}b.searchBtn.removeClassName("disabled").setValue(b.searchBtn.retrieve("originValue")).disabled=false}})},_getNextPageBtn:function(){var a={};a.me=this;return new Element("div",{"class":"pagination"}).insert({bottom:new Element("span",{"class":"button"}).update("Show More").observe("click",function(){a.me._pagination.pageNo=a.me._pagination.pageNo*1+1;$(this).update("Fetching more results ...").addClassName("disabled");a.me.getResults()})})},_getAddrDiv:function(a){return new Element("div").insert({bottom:new Element("span",{"class":"addr_contact_name"}).update(a.contactName).insert({top:new Element("span",{"class":"icon"})})}).insert({bottom:new Element("span",{"class":"addr_contactNo"}).update(a.contactNo).insert({top:new Element("span",{"class":"icon"})})}).insert({bottom:new Element("span",{"class":"addr_addr"}).update(a.full).insert({top:new Element("span",{"class":"icon"})})})},_getTitledDiv:function(b,a){return new Element("div",{"class":"field_div"}).insert({bottom:new Element("span",{"class":"inlineblock title"}).update(b)}).insert({bottom:new Element("span",{"class":"inlineblock divcontent"}).update(a)})},_getResultRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);b.quantity="n/a";b.custName="n/a";b.custEmail="n/a";if(c.infos&&c.infos!==null){if(b.me._infoTypes.qty in c.infos&&c.infos[b.me._infoTypes.qty].length>0){b.quantity=c.infos[b.me._infoTypes.qty][0].value}if(b.me._infoTypes.custName in c.infos&&c.infos[b.me._infoTypes.custName].length>0){b.custName=c.infos[b.me._infoTypes.custName][0].value}if(b.me._infoTypes.custEmail in c.infos&&c.infos[b.me._infoTypes.custEmail].length>0){b.custEmail=c.infos[b.me._infoTypes.custEmail][0].value}}return new Element("div",{"class":"row"}).store("data",c).insert({bottom:new Element("span",{"class":"cell orderNo"}).update(b.isTitle?c.orderNo:new Element("div").update(new Element("div",{"class":"orderNoNo"}).update(c.orderNo).observe("click",function(){jQuery.fancybox({width:"80%",height:"90%",autoScale:false,transitionIn:"none",transitionOut:"none",type:"iframe",autoDimensions:false,autoSize:false,href:"/orderdetails/"+c.id+".html"})})).insert({bottom:new Element("div",{"class":"qty"}).update("Qty: "+b.quantity)}))}).insert({bottom:new Element("span",{"class":"cell orderDate"}).update(c.orderDate)}).insert({bottom:new Element("span",{"class":"cell custName"}).update(b.isTitle?c.custName:new Element("div").update(b.custName).insert({bottom:new Element("div",{"class":"custEmail"}).update(b.custEmail)}))}).insert({bottom:new Element("span",{"class":"cell shippingAddr"}).update(b.isTitle?c.shippingAddr:b.me._getAddrDiv(c.address.shipping))}).insert({bottom:new Element("span",{"class":"cell status"}).update(c.status?c.status.name:"")}).insert({bottom:new Element("span",{"class":"cell payment"}).update(b.isTitle?"Payments":new Element("div").insert({bottom:b.me._getTitledDiv("Payment Checked?",c.passPaymentCheck?new Element("span",{"class":"passPaymentChecked inlineblock"}):"")}).insert({bottom:b.me._getTitledDiv("Total Due: ",b.isTitle?c.totalDue:b.me.getCurrency(c.totalDue))}).insert({bottom:b.me._getTitledDiv("Inv. No.: ",c.invNo)}))})}});