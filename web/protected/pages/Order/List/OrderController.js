var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_infoTypes:{},orderStatuses:[],_loadChosen:function(){$$(".chosen").each(function(a){a.store("chosen",new Chosen(a,{disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"}))});return this},_bindSearchKey:function(){var a={};a.me=this;$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(c){a.me.keydown(c,function(){$("searchBtn").click()})})});return this},_loadStatuses:function(b){this.orderStatuses=b;var a={};a.me=this;a.statusBox=$(a.me.searchDivId).down("#orderStatusId");a.me.orderStatuses.each(function(c){a.statusBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return this},setSearchCriteria:function(b){var a={};a.me=this;a.searchPanel=$(a.me.searchDivId);$H(b).each(function(c){a.field=c.key;a.value=c.value;a.fieldBox=a.searchPanel.down('[search_field="'+a.field+'"]');if(a.fieldBox){a.optlength=a.fieldBox.options.length;for(a.i=0;a.i<a.optlength;a.i++){if(a.value.indexOf(a.fieldBox.options[a.i].value*1)>=0){a.fieldBox.options[a.i].selected=true}}}});a.me._loadChosen()._bindSearchKey();return this},getSearchCriteria:function(){var a={};a.me=this;if(a.me._searchCriteria===null){a.me._searchCriteria={}}a.nothingTosearch=true;$(a.me.searchDivId).getElementsBySelector("[search_field]").each(function(b){a.me._searchCriteria[b.readAttribute("search_field")]=$F(b);if(($F(b) instanceof Array&&$F(b).size()>0)||(typeof $F(b)==="string"&&!$F(b).blank())){a.nothingTosearch=false}});if(a.nothingTosearch===true){a.me._searchCriteria=null}return this},getResults:function(c,a){var b={};b.me=this;b.searchBtn=$("searchBtn");b.reset=(c||false);if(b.me._searchCriteria===null){alert("Nothing to search!");return}if(b.reset===true){b.me._pagination.pageNo=1}b.me._pagination.pageSize=(a||b.me._pagination.pageSize);b.me.postAjax(b.me.getCallbackId("getOrders"),{pagination:b.me._pagination,searchCriteria:b.me._searchCriteria},{onLoading:function(){b.searchBtn.store("originValue",$F(b.searchBtn)).addClassName("disabled").setValue("Searching ...").disabled=true},onComplete:function(d,g){try{b.result=b.me.getResp(g,false,true);$(b.me.totalNoOfItemsId).update(b.result.pageStats.totalRows);b.resultDiv=$(b.me.resultDivId);if(b.reset===true){b.titleRow={orderNo:"Order Info.",custName:"Customer Name",shippingAddr:"Shipping Address",invNo:"Invoice No.",status:{name:"Status"},totalDue:"Total Due",passPaymentCheck:"Payment Cleared?"};b.resultDiv.update(b.me._getResultRow(b.titleRow,true).addClassName("header"))}b.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()});b.result.items.each(function(e){b.resultDiv.insert({bottom:b.me._getResultRow(e)})});if(b.result.pageStats.pageNumber<b.result.pageStats.totalPages){b.resultDiv.insert({bottom:b.me._getNextPageBtn().addClassName("paginWrapper")})}}catch(f){alert(f)}b.searchBtn.removeClassName("disabled").setValue(b.searchBtn.retrieve("originValue")).disabled=false}})},_getNextPageBtn:function(){var a={};a.me=this;return new Element("div",{"class":"pagination"}).insert({bottom:new Element("span",{"class":"button"}).update("Show More").observe("click",function(){a.me._pagination.pageNo=a.me._pagination.pageNo*1+1;$(this).update("Fetching more results ...").addClassName("disabled");a.me.getResults()})})},_getAddrDiv:function(b){var a={};a.me=this;return new Element("div").insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),b.contactName).addClassName("addr_contact_name")}).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),b.contactNo).addClassName("addr_contactNo")}).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),b.full).addClassName("addr_addr")})},_getTitledDiv:function(b,a){return new Element("div",{"class":"field_div"}).insert({bottom:new Element("span",{"class":"inlineblock title"}).update(b)}).insert({bottom:new Element("span",{"class":"inlineblock divcontent"}).update(a)})},_openDetailPage:function(b){var a={};a.me=this;jQuery.fancybox({width:"80%",height:"90%",autoScale:true,type:"iframe",href:"/orderdetails/"+b.id+".html",beforeClose:function(){if($(a.me.resultDivId).down(".row[order_id="+b.id+"]")){$(a.me.resultDivId).down(".row[order_id="+b.id+"]").replace(a.me._getResultRow($$("iframe.fancybox-iframe").first().contentWindow.pageJs._order))}}})},_getOrderInfoCell:function(b){var a={};a.me=this;a.quantity="n/a";a.custName="n/a";a.custEmail="n/a";if(b.infos&&b.infos!==null){if(a.me._infoTypes.qty in b.infos&&b.infos[a.me._infoTypes.qty].length>0){a.quantity=b.infos[a.me._infoTypes.qty][0].value}if(a.me._infoTypes.custName in b.infos&&b.infos[a.me._infoTypes.custName].length>0){a.custName=b.infos[a.me._infoTypes.custName][0].value}if(a.me._infoTypes.custEmail in b.infos&&b.infos[a.me._infoTypes.custEmail].length>0){a.custEmail=b.infos[a.me._infoTypes.custEmail][0].value}}return new Element("div").update(new Element("div",{"class":"orderNo"}).update(b.orderNo).observe("click",function(){a.me._openDetailPage(b)})).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),a.custName).addClassName("custName addr_contact_name")}).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),new Element("a",{href:"mailto:"+a.custEmail}).update(a.custEmail)).addClassName("custEmail addr_contact_email")}).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),b.orderDate).addClassName("orderDate")})},_getPaymentCell:function(b){var a={};a.me=this;return new Element("div").insert({bottom:a.me._getTitledDiv("",!b.passPaymentCheck?"":new Element("span",{"class":"icon"}).addClassName(b.totalDue===0?"ok":"warning").writeAttribute("title",b.totalDue===0?"Full Paied":"Short Paid"))}).insert({bottom:a.me._getTitledDiv(new Element("span",{"class":"icon"}),a.me.getCurrency(b.totalDue)).addClassName("totalDue").writeAttribute("title","Total Due Amount:"+a.me.getCurrency(b.totalDue))}).insert({bottom:!b.passPaymentCheck?"":a.me._getTitledDiv(new Element("span",{"class":"icon"}),new Element("span",{"class":"tooltipTarget"}).update("payment details").writeAttribute("title","click to view payment details").observe("click",function(){a.me._openDetailPage(b)})).addClassName("paymentdetails")})},_getPurchasingCell:function(b){var a={};a.me=this;a.statusId_stockchecked=["4","5","6","7","8"];a.statusId_stockchecked_not_passed=["4","6"];a.hasCheckedStock=(a.statusId_stockchecked.indexOf(b.status.id)>=0);a.stockChkedWIssues=(a.statusId_stockchecked_not_passed.indexOf(b.status.id)>=0);return new Element("div").insert({bottom:a.me._getTitledDiv("",!a.hasCheckedStock?"":new Element("span",{"class":"icon"}).addClassName(!a.stockChkedWIssues?"ok":"warning").writeAttribute("title",a.stockChkedWIssues?"insufficient stock":"Stocked checked"))}).insert({bottom:!a.hasCheckedStock?"":a.me._getTitledDiv(new Element("span",{"class":"icon"}),new Element("span",{"class":"tooltipTarget"}).update("view items").writeAttribute("title","click to view order items").observe("click",function(){a.me._openDetailPage(b)})).addClassName("vieworderitems")})},_getWarehouseCell:function(b){var a={};a.me=this;a.statusId_whchecked=["6","7","8"];a.statusId_whchecked_not_passed=["6"];a.hasChecked=(a.statusId_whchecked.indexOf(b.status.id)>=0);a.chkedWIssues=(a.statusId_whchecked_not_passed.indexOf(b.status.id)>=0);return new Element("div").insert({bottom:a.me._getTitledDiv("",!a.hasChecked?"":new Element("span",{"class":"icon"}).addClassName(!a.chkedWIssues?"ok":"warning").writeAttribute("title",a.chkedWIssues?"insufficient stock":"Stock Handled successfully!"))}).insert({bottom:!a.hasChecked?"":a.me._getTitledDiv(new Element("span",{"class":"icon"}),new Element("span",{"class":"tooltipTarget"}).update("view items").writeAttribute("title","click to view order items").observe("click",function(){a.me._openDetailPage(b)})).addClassName("vieworderitems")})},_getResultRow:function(c,a){var b={};b.me=this;b.isTitle=(a||false);return new Element("div",{"class":"row",order_id:c.id}).store("data",c).insert({bottom:new Element("span",{"class":"cell orderInfo"}).update(b.isTitle?c.orderNo:b.me._getOrderInfoCell(c))}).insert({bottom:new Element("span",{"class":"cell shippingAddr"}).update(b.isTitle?c.shippingAddr:b.me._getAddrDiv(c.address.shipping))}).insert({bottom:new Element("span",{"class":"cell status",order_status:c.status.name}).update(c.status?c.status.name:"")}).insert({bottom:new Element("span",{"class":"cell payment"}).update(b.isTitle?"Payments":b.me._getPaymentCell(c))}).insert({bottom:new Element("span",{"class":"cell purchasing"}).update(b.isTitle?"Purchasing":b.me._getPurchasingCell(c))}).insert({bottom:new Element("span",{"class":"cell warehouse"}).update(b.isTitle?"Warehouse":b.me._getWarehouseCell(c))})}});