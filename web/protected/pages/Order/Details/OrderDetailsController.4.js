var PageJs=new Class.create();PageJs.prototype=Object.extend(new BPCPageJs(),{_order:null,_orderStatuses:[],_paymentMethods:[],_orderItems:[],_resultDivId:"",_couriers:[],_editMode:{purchasing:false,warehouse:false,accounting:false,status:false},_commentsDiv:{pagination:{pageSize:10,pageNo:1},resultDivId:"",type:""},infoType_custName:1,infoType_custEmail:2,order_status_picked:7,comment_type_warehouse:"WAREHOUSE",comment_type_purchasing:"PURCHASING",_tooltipObj:null,_commentsTypeIds:{},setToolTipCommentsObj:function(a){this._tooltipObj=a;return this},setCommentsTypeIds:function(a){this._commentsTypeIds=a;return this},setEditMode:function(b,d,a,c){this._editMode.purchasing=(b||false);this._editMode.warehouse=(d||false);this._editMode.accounting=(a||false);this._editMode.status=(c||false);return this},setOrder:function(a,b,c){this._order=a;this._orderItems=b;this._orderStatuses=c;return this},setCourier:function(b){var a={};a.me=this;a.me._couriers=b;return a.me},setPaymentMethods:function(b){var a={};a.me=this;a.me._paymentMethods=b;return a.me},_getAddressDiv:function(a,b){return new Element("div",{"class":"addr"}).insert({bottom:new Element("div",{"class":"title"}).update(a)}).insert({bottom:new Element("div",{"class":"addr_content"}).insert({bottom:new Element("div",{"class":"contactName"}).update(b.contactName)}).insert({bottom:new Element("div",{"class":"street"}).update(b.street)}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"city inlineblock"}).update(b.city)}).insert({bottom:new Element("span",{"class":"region inlineblock"}).update(b.region)}).insert({bottom:new Element("span",{"class":"postcode inlineblock"}).update(b.postCode)})})})},_getfieldDiv:function(b,a){return new Element("span",{"class":"fieldDiv"}).insert({bottom:new Element("span",{"class":"fieldDiv_title"}).update(b)}).insert({bottom:new Element("span",{"class":"fieldDiv_content"}).update(a)})},_getHasStockSel:function(d,c,a){var b={};b.selBox=new Element("select",{"class":"hasStock"}).insert({bottom:new Element("option",{value:""}).update(d)}).insert({bottom:new Element("option",{value:"Y"}).update("YES")}).insert({bottom:new Element("option",{value:"N"}).update("NO")}).observe("change",a);if(!c.blank()){b.options=b.selBox.getElementsBySelector("option");for(b.i=0;b.i<b.options.size();b.i++){if(b.options[b.i].value===c){b.options[b.i].selected=true}}}return b.selBox},_blockUI:function(){jQuery.fancybox.showLoading();return this},_unBlockUI:function(){jQuery.fancybox.hideLoading();return this},_clearETA:function(b,c){var a={};a.me=this;if(!confirm("You are trying to mark a part as received/clearing the ETA?\n continue?")){return a.me}a.reason=prompt("The reason for clearing the ETA");if(a.reason===null){return a.me}a.me.postAjax(a.me.getCallbackId("clearETA"),{item_id:c.id,comments:a.reason},{onLoading:function(d,e){$(b).store("originValue",$(b).innerHTML).addClassName("disabled").update("...");a.me._blockUI()},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result){return}alert("ETA cleared Successfully!");window.location=document.URL}catch(f){alert(f)}},onComplete:function(d,e){if($(b)){$(b).removeClassName("disabled").update($(b).retrieve("originValue"))}a.me._unblockUI()}});return a.me},_getClearETABtn:function(b){var a={};a.me=this;if(b.eta==="0001-01-01 00:00:00"){return}a.newDiv=new Element("span",{"class":"button"}).update("clear ETA").observe("click",function(){a.me._clearETA(this,b)});return a.newDiv},_changeIsOrdered:function(c,a){var b={};b.me=this;b.isOrdered=$(c).checked;if(!confirm("You are going to change this order item to be: "+(b.isOrdered===true?"ORDERED":"NOT ORDERED"))){return false}b.me.postAjax(b.me.getCallbackId("changeIsOrdered"),{item_id:a.id,isOrdered:b.isOrdered},{onLoading:function(d,e){b.me._blockUI()},onSuccess:function(d,g){try{b.result=b.me.getResp(g,false,true);if(!b.result){return}alert("IsOrdered flag changed Successfully!");window.location=document.URL}catch(f){alert(f)}},onComplete:function(d,e){b.me._unblockUI()}});return true},_getPurchasingCell:function(a){var b={};b.me=this;b.hasStock=(a.eta===""?"":(a.eta==="0001-01-01 00:00:00"?"Y":"N"));b.isOrdered=(a.isOrdered===false?false:true);if(b.me._editMode.purchasing===false){b.newDiv=new Element("div",{"class":"order_item_details"});if(b.hasStock===""){return b.newDiv.update("N/A")}return b.newDiv.insert({bottom:b.me._getfieldDiv("hasStock?: ",b.hasStock)}).insert({bottom:b.me._getfieldDiv("ETA: ",a.eta)}).insert({bottom:b.me._getfieldDiv("Is Ordered: ",new Element("input",{type:"checkbox",checked:b.isOrdered}).observe("change",function(c){return b.me._changeIsOrdered(this,a)}))}).insert({bottom:b.me._getfieldDiv("Comments: ",new Element("span",{"class":"comment cuspntr",tooltipcomments_entity:"OrderItem",tooltipcomments_entityid:a.id,tooltipcomments_commentstype:b.me._commentsTypeIds.purchasing}).update("show").observe("mouseover",function(c){b.me._tooltipObj._getComments(this,c)}))}).insert({bottom:b.me._getClearETABtn(a)})}b.getEditDiv=function(d,c){b.etaBox=new Element("input",{type:"text",placeholder:"ETA:",update_order_item:"eta",id:"order_item_"+a.id,readonly:true,value:c?c:""});b.returnDiv=new Element("div").insert({bottom:b.me._getfieldDiv("ETA:",b.etaBox)}).insert({bottom:b.me._getfieldDiv("Comments: ",new Element("input",{update_order_item:"comments",placeholder:"The reason"}))}).insert({bottom:b.me._getfieldDiv("Is Ordered: ",new Element("input",{type:"checkbox",update_order_item:"isOrdered",is_ordered:"is_ordered"}))}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update("cancel").observe("click",function(){$(this).up(".operationDiv").update(b.me._getHasStockSel("Has Stock?",d,b.func))})});if(b.isOrdered===true){$(b.returnDiv).down("[is_ordered]").writeAttribute("checked","checked")}return b.returnDiv};b.func=function(){if($(this)&&$(this).up(".cell")){$(this).up(".cell").getElementsBySelector(".msgDiv").each(function(c){c.remove()})}if($F(this)==="N"){$(this).up(".operationDiv").update(b.getEditDiv(b.hasStock));new Prado.WebUI.TDatePicker({ID:"order_item_"+a.id,InputMode:"TextBox",Format:"yyyy-MM-dd 17:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom"})}else{$(this).up(".operationDiv").getElementsBySelector("[update_order_item]").each(function(c){c.remove()});if($F(this)==="Y"){$(this).up(".operationDiv").insert({bottom:new Element("input",{type:"hidden",update_order_item:"eta",value:"0001-01-01 00:00:00"})});$(this).up(".operationDiv").insert({bottom:new Element("input",{type:"hidden",update_order_item:"isOrdered",value:"false"})})}}};if(b.hasStock==="N"){return new Element("div",{"class":"operationDiv"}).update(b.getEditDiv("",a.eta))}b.selBox=b.me._getHasStockSel("Has Stock?",b.hasStock,b.func);b.returnDiv=new Element("div",{"class":"operationDiv"});b.returnDiv.insert({bottom:b.selBox});if(b.hasStock==="Y"){b.returnDiv.insert({bottom:new Element("input",{type:"hidden",update_order_item:"eta",value:"0001-01-01 00:00:00"})}).insert({bottom:new Element("input",{type:"hidden",update_order_item:"isOrdered",value:"false"})})}return b.returnDiv},_getWarehouseCell:function(a){var b={};b.me=this;if(b.me._editMode.warehouse===false||b.me._order.status.id*1===b.me.order_status_picked){return new Element("div",{"class":"order_item_details"}).insert({bottom:b.me._getfieldDiv("Picked?: ",a.isPicked?"Y":"N")}).insert({bottom:b.me._getfieldDiv("Comments: ",new Element("span",{"class":"comment cuspntr",tooltipcomments_entity:"OrderItem",tooltipcomments_entityid:a.id,tooltipcomments_commentstype:b.me._commentsTypeIds.warehouse}).update("show").observe("mouseover",function(c){b.me._tooltipObj._getComments(this,c)}))})}b.func=function(){$(this).up(".cell").getElementsBySelector(".msgDiv").each(function(c){c.remove()});if($F(this)==="N"){$(this).up(".operationDiv").update(new Element("div").insert({bottom:b.me._getfieldDiv("Comments: ",new Element("input",{pick_order_item:"comments",placeholder:"The reason"}))}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update("cancel").observe("click",function(){$(this).up(".operationDiv").update(b.me._getHasStockSel("Is Picked?","",b.func))})}).insert({bottom:new Element("input",{type:"hidden",pick_order_item:"isPicked",value:$F(this)})}))}else{$(this).up(".operationDiv").insert({bottom:new Element("input",{type:"hidden",pick_order_item:"isPicked",value:$F(this)})})}};return b.me._getHasStockSel("Is Picked?","",b.func).wrap(new Element("div",{"class":"operationDiv"}))},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.newDiv=new Element("div",{"class":"row "+(c.isTitle===true?"":"productRow")}).store("data",b).writeAttribute("order_item_id",b.id).insert({bottom:new Element("span",{"class":"inlineblock cell sku"}).update(b.product.sku)}).insert({bottom:new Element("span",{"class":"inlineblock cell productName"}).update(b.product.name)}).insert({bottom:new Element("span",{"class":"inlineblock cell uprice"}).update(c.isTitle===true?b.unitPrice:c.me.getCurrency(b.unitPrice))}).insert({bottom:new Element("span",{"class":"inlineblock cell qty"}).update(b.qtyOrdered)}).insert({bottom:new Element("span",{"class":"inlineblock cell tprice"}).update(c.isTitle===true?b.totalPrice:c.me.getCurrency(b.totalPrice))}).insert({bottom:new Element("span",{"class":"inlineblock cell purchasing"}).update(c.isTitle===true?"Purchasing":c.me._getPurchasingCell(b))}).insert({bottom:new Element("span",{"class":"inlineblock cell warehouse"}).update(c.isTitle===true?"Warehouse":c.me._getWarehouseCell(b))});return c.newDiv},_changeOrderStatus:function(b){var a={};a.me=this;a.msg="About to change the status of this order?\n Continue?";if(confirm(a.msg)){a.comments="";while(a.comments!==null&&a.comments.blank()){a.comments=window.prompt("Please Type in the reason for changing:")}if(a.comments===null){$(b).replace(a.me._getOrderStatus());return this}a.me.postAjax(a.me.getCallbackId("changeOrderStatus"),{order:a.me._order,orderStatusId:$F(b),comments:a.comments},{onLoading:function(c,d){a.me._blockUI();$(b).disabled=true},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);alert("Saved Successfully!");window.location=document.URL}catch(d){alert(d);$(b).disabled=false;$(b).replace(a.me._getOrderStatus())}},onComplete:function(c,d){a.me._unblockUI()}});return this}$(b).replace(a.me._getOrderStatus());return this},_submitPaymentConfirmation:function(b){var a={};a.me=this;a.paidAmount=$F($(b).up(".wrapper").down("#paidAmount"));a.paymentMethod=$F($(b).up(".wrapper").down("#paymentMethod"));a.confDiv=$(b).up("#extraConfDiv");a.extraComment="";$(b).up(".wrapper").getElementsBySelector(".msgDiv").each(function(c){c.remove()});a.exception="";if(a.paidAmount===null||a.paidAmount.blank()||isNaN(a.paidAmount)){a.exception+="Paid Amount is NOT valid\n"}if(a.paymentMethod===null||a.paidAmount.blank()){a.exception+="Payment Method is NOT selected\n"}if(!a.exception.blank()){alert(a.exception);return this}a.amtDiff=Math.abs($F(a.confDiv.down("#paidAmtDiff")));a.hasErr=false;if(a.amtDiff!==0){a.confDiv.getElementsBySelector(".extraConf").each(function(c){if(c.readAttribute("type")==="text"){a.extraComment=$F(c).strip();if(a.extraComment.blank()||a.extraComment===null){c.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update("Additional Comment is Mandatory!"))});a.hasErr=true}}if(c.readAttribute("type")==="checkbox"){if(!c.checked||c.checked===false||c.checked===null){c.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update("Pls Select The Payment Check Box"))});a.hasErr=true}}})}if(a.hasErr===true){return this}a.me.postAjax(a.me.getCallbackId("confirmPayment"),{paidAmt:a.paidAmount,paymentMethod:a.paymentMethod,amtDiff:a.amtDiff,extraComment:a.extraComment,order:a.me._order},{onLoading:function(c,d){$(b).store("originValue",$(b).innerHTML).addClassName("disabled").update("saving ...");a.me._blockUI()},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);alert("Saved Successfully!");window.location=document.URL}catch(d){alert(d)}},onComplete:function(c,d){if($(b)){$(b).update($(b).retrieve("originValue")).removeClassName("disabled")}a.me._unblockUI()}});return this},_checkPaidAmount:function(b){var a={};a.me=this;a.hasError=false;a.paidAmount=$F(b).strip();a.paidAmount=a.paidAmount.replace(new RegExp("(\\$|\\s|,)","g"),"");$(b).value=a.paidAmount;$(b).up(".wrapper").getElementsBySelector(".msgDiv").each(function(c){c.remove()});a.extraInfoDiv=$(b).up(".wrapper").down("#extraConfDiv");if(a.extraInfoDiv.getElementsBySelector(".fieldDiv").length>0){a.extraInfoDiv.getElementsBySelector(".fieldDiv").each(function(c){c.remove()})}a.paymentMethodElement=$(b).up(".wrapper").down("#paymentMethod");a.paymentMethod=$F(a.paymentMethodElement).strip();if(a.paymentMethod.blank()||a.paymentMethod===null||a.paymentMethod===""){a.paymentMethodElement.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update("Payment Method NOT selected"))});a.hasError=true}if(a.paidAmount===null||a.paidAmount.blank()||isNaN(a.paidAmount)){$(b).insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update("Paid Amount is NOT valid"))});a.hasError=true}if(a.hasError===true){return}a.diff=Math.abs(Math.abs(parseFloat(a.paidAmount).toFixed(2))-Math.abs(parseFloat(a.me._order.totalAmount).toFixed(2)));a.extraInfoDiv.down("#paidAmtDiff").value=a.diff;if(a.diff!==0){a.extraInfoDiv.insert({bottom:a.me._getfieldDiv("Additional Comment",new Element("input",{type:"text","class":"extraConf",id:"extraComment"}))}).insert({bottom:a.me._getfieldDiv("Payment Check",new Element("input",{type:"checkbox","class":"extraConf",id:"extraPaymentCheck"}))})}a.extraInfoDiv.insert({bottom:a.me._getfieldDiv("",new Element("span",{"class":"button"}).update("Confirm Payment").observe("click",function(){a.me._submitPaymentConfirmation(this)}))})},_generateSelectionForPaymentMethod:function(b){var a={};a.me=this;if((b instanceof Array&&b.length===0)||!(b instanceof Array)){b=a.me._paymentMethods}a.selBox=new Element("select",{id:"paymentMethod","class":"chosen2",title_text:"Select Payment Method",dis_search:"false"}).insert({bottom:new Element("option",{value:""}).update("")});b.each(function(c){a.selBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return a.selBox},_getFinanceBtns:function(){var a={};a.me=this;if(a.me._editMode.accounting!==true){return""}return new Element("div",{"class":"wrapper financeBtnWrapper"}).insert({bottom:a.me._getfieldDiv("Payment Method:",a.me._generateSelectionForPaymentMethod(a.me._paymentMethods).observe("change",function(){if(((a.paymentMethod=$F(this).strip())!==""&&a.paymentMethod!==null&&!a.paymentMethod.blank())&&(a.paidAmount=$F($(this).up(".financeBtnWrapper").down("#paidAmount")).strip())!==""&&(!a.paidAmount.blank())&&(a.paidAmount!==null)){a.me._checkPaidAmount($(this).up(".financeBtnWrapper").down("#paidAmount"))}}))}).insert({bottom:a.me._getfieldDiv("Paid:",new Element("input",{type:"text",id:"paidAmount"}).observe("change",function(){if((a.paymentMethod=$F($(this).up(".financeBtnWrapper").down("#paymentMethod")).strip())!==""&&!a.paymentMethod.blank()&&a.paymentMethod!==null){a.me._checkPaidAmount(this)}else{$(this).up(".financeBtnWrapper").getElementsBySelector(".msgDiv").each(function(b){b.remove()});$(this).up(".financeBtnWrapper").down("#extraConfDiv").getElementsBySelector(".fieldDiv").each(function(b){b.remove()})}}))}).insert({bottom:new Element("span",{id:"extraConfDiv"}).insert({bottom:new Element("input",{type:"hidden",id:"paidAmtDiff"})})})},_collectData:function(c,b){var a={};a.me=this;a.data=[];a.hasError=false;$(a.me._resultDivId).getElementsBySelector(".productRow ."+c).each(function(d){d.getElementsBySelector(".msgDiv").each(function(e){e.remove()});a.fields=d.getElementsBySelector("["+b+"]");if(a.fields.size()===0){d.insert({top:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update("Pls Select One!"))});a.hasError=true}else{a.orderItem=d.up(".row").retrieve("data");a.attrData={orderItem:a.orderItem};a.fields.each(function(e){a.fieldName=e.readAttribute(b);if(e.readAttribute("type")!=="checkbox"){a.value=$F(e)}else{a.value=$(e).checked}if((typeof a.value=="string")&&a.value.blank()){e.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update(a.fieldName+" Required!"))});a.hasError=true}else{if(!a.attrData[c]){a.attrData[c]={}}a.attrData[c][a.fieldName]=a.value}});a.data.push(a.attrData)}});return(a.hasError===true?null:a.data)},_getPurchasingBtns:function(){var a={};a.me=this;if(a.me._editMode.purchasing===false){return""}return new Element("div").insert({bottom:new Element("span",{"class":"button"}).update("submit").observe("click",function(){a.btn=this;a.data=a.me._collectData("purchasing","update_order_item");if(a.data===null){alert("Error Occurred, pls scroll up to see details!");return}a.me.postAjax(a.me.getCallbackId("updateOrder"),{items:a.data,order:a.me._order,"for":"purchasing"},{onLoading:function(b,c){a.btn.addClassName("disabled").update("Saving ...");a.me._blockUI()},onSuccess:function(b,d){try{a.result=a.me.getResp(d,false,true);if(!a.result){return}alert("Saved Successfully!");window.location=document.URL}catch(c){alert(c)}},onComplete:function(b,c){if(a.btn){a.btn.removeClassName("disabled").update("submit")}a.me._unblockUI()}})})})},_getWHBtns:function(){var a={};a.me=this;if(a.me._editMode.warehouse===false||a.me._order.status.id*1===a.me.order_status_picked){return""}return new Element("div").insert({bottom:new Element("span",{"class":"button"}).update("submit").observe("click",function(){a.btn=this;a.data=a.me._collectData("warehouse","pick_order_item");if(a.data===null){alert("Error Occurred, pls scroll up to see details!");return}a.hasError=false;a.finalOrderItemArray=[];a.data.each(function(b){if(b.warehouse.isPicked==="N"&&(!b.warehouse.comments||b.warehouse.comments===null||b.warehouse.comments.strip()==="")){alert("Error Occurred, pls scroll up to see details!");a.hasError=true;return}a.finalOrderItemArray.push(b)});if(a.hasError===true){return}a.me.postAjax(a.me.getCallbackId("updateOIForWH"),{orderItems:a.finalOrderItemArray,order:a.me._order},{onLoading:function(b,c){a.btn.addClassName("disabled").update("Saving ...");a.me._blockUI()},onSuccess:function(b,d){try{a.result=a.me.getResp(d,false,true);if(!a.result){return}alert("Saved Successfully!");window.location=document.URL}catch(c){alert(c)}},onComplete:function(b,c){if(a.btn){a.btn.removeClassName("disabled").update("submit")}a.me._unblockUI()}})})})},_getCommentsRow:function(a){return new Element("div",{"class":"row comments"}).insert({bottom:new Element("span",{"class":"inlineblock cell created"}).update(a.created)}).insert({bottom:new Element("span",{"class":"inlineblock cell creator"}).update(a.creator)}).insert({bottom:new Element("span",{"class":"inlineblock cell type"}).update(a.type)}).insert({bottom:new Element("span",{"class":"inlineblock cell comments"}).update(a.comments)})},_getComments:function(c,b){var a={};a.me=this;a.reset=(c||false);a.me.postAjax(a.me.getCallbackId("getComments"),{pagination:a.me._commentsDiv.pagination,order:a.me._order,type:a.me._commentsDiv.type},{onLoading:function(d,e){if(a.reset===true){$(a.me._commentsDiv.resultDivId).update(new Element("img",{src:"/themes/default/images/loading_big.gif"}))}if(b){$(b).store("originValue",$F(b)).addClassName("disabled").setValue("Getting ...").disabled=true}},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(a.reset===true){$(a.me._commentsDiv.resultDivId).update(a.me._getCommentsRow({type:"Type",creator:"WHO",created:"WHEN",comments:"COMMENTS"}).addClassName("header"))}if(!a.result){return}a.result.items.each(function(e){$(a.me._commentsDiv.resultDivId).insert({bottom:a.me._getCommentsRow(e)})});if(b){$(b).remove()}if(a.result.pagination.pageNumber<a.result.pagination.totalPages){$(a.me._commentsDiv.resultDivId).insert({bottom:new Element("input",{type:"button","class":"button",value:"Get More Comments"}).observe("click",function(){a.me._commentsDiv.pagination.pageNo=a.me._commentsDiv.pagination.pageNo*1+1;a.me._getComments(false,this)})})}}catch(f){alert(f);if(b){a.orginalValue=$(b).retrieve("originValue");$(b).removeClassName("disabled").setValue(a.orginalValue).disabled=false}}}});return this},_addComments:function(c,a){var b={};b.me=this;b.commentsBox=$(c).up(".new_comments_wrapper").down("[new_comments=comments]");b.comments=$F(b.commentsBox);if(b.comments.blank()){return this}b.me.postAjax(b.me.getCallbackId("addComments"),{comments:b.comments,order:b.me._order},{onLoading:function(d,e){$(c).store("originValue",$F(c)).addClassName("disabled").setValue("saving ...").disabled=true},onSuccess:function(d,g){try{b.result=b.me.getResp(g,false,true);if(!b.result){return}$(a).down(".header").insert({after:b.me._getCommentsRow(b.result)});b.commentsBox.setValue("")}catch(f){alert(f)}},onComplete:function(){b.originValue=$(c).retrieve("originValue");$(c).removeClassName("disabled").setValue(b.originValue).disabled=false}});return this},_getOrderStatus:function(){var a={};a.me=this;if(a.me._editMode.status!==true){return a.me._order.status.name}a.selBox=new Element("select").observe("change",function(){a.me._changeOrderStatus(this)});a.me._orderStatuses.each(function(b){a.opt=new Element("option",{value:b.id}).update(b.name);if(b.id===a.me._order.status.id){a.opt.writeAttribute("selected",true)}a.selBox.insert({bottom:a.opt})});return a.selBox},_getCourierList:function(){var a={};a.me=this;a.courierSelect=new Element("select",{"class":"chosen",title_text:"Select Post Option",dis_search:"false"}).insert({bottom:new Element("option",{value:""}).update("")});a.me._couriers.each(function(b){a.courierSelect.insert({bottom:new Element("option",{value:b.id}).update(b.name)})});return a.courierSelect},_checkAndSubmitShippingOptions:function(b){var a={};a.me=this;a.hasErr=false;a.finalShippingDataArray={};a.shippingDiv=$(b).up("#shippingInfoDiv");a.shippingDiv.getElementsBySelector(".msgDiv").each(function(c){c.remove()});a.shippingDiv.getElementsBySelector(".shipmentInfo").each(function(c){a.insertData=false;a.itemValue=$F(c).strip();if(c.readAttribute("mandatory")==="true"){if(a.itemValue===null||!a.itemValue||a.itemValue===""||a.itemValue.blank()){c.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update(c.readAttribute("displayValue")+" is Mandatory!"))});a.hasErr=true}else{if(c.hasAttribute("amount")&&c.readAttribute("amount")==="true"){a.itemValue=a.itemValue.replace(new RegExp("(\\$|\\s|,)","g"),"");$(c).value=a.itemValue;if(isNaN(a.itemValue)){c.insert({before:new Element("div",{"class":"msgDiv errorMsgDiv"}).update(new Element("div",{"class":"msg"}).update(c.readAttribute("displayValue")+" is Not Valid!"))});a.hasErr=true}else{a.insertData=true}}else{a.insertData=true}}}else{a.insertData=true}if(a.insertData===true&&a.hasErr===false){if(!(c.readAttribute("dataType") in a.finalShippingDataArray)){a.finalShippingDataArray[c.readAttribute("dataType")]=[]}a.finalShippingDataArray[c.readAttribute("dataType")].push(a.itemValue)}});if(a.hasErr===true){return}a.btn=$(b);a.me.postAjax(a.me.getCallbackId("updateShippingInfo"),{shippingInfo:a.finalShippingDataArray,order:a.me._order},{onLoading:function(c,d){a.btn.addClassName("disabled").update("Saving ...");a.me._blockUI()},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result){return}alert("Saved Successfully!");window.location=document.URL}catch(d){alert(d)}},onComplete:function(c,d){if(a.btn){a.btn.removeClassName("disabled").update("submit")}a.me._unblockUI()}})},_generateShippingReceiverInfoDetailsForEdit:function(){var a={};a.me=this;return new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"courier"}).insert({bottom:a.me._getfieldDiv("Courier:",a.me._getCourierList().addClassName("shipmentInfo").writeAttribute("dataType","courierId").writeAttribute("displayValue","Courier Info").writeAttribute("mandatory","true"))})}).insert({bottom:new Element("span",{"class":"contactName"}).insert({bottom:a.me._getfieldDiv("Contact Name:",new Element("input",{type:"text",dataType:"contactName",displayValue:"Contact Name","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.contactName))})}).insert({bottom:new Element("span",{"class":"contactNo"}).insert({bottom:a.me._getfieldDiv("Contact No:",new Element("input",{type:"text",dataType:"contactNo",displayValue:"Contact No","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.contactNo))})})},_generateShippingAddressDetailsForEdit:function(){var a={};a.me=this;return new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"street"}).insert({bottom:a.me._getfieldDiv("Street:",new Element("input",{type:"text",mandatory:"true",dataType:"street",displayValue:"Street","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.street))})}).insert({bottom:new Element("span",{"class":"city"}).insert({bottom:a.me._getfieldDiv("City:",new Element("input",{type:"text",mandatory:"true",dataType:"city",displayValue:"City","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.city))})}).insert({bottom:new Element("span",{"class":"region"}).insert({bottom:a.me._getfieldDiv("Region:",new Element("input",{type:"text",mandatory:"true",dataType:"region",displayValue:"Region","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.region))})}).insert({bottom:new Element("span",{"class":"country"}).insert({bottom:a.me._getfieldDiv("Country:",new Element("input",{type:"text",mandatory:"true",dataType:"country",displayValue:"Counter","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.country))})}).insert({bottom:new Element("span",{"class":"postCode"}).insert({bottom:a.me._getfieldDiv("Post Code:",new Element("input",{type:"text",mandatory:"true",dataType:"postCode",displayValue:"Post Code","class":"shipmentInfo"}).writeAttribute("value",a.me._order.address.shipping.postCode))})})},_generateOtherShippingDetailsForEdit:function(){var a={};a.me=this;return new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"noOfCartons"}).insert({bottom:a.me._getfieldDiv("No Of Carton(s):",new Element("input",{type:"text",mandatory:"true",dataType:"noOfCartons",displayValue:"No Of Carton","class":"shipmentInfo"}))})}).insert({bottom:new Element("span",{"class":"consignmentNo"}).insert({bottom:a.me._getfieldDiv("Consignment No:",new Element("input",{type:"text",mandatory:"true",dataType:"conNoteNo",displayValue:"Consignment No","class":"shipmentInfo"}))})}).insert({bottom:new Element("span",{"class":"estShippingCost"}).insert({bottom:a.me._getfieldDiv("Estimated Shipping Cost",new Element("input",{type:"text",mandatory:"true",amount:"true",dataType:"estShippingCost",displayValue:"Est Shipping Cost","class":"shipmentInfo number"}))})})},_getShippingRow:function(){var a={};a.me=this;return new Element("div",{"class":"shippingWrapper",id:"shippingInfoDiv"}).insert({bottom:new Element("div",{"class":"row header"}).update("Receiver Info")}).insert({bottom:a.me._generateShippingReceiverInfoDetailsForEdit()}).insert({bottom:new Element("div",{"class":"row header"}).update("Shipping Address Info")}).insert({bottom:a.me._generateShippingAddressDetailsForEdit()}).insert({bottom:new Element("div",{"class":"row header"}).update("Other Shipping Details")}).insert({bottom:a.me._generateOtherShippingDetailsForEdit()}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:a.me._getfieldDiv("Delivery Instruction:",new Element("textarea",{mandatory:"false",dataType:"deliveryInstructions","class":"shipmentInfo"})).addClassName("deliveryIns")}).insert({bottom:new Element("span",{"class":"submitShipping fieldDiv"}).insert({bottom:new Element("span",{"class":"button"}).update("Save").observe("click",function(){a.me._checkAndSubmitShippingOptions(this)})})})})},_viewShippingDetails:function(a){var b={};b.me=this;if(!a instanceof Array||a.length===0){a=b.me._order.shippment}b.finalReturnDiv=new Element("div",{"class":"viewShipping"});a.each(function(c){b.finalReturnDiv.insert({bottom:new Element("div",{"class":"row"}).insert({bottom:b.me._getfieldDiv("Receiver:",c.receiver).addClassName("receiver")}).insert({bottom:b.me._getfieldDiv("Contact No:",(c.contact)).addClassName("contactNo")}).insert({bottom:b.me._getfieldDiv("Courier:",(c.courier.name)).addClassName("courier")}).insert({bottom:b.me._getfieldDiv("Shipping Address:",c.address).addClassName("shippingAddr")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:b.me._getfieldDiv("No Of Cartons:",c.noOfCartons).addClassName("noOfCartons")}).insert({bottom:b.me._getfieldDiv("Est Shipping Cost:",b.me.getCurrency(c.estShippingCost)).addClassName("estShippingCost")}).insert({bottom:b.me._getfieldDiv("Consignment No:",c.conNoteNo).addClassName("consignmentNo")}).insert({bottom:b.me._getfieldDiv("Shipping Date:",c.shippingDate).addClassName("shippingDate")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:b.me._getfieldDiv("Delivery Instructions:",c.deliveryInstructions).addClassName("deliveryIns")})});b.finalReturnDiv.insert({bottom:b.returnDiv})});return b.finalReturnDiv},_getLatestPaymentMethod:function(){var a={};a.me=this;a.insertPoint=$(a.me._resultDivId).down("#lastPaymentMethod");a.me.postAjax(a.me.getCallbackId("getPaymentDetails"),{order:a.me._order},{onLoading:function(b,c){},onSuccess:function(b,d){try{a.result=a.me.getResp(d,false,true);if(a.result&&a.result.items.length>0){a.lastPaymentMethod=a.result.items[0].method.name;a.insertPoint.update(a.lastPaymentMethod)}else{a.insertPoint.update("N/A")}}catch(c){alert(c)}}});return a.me},_loadChosen:function(){$$(".chosen").each(function(a){a.store("chosen",new Chosen(a,{no_results_text:"Oops, nothing found!",placeholder_text_single:((titleText=$(a).readAttribute("title_text").strip())!==""?titleText:"Select Post Option"),disable_search:((titleText=$(a).readAttribute("dis_search").strip())==="true"?true:false),width:"100%"}))});return this},load:function(b){var a={};a.me=this;a.me._resultDivId=b;a.newDiv=new Element("div");a.custName=a.custEmail="n/a";if(a.me._order.infos&&a.me._order.infos!==null){if(a.me._order.infos[a.me.infoType_custName]&&a.me._order.infos[a.me.infoType_custName].length>0){a.custName=a.me._order.infos[a.me.infoType_custName][0].value}if(a.me._order.infos[a.me.infoType_custEmail]&&a.me._order.infos[a.me.infoType_custEmail].length>0){a.custEmail=a.me._order.infos[a.me.infoType_custEmail][0].value}}a.newDiv.insert({bottom:new Element("fieldset",{"class":"row orderInfo"}).insert({bottom:new Element("legend").update("info")}).insert({bottom:new Element("span",{"class":"orderNo inlineblock"}).update(a.me._getfieldDiv("Order No.",a.me._order.orderNo))}).insert({bottom:new Element("span",{"class":"orderDate inlineblock"}).update(a.me._getfieldDiv("Order Date:",a.me._order.orderDate))}).insert({bottom:new Element("span",{"class":"orderStatus inlineblock"}).update(a.me._getfieldDiv("Order Status:",a.me._getOrderStatus()))})});a.newDiv.insert({bottom:new Element("fieldset",{"class":"row addressRow"}).insert({bottom:new Element("legend").update("Customer")}).insert({bottom:new Element("div",{"class":"customer"}).insert({bottom:new Element("div").update("Customer: ")}).insert({bottom:new Element("span",{"class":"custName inlineblock"}).update(a.me._getfieldDiv("",a.custName))}).insert({bottom:new Element("span",{"class":"custEmail inlineblock"}).update(a.me._getfieldDiv("",a.custEmail))})}).insert({bottom:new Element("div").insert({bottom:a.me._getAddressDiv("Shipping Address: ",a.me._order.address.shipping).addClassName("inlineblock")}).insert({bottom:a.me._getAddressDiv("Billing Address: ",a.me._order.address.billing).addClassName("inlineblock")})})});a.productListDiv=new Element("div",{"class":"productlist dataTable"}).insert({bottom:a.me._getProductRow({product:{sku:"SKU",name:"Product Name"},unitPrice:"Unit Price",qtyOrdered:"Qty",totalPrice:"Total Price"},true).addClassName("header")});a.me._orderItems.each(function(c){a.productListDiv.insert({bottom:a.me._getProductRow(c)})});a.btnsRow=a.me._getProductRow({product:{sku:"",name:""},unitPrice:"",qtyOrdered:"",totalPrice:""},true).addClassName("submitBtns");a.btnsRow.down(".purchasing").update(a.me._getPurchasingBtns()).up(".row").down(".warehouse").update(a.me._getWHBtns());a.newDiv.insert({bottom:new Element("fieldset",{"class":"row productsRow dataTableWrapper"}).insert({bottom:new Element("legend").update("Products")}).insert({bottom:new Element("div",{"class":"rowWrapper"}).insert({bottom:a.productListDiv.insert({bottom:a.btnsRow})})})});a.newDiv.insert({bottom:new Element("fieldset",{"class":"row summary"}).insert({bottom:new Element("legend").update("Finance")}).insert({bottom:new Element("div",{"class":"rowWrapper"}).insert({bottom:new Element("div",{"class":"viewRow"}).insert({bottom:a.me._getfieldDiv("Shipping",a.me._order.infos[9][0].value).addClassName("shippingMethod")}).insert({bottom:a.me._getfieldDiv("Magento Payment Method",a.me._order.infos[6][0].value).addClassName("magePaymentMethod")}).insert({bottom:a.me._getfieldDiv("Last Payment Method",new Element("span",{id:"lastPaymentMethod"}).update(new Element("img"))).addClassName("lastPaymentMethod")}).insert({bottom:a.me._getfieldDiv("Total Amount",a.me.getCurrency(a.me._order.totalAmount)).addClassName("totalAmount")}).insert({bottom:a.me._getfieldDiv("Total Paid",a.me.getCurrency(a.me._order.totalPaid)).addClassName("totalPaid")}).insert({bottom:a.me._getfieldDiv("Total Due",a.me.getCurrency(a.me._order.totalDue)).addClassName("totalDue")})}).insert({bottom:new Element("div",{"class":"rowWrapper"}).insert({bottom:new Element("div",{"class":"financeBtns"}).update(a.me._getFinanceBtns())})})})});a.shipmentRow="";if(a.me._order.status.id*1===a.me.order_status_picked&&a.me._editMode.warehouse===true){a.shipmentRow=a.me._getShippingRow()}else{if(a.me._order.shippment.length>0){a.shippingInfos=a.me._order.shippment;a.shipmentRow=a.me._viewShippingDetails(a.shippingInfos)}}a.newDiv.insert({bottom:new Element("fieldset",{"class":"row shipping"}).insert({bottom:new Element("legend").update("Shipping")}).insert({bottom:new Element("div",{"class":"rowWrapper"}).update(a.shipmentRow)})});a.newDiv.insert({bottom:new Element("fieldset",{"class":"row commentsWrapper dataTableWrapper"}).insert({bottom:new Element("legend").update("Comments")}).insert({bottom:new Element("div",{"class":"rowWrapper"}).insert({bottom:new Element("div",{id:"comments_list","class":"dataTable"})}).insert({bottom:new Element("div",{"class":"comments_input_row"}).insert({bottom:a.me._getfieldDiv("New Comments:",new Element("div",{"class":"new_comments_wrapper"}).insert({bottom:new Element("input",{type:"text",new_comments:"comments",placeholder:"add more comments to this order"}).observe("keydown",function(c){a.me.keydown(c,function(){$(c.currentTarget).up(".new_comments_wrapper").down("[new_comments=btn]").click()})})}).insert({bottom:new Element("input",{type:"button",new_comments:"btn",value:"Add","class":"button"}).observe("click",function(){a.me._addComments(this,"comments_list")})}))})})})});$(a.me._resultDivId).update(a.newDiv);a.me._commentsDiv.resultDivId="comments_list";a.me._getComments(true)._loadChosen()._getLatestPaymentMethod();return this}});