var PageJs=new Class.create;PageJs.prototype=Object.extend(new DetailsPageJs,{_manufacturers:[],_suppliers:[],_statuses:[],_btnIdNewPO:null,_priceTypes:[],_codeTypes:[],_locationTypes:[],_productTreeId:"product_category_tree",_imgPanelId:"images_panel",_readOnlyMode:!1,_storeId:1,_roleId:0,_accountingCodes:[],_selectTypeTxt:"Select One...",_getFormGroup:function(e,t){return new Element("div",{class:"form-group form-group-sm form-group-sm-label"}).insert({bottom:new Element("label").update(e)}).insert({bottom:t.addClassName("form-control")})},setPreData:function(e,t,n,i,s,o,a,l){return this._manufacturers=e,this._suppliers=t,this._statuses=n,this._priceTypes=i,this._codeTypes=s,this._locationTypes=o,this._btnIdNewPO=a||!1,this._btnIdNewPO&&(this._btnIdNewPO=a.replace(/["']/g,"")||!1),this._accountingCodes=l,this},_getSelBox:function(e,t){var n={};return n.me=this,n.selBox=new Element("select"),e.each(function(e){n.selBox.insert({bottom:new Element("option",{value:e.id,selected:!(!t||e.id!==t)}).update(e.name)})}),n.selBox},_getListPanelRow:function(e,t,n,i,s,o){var a={};return a.me=this,a.isTitle=s||!1,a.tag=!0===a.isTitle?"th":"td",a.typeString=i.type.toLowerCase(),a.valueString=i.value.toLowerCase(),a.randId="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now(),a.newRow=new Element("tr").insert({bottom:new Element(a.tag).update(!0===a.isTitle?i.type:a.me._getSelBox(n,t[a.typeString]&&t[a.typeString].id?t[a.typeString].id:"").addClassName("form-control input-sm "+e).writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",t.id?t.id:a.randId).observe("change",function(e){"function"==typeof o&&o(e)}).wrap(new Element("div",{class:"form-group"})))}),t.id&&a.newRow.insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"id",value:t.id}).writeAttribute("list-item",t.id?t.id:a.randId)}),i.start&&a.newRow.insert({bottom:new Element(a.tag).update(!0===a.isTitle?i.start:new Element("input",{class:"form-control input-sm datepicker","list-panel-row":"start",value:t.start?t.start:"",required:!0,disabled:t.type&&!t.type.needTime}).writeAttribute("list-item",t.id?t.id:a.randId).wrap(new Element("div",{class:"form-group"})))}),i.end&&a.newRow.insert({bottom:new Element(a.tag).update(!0===a.isTitle?i.end:new Element("input",{class:"form-control input-sm datepicker","list-panel-row":"end",value:t.end?t.end:"",required:!0,disabled:t.type&&!t.type.needTime}).writeAttribute("list-item",t.id?t.id:a.randId).wrap(new Element("div",{class:"form-group"})))}),a.inputBoxDiv=new Element("div",{class:"input-group input-group-sm"}).insert({bottom:new Element("input",{type:"text",class:"form-control "+e,"list-panel-row":"value",required:!0,value:t[a.valueString]?t[a.valueString]:""}).writeAttribute("list-item",t.id?t.id:a.randId)}).insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"active",value:"1"}).writeAttribute("list-item",t.id?t.id:a.randId)}).insert({bottom:new Element("span",{class:"btn btn-del btn-danger input-group-addon "+e}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){t.id?($(this).up(".input-group").down("[list-panel-row=active]").value="0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):$(this).up(".list-panel-row").remove()})}),a.newRow.insert({bottom:new Element(a.tag).update(!0===a.isTitle?i.value:a.inputBoxDiv.wrap(new Element("div",{class:"form-group"})))}),a.newRow},_getListPanel:function(e,t,n,i,s){var o={};return o.me=this,e=e.replace(/:/g,""),o.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{class:"toggle-btn",href:"javascript: void(0);",title:"click show/hide content below"}).insert({bottom:new Element("strong").update(e)}).observe("click",function(){$(this).up(".panel").down(".list-div").toggle()})}).insert({bottom:new Element("span",{class:"btn btn-del btn-primary btn-xs pull-right "+e,title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){o.parentPanel=$(this).up(".panel"),o.newData={},n.start&&(o.newData.start="0001-01-01 00:00:00"),n.end&&(o.newData.end="9999-12-31 23:59:59"),o.parentPanel.down(".table tbody").insert({bottom:o.me._getListPanelRow(e,o.newData,i,n,!1,s).addClassName("list-panel-row").writeAttribute("item_id","")}),o.parentPanel.down(".list-div").show(),o.me._bindDatePicker()})})}).insert({bottom:new Element("div",{class:"list-div table-responsive"}).insert({bottom:new Element("table",{class:"table table-condensed",style:"width : auto"}).insert({bottom:new Element("thead").update(o.me._getListPanelRow(e,n,i,n,!0,s))}).insert({bottom:o.listDiv=new Element("tbody")})})}),t&&t.each(function(t){o.listDiv.insert({bottom:o.me._getListPanelRow(e,t,i,n,!1,s).addClassName("list-panel-row").writeAttribute("item_id",t.id)})}),o.newDiv},_loadRichTextEditor:function(e){var t={};return t.me=this,t.me._signRandID(e),jQuery("#"+e.id).summernote({height:90,airMode:!1}),t.me},_getRichTextEditor:function(e,t){var n={};return n.me=this,n.newDiv=new Element("div",{class:"summernote",save:e}).update(t||""),n.newDiv},_getFullDescriptionPanel:function(e){var t={};return t.me=this,t.fullDescriptioAssetId=e.fullDescAssetId?e.fullDescAssetId:"",t.loadFullBtn=e.id?new Element("span",{class:"btn btn-default btn-loadFullDesc"}).update("click to show the full description editor").observe("click",function(){t.btn=$(this),e.fullDescriptionAsset||t.me._readOnlyMode?!e.fullDescriptionAsset&&t.me._readOnlyMode?(t.newTextarea=t.me._getRichTextEditor("fullDescription",""),$$(".fullDescriptionEl").first().replace(new Element("div",{class:"col-sm-12"}).update(t.me._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:e.fullDescriptionAsset.url,success:function(e){t.newTextarea=t.me._getRichTextEditor("fullDescription",e),t.me._readOnlyMode?$$(".fullDescriptionEl").first().replace(new Element("div",{class:"col-sm-12"}).update(t.me._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:e||""})))):($(t.btn).replace(t.newTextarea),t.me._loadRichTextEditor(t.newTextarea),1!=t.me._storeId&&jQuery('.summernote[save="fullDescription"]').summernote("disable"))}}):(t.newTextarea=t.me._getRichTextEditor("fullDescription",""),$(t.btn).replace(t.newTextarea),t.me._loadRichTextEditor(t.newTextarea))}):t.me._getRichTextEditor("fullDescription",""),t.newDiv=t.me._getFormGroup("Full Description:",t.loadFullBtn),t.newDiv},_getcustomTabPanel:function(e){var t={};return t.me=this,t.customTabAssetId=e.customTabAssetId?e.customTabAssetId:"",t.loadFullBtn=e.id?new Element("span",{class:"btn btn-default btn-loadCustomTab"}).update("click to show the feature editor").observe("click",function(){t.btn=$(this),e.customTabAsset||t.me._readOnlyMode?!e.customTabAsset&&t.me._readOnlyMode?(t.newTextarea=t.me._getRichTextEditor("customTab",""),$$(".customTabEl").first().replace(new Element("div",{class:"col-sm-12"}).update(t.me._getFormGroup("Feature:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:e.customTabAsset.url,success:function(e){t.newTextarea=t.me._getRichTextEditor("customTab",e),t.me._readOnlyMode?$$(".customTabEl").first().replace(new Element("div",{class:"col-sm-12"}).update(t.me._getFormGroup("Feature:",new Element("input",{type:"text",disabled:!0,value:e||""})))):($(t.btn).replace(t.newTextarea),t.me._loadRichTextEditor(t.newTextarea),1!=t.me._storeId&&jQuery('.summernote[save="customTab"]').summernote("disable"))}}):(t.newTextarea=t.me._getRichTextEditor("customTab",""),$(t.btn).replace(t.newTextarea),t.me._loadRichTextEditor(t.newTextarea))}):t.me._getRichTextEditor("customTab",""),t.newDiv=t.me._getFormGroup("Feature:",t.loadFullBtn),t.newDiv},_getChildCategoryJson:function(e,t){var n={};return n.me=this,n.cate={text:e.name,id:e.id},t.indexOf(e.id)>=0&&(n.cate.checked=!0),e.children&&e.children.size()>0&&(n.cate.children=[],e.children.each(function(e){n.cate.children.push(n.me._getChildCategoryJson(e,t))})),n.cate},_initTree:function(e,t){var n={};return n.me=this,n.categoies=[],n.selectedCateIds=[],n.me._item&&n.me._item.categories&&n.me._item.categories.length>0&&n.me._item.categories.each(function(e){n.selectedCateIds.push(e.id)}),e.each(function(e){n.categoies.push(n.me._getChildCategoryJson(e,n.selectedCateIds))}),jQuery(t).tree({data:n.categoies}),n.me},_getCategories:function(e){var t={};return t.me=this,t.me.postAjax(t.me.getCallbackId("getCategories"),{},{onLoading:function(n,i){$(e).update(t.me.getLoadingImg())},onSuccess:function(n,i){try{if(t.result=t.me.getResp(i,!1,!0),!t.result||!t.result.items)return;t.treeDiv=new Element("ul",{id:t.me._productTreeId,"data-options":"animate:true, checkbox:true, cascadeCheck:false"}),$(e).update(new Element("div",{class:"easyui-panel"}).update(t.treeDiv)),t.me._signRandID(t.treeDiv),t.me._initTree(t.result.items,"#"+t.treeDiv.id),$(e).addClassName("loaded")}catch(n){$(e).update(t.me.getAlertBox("Error:",n).addClassName("alert-danger"))}}}),t.me},_getCategoryPanel:function(e){var t={};return t.me=this,t.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).insert({bottom:new Element("strong").update("Categories: "+(t.me._item.categories?t.me._item.categories.size()+" Selected":""))})}).observe("click",function(){t.btn=this,t.panelBody=$(t.btn).up(".panel").down(".panel-body"),t.panelBody.hasClassName("loaded")||t.me._getCategories(t.panelBody),t.panelBody.toggle()})}).insert({bottom:new Element("div",{class:"panel-body",style:"display: none"})}),t.newDiv},_getSummaryDiv:function(e){var t={};return t.me=this,t.item=e,t.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(t.item.name?"Editing: "+t.item.name:"Creating: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("small",{class:"pull-right"}).insert({bottom:new Element("label",{for:"showOnWeb_"+t.item.id}).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+t.item.id,"save-item":"sellOnWeb",type:"checkbox",checked:t.item.sellOnWeb})})})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("Name",new Element("input",{"save-item":"name",type:"text",required:!0,value:t.item.name?t.item.name:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("sku",t.skuInputEl=new Element("input",{"save-item":"sku",type:"text",required:!0,value:t.item.sku?t.item.sku:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("Status",t.me._getSelBox(t.me._statuses,t.item.status?t.item.status.id:null).writeAttribute("save-item","statusId").addClassName("chosen")))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("Brand/Manf.",t.me._getSelBox(t.me._manufacturers,t.item.manufacturer?t.item.manufacturer.id:null).writeAttribute("save-item","manufacturerId").addClassName("chosen")))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("Web As New Start:",new Element("input",{class:"datepicker","save-item":"asNewFromDate",value:t.item.asNewFromDate?t.item.asNewFromDate:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(t.me._getFormGroup("Web As New End:",new Element("input",{class:"datepicker","save-item":"asNewToDate",value:t.item.asNewToDate?t.item.asNewToDate:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(t.me._getFormGroup("Attribute Set Name:",new Element("input",{disabled:!0,type:"text",value:t.item.attributeSet?t.item.attributeSet.name:""})))}).insert({bottom:new Element("div",{class:"col-sm-3"}).update(t.me._getFormGroup("Attribute Set Description:",new Element("input",{disabled:!0,type:"text",value:t.item.attributeSet?t.item.attributeSet.description:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(t.me._getFormGroup("Attribute Set ID:",new Element("input",{disabled:!0,type:"text",value:t.item.attributeSet?t.item.attributeSet.id:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(t.me._getFormGroup("Attribute Set Mage ID:",new Element("input",{disabled:!0,type:"text",value:t.item.attributeSet?t.item.attributeSet.mageId:""})))}).insert({bottom:new Element("div",{class:"col-sm-3"}).update(t.me._getFormGroup("ETA:",new Element("input",{type:"date",value:t.item.eta?t.item.eta:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-10"}).update(t.me._getFormGroup("Short Description:",new Element("input",{"save-item":"shortDescription",type:"text",value:t.item.shortDescription?t.item.shortDescription:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(t.me._getFormGroup("Weight:",new Element("input",{"save-item":"weight",required:!0,type:"text",value:parseFloat(t.item.weight)>0?t.item.weight:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-12 fullDescriptionEl"}).update(t.me._getFullDescriptionPanel(t.item))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-12 customTabEl"}).update(t.me._getcustomTabPanel(t.item))})})}),t.me._item.id&&!1!==jQuery.isNumeric(t.me._item.id)||t.skuInputEl.observe("change",function(e){t.me._validateSKU($F(t.skuInputEl),t.skuInputEl)}),t.newDiv},_validateSKU:function(e,t){var n={};return n.me=this,n.inputEl=n.inputEl||!1,n.sku=e,n.me.postAjax(n.me.getCallbackId("validateSKU"),{sku:e},{onLoading:function(e,t){!1!==n.inputEl&&n.inputEl.writeAttribute("disabled",!0)},onSuccess:function(t,i){try{if(n.result=n.me.getResp(i,!1,!0),!n.result||!n.result.item)return;n.result.item.id&&!0===jQuery.isNumeric(n.result.item.id)&&(n.product=n.result.item,n.message=new Element("div",{class:""}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-md-3"}).update("SKU")}).insert({bottom:new Element("div",{class:"col-md-9"}).insert({bottom:new Element("a",{href:"/product/"+n.product.id+".html",target:"_BLANK"}).update(n.product.sku)})})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-md-3"}).update("Name")}).insert({bottom:new Element("div",{class:"col-md-9"}).update(n.product.name)})}),n.me.showModalBox('<span class="text-warinig"><b>The SKU '+e+" already exist</b></span>",n.message))}catch(e){n.me.showModalBox("Error","<pre>"+e+"</pre>")}},onComplete:function(){!1!==n.inputEl&&n.inputEl.removeAttribute("disabled")}}),n.me},_loadFancyBox:function(e){var t={};return t.me=this,e.each(function(n){n.observe("click",function(){t.imgs=[],e.each(function(e){t.imgs.push({href:e.down("img").readAttribute("src")})}),jQuery.fancybox(t.imgs,{prevEffect:"none",nextEffect:"none",helpers:{title:{type:"outside"},thumbs:{height:50}}})})}),this},_getImageThumb:function(e){var t={};return t.me=this,t.src=e.data?e.data:e.path,t.newDiv=new Element("div",{class:"col-xs-12 col-sm-6 col-md-4 thumbnail-holder btn-hide-row product-image",active:"1"}).store("data",e).insert({bottom:new Element("a",{href:"javascript: void(0)",class:"thumbnail fancybox-thumb",ref:"product_thumbs"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x180",src:t.src})})}).insert({bottom:new Element("span",{class:"btns"}).insert({bottom:new Element("small",{class:"btn btn-del btn-danger btn-xs"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})})}).observe("click",function(){if(!confirm("Delete this image?"))return!1;t.imgDiv=$(this).up(".product-image"),t.imgDiv.hasAttribute("asset-id")?t.imgDiv.remove():t.imgDiv.writeAttribute("active","0").hide()})}),e.imageAssetId||t.newDiv.writeAttribute("file-name",e.filename).writeAttribute("asset-id",e.imageAssetId),t.newDiv},_readImages:function(e,t){var n={};for(n.me=this,n.files=e.target.files,n.i=0;n.file=n.files[n.i];n.i++)n.file.type.match("image.*")&&(n.reader=new FileReader,n.reader.onload=function(i){return function(s){n.thumb=n.me._getImageThumb({data:s.target.result,filename:i.name}),$(t).insert({bottom:n.thumb}),e.target.value="",n.me._loadFancyBox($(n.me._imgPanelId).getElementsBySelector(".fancybox-thumb"))}}(n.file),n.reader.readAsDataURL(n.file));return n.me},_getImagesPanel:function(e){var t={};return t.me=this,t.noLocalReader=!(window.File&&window.FileReader&&window.FileList&&window.Blob),t.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Images: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:t.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:t.body=new Element("div",{id:t.me._imgPanelId,class:"panel-body"})}),e.images&&e.images.each(function(e){e.asset&&t.body.insert({bottom:t.me._getImageThumb({path:e.asset.url,filename:e.asset.filename,imageAssetId:e.asset.assetId})})}),t.noLocalReader?t.uploadDiv.update(new Element("span",{class:"btn btn-del btn-danger btn-xs pull-right",title:"Your browser does NOT support this feature. Pls change browser and try again"}).insert({bottom:new Element("span",{class:" glyphicon glyphicon-exclamation-sign"})}).insert({bottom:" Not Supported"})):t.uploadDiv.insert({bottom:new Element("span",{class:"btn btn-del btn-primary btn-xs pull-right",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up(".new-btn-panel").down(".new-images-file").click()})}).insert({bottom:new Element("input",{class:"new-images-file",type:"file",multiple:!0,style:"display: none"}).observe("change",function(e){t.panelBody=$(this).up(".panel").down(".panel-body"),t.me._readImages(e,t.panelBody),t.panelBody.show()})}),t.newDiv},_submitSave:function(e){var t={};if(t.me=this,t.data=t.me._collectFormData($(t.me.getHTMLID("itemDiv")),"save-item"),null===t.data)return t.me;if(t.data.prices=t.me._collectFormData($(t.me.getHTMLID("itemDiv")).down(".prices-panel"),"list-panel-row","list-item"),!jQuery.isEmptyObject(t.data.prices)){if(t.data.supplierCodes=t.me._collectFormData($(t.me.getHTMLID("itemDiv")).down(".suppliers-panel"),"list-panel-row","list-item"),null===t.data.supplierCodes)return t.me;if(t.data.productCodes=t.me._collectFormData($(t.me.getHTMLID("itemDiv")).down(".codes-panel"),"list-panel-row","list-item"),null===t.data.productCodes)return t.me;if(t.data.locations=t.me._collectFormData($(t.me.getHTMLID("itemDiv")).down(".locations-panel"),"list-panel-row","list-item"),null===t.data.locations)return t.me;if(t.data.id=t.me._item.id,$$("[save=fullDescription]").size()>0&&(t.fullDescriptionBox=$$("[save=fullDescription]").first())&&(t.data.fullDescription=jQuery("#"+t.fullDescriptionBox.id).summernote("code")),$$("[save=customTab]").size()>0&&(t.customTabBox=$$("[save=customTab]").first())&&(t.data.customTab=jQuery("#"+t.customTabBox.id).summernote("code")),jQuery("#"+t.me._productTreeId).length>0)for(t.data.categoryIds=[],t.checkedNodes=jQuery("#"+t.me._productTreeId).tree("getChecked"),t.i=0;t.i<t.checkedNodes.length;t.i++)t.data.categoryIds.push(t.checkedNodes[t.i].id);return t.data.images=[],t.imgPanel=$(t.me._imgPanelId),t.imgPanel.getElementsBySelector(".product-image").each(function(e){t.img=e.retrieve("data"),t.img.imageAssetId=t.img.imageAssetId?t.img.imageAssetId:"",t.img.active="1"===e.readAttribute("active"),t.data.images.push(t.img)}),t.me.saveItem(e,t.data,function(e){if(!e.url)throw"System Error: no return product url";t.me._item=e.item,t.me.refreshParentWindow(),t.me.showModalBox('<strong class="text-success">Saved Successfully!</strong>',"Saved Successfully!",!0),window.location=e.url}),t.me}t.me.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>price</b>')},_validateAccountingCode:function(e){var t={};return t.me=this,t.code=e||!1,t.result=!1,t.me._accountingCodes.each(function(e){!1===t.result&&t.code===e.code&&(t.result=!0)}),t.result},_loadChosen:function(){return{}.me=this,jQuery(".chosen").chosen({search_contains:!0,inherit_select_classes:!0,no_results_text:"No code type found!",width:"100%"}),this},_getAccCodeSelectEl:function(e){var t={};switch(t.me=this,e){case"assetAccNo":t.type=1;break;case"revenueAccNo":t.type=4;break;case"costAccNo":t.type=5;break;default:t.showModelBox("Error","Invalid Account Code Type")}return t.selectEl=new Element("select",{class:"chosen","save-item":"type","data-placeholder":"Type"}).setStyle("z-index: 9999;").insert({bottom:new Element("option",{value:t.me._selectTypeTxt}).update(t.me._selectTypeTxt)}),t.me._signRandID(t.selectEl),t.me._accountingCodes.each(function(e){e.type==t.type&&(t.selectEl.insert({bottom:t.option=new Element("option",{value:e.code,description:e.description}).store("data",e).update(e.description)}),e.code!==t.me._item.assetAccNo&&e.code!==t.me._item.revenueAccNo&&e.code!==t.me._item.costAccNo||t.option.writeAttribute("selected",!0))}),t.selectEl},_getOtherStocks:function(e){return ret="",e&&e.stock&&e.stock.storeId?(currentStoreId=e.stock.storeId.id,e.stocks.each(function(e){e.storeId.id!=currentStoreId&&(""==ret?ret=ret+"["+e.storeId.name+":"+e.stockOnHand+"]":ret=ret+", ["+e.storeId.name+":"+e.stockOnHand+"]")}),ret):ret},_getStockDev:function(e){var t={};return t.me=this,t.item=e,t.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Stock Info").insert({bottom:new Element("span",{class:"pull-right"}).update("Average Cost Ex GST: "+(0!=t.item.totalOnHandValue&&0!=t.item.stockOnHand?t.me.getCurrency(t.item.totalOnHandValue/t.item.stockOnHand):"N/A"))})}).observe("click",function(){t.me.openInNewTab("/productqtylog.html?productid="+e.id)})}).insert({bottom:t.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock On Hand: ",new Element("input",{"save-item":"stockOnHand",type:"value",disabled:!0,value:t.item.stockOnHand?t.item.stockOnHand:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock On Hand Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:t.item.totalOnHandValue?t.me.getCurrency(t.item.totalOnHandValue):""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock In Parts",new Element("input",{"save-item":"stockInParts",type:"value",disabled:!0,value:t.item.stockInParts?t.item.stockInParts:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock In Parts Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:t.item.totalOnHandValue?t.me.getCurrency(t.item.totalOnHandValue):""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock On Order",new Element("input",{"save-item":"stockOnOrder",type:"value",disabled:!0,value:t.item.stockOnOrder?t.item.stockOnOrder:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock On PO",new Element("input",{"save-item":"stockOnPO",type:"value",disabled:!0,value:t.item.stockOnPO?t.item.stockOnPO:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Stock In RMA",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:t.item.stockInRMA?t.item.stockInRMA:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(t.me._getFormGroup("Average Cost",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:0!=t.item.totalOnHandValue&&0!=t.item.stockOnHand?t.me.getCurrency(t.item.totalOnHandValue/t.item.stockOnHand):"N/A"})))})})}),t.newDiv},_getAccInfoDiv:function(e){var t={};return t.me=this,t.item=e,t.newDiv=new Element("div",{class:"panel panel-default"}).setStyle("overflow: unset !important;").insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Accounting Info")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:t.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:new Element("div",{class:"panel-body"}).setStyle("overflow: unset !important;").insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Asset Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:t.me._getAccCodeSelectEl("assetAccNo").writeAttribute("save-item","assetAccNo")})})})}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Revenue Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:t.me._getAccCodeSelectEl("revenueAccNo").writeAttribute("save-item","revenueAccNo")})})})}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Cost Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:t.me._getAccCodeSelectEl("costAccNo").writeAttribute("save-item","costAccNo")})})})})}),t.newDiv},_getItemDiv:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:e.me._getStockDev(e.me._item).wrap(new Element("div",{class:"col-sm-12"}))}).insert({bottom:e.me._getImagesPanel(e.me._item)}).insert({bottom:e.me._getCategoryPanel(e.me._item)})}).insert({bottom:new Element("div",{class:"col-sm-8"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:e.me._getSummaryDiv(e.me._item).wrap(new Element("div",{class:"col-sm-12"}))}).insert({bottom:e.me._getListPanel("Prices:",e.me._item.prices,{type:"Type",value:"Price",start:"From",end:"To"},e.me._priceTypes,function(t){e.selectedPriceType=null,e.selBox=t.target,e.me._priceTypes.each(function(t){t.id===$F(e.selBox)&&(e.selectedPriceType=t)}),e.selRow=$(e.selBox).up(".list-panel-row"),e.startBox=e.selRow.down('[list-panel-row="start"]'),e.endBox=e.selRow.down('[list-panel-row="end"]'),null!==e.selectedPriceType&&!1===e.selectedPriceType.needTime?(e.startBox.writeAttribute("disabled",!0).writeAttribute("value","0001-01-01 00:00:00"),e.endBox.writeAttribute("disabled",!0).writeAttribute("value","9999-12-31 23:59:59"),e.selRow.down('[list-panel-row="value"]').select()):(e.endBox.writeAttribute("disabled",!1).writeAttribute("value",""),e.startBox.writeAttribute("disabled",!1).writeAttribute("value","").select())}).wrap(new Element("div",{class:"col-sm-12 prices-panel"}))}).insert({bottom:e.me._getListPanel("Suppliers:",e.me._item.supplierCodes,{type:"Supplier",value:"Code"},e.me._suppliers).wrap(new Element("div",{class:"col-sm-4 suppliers-panel"}))}).insert({bottom:e.me._getListPanel("Codes:",e.me._item.productCodes,{type:"Type",value:"Code"},e.me._codeTypes).wrap(new Element("div",{class:"col-sm-4 codes-panel"}))}).insert({bottom:e.me._getListPanel("Locations:",e.me._item.locations,{type:"Type",value:"value"},e.me._locationTypes).wrap(new Element("div",{class:"col-sm-4 locations-panel"}))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("span",{class:"btn btn-del Locations btn-primary pull-right col-sm-4","data-loading-text":"saving ..."}).update("Save").observe("click",function(){e.me._submitSave(this)})})})})}),e.newDiv},_bindDatePicker:function(){var e={};return e.me=this,$$(".datepicker").each(function(t){t.hasClassName("datepicked")||(e.me._signRandID(t),e.picker=new Prado.WebUI.TDatePicker({ID:t.id,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"}),t.store("picker",e.picker))}),e.me},bindAllEventNObjects:function(){var e={};return e.me=this,e.me._bindDatePicker(),$$(".summernote").each(function(t){e.me._loadRichTextEditor(t)}),e.me},refreshParentWindow:function(){var e={};e.me=this,window.opener&&(e.parentWindow=window.opener,e.row=$(e.parentWindow.document.body).down("#"+e.parentWindow.pageJs.resultDivId+" .product_item[product_id="+e.me._item.id+"]"),e.row&&(e.row.replace(e.parentWindow.pageJs._getResultRow(e.me._item)),e.row.hasClassName("success")&&e.row.addClassName("success")),e.newPObtn=$(e.parentWindow.document.body).down("#"+e.me._btnIdNewPO),e.newPObtn&&e.parentWindow.pageJs&&e.parentWindow.pageJs.selectProduct&&e.parentWindow.pageJs.selectProduct(e.me._item,e.newPObtn))},readOnlyMode:function(e,t,n){var i={};i.me=this,i.me._readOnlyMode=!e,i.me._storeId=t,i.me._roleId=n,e?1!=t&&($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery("input:not(.Locations)").prop("disabled",!0),jQuery("select:not(.Locations)").prop("disabled",!0),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),jQuery('.chosen[save-item="statusId"]').prop("disabled",!1).trigger("chosen:updated"),jQuery(".btn-del:not(.Locations)").remove(),jQuery(".summernote").summernote("disable")):($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery(".summernote").summernote("disable"),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),1!=n?(jQuery("select").prop("disabled",!0),jQuery("input").prop("disabled",!0),jQuery(".btn-del").remove()):(jQuery("select:not(.Locations)").prop("disabled",!0),jQuery("input:not(.Locations)").prop("disabled",!0),jQuery(".btn-del:not(.Locations)").remove()))}});