var PageJs=new Class.create;PageJs.prototype=Object.extend(new DetailsPageJs,{_manufacturers:[],_suppliers:[],_statuses:[],_btnIdNewPO:null,_priceTypes:[],_codeTypes:[],_locationTypes:[],_productTreeId:"product_category_tree",_imgPanelId:"images_panel",_readOnlyMode:!1,_storeId:1,_roleId:0,_accountingCodes:[],_selectTypeTxt:"Select One...",_getFormGroup:function(a,b){return new Element("div",{class:"form-group form-group-sm form-group-sm-label"}).insert({bottom:new Element("label").update(a)}).insert({bottom:b.addClassName("form-control")})},setPreData:function(a,b,c,d,e,f,g,h){return this._manufacturers=a,this._suppliers=b,this._statuses=c,this._priceTypes=d,this._codeTypes=e,this._locationTypes=f,this._btnIdNewPO=g||!1,this._btnIdNewPO&&(this._btnIdNewPO=g.replace(/["']/g,"")||!1),this._accountingCodes=h,this},_getSelBox:function(a,b){var c={};return c.me=this,c.selBox=new Element("select"),a.each(function(a){c.selBox.insert({bottom:new Element("option",{value:a.id,selected:!(!b||a.id!==b)}).update(a.name)})}),c.selBox},_getListPanelRow:function(a,b,c,d,e,f){var g={};return g.me=this,g.isTitle=e||!1,g.tag=!0===g.isTitle?"th":"td",g.typeString=d.type.toLowerCase(),g.valueString=d.value.toLowerCase(),g.randId="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now(),g.newRow=new Element("tr").insert({bottom:new Element(g.tag).update(!0===g.isTitle?d.type:g.me._getSelBox(c,b[g.typeString]&&b[g.typeString].id?b[g.typeString].id:"").addClassName("form-control input-sm "+a).writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",b.id?b.id:g.randId).observe("change",function(a){"function"==typeof f&&f(a)}).wrap(new Element("div",{class:"form-group"})))}),b.id&&g.newRow.insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"id",value:b.id}).writeAttribute("list-item",b.id?b.id:g.randId)}),d.start&&g.newRow.insert({bottom:new Element(g.tag).update(!0===g.isTitle?d.start:new Element("input",{class:"form-control input-sm datepicker","list-panel-row":"start",value:b.start?b.start:"",required:!0,disabled:b.type&&!b.type.needTime}).writeAttribute("list-item",b.id?b.id:g.randId).wrap(new Element("div",{class:"form-group"})))}),d.end&&g.newRow.insert({bottom:new Element(g.tag).update(!0===g.isTitle?d.end:new Element("input",{class:"form-control input-sm datepicker","list-panel-row":"end",value:b.end?b.end:"",required:!0,disabled:b.type&&!b.type.needTime}).writeAttribute("list-item",b.id?b.id:g.randId).wrap(new Element("div",{class:"form-group"})))}),g.inputBoxDiv=new Element("div",{class:"input-group input-group-sm"}).insert({bottom:new Element("input",{type:"text",class:"form-control "+a,"list-panel-row":"value",required:!0,value:b[g.valueString]?b[g.valueString]:""}).writeAttribute("list-item",b.id?b.id:g.randId)}).insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"active",value:"1"}).writeAttribute("list-item",b.id?b.id:g.randId)}).insert({bottom:new Element("span",{class:"btn btn-del btn-danger input-group-addon "+a}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){b.id?($(this).up(".input-group").down("[list-panel-row=active]").value="0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):$(this).up(".list-panel-row").remove()})}),g.newRow.insert({bottom:new Element(g.tag).update(!0===g.isTitle?d.value:g.inputBoxDiv.wrap(new Element("div",{class:"form-group"})))}),g.newRow},_getListPanel:function(a,b,c,d,e){var f={};return f.me=this,a=a.replace(/:/g,""),f.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{class:"toggle-btn",href:"javascript: void(0);",title:"click show/hide content below"}).insert({bottom:new Element("strong").update(a)}).observe("click",function(){$(this).up(".panel").down(".list-div").toggle()})}).insert({bottom:new Element("span",{class:"btn btn-del btn-primary btn-xs pull-right "+a,title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){f.parentPanel=$(this).up(".panel"),f.newData={},c.start&&(f.newData.start="0001-01-01 00:00:00"),c.end&&(f.newData.end="9999-12-31 23:59:59"),f.parentPanel.down(".table tbody").insert({bottom:f.me._getListPanelRow(a,f.newData,d,c,!1,e).addClassName("list-panel-row").writeAttribute("item_id","")}),f.parentPanel.down(".list-div").show(),f.me._bindDatePicker()})})}).insert({bottom:new Element("div",{class:"list-div table-responsive"}).insert({bottom:new Element("table",{class:"table table-condensed",style:"width : auto"}).insert({bottom:new Element("thead").update(f.me._getListPanelRow(a,c,d,c,!0,e))}).insert({bottom:f.listDiv=new Element("tbody")})})}),b&&b.each(function(b){f.listDiv.insert({bottom:f.me._getListPanelRow(a,b,d,c,!1,e).addClassName("list-panel-row").writeAttribute("item_id",b.id)})}),f.newDiv},_loadRichTextEditor:function(a){var b={};return b.me=this,b.me._signRandID(a),jQuery("#"+a.id).summernote({height:90,airMode:!1}),b.me},_getRichTextEditor:function(a,b){var c={};return c.me=this,c.newDiv=new Element("div",{class:"summernote",save:a}).update(b||""),c.newDiv},_getFullDescriptionPanel:function(a){var b={};return b.me=this,b.fullDescriptioAssetId=a.fullDescAssetId?a.fullDescAssetId:"",b.loadFullBtn=a.id?new Element("span",{class:"btn btn-default btn-loadFullDesc"}).update("click to show the full description editor").observe("click",function(){b.btn=$(this),a.fullDescriptionAsset||b.me._readOnlyMode?!a.fullDescriptionAsset&&b.me._readOnlyMode?(b.newTextarea=b.me._getRichTextEditor("fullDescription",""),$$(".fullDescriptionEl").first().replace(new Element("div",{class:"col-sm-12"}).update(b.me._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:a.fullDescriptionAsset.url,success:function(a){b.newTextarea=b.me._getRichTextEditor("fullDescription",a),b.me._readOnlyMode?$$(".fullDescriptionEl").first().replace(new Element("div",{class:"col-sm-12"}).update(b.me._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:a||""})))):($(b.btn).replace(b.newTextarea),b.me._loadRichTextEditor(b.newTextarea),1!=b.me._storeId&&jQuery('.summernote[save="fullDescription"]').summernote("disable"))}}):(b.newTextarea=b.me._getRichTextEditor("fullDescription",""),$(b.btn).replace(b.newTextarea),b.me._loadRichTextEditor(b.newTextarea))}):b.me._getRichTextEditor("fullDescription",""),b.newDiv=b.me._getFormGroup("Full Description:",b.loadFullBtn),b.newDiv},_getcustomTabPanel:function(a){var b={};return b.me=this,b.customTabAssetId=a.customTabAssetId?a.customTabAssetId:"",b.loadFullBtn=a.id?new Element("span",{class:"btn btn-default btn-loadCustomTab"}).update("click to show the feature editor").observe("click",function(){b.btn=$(this),a.customTabAsset||b.me._readOnlyMode?!a.customTabAsset&&b.me._readOnlyMode?(b.newTextarea=b.me._getRichTextEditor("customTab",""),$$(".customTabEl").first().replace(new Element("div",{class:"col-sm-12"}).update(b.me._getFormGroup("Feature:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:a.customTabAsset.url,success:function(a){b.newTextarea=b.me._getRichTextEditor("customTab",a),b.me._readOnlyMode?$$(".customTabEl").first().replace(new Element("div",{class:"col-sm-12"}).update(b.me._getFormGroup("Feature:",new Element("input",{type:"text",disabled:!0,value:a||""})))):($(b.btn).replace(b.newTextarea),b.me._loadRichTextEditor(b.newTextarea),1!=b.me._storeId&&jQuery('.summernote[save="customTab"]').summernote("disable"))}}):(b.newTextarea=b.me._getRichTextEditor("customTab",""),$(b.btn).replace(b.newTextarea),b.me._loadRichTextEditor(b.newTextarea))}):b.me._getRichTextEditor("customTab",""),b.newDiv=b.me._getFormGroup("Feature:",b.loadFullBtn),b.newDiv},_getChildCategoryJson:function(a,b){var c={};return c.me=this,c.cate={text:a.name,id:a.id},b.indexOf(a.id)>=0&&(c.cate.checked=!0),a.children&&a.children.size()>0&&(c.cate.children=[],a.children.each(function(a){c.cate.children.push(c.me._getChildCategoryJson(a,b))})),c.cate},_initTree:function(a,b){var c={};return c.me=this,c.categoies=[],c.selectedCateIds=[],c.me._item&&c.me._item.categories&&c.me._item.categories.length>0&&c.me._item.categories.each(function(a){c.selectedCateIds.push(a.id)}),a.each(function(a){c.categoies.push(c.me._getChildCategoryJson(a,c.selectedCateIds))}),jQuery(b).tree({data:c.categoies}),c.me},_getCategories:function(a){var b={};return b.me=this,b.me.postAjax(b.me.getCallbackId("getCategories"),{},{onLoading:function(c,d){$(a).update(b.me.getLoadingImg())},onSuccess:function(c,d){try{if(b.result=b.me.getResp(d,!1,!0),!b.result||!b.result.items)return;b.treeDiv=new Element("ul",{id:b.me._productTreeId,"data-options":"animate:true, checkbox:true, cascadeCheck:false"}),$(a).update(new Element("div",{class:"easyui-panel"}).update(b.treeDiv)),b.me._signRandID(b.treeDiv),b.me._initTree(b.result.items,"#"+b.treeDiv.id),$(a).addClassName("loaded")}catch(c){$(a).update(b.me.getAlertBox("Error:",c).addClassName("alert-danger"))}}}),b.me},_getCategoryPanel:function(a){var b={};return b.me=this,b.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).insert({bottom:new Element("strong").update("Categories: "+(b.me._item.categories?b.me._item.categories.size()+" Selected":""))})}).observe("click",function(){b.btn=this,b.panelBody=$(b.btn).up(".panel").down(".panel-body"),b.panelBody.hasClassName("loaded")||b.me._getCategories(b.panelBody),b.panelBody.toggle()})}).insert({bottom:new Element("div",{class:"panel-body",style:"display: none"})}),b.newDiv},_getSummaryDiv:function(a){var b={};return b.me=this,b.item=a,b.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(b.item.name?"Editing: "+b.item.name:"Creating: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("small",{class:"pull-right"}).insert({bottom:new Element("label",{for:"showOnWeb_"+b.item.id}).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+b.item.id,"save-item":"sellOnWeb",type:"checkbox",checked:b.item.sellOnWeb})})})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("Name",new Element("input",{"save-item":"name",type:"text",required:!0,value:b.item.name?b.item.name:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("sku",b.skuInputEl=new Element("input",{"save-item":"sku",type:"text",required:!0,value:b.item.sku?b.item.sku:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("Status",b.me._getSelBox(b.me._statuses,b.item.status?b.item.status.id:null).writeAttribute("save-item","statusId").addClassName("chosen")))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("Brand/Manf.",b.me._getSelBox(b.me._manufacturers,b.item.manufacturer?b.item.manufacturer.id:null).writeAttribute("save-item","manufacturerId").addClassName("chosen")))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("Web As New Start:",new Element("input",{class:"datepicker","save-item":"asNewFromDate",value:b.item.asNewFromDate?b.item.asNewFromDate:""})))}).insert({bottom:new Element("div",{class:"col-sm-4"}).update(b.me._getFormGroup("Web As New End:",new Element("input",{class:"datepicker","save-item":"asNewToDate",value:b.item.asNewToDate?b.item.asNewToDate:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Attribute Set Name:",new Element("input",{disabled:!0,type:"text",value:b.item.attributeSet?b.item.attributeSet.name:""})))}).insert({bottom:new Element("div",{class:"col-sm-3"}).update(b.me._getFormGroup("Attribute Set Description:",new Element("input",{disabled:!0,type:"text",value:b.item.attributeSet?b.item.attributeSet.description:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Attribute Set ID:",new Element("input",{disabled:!0,type:"text",value:b.item.attributeSet?b.item.attributeSet.id:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Attribute Set Mage ID:",new Element("input",{disabled:!0,type:"text",value:b.item.attributeSet?b.item.attributeSet.mageId:""})))}).insert({bottom:new Element("div",{class:"col-sm-3"}).update(b.me._getFormGroup("ETA:",new Element("input",{type:"date",value:b.item.eta?b.item.eta:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-10"}).update(b.me._getFormGroup("Short Description:",new Element("input",{"save-item":"shortDescription",type:"text",value:b.item.shortDescription?b.item.shortDescription:""})))}).insert({bottom:new Element("div",{class:"col-sm-2"}).update(b.me._getFormGroup("Weight:",new Element("input",{"save-item":"weight",required:!0,type:"text",value:parseFloat(b.item.weight)>0?b.item.weight:""})))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-12 fullDescriptionEl"}).update(b.me._getFullDescriptionPanel(b.item))})}).insert({bottom:new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-sm-12 customTabEl"}).update(b.me._getcustomTabPanel(b.item))})})}),b.me._item.id&&!1!==jQuery.isNumeric(b.me._item.id)||b.skuInputEl.observe("change",function(a){b.me._validateSKU($F(b.skuInputEl),b.skuInputEl)}),b.newDiv},_validateSKU:function(a,b){var c={};return c.me=this,c.inputEl=c.inputEl||!1,c.sku=a,c.me.postAjax(c.me.getCallbackId("validateSKU"),{sku:a},{onLoading:function(a,b){!1!==c.inputEl&&c.inputEl.writeAttribute("disabled",!0)},onSuccess:function(b,d){try{if(c.result=c.me.getResp(d,!1,!0),!c.result||!c.result.item)return;c.result.item.id&&!0===jQuery.isNumeric(c.result.item.id)&&(c.product=c.result.item,c.message=new Element("div",{class:""}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-md-3"}).update("SKU")}).insert({bottom:new Element("div",{class:"col-md-9"}).insert({bottom:new Element("a",{href:"/product/"+c.product.id+".html",target:"_BLANK"}).update(c.product.sku)})})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-md-3"}).update("Name")}).insert({bottom:new Element("div",{class:"col-md-9"}).update(c.product.name)})}),c.me.showModalBox('<span class="text-warinig"><b>The SKU '+a+" already exist</b></span>",c.message))}catch(a){c.me.showModalBox("Error","<pre>"+a+"</pre>")}},onComplete:function(){!1!==c.inputEl&&c.inputEl.removeAttribute("disabled")}}),c.me},_loadFancyBox:function(a){var b={};return b.me=this,a.each(function(c){c.observe("click",function(){b.imgs=[],a.each(function(a){b.imgs.push({href:a.down("img").readAttribute("src")})}),jQuery.fancybox(b.imgs,{prevEffect:"none",nextEffect:"none",helpers:{title:{type:"outside"},thumbs:{height:50}}})})}),this},_getImageThumb:function(a){var b={};return b.me=this,b.src=a.data?a.data:a.path,b.newDiv=new Element("div",{class:"col-xs-12 col-sm-6 col-md-4 thumbnail-holder btn-hide-row product-image",active:"1"}).store("data",a).insert({bottom:new Element("a",{href:"javascript: void(0)",class:"thumbnail fancybox-thumb",ref:"product_thumbs"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x180",src:b.src})})}).insert({bottom:new Element("span",{class:"btns"}).insert({bottom:new Element("small",{class:"btn btn-del btn-danger btn-xs"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})})}).observe("click",function(){if(!confirm("Delete this image?"))return!1;b.imgDiv=$(this).up(".product-image"),b.imgDiv.hasAttribute("asset-id")?b.imgDiv.remove():b.imgDiv.writeAttribute("active","0").hide()})}),a.imageAssetId||b.newDiv.writeAttribute("file-name",a.filename).writeAttribute("asset-id",a.imageAssetId),b.newDiv},_readImages:function(a,b){var c={};for(c.me=this,c.files=a.target.files,c.i=0;c.file=c.files[c.i];c.i++)c.file.type.match("image.*")&&(c.reader=new FileReader,c.reader.onload=function(d){return function(e){c.thumb=c.me._getImageThumb({data:e.target.result,filename:d.name}),$(b).insert({bottom:c.thumb}),a.target.value="",c.me._loadFancyBox($(c.me._imgPanelId).getElementsBySelector(".fancybox-thumb"))}}(c.file),c.reader.readAsDataURL(c.file));return c.me},_getImagesPanel:function(a){var b={};return b.me=this,b.noLocalReader=!(window.File&&window.FileReader&&window.FileList&&window.Blob),b.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Images: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:b.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:b.body=new Element("div",{id:b.me._imgPanelId,class:"panel-body"})}),a.images&&a.images.each(function(a){a.asset&&b.body.insert({bottom:b.me._getImageThumb({path:a.asset.url,filename:a.asset.filename,imageAssetId:a.asset.assetId})})}),b.noLocalReader?b.uploadDiv.update(new Element("span",{class:"btn btn-del btn-danger btn-xs pull-right",title:"Your browser does NOT support this feature. Pls change browser and try again"}).insert({bottom:new Element("span",{class:" glyphicon glyphicon-exclamation-sign"})}).insert({bottom:" Not Supported"})):b.uploadDiv.insert({bottom:new Element("span",{class:"btn btn-del btn-primary btn-xs pull-right",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up(".new-btn-panel").down(".new-images-file").click()})}).insert({bottom:new Element("input",{class:"new-images-file",type:"file",multiple:!0,style:"display: none"}).observe("change",function(a){b.panelBody=$(this).up(".panel").down(".panel-body"),b.me._readImages(a,b.panelBody),b.panelBody.show()})}),b.newDiv},_submitSave:function(a){var b={};if(b.me=this,b.data=b.me._collectFormData($(b.me.getHTMLID("itemDiv")),"save-item"),null===b.data)return b.me;if(b.data.prices=b.me._collectFormData($(b.me.getHTMLID("itemDiv")).down(".prices-panel"),"list-panel-row","list-item"),jQuery.isEmptyObject(b.data.prices))return void b.me.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>price</b>');if(b.data.id=b.me._item.id,$$("[save=fullDescription]").size()>0&&(b.fullDescriptionBox=$$("[save=fullDescription]").first())&&(b.data.fullDescription=jQuery("#"+b.fullDescriptionBox.id).summernote("code")),$$("[save=customTab]").size()>0&&(b.customTabBox=$$("[save=customTab]").first())&&(b.data.customTab=jQuery("#"+b.customTabBox.id).summernote("code")),jQuery("#"+b.me._productTreeId).length>0)for(b.data.categoryIds=[],b.checkedNodes=jQuery("#"+b.me._productTreeId).tree("getChecked"),b.i=0;b.i<b.checkedNodes.length;b.i++)b.data.categoryIds.push(b.checkedNodes[b.i].id);return b.data.images=[],b.imgPanel=$(b.me._imgPanelId),b.imgPanel.getElementsBySelector(".product-image").each(function(a){b.img=a.retrieve("data"),b.img.imageAssetId=b.img.imageAssetId?b.img.imageAssetId:"",b.img.active="1"===a.readAttribute("active"),b.data.images.push(b.img)}),b.me.saveItem(a,b.data,function(a){if(!a.url)throw"System Error: no return product url";b.me._item=a.item,b.me.refreshParentWindow(),b.me.showModalBox('<strong class="text-success">Saved Successfully!</strong>',"Saved Successfully!",!0),window.location=a.url}),b.me},_validateAccountingCode:function(a){var b={};return b.me=this,b.code=a||!1,b.result=!1,b.me._accountingCodes.each(function(a){!1===b.result&&b.code===a.code&&(b.result=!0)}),b.result},_loadChosen:function(){return{}.me=this,jQuery(".chosen").chosen({search_contains:!0,inherit_select_classes:!0,no_results_text:"No code type found!",width:"100%"}),this},_getAccCodeSelectEl:function(a){var b={};switch(b.me=this,a){case"assetAccNo":b.type=1;break;case"revenueAccNo":b.type=4;break;case"costAccNo":b.type=5;break;default:b.showModelBox("Error","Invalid Account Code Type")}return b.selectEl=new Element("select",{class:"chosen","save-item":"type","data-placeholder":"Type"}).setStyle("z-index: 9999;").insert({bottom:new Element("option",{value:b.me._selectTypeTxt}).update(b.me._selectTypeTxt)}),b.me._signRandID(b.selectEl),b.me._accountingCodes.each(function(a){a.type==b.type&&(b.selectEl.insert({bottom:b.option=new Element("option",{value:a.code,description:a.description}).store("data",a).update(a.description)}),a.code!==b.me._item.assetAccNo&&a.code!==b.me._item.revenueAccNo&&a.code!==b.me._item.costAccNo||b.option.writeAttribute("selected",!0))}),b.selectEl},_getOtherStocks:function(a){var b={};return ret="",a&&a.stock&&a.stock.storeId?(currentStoreId=a.stock.storeId.id,b=a.stocks,b.each(function(a){a.storeId.id!=currentStoreId&&(""==ret?ret=ret+"["+a.storeId.name+":"+a.stockOnHand+"]":ret=ret+", ["+a.storeId.name+":"+a.stockOnHand+"]")}),ret):ret},_getStockDev:function(a){var b={};return b.me=this,b.item=a,b.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Stock Info").insert({bottom:new Element("span",{class:"pull-right"}).update("Average Cost Ex GST: "+(0!=b.item.totalOnHandValue&&0!=b.item.stockOnHand?b.me.getCurrency(b.item.totalOnHandValue/b.item.stockOnHand):"N/A"))})}).observe("click",function(){b.me.openInNewTab("/productqtylog.html?productid="+a.id)})}).insert({bottom:b.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock On Hand: "+b.me._getOtherStocks(a),new Element("input",{"save-item":"stockOnHand",type:"value",disabled:!0,value:b.item.stockOnHand?b.item.stockOnHand:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock On Hand Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:b.item.totalOnHandValue?b.me.getCurrency(b.item.totalOnHandValue):""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock In Parts",new Element("input",{"save-item":"stockInParts",type:"value",disabled:!0,value:b.item.stockInParts?b.item.stockInParts:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock In Parts Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:b.item.totalOnHandValue?b.me.getCurrency(b.item.totalOnHandValue):""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock On Order",new Element("input",{"save-item":"stockOnOrder",type:"value",disabled:!0,value:b.item.stockOnOrder?b.item.stockOnOrder:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock On PO",new Element("input",{"save-item":"stockOnPO",type:"value",disabled:!0,value:b.item.stockOnPO?b.item.stockOnPO:""})))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Stock In RMA",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:b.item.stockInRMA?b.item.stockInRMA:""})))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(b.me._getFormGroup("Average Cost",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:0!=b.item.totalOnHandValue&&0!=b.item.stockOnHand?b.me.getCurrency(b.item.totalOnHandValue/b.item.stockOnHand):"N/A"})))})})}),b.newDiv},_getAccInfoDiv:function(a){var b={};return b.me=this,b.item=a,b.newDiv=new Element("div",{class:"panel panel-default"}).setStyle("overflow: unset !important;").insert({bottom:new Element("div",{class:"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"}).insert({bottom:new Element("strong").update("Accounting Info")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:b.uploadDiv=new Element("span",{class:"pull-right new-btn-panel"})})}).insert({bottom:new Element("div",{class:"panel-body"}).setStyle("overflow: unset !important;").insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Asset Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:b.me._getAccCodeSelectEl("assetAccNo").writeAttribute("save-item","assetAccNo")})})})}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Revenue Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:b.me._getAccCodeSelectEl("revenueAccNo").writeAttribute("save-item","revenueAccNo")})})})}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:new Element("div",{class:"form-group form-group-sm"}).insert({bottom:new Element("label").update("Cost Account No.")}).insert({bottom:new Element("div",{class:"form-control chosen-container"}).setStyle("padding: 0px; height: 100%;").insert({bottom:b.me._getAccCodeSelectEl("costAccNo").writeAttribute("save-item","costAccNo")})})})})}),b.newDiv},_getItemDiv:function(){var a={};return a.me=this,a.newDiv=new Element("div").insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-4"}).insert({bottom:a.me._getStockDev(a.me._item).wrap(new Element("div",{class:"col-sm-12"}))}).insert({bottom:a.me._getImagesPanel(a.me._item)}).insert({bottom:a.me._getCategoryPanel(a.me._item)})}).insert({bottom:new Element("div",{class:"col-sm-8"}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:a.me._getSummaryDiv(a.me._item).wrap(new Element("div",{class:"col-sm-12"}))}).insert({bottom:a.me._getListPanel("Prices:",a.me._item.prices,{type:"Type",value:"Price",start:"From",end:"To"},a.me._priceTypes,function(b){a.selectedPriceType=null,a.selBox=b.target,a.me._priceTypes.each(function(b){b.id===$F(a.selBox)&&(a.selectedPriceType=b)}),a.selRow=$(a.selBox).up(".list-panel-row"),a.startBox=a.selRow.down('[list-panel-row="start"]'),a.endBox=a.selRow.down('[list-panel-row="end"]'),null!==a.selectedPriceType&&!1===a.selectedPriceType.needTime?(a.startBox.writeAttribute("disabled",!0).writeAttribute("value","0001-01-01 00:00:00"),a.endBox.writeAttribute("disabled",!0).writeAttribute("value","9999-12-31 23:59:59"),a.selRow.down('[list-panel-row="value"]').select()):(a.endBox.writeAttribute("disabled",!1).writeAttribute("value",""),a.startBox.writeAttribute("disabled",!1).writeAttribute("value","").select())}).wrap(new Element("div",{class:"col-sm-12 prices-panel"}))})}).insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("span",{class:"btn btn-del Locations btn-primary pull-right col-sm-4","data-loading-text":"saving ..."}).update("Save").observe("click",function(){a.me._submitSave(this)})})})})}),a.newDiv},_bindDatePicker:function(){var a={};return a.me=this,$$(".datepicker").each(function(b){b.hasClassName("datepicked")||(a.me._signRandID(b),a.picker=new Prado.WebUI.TDatePicker({ID:b.id,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"}),b.store("picker",a.picker))}),a.me},bindAllEventNObjects:function(){var a={};return a.me=this,a.me._bindDatePicker(),$$(".summernote").each(function(b){a.me._loadRichTextEditor(b)}),a.me},refreshParentWindow:function(){var a={};a.me=this,window.opener&&(a.parentWindow=window.opener,a.row=$(a.parentWindow.document.body).down("#"+a.parentWindow.pageJs.resultDivId+" .product_item[product_id="+a.me._item.id+"]"),a.row&&(a.row.replace(a.parentWindow.pageJs._getResultRow(a.me._item)),a.row.hasClassName("success")&&a.row.addClassName("success")),a.newPObtn=$(a.parentWindow.document.body).down("#"+a.me._btnIdNewPO),a.newPObtn&&a.parentWindow.pageJs&&a.parentWindow.pageJs.selectProduct&&a.parentWindow.pageJs.selectProduct(a.me._item,a.newPObtn))},readOnlyMode:function(a,b,c){var d={};d.me=this,d.me._readOnlyMode=!a,d.me._storeId=b,d.me._roleId=c,a?1!=b&&($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery("input:not(.Locations)").prop("disabled",!0),jQuery("select:not(.Locations)").prop("disabled",!0),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),jQuery('.chosen[save-item="statusId"]').prop("disabled",!1).trigger("chosen:updated"),jQuery(".btn-del:not(.Locations)").remove(),jQuery(".summernote").summernote("disable")):($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery(".summernote").summernote("disable"),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),1!=c?(jQuery("select").prop("disabled",!0),jQuery("input").prop("disabled",!0),jQuery(".btn-del").remove()):(jQuery("select:not(.Locations)").prop("disabled",!0),jQuery("input:not(.Locations)").prop("disabled",!0),jQuery(".btn-del:not(.Locations)").remove()))}});