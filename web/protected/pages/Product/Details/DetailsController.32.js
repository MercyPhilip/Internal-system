var PageJs=new Class.create;
PageJs.prototype=Object.extend(new DetailsPageJs,{_manufacturers:[],_suppliers:[],_statuses:[],_btnIdNewPO:null,_priceTypes:[],_codeTypes:[],_locationTypes:[],_productTreeId:"product_category_tree",_imgPanelId:"images_panel",_readOnlyMode:!1,_storeId:1,_roleId:0,_accountingCodes:[],_selectTypeTxt:"Select One...",_getFormGroup:function(b,a){return(new Element("div",{"class":"form-group form-group-sm form-group-sm-label"})).insert({bottom:(new Element("label")).update(b)}).insert({bottom:a.addClassName("form-control")})},setPreData:function(b,
a,c,d,e,f,g,h){this._manufacturers=b;this._suppliers=a;this._statuses=c;this._priceTypes=d;this._codeTypes=e;this._locationTypes=f;if(this._btnIdNewPO=g||!1)this._btnIdNewPO=g.replace(/["']/g,"")||!1;this._accountingCodes=h;return this},_getSelBox:function(b,a){var c;c=new Element("select");b.each(function(b){c.insert({bottom:(new Element("option",{value:b.id,selected:a&&b.id===a?!0:!1})).update(b.name)})});return c},_getListPanelRow:function(b,a,c,d,e,f){var g,h,l,k;e=e||!1;g=!0===e?"th":"td";h=
d.type.toLowerCase();l=d.value.toLowerCase();k="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now();c=(new Element("tr")).insert({bottom:(new Element(g)).update(!0===e?d.type:this._getSelBox(c,a[h]&&a[h].id?a[h].id:"").addClassName("form-control input-sm "+b).writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",a.id?a.id:k).observe("change",function(a){"function"===typeof f&&f(a)}).wrap(new Element("div",{"class":"form-group"})))});a.id&&
c.insert({bottom:(new Element("input",{type:"hidden","class":"form-control","list-panel-row":"id",value:a.id})).writeAttribute("list-item",a.id?a.id:k)});d.start&&c.insert({bottom:(new Element(g)).update(!0===e?d.start:(new Element("input",{"class":"form-control input-sm datepicker","list-panel-row":"start",value:a.start?a.start:"",required:!0,disabled:a.type&&!a.type.needTime})).writeAttribute("list-item",a.id?a.id:k).wrap(new Element("div",{"class":"form-group"})))});d.end&&c.insert({bottom:(new Element(g)).update(!0===
e?d.end:(new Element("input",{"class":"form-control input-sm datepicker","list-panel-row":"end",value:a.end?a.end:"",required:!0,disabled:a.type&&!a.type.needTime})).writeAttribute("list-item",a.id?a.id:k).wrap(new Element("div",{"class":"form-group"})))});b=(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("input",{type:"text","class":"form-control "+b,"list-panel-row":"value",required:!0,value:a[l]?a[l]:""})).writeAttribute("list-item",a.id?a.id:k)}).insert({bottom:(new Element("input",
{type:"hidden","class":"form-control","list-panel-row":"active",value:"1"})).writeAttribute("list-item",a.id?a.id:k)}).insert({bottom:(new Element("span",{"class":"btn btn-del btn-danger input-group-addon "+b})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){a.id?($(this).up(".input-group").down("[list-panel-row=active]").value="0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):
$(this).up(".list-panel-row").remove()})});c.insert({bottom:(new Element(g)).update(!0===e?d.value:b.wrap(new Element("div",{"class":"form-group"})))});return c},_getListPanel:function(b,a,c,d,e){var f,g,h,l,k;f=this;b=b.replace(/:/g,"");g=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("a",{"class":"toggle-btn",href:"javascript: void(0);",title:"click show/hide content below"})).insert({bottom:(new Element("strong")).update(b)}).observe("click",
function(){$(this).up(".panel").down(".list-div").toggle()})}).insert({bottom:(new Element("span",{"class":"btn btn-del btn-primary btn-xs pull-right "+b,title:"New"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){h=$(this).up(".panel");l={};c.start&&(l.start="0001-01-01 00:00:00");c.end&&(l.end="9999-12-31 23:59:59");h.down(".table tbody").insert({bottom:f._getListPanelRow(b,l,d,c,!1,e).addClassName("list-panel-row").writeAttribute("item_id",
"")});h.down(".list-div").show();f._bindDatePicker()})})}).insert({bottom:(new Element("div",{"class":"list-div table-responsive"})).insert({bottom:(new Element("table",{"class":"table table-condensed",style:"width : auto"})).insert({bottom:(new Element("thead")).update(f._getListPanelRow(b,c,d,c,!0,e))}).insert({bottom:k=new Element("tbody")})})});a&&a.each(function(a){k.insert({bottom:f._getListPanelRow(b,a,d,c,!1,e).addClassName("list-panel-row").writeAttribute("item_id",a.id)})});return g},_loadRichTextEditor:function(b){this._signRandID(b);
jQuery("#"+b.id).summernote({height:90,airMode:!1});return this},_getRichTextEditor:function(b,a){return(new Element("div",{"class":"summernote",save:b})).update(a?a:"")},_getFullDescriptionPanel:function(b){var a,c,d,e;a=this;c=b.id?(new Element("span",{"class":"btn btn-default btn-loadFullDesc"})).update("click to show the full description editor").observe("click",function(){d=$(this);b.fullDescriptionAsset||a._readOnlyMode?!b.fullDescriptionAsset&&a._readOnlyMode?(e=a._getRichTextEditor("fullDescription",
""),$$(".fullDescriptionEl").first().replace((new Element("div",{"class":"col-sm-12"})).update(a._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:b.fullDescriptionAsset.url,success:function(b){e=a._getRichTextEditor("fullDescription",b);a._readOnlyMode?$$(".fullDescriptionEl").first().replace((new Element("div",{"class":"col-sm-12"})).update(a._getFormGroup("Full Description:",new Element("input",{type:"text",disabled:!0,value:b?
b:""})))):($(d).replace(e),a._loadRichTextEditor(e),1!=a._storeId&&jQuery('.summernote[save="fullDescription"]').summernote("disable"))}}):(e=a._getRichTextEditor("fullDescription",""),$(d).replace(e),a._loadRichTextEditor(e))}):a._getRichTextEditor("fullDescription","");return a._getFormGroup("Full Description:",c)},_getcustomTabPanel:function(b){var a,c,d,e;a=this;c=b.id?(new Element("span",{"class":"btn btn-default btn-loadCustomTab"})).update("click to show the feature editor").observe("click",
function(){d=$(this);b.customTabAsset||a._readOnlyMode?!b.customTabAsset&&a._readOnlyMode?(e=a._getRichTextEditor("customTab",""),$$(".customTabEl").first().replace((new Element("div",{"class":"col-sm-12"})).update(a._getFormGroup("Feature:",new Element("input",{type:"text",disabled:!0,value:""}))))):jQuery.ajax({type:"GET",url:b.customTabAsset.url,success:function(b){e=a._getRichTextEditor("customTab",b);a._readOnlyMode?$$(".customTabEl").first().replace((new Element("div",{"class":"col-sm-12"})).update(a._getFormGroup("Feature:",
new Element("input",{type:"text",disabled:!0,value:b?b:""})))):($(d).replace(e),a._loadRichTextEditor(e),1!=a._storeId&&jQuery('.summernote[save="customTab"]').summernote("disable"))}}):(e=a._getRichTextEditor("customTab",""),$(d).replace(e),a._loadRichTextEditor(e))}):a._getRichTextEditor("customTab","");return a._getFormGroup("Feature:",c)},_getChildCategoryJson:function(b,a){var c,d;c=this;d={text:b.name,id:b.id};0<=a.indexOf(b.id)&&(d.checked=!0);b.children&&0<b.children.size()&&(d.children=[],
b.children.each(function(b){d.children.push(c._getChildCategoryJson(b,a))}));return d},_initTree:function(b,a){var c,d,e;c=this;d=[];e=[];c._item&&c._item.categories&&0<c._item.categories.length&&c._item.categories.each(function(a){e.push(a.id)});b.each(function(a){d.push(c._getChildCategoryJson(a,e))});jQuery(a).tree({data:d});return c},_getCategories:function(b){var a,c,d;a=this;a.postAjax(a.getCallbackId("getCategories"),{},{onLoading:function(c,d){$(b).update(a.getLoadingImg())},onSuccess:function(e,
f){try{(c=a.getResp(f,!1,!0))&&c.items&&(d=new Element("ul",{id:a._productTreeId,"data-options":"animate:true, checkbox:true, cascadeCheck:false"}),$(b).update((new Element("div",{"class":"easyui-panel"})).update(d)),a._signRandID(d),a._initTree(c.items,"#"+d.id),$(b).addClassName("loaded"))}catch(g){$(b).update(a.getAlertBox("Error:",g).addClassName("alert-danger"))}}});return a},_getCategoryPanel:function(b){var a,c,d;a=this;return(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",
{"class":"panel-heading"})).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).insert({bottom:(new Element("strong")).update("Categories: "+(a._item.categories?a._item.categories.size()+" Selected":""))})}).observe("click",function(){c=this;d=$(c).up(".panel").down(".panel-body");d.hasClassName("loaded")||a._getCategories(d);d.toggle()})}).insert({bottom:new Element("div",{"class":"panel-body",style:"display: none"})})},_getSummaryDiv:function(b){var a,c;a=this;b=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",
{"class":"panel-heading"})).insert({bottom:(new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"})).insert({bottom:(new Element("strong")).update(b.name?"Editing: "+b.name:"Creating: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:(new Element("small",{"class":"pull-right"})).insert({bottom:(new Element("label",{"for":"showOnWeb_"+b.id})).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+b.id,
"save-item":"sellOnWeb",type:"checkbox",checked:b.sellOnWeb})})})}).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-4"})).update(a._getFormGroup("Name",new Element("input",{"save-item":"name",type:"text",required:!0,value:b.name?b.name:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).update(a._getFormGroup("sku",c=new Element("input",{"save-item":"sku",type:"text",required:!0,
value:b.sku?b.sku:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).update(a._getFormGroup("Status",a._getSelBox(a._statuses,b.status?b.status.id:null).writeAttribute("save-item","statusId").addClassName("chosen")))})}).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-4"})).update(a._getFormGroup("Brand/Manf.",a._getSelBox(a._manufacturers,b.manufacturer?b.manufacturer.id:null).writeAttribute("save-item","manufacturerId").addClassName("chosen")))}).insert({bottom:(new Element("div",
{"class":"col-sm-4"})).update(a._getFormGroup("Web As New Start:",new Element("input",{"class":"datepicker","save-item":"asNewFromDate",value:b.asNewFromDate?b.asNewFromDate:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).update(a._getFormGroup("Web As New End:",new Element("input",{"class":"datepicker","save-item":"asNewToDate",value:b.asNewToDate?b.asNewToDate:""})))})}).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(a._getFormGroup("Attribute Set Name:",
new Element("input",{disabled:!0,type:"text",value:b.attributeSet?b.attributeSet.name:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(a._getFormGroup("Attribute Set Description:",new Element("input",{disabled:!0,type:"text",value:b.attributeSet?b.attributeSet.description:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(a._getFormGroup("Attribute Set ID:",new Element("input",{disabled:!0,type:"text",value:b.attributeSet?b.attributeSet.id:""})))}).insert({bottom:(new Element("div",
{"class":"col-sm-3"})).update(a._getFormGroup("Attribute Set Mage ID:",new Element("input",{disabled:!0,type:"text",value:b.attributeSet?b.attributeSet.mageId:""})))})}).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-10"})).update(a._getFormGroup("Short Description:",new Element("input",{"save-item":"shortDescription",type:"text",value:b.shortDescription?b.shortDescription:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-2"})).update(a._getFormGroup("Weight:",
new Element("input",{"save-item":"weight",required:!0,type:"text",value:0<parseFloat(b.weight)?b.weight:""})))})}).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-12 fullDescriptionEl"})).update(a._getFullDescriptionPanel(b))})}).insert({bottom:(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-sm-12 customTabEl"})).update(a._getcustomTabPanel(b))})})});a._item.id&&!1!==jQuery.isNumeric(a._item.id)||c.observe("change",
function(b){a._validateSKU($F(c),c)});return b},_validateSKU:function(b,a){var c,d,e,f,g;c=this;d=d||!1;c.postAjax(c.getCallbackId("validateSKU"),{sku:b},{onLoading:function(a,b){!1!==d&&d.writeAttribute("disabled",!0)},onSuccess:function(a,d){try{(e=c.getResp(d,!1,!0))&&e.item&&e.item.id&&!0===jQuery.isNumeric(e.item.id)&&(f=e.item,g=(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-md-3"})).update("SKU")}).insert({bottom:(new Element("div",
{"class":"col-md-9"})).insert({bottom:(new Element("a",{href:"/product/"+f.id+".html",target:"_BLANK"})).update(f.sku)})})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-md-3"})).update("Name")}).insert({bottom:(new Element("div",{"class":"col-md-9"})).update(f.name)})}),c.showModalBox('<span class="text-warinig"><b>The SKU '+b+" already exist</b></span>",g))}catch(k){c.showModalBox("Error","<pre>"+k+"</pre>")}},onComplete:function(){!1!==d&&
d.removeAttribute("disabled")}});return c},_loadFancyBox:function(b){var a;b.each(function(c){c.observe("click",function(){a=[];b.each(function(b){a.push({href:b.down("img").readAttribute("src")})});jQuery.fancybox(a,{prevEffect:"none",nextEffect:"none",helpers:{title:{type:"outside"},thumbs:{height:50}}})})});return this},_getImageThumb:function(b){var a,c;a=b.data?b.data:b.path;a=(new Element("div",{"class":"col-xs-12 col-sm-6 col-md-4 thumbnail-holder btn-hide-row product-image",active:"1"})).store("data",
b).insert({bottom:(new Element("a",{href:"javascript: void(0)","class":"thumbnail fancybox-thumb",ref:"product_thumbs"})).insert({bottom:new Element("img",{"data-src":"holder.js/100%x180",src:a})})}).insert({bottom:(new Element("span",{"class":"btns"})).insert({bottom:(new Element("small",{"class":"btn btn-del btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})})}).observe("click",function(){if(!confirm("Delete this image?"))return!1;c=$(this).up(".product-image");
c.hasAttribute("asset-id")?c.remove():c.writeAttribute("active","0").hide()})});b.imageAssetId||a.writeAttribute("file-name",b.filename).writeAttribute("asset-id",b.imageAssetId);return a},_readImages:function(b,a){var c,d,e,f,g,h;c=this;d=b.target.files;for(e=0;f=d[e];e++)f.type.match("image.*")&&(g=new FileReader,g.onload=function(d){return function(e){h=c._getImageThumb({data:e.target.result,filename:d.name});$(a).insert({bottom:h});b.target.value="";c._loadFancyBox($(c._imgPanelId).getElementsBySelector(".fancybox-thumb"))}}(f),
g.readAsDataURL(f));return c},_getImagesPanel:function(b){var a,c,d,e,f,g;a=this;c=!(window.File&&window.FileReader&&window.FileList&&window.Blob);d=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"})).insert({bottom:(new Element("strong")).update("Images: ")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:e=
new Element("span",{"class":"pull-right new-btn-panel"})})}).insert({bottom:f=new Element("div",{id:a._imgPanelId,"class":"panel-body"})});b.images&&b.images.each(function(b){b.asset&&f.insert({bottom:a._getImageThumb({path:b.asset.url,filename:b.asset.filename,imageAssetId:b.asset.assetId})})});c?e.update((new Element("span",{"class":"btn btn-del btn-danger btn-xs pull-right",title:"Your browser does NOT support this feature. Pls change browser and try again"})).insert({bottom:new Element("span",
{"class":" glyphicon glyphicon-exclamation-sign"})}).insert({bottom:" Not Supported"})):e.insert({bottom:(new Element("span",{"class":"btn btn-del btn-primary btn-xs pull-right",title:"New"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up(".new-btn-panel").down(".new-images-file").click()})}).insert({bottom:(new Element("input",{"class":"new-images-file",type:"file",multiple:!0,style:"display: none"})).observe("change",
function(b){g=$(this).up(".panel").down(".panel-body");a._readImages(b,g);g.show()})});return d},_submitSave:function(b){var a,c,d,e,f;a=this;c=a._collectFormData($(a.getHTMLID("itemDiv")),"save-item");if(null===c)return a;c.prices=a._collectFormData($(a.getHTMLID("itemDiv")).down(".prices-panel"),"list-panel-row","list-item");if(jQuery.isEmptyObject(c.prices))a.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>price</b>');else{c.supplierCodes=a._collectFormData($(a.getHTMLID("itemDiv")).down(".suppliers-panel"),
"list-panel-row","list-item");if(null===c.supplierCodes)return a;c.productCodes=a._collectFormData($(a.getHTMLID("itemDiv")).down(".codes-panel"),"list-panel-row","list-item");if(null===c.productCodes)return a;c.locations=a._collectFormData($(a.getHTMLID("itemDiv")).down(".locations-panel"),"list-panel-row","list-item");if(null===c.locations)return a;c.id=a._item.id;0<$$("[save=fullDescription]").size()&&(d=$$("[save=fullDescription]").first())&&(c.fullDescription=jQuery("#"+d.id).summernote("code"));
0<$$("[save=customTab]").size()&&(e=$$("[save=customTab]").first())&&(c.customTab=jQuery("#"+e.id).summernote("code"));if(0<jQuery("#"+a._productTreeId).length)for(c.categoryIds=[],d=jQuery("#"+a._productTreeId).tree("getChecked"),e=0;e<d.length;e++)c.categoryIds.push(d[e].id);c.images=[];d=$(a._imgPanelId);d.getElementsBySelector(".product-image").each(function(a){f=a.retrieve("data");f.imageAssetId=f.imageAssetId?f.imageAssetId:"";f.active="1"===a.readAttribute("active");c.images.push(f)});if(!0!==
a._validateAccountingCode(c.assetAccNo))a.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>Asset Account Number</b>');else if(!0!==a._validateAccountingCode(c.revenueAccNo))a.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>Revenue Account Number</b>');else if(!0!==a._validateAccountingCode(c.costAccNo))a.showModalBox("Notice",'<span class="text-warning">You <b>MUST</b> enter a valid <b>Cost Account Number</b>');else return a.saveItem(b,
c,function(b){if(!b.url)throw"System Error: no return product url";a._item=b.item;a.refreshParentWindow();a.showModalBox('<strong class="text-success">Saved Successfully!</strong>',"Saved Successfully!",!0);window.location=b.url}),a}},_validateAccountingCode:function(b){var a,c;a=b||!1;c=!1;this._accountingCodes.each(function(b){!1===c&&a===b.code&&(c=!0)});return c},_loadChosen:function(){var b,a,c,d;b=this;jQuery(".chosen").chosen({search_contains:!0,inherit_select_classes:!0,no_results_text:"No code type found!",
width:"100%"});jQuery('.chosen[save-item="assetAccNo"]').change(function(e){a=$(this).down('[value="'+$F($(this))+'"]').retrieve("data");c=$$('.chosen[save-item="revenueAccNo"]').first();d=$$('.chosen[save-item="costAccNo"]').first();$F($(this))!==b._selectTypeTxt&&(c.getElementsBySelector('option[selected="selected"]').each(function(a){a.removeAttribute("selected")}),c.down('option[description="'+a.description+'"]').writeAttribute("selected",!0),jQuery('.chosen[save-item="revenueAccNo"]').trigger("chosen:updated"),
d.getElementsBySelector('option[selected="selected"]').each(function(a){a.removeAttribute("selected")}),d.down('option[description="'+a.description+'"]').writeAttribute("selected",!0),jQuery('.chosen[save-item="costAccNo"]').trigger("chosen:updated"))});return this},_getAccCodeSelectEl:function(b){var a={me:this};switch(b){case "assetAccNo":a.type=1;break;case "revenueAccNo":a.type=4;break;case "costAccNo":a.type=5;break;default:a.showModelBox("Error","Invalid Account Code Type")}a.selectEl=(new Element("select",
{"class":"chosen","save-item":"type","data-placeholder":"Type"})).setStyle("z-index: 9999;").insert({bottom:(new Element("option",{value:a.me._selectTypeTxt})).update(a.me._selectTypeTxt)});a.me._signRandID(a.selectEl);a.me._accountingCodes.each(function(b){b.type==a.type&&(a.selectEl.insert({bottom:a.option=(new Element("option",{value:b.code,description:b.description})).store("data",b).update(b.description)}),b.code!==a.me._item.assetAccNo&&b.code!==a.me._item.revenueAccNo&&b.code!==a.me._item.costAccNo||
a.option.writeAttribute("selected",!0))});return a.selectEl},_getOtherStocks:function(b){var a={};ret="";if(!b||!b.stock||!b.stock.storeId)return ret;currentStoreId=b.stock.storeId.id;a=b.stocks;a.each(function(a){a.storeId.id!=currentStoreId&&(ret=""==ret?ret+"["+a.storeId.name+":"+a.stockOnHand+"]":ret+", ["+a.storeId.name+":"+a.stockOnHand+"]")});return ret},_getStockDev:function(b){var a;a=this;return(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("a",
{href:"javascript: void(0);",title:"click to show/hide content below"})).insert({bottom:(new Element("strong")).update("Stock Info").insert({bottom:(new Element("span",{"class":"pull-right"})).update("Average Cost Ex GST: "+(0!=b.totalOnHandValue&&0!=b.stockOnHand?a.getCurrency(b.totalOnHandValue/b.stockOnHand):"N/A"))})}).observe("click",function(){a.openInNewTab("/productqtylog.html?productid="+b.id)})}).insert({bottom:new Element("span",{"class":"pull-right new-btn-panel"})})}).insert({bottom:(new Element("div",
{"class":"panel-body"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock On Hand: "+a._getOtherStocks(b),new Element("input",{"save-item":"stockOnHand",type:"value",disabled:!0,value:b.stockOnHand?b.stockOnHand:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock On Hand Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:b.totalOnHandValue?
a.getCurrency(b.totalOnHandValue):""})))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock In Parts",new Element("input",{"save-item":"stockInParts",type:"value",disabled:!0,value:b.stockInParts?b.stockInParts:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock In Parts Value",new Element("input",{"save-item":"totalOnHandValue",type:"value",disabled:!0,value:b.totalOnHandValue?
a.getCurrency(b.totalOnHandValue):""})))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock On Order",new Element("input",{"save-item":"stockOnOrder",type:"value",disabled:!0,value:b.stockOnOrder?b.stockOnOrder:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock On PO",new Element("input",{"save-item":"stockOnPO",type:"value",disabled:!0,value:b.stockOnPO?b.stockOnPO:
""})))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Stock In RMA",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:b.stockInRMA?b.stockInRMA:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(a._getFormGroup("Average Cost",new Element("input",{"save-item":"stockInRMA",type:"value",disabled:!0,value:0!=b.totalOnHandValue&&0!=b.stockOnHand?a.getCurrency(b.totalOnHandValue/
b.stockOnHand):"N/A"})))})})})},_getAccInfoDiv:function(b){return(new Element("div",{"class":"panel panel-default"})).setStyle("overflow: unset !important;").insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("a",{href:"javascript: void(0);",title:"click to show/hide content below"})).insert({bottom:(new Element("strong")).update("Accounting Info")}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("span",
{"class":"pull-right new-btn-panel"})})}).insert({bottom:(new Element("div",{"class":"panel-body"})).setStyle("overflow: unset !important;").insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("div",{"class":"form-group form-group-sm"})).insert({bottom:(new Element("label")).update("Asset Account No.")}).insert({bottom:(new Element("div",{"class":"form-control chosen-container"})).setStyle("padding: 0px; height: 100%;").insert({bottom:this._getAccCodeSelectEl("assetAccNo").writeAttribute("save-item",
"assetAccNo")})})})}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("div",{"class":"form-group form-group-sm"})).insert({bottom:(new Element("label")).update("Revenue Account No.")}).insert({bottom:(new Element("div",{"class":"form-control chosen-container"})).setStyle("padding: 0px; height: 100%;").insert({bottom:this._getAccCodeSelectEl("revenueAccNo").writeAttribute("save-item","revenueAccNo")})})})}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("div",
{"class":"form-group form-group-sm"})).insert({bottom:(new Element("label")).update("Cost Account No.")}).insert({bottom:(new Element("div",{"class":"form-control chosen-container"})).setStyle("padding: 0px; height: 100%;").insert({bottom:this._getAccCodeSelectEl("costAccNo").writeAttribute("save-item","costAccNo")})})})})})},_getItemDiv:function(){var b,a,c,d,e,f;b=this;return(new Element("div")).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:b._getStockDev(b._item).wrap(new Element("div",
{"class":"col-sm-12"}))}).insert({bottom:b._getImagesPanel(b._item)}).insert({bottom:b._getCategoryPanel(b._item)})}).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:b._getSummaryDiv(b._item).wrap(new Element("div",{"class":"col-sm-12"}))}).insert({bottom:b._getListPanel("Prices:",b._item.prices,{type:"Type",value:"Price",start:"From",end:"To"},b._priceTypes,function(g){a=null;c=g.target;b._priceTypes.each(function(b){b.id===
$F(c)&&(a=b)});d=$(c).up(".list-panel-row");e=d.down('[list-panel-row="start"]');f=d.down('[list-panel-row="end"]');null!==a&&!1===a.needTime?(e.writeAttribute("disabled",!0).writeAttribute("value","0001-01-01 00:00:00"),f.writeAttribute("disabled",!0).writeAttribute("value","9999-12-31 23:59:59"),d.down('[list-panel-row="value"]').select()):(f.writeAttribute("disabled",!1).writeAttribute("value",""),e.writeAttribute("disabled",!1).writeAttribute("value","").select())}).wrap(new Element("div",{"class":"col-sm-12 prices-panel"}))}).insert({bottom:b._getAccInfoDiv(b._item).wrap(new Element("div",
{"class":"col-sm-12"}))}).insert({bottom:b._getListPanel("Suppliers:",b._item.supplierCodes,{type:"Supplier",value:"Code"},b._suppliers).wrap(new Element("div",{"class":"col-sm-4 suppliers-panel"}))}).insert({bottom:b._getListPanel("Codes:",b._item.productCodes,{type:"Type",value:"Code"},b._codeTypes).wrap(new Element("div",{"class":"col-sm-4 codes-panel"}))}).insert({bottom:b._getListPanel("Locations:",b._item.locations,{type:"Type",value:"value"},b._locationTypes).wrap(new Element("div",{"class":"col-sm-4 locations-panel"}))})}).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("span",{"class":"btn btn-del Locations btn-primary pull-right col-sm-4","data-loading-text":"saving ..."})).update("Save").observe("click",function(){b._submitSave(this)})})})})})},_bindDatePicker:function(){var b,a;b=this;$$(".datepicker").each(function(c){c.hasClassName("datepicked")||(b._signRandID(c),a=new Prado.WebUI.TDatePicker({ID:c.id,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,
PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"}),c.store("picker",a))});return b},bindAllEventNObjects:function(){var b;b=this;b._bindDatePicker();$$(".summernote").each(function(a){b._loadRichTextEditor(a)});return b},refreshParentWindow:function(){var b,a;if(window.opener){b=window.opener;if(a=$(b.document.body).down("#"+b.pageJs.resultDivId+" .product_item[product_id="+this._item.id+"]"))a.replace(b.pageJs._getResultRow(this._item)),a.hasClassName("success")&&a.addClassName("success");
(a=$(b.document.body).down("#"+this._btnIdNewPO))&&b.pageJs&&b.pageJs.selectProduct&&b.pageJs.selectProduct(this._item,a)}},readOnlyMode:function(b,a,c){this._readOnlyMode=!b;this._storeId=a;this._roleId=c;b?1!=a&&($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery("input:not(.Locations)").prop("disabled",!0),jQuery("select:not(.Locations)").prop("disabled",!0),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),jQuery('.chosen[save-item="statusId"]').prop("disabled",
!1).trigger("chosen:updated"),jQuery(".btn-del:not(.Locations)").remove(),jQuery(".summernote").summernote("disable")):($$(".btn.btn-loadFullDesc").first().click(),$$(".btn.btn-loadCustomTab").first().click(),jQuery(".summernote").summernote("disable"),jQuery(".chosen").prop("disabled",!0).trigger("chosen:updated"),1!=c?(jQuery("select").prop("disabled",!0),jQuery("input").prop("disabled",!0),jQuery(".btn-del").remove()):(jQuery("select:not(.Locations)").prop("disabled",!0),jQuery("input:not(.Locations)").prop("disabled",
!0),jQuery(".btn-del:not(.Locations)").remove()))}});