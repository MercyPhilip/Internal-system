var PageJs=new Class.create();PageJs.prototype=Object.extend(new CRUDPageJs(),{manufactures:[],suppliers:[],productCategories:[],productStatuses:[],_showRightPanel:false,_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",manufacturer:{name:"Brand"},supplierCodes:[{supplier:{name:"Supplier"},code:""}],active:"act?"}},_loadManufactures:function(b){this.manufactures=b;var a={};a.me=this;a.selectionBox=$(a.me.searchDivId).down('[search_field="pro.manufacturerIds"]');a.me.manufactures.each(function(c){a.selectionBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return this},_loadProductStatuses:function(a){this.productStatuses=a;var b={};b.me=this;b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productStatusIds"]');b.me.productStatuses.each(function(c){b.selectionBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return this},_loadSuppliers:function(a){this.suppliers=a;var b={};b.me=this;b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.supplierIds"]');b.me.suppliers.each(function(c){b.selectionBox.insert({bottom:new Element("option",{value:c.id}).update(c.name)})});return this},_loadCategories:function(a){this.categories=a;var b={};b.me=this;b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productCategoryIds"]');b.me.categories.sort(function(d,c){return d.namePath>c.namePath}).each(function(c){b.selectionBox.insert({bottom:new Element("option",{value:c.id}).update(c.namePath)})});return this},_loadChosen:function(){jQuery(".chosen").chosen({search_contains:true,inherit_select_classes:true,no_results_text:"Oops, nothing found!",width:"95%"});return this},_bindSearchKey:function(){var a={};a.me=this;$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(c){a.me.keydown(c,function(){$(a.me.searchDivId).down("#searchBtn").click()})})});return this},_getSupplierCodes:function(c,a){var b={};b.me=this;b.supplierCodeString=[];c.each(function(d){b.supplierCodeString.push(a===true?"Supplier":'<abbr title="Code: '+d.code+'">'+d.supplier.name+"</abbr>")});return b.supplierCodeString.join(", ")},_displayPriceMatchResult:function(b){var a={};a.me=this;a.newDiv=new Element("table",{"class":"table table-striped price-match-listing"}).insert({bottom:new Element("thead").insert({bottom:new Element("tr").insert({bottom:new Element("th").update("SKU")}).insert({bottom:new Element("th").update("My Price")}).insert({bottom:new Element("th",{"class":"price_diff"}).update("Price Diff.")}).insert({bottom:new Element("th").update("Min Price")})})}).insert({bottom:new Element("tbody").insert({bottom:new Element("tr").insert({bottom:new Element("td").update(b.sku)}).insert({bottom:new Element("td").update(a.me.getCurrency(b.myPrice))}).insert({bottom:new Element("td",{"class":"price_diff"}).update(a.me.getCurrency(b.priceDiff))}).insert({bottom:new Element("td",{"class":"price_min"}).update(new Element("a",{href:"javascript: void(0);"}).update(a.me.getCurrency(b.minPrice)).observe("click",function(){a.table=new Element("table",{"class":"table table-striped"}).insert({bottom:new Element("thead").insert({bottom:new Element("tr").insert({bottom:new Element("th").update("Company")}).insert({bottom:new Element("th").update("Price")})})}).insert({bottom:a.tbody=new Element("tbody")});$H(b.companyPrices).each(function(c){a.tbody.insert({bottom:new Element("tr").insert({bottom:new Element("td").update(c.key)}).insert({bottom:new Element("td").update(c.value.priceURL&&!c.value.priceURL.blank()?new Element("a",{href:c.value.priceURL,target:"__blank"}).update(a.me.getCurrency(c.value.price)):a.me.getCurrency(c.value.price))})})});a.me.showModalBox("Min Price Details: ",a.table,false)}))})})});return a.newDiv},_getInfoPanel:function(b){var a={};a.me=this;return new Element("div",{id:"info_panel_"+b.id}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"panel panel-default price-match-div"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("<strong>Price Match</strong>")}).insert({bottom:new Element("div",{"class":"panel-body price-match-listing"}).update(a.me.getLoadingImg())})})}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"panel panel-default price-trend-div"}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("iframe",{frameborder:"0",scrolling:"auto",width:"100%",height:"400px"})})})})}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-body"}).update("<h4>Reserved for Next Phase of Developing</h4>")})})}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-body"}).update("<h4>Reserved for Next Phase of Developing</h4>")})})})},_showProductInfoOnRightPanel:function(b){var a={};a.me=this;a.infoPanel=a.me._getInfoPanel(b);a.infoPanel.down(".price-trend-div iframe").writeAttribute("src","/statics/product/pricetrend.html?productid="+b.id);a.me.postAjax(a.me.getCallbackId("priceMatching"),{id:b.id},{onLoading:function(){a.infoPanel.down(".price-match-div .price-match-listing").replace(new Element("div",{"class":"panel-body price-match-listing"}).update(a.me.getLoadingImg()))},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result){return}if($("info_panel_"+b.id)){$("info_panel_"+b.id).down(".price-match-div .price-match-listing").replace(a.me._displayPriceMatchResult(a.result))}}catch(d){a.me.showModalBox("Error",d,true)}}});return a.infoPanel},deSelectProduct:function(){var a={};a.me=this;jQuery(".product_item.success",jQuery("#"+a.me.resultDivId)).removeClass("success").popover("hide");$(a.me.resultDivId).up(".list-panel").removeClassName("col-xs-4").addClassName("col-xs-12");jQuery(".product_name",jQuery("#"+a.me.resultDivId)).show();jQuery(".btns",jQuery("#"+a.me.resultDivId)).show();a.me._showRightPanel=false;return a.me},_displaySelectedProduct:function(b){var a={};a.me=this;$(a.me.resultDivId).up(".list-panel").removeClassName("col-xs-12").addClassName("col-xs-4");jQuery(".product_name",jQuery("#"+a.me.resultDivId)).hide();jQuery(".btns",jQuery("#"+a.me.resultDivId)).hide();a.me._showRightPanel=true;jQuery(".product_item.success",jQuery("#"+a.me.resultDivId)).removeClass("success").popover("hide");a.selectedRow=jQuery('[product_id="'+b.id+'"]',jQuery("#"+a.me.resultDivId)).addClass("success");if(!a.selectedRow.hasClass("popover-loaded")){a.selectedRow.popover({title:'<div class="row"><div class="col-xs-10">Details for: '+b.sku+'</div><div class="col-xs-2"><span class="btn btn-danger pull-right btn-sm" onclick="pageJs.deSelectProduct();"><span class="glyphicon glyphicon-remove"></span></span></div></div>',html:true,placement:"right",container:"body",trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return a.me._showProductInfoOnRightPanel(b).wrap(new Element("div")).innerHTML},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded")}a.selectedRow.popover("toggle");return a.me},_openProductDetails:function(b){var a={};a.newWindow=window.open("/product/"+b.id+".html","Product Details for: "+b.sku,"location=no, menubar=no, status=no, titlebar=no, fullscreen=yes, toolbar=no");a.newWindow.focus()},_getResultRow:function(c,a){var b={};b.me=this;b.tag=(b.isTitle===true?"th":"td");b.isTitle=(a||false);b.row=new Element("tr",{"class":"visible-xs visible-md visible-lg visible-sm "+(b.isTitle===true?"":"product_item"),product_id:c.id}).store("data",c).insert({bottom:new Element(b.tag,{"class":"sku",title:c.name}).insert({bottom:new Element("span",{style:"margin: 0 5px 0 0;"}).insert({bottom:new Element("input",{type:"checkbox","class":"product-selected"}).observe("click",function(){b.checked=this.checked;if(b.isTitle===true){$(b.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(d){d.checked=b.checked})}})})}).insert({bottom:b.isTitle===true?c.sku:new Element("a",{href:"javascript: void(0);","class":"sku-link"}).update(c.sku)})}).insert({bottom:new Element(b.tag,{"class":"product_name hidden-xs hidden-sm",style:(b.me._showRightPanel?"display: none":"")}).update(c.name)}).insert({bottom:new Element(b.tag,{"class":"manufacturer col-xs-2"}).update(c.manufacturer?c.manufacturer.name:"")}).insert({bottom:new Element(b.tag,{"class":"supplier col-xs-2"}).update(c.supplierCodes?b.me._getSupplierCodes(c.supplierCodes,a):"")}).insert({bottom:new Element(b.tag,{"class":"product_active col-xs-1"}).insert({bottom:(b.isTitle===true?c.active:new Element("input",{type:"checkbox",disabled:true,checked:c.active}))})}).insert({bottom:b.isTitle===true?"":new Element(b.tag,{"class":"btns hidden-xs hidden-sm",style:(b.me._showRightPanel?"display: none":"")}).insert({bottom:new Element("span",{"class":"btn btn-primary btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})})}).observe("click",function(){b.me._openProductDetails(c)})});if(b.isTitle===false){b.row.down(".sku-link").observe("click",function(){b.me._displaySelectedProduct(c)}).observe("dblclick",function(){b.me._openProductDetails(c)})}return b.row}});