var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],suppliers:[],_tickAll:!1,productCategories:[],productStatuses:[],_showRightPanel:!1,_nextPageColSpan:9,_autoLoading:!1,_readOnlyMode:!1,_storeId:1,_roleId:0,_postIndex:null,_selected:null,_priceMatchRule:null,newRuleResultContainerId:"new_rule_result_container",_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",locations:"Locations",invenAccNo:"AccNo.",manufacturer:{name:"Brand"},supplierCodes:[{supplier:{name:"Supplier"},code:""}],active:"act?",stockOnOrder:"OnOrder",stockOnHand:"OnHand",stockOnPO:"OnPO"}},toggleSearchPanel:function(a){var b={};return b.me=this,$(a).toggle(),b.me.deSelectProduct(),b.me},_loadManufactures:function(a){this.manufactures=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.manufacturerIds"]'),b.me.manufactures.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadProductStatuses:function(a){this.productStatuses=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productStatusIds"]'),b.me.productStatuses.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadSuppliers:function(a){this.suppliers=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.supplierIds"]'),b.me.suppliers.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadCategories:function(a){this.categories=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productCategoryIds"]'),b.me.categories.sort(function(a,b){return a.namePath>b.namePath}).each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.namePath)})}),this},_loadChosen:function(){return jQuery(".chosen").select2({minimumResultsForSearch:1/0}),this},_getSelection:function(){var a={};return a.me=this,a.products=[],a.itemList=$("item-list"),a.itemList.getElementsBySelector(".product_item.item_row").each(function(b){a.checked=b.down('input.product-selected[type="checkbox"]').checked,a.productId=b.readAttribute("product_id"),!0===a.checked&&!0===jQuery.isNumeric(a.productId)&&a.products.push(b.retrieve("data"))}),$("total-selected-count").update(a.products.length),a.products},_bindSearchKey:function(){var a={};return a.me=this,$$("#searchBtn").first().observe("click",function(b){$$("#showSearch").first().checked?(a.me._tickAll=!1,a.me.deSelectProduct(),a.me.getSearchCriteria().getResults(!0,a.me._pagination.pageSize)):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(b){a.me.keydown(b,function(){$(a.me.searchDivId).down("#searchBtn").click()})})}),this},_getSupplierCodes:function(a,b){var c={};return c.me=this,c.supplierCodeString=[],a.each(function(a){c.supplierCodeString.push(!0===b?"Supplier":'<abbr title="Code: '+a.code+'">'+(a.supplier&&a.supplier.name?a.supplier.name:"")+"</abbr>")}),c.supplierCodeString.join(", ")},postNewRule:function(a,b){var c={};c.me=this,c.btn=a||null,c.del=b||!1,null!==c.btn&&c.me._signRandID(c.btn),c.me._priceMatchRule.price_from=c.me.getValueFromCurrency(c.me._priceMatchRule.price_from),c.me._priceMatchRule.price_to=c.me.getValueFromCurrency(c.me._priceMatchRule.price_to),c.me._priceMatchRule.offset=c.me.getValueFromCurrency(c.me._priceMatchRule.offset),c.me._priceMatchRule.active=!0!==c.del,c.me._selected[c.me._postIndex]?(window.onbeforeunload=function(){return"Processing... Please Do not close"},c.ModalBox=$(c.me.modalId),c.ModalBox&&c.ModalBox.down(".modal-header").update('<h4 style="color:red;">Processing... Please Do NOT close</h4>'),c.me.postAjax(c.me.getCallbackId("newRule"),{productId:c.me._selected[c.me._postIndex].id,rule:c.me._priceMatchRule},{onLoading:function(){null!==c.btn&&jQuery(".right-panel.btn").button("loading")},onSuccess:function(a,b){try{if(c.result=c.me.getResp(b,!1,!0),!c.result)return;$(c.me.newRuleResultContainerId).insert({bottom:new Element("d",{class:"col-xs-9"}).update(c.me._selected[c.me._postIndex].sku)}).insert({bottom:new Element("div",{class:"col-xs-3"}).update("done")})}catch(a){$(c.me.newRuleResultContainerId).insert({top:c.me.getAlertBox("",a).addClassName("alert-danger col-xs-12").insert({top:new Element("b",{class:"col-xs-12"}).update("SKU: "+c.me._selected[c.me._postIndex].sku)})})}},onComplete:function(){window.onbeforeunload=null,null!==c.btn&&jQuery(".right-panel.btn").button("reset"),c.me._postIndex=c.me._postIndex+1,c.me.postNewRule(c.btn,c.del)}})):($(c.me.newRuleResultContainerId).insert({top:new Element("div",{class:"col-xs-12"}).update("All Done!")}),c.me.hideModalBox(),jQuery("#"+c.me.modalId).remove(),$("searchBtn").click())},_bindNewRuleBtn:function(a,b){var c={};return c.me=this,c.product=b||null,c.btn=a||$("newPriceMatchRuleBtn"),c.me.observeClickNDbClick(c.btn,function(){c.selected=c.me._getSelection(),c.totalQty=$("total-found-count").innerHTML,null===c.product&&null!==c.selected&&c.selected.length>0?(c.warningMsg=new Element("div").insert({bottom:new Element("h3",{class:"col-lg-12"}).update("only <b>"+c.selected.length+"</b> out of <b>"+c.totalQty+"</b> is selected, Contrinue?")}).insert({bottom:new Element("i",{class:"btn btn-danger btn-lg"}).update("No").observe("click",function(){c.me.hideModalBox()})}).insert({bottom:new Element("i",{class:"btn btn-success btn-lg pull-right"}).update("Yes").setStyle(0===c.selected.length?"display: none;":"").observe("click",function(){jQuery("#select2-drop-mask").select2("close"),$(this).up(".modal-body").update("").insert({bottom:c.ruleContainer=c.me._getPriceMatchRuleEl(null,c.selected)}).insert({bottom:new Element("div",{class:"row",id:c.me.newRuleResultContainerId})}),c.me._getPriceMatchCompanySelect2(jQuery('[match_rule="company_id"]'),!0)})}),c.me.showModalBox("Warning",c.warningMsg,!1,null,null,!0)):c.product&&jQuery.isNumeric(c.product.id)},null),c.me},_getPriceMatchCompanySelect2:function(a,b){var c={};return c.me=this,c.product=b||null,c.selectBox=jQuery(a).select2({ajax:{delay:250,url:"/ajax/getAll",type:"POST",data:function(a){return{searchTxt:"companyName like ?",searchParams:["%"+a+"%"],entityName:"PriceMatchCompany"}},results:function(a,b,d){return c.result=[],a.resultData&&a.resultData.items&&a.resultData.items.each(function(a){!1===c.me._checkUniquePriceMatchCompanies(c.result,a)&&c.result.push({id:a.id,text:a.companyName,data:a})}),{results:c.result}}},cache:!0,escapeMarkup:function(a){return a}}),null!==c.product&&c.product.priceMatchRule&&c.product.priceMatchRule.id&&c.product.priceMatchRule.priceMatchCompany&&c.product.priceMatchRule.priceMatchCompany.id&&c.selectBox.select2("data",{id:c.product.priceMatchRule.priceMatchCompany.id,text:c.product.priceMatchRule.priceMatchCompany.companyName,data:c.product.priceMatchRule.priceMatchCompany}),c.selectBox},_checkUniquePriceMatchCompanies:function(a,b){var c={};return c.me=this,c.found=!1,a.each(function(a){!1===c.found&&a.text===b.companyName&&(c.found=!0)}),c.found},_getLocations:function(a,b){var c={};return c.me=this,!0===b?"Locations":(c.locationStrings=[],a.each(function(a){c.locationStrings.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+a.type.name+': </strong><abbr title="Type: '+a.type.name+'">'+a.value+"</abbr></small></div>")}),c.locationStrings.join(""))},_displayPriceMatchResult:function(a,b){var c={};return c.me=this,c.minPrice=0,$H(a.companyPrices).each(function(a){0!==parseInt(a.value.price)&&(0===parseInt(c.minPrice)&&parseFloat(a.value.price)>0||parseFloat(a.value.price)<parseFloat(c.minPrice))&&(c.minPrice=a.value.price)}),c.priceDiff=parseFloat(a.myPrice)-parseFloat(c.minPrice),c.priceDiffClass="",0!==parseInt(c.minPrice)&&(parseInt(c.priceDiff)>0?c.priceDiffClass="label label-danger":parseInt(c.priceDiff)<0&&(c.priceDiffClass="label label-success")),c.newDiv=new Element("table",{class:"table table-striped table-hover price-match-listing"}).insert({bottom:new Element("thead").insert({bottom:new Element("tr").insert({bottom:new Element("th").update("My Price")}).insert({bottom:new Element("th",{class:"price_diff"}).update("Price Diff.")}).insert({bottom:new Element("th").update("Min Price")})})}).insert({bottom:new Element("tbody").insert({bottom:new Element("tr").insert({bottom:new Element("td").update(c.priceInput=new Element("input",{class:"click-to-edit price-input",value:c.me.getCurrency(a.myPrice),"product-id":b.id}).setStyle("width: 80%"))}).insert({bottom:new Element("td",{class:"price_diff"}).update(new Element("span",{class:""+c.priceDiffClass}).update(c.me.getCurrency(c.priceDiff)))}).insert({bottom:new Element("td",{class:"price_min"}).update(c.me.getCurrency(c.minPrice))})})}),c.newDiv},_displayCompetatorPrice:function(a,b){var c={};return c.me=this,c.newDiv=new Element("div"),$H(a.companyPrices).each(function(a){c.newDiv.insert({bottom:new Element("div",{class:"col-md-4 competator-price"}).insert({bottom:new Element("span",{class:"col-md-7"}).update(a.key).addClassName(b.priceMatchRule&&a.key===b.priceMatchRule.priceMatchCompany.companyName?"success":"")}).insert({bottom:new Element("span",{class:"col-md-5"}).update(a.value.priceURL&&!a.value.priceURL.blank()?new Element("a",{href:a.value.priceURL,target:"__blank"}).update(c.me.getCurrency(a.value.price)):c.me.getCurrency(a.value.price))})})}),c.newDiv},_getInfoPanel:function(a){var b={};return b.me=this,b.newDiv=new Element("div",{id:"info_panel_"+a.id}).insert({bottom:new Element("div",{class:"col-md-4"})}).insert({bottom:new Element("div",{class:"col-md-5"}).insert({bottom:new Element("div",{class:"panel panel-default price-trend-div"}).insert({bottom:new Element("div",{class:"panel-body"}).insert({bottom:new Element("iframe",{frameborder:"0",scrolling:"auto",width:"100%",height:"300px"})})})})}).insert({bottom:b.me._readOnlyMode?"":new Element("div",{class:"col-md-3"})}),b.me.postAjax(b.me.getCallbackId("checkPriceMatchEnable"),{},{onLoading:function(){},onSuccess:function(c,d){b.result=b.me.getResp(d,!1,!0),b.result&&1==b.result.enable&&($("info_panel_"+a.id).down(".col-md-4").insert(new Element("div",{class:"panel panel-default price-match-div"}).insert({bottom:new Element("div",{class:"panel-heading"}).update("<strong>Price Match</strong>")}).insert({bottom:new Element("div",{class:"panel-body price-match-listing"}).update(b.me.getLoadingImg())}).insert({bottom:new Element("div",{class:"panel-competator-price"}).update()})),$("info_panel_"+a.id).down(".col-md-3").insert(new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("div",{class:"panel-heading"}).update("<strong>Price Match Rule</strong>")}).insert({bottom:new Element("div",{class:"panel-body"}).update(b.ProductRuleEl=b.me._getPriceMatchRuleEl(a))})))},onComplete:function(){}}),b.newDiv},_getPriceMatchRuleEl:function(a,b){var c={};return c.me=this,c.product=a||null,c.selected=b||null,c.newDiv=new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-xs-12"}).insert({bottom:new Element("div",{class:"form-group form-group-sm input-group"}).insert({bottom:new Element("label",{class:"contorl-label input-group-addon priceMatchRule"}).update("Target Competitor")}).insert({bottom:new Element("input",{type:"text",class:"form-control input-sm rightPanel",match_rule:"company_id"})})})}).insert({bottom:new Element("div",{class:"col-xs-12"}).insert({bottom:new Element("div",{class:"form-group form-group-sm input-group"}).insert({bottom:new Element("label",{class:"contorl-label input-group-addon priceMatchRule"}).update("Lower Safty Boundary")}).insert({bottom:new Element("input",{type:"text",class:"form-control input-sm",match_rule:"price_from",value:c.product&&c.product.priceMatchRule?c.product.priceMatchRule.price_from:""}).observe("keyup",function(a){$(this).up(".modal-body").down('[match_rule="price_to"]').value=$F($(this))}).observe("keydown",function(a){c.txtBox=this,c.me.keydown(a,function(){Event.stop(a),$(c.txtBox).up(".modal-body").down('[match_rule="offset"]').focus(),$(c.txtBox).up(".modal-body").down('[match_rule="offset"]').select()},function(){},Event.KEY_TAB)})})})}).insert({bottom:new Element("div",{class:"col-xs-12"}).insert({bottom:new Element("div",{class:"form-group form-group-sm input-group"}).insert({bottom:new Element("label",{class:"contorl-label input-group-addon priceMatchRule"}).update("Upper Safty Boundary")}).insert({bottom:new Element("input",{type:"text",class:"form-control input-sm",match_rule:"price_to",value:c.product&&c.product.priceMatchRule?c.product.priceMatchRule.price_to:""}).observe("keyup",function(a){$(this).up(".modal-body").down('[match_rule="price_from"]').value=$F($(this))})})})}).insert({bottom:new Element("div",{class:"col-xs-12"}).insert({bottom:new Element("div",{class:"form-group form-group-sm input-group"}).insert({bottom:new Element("label",{class:"contorl-label input-group-addon priceMatchRule"}).update("Extra Margin After Price Match")}).insert({bottom:new Element("input",{type:"text",class:"form-control input-sm",match_rule:"offset",value:c.product&&c.product.priceMatchRule?c.product.priceMatchRule.offset:""})})})}).insert({bottom:new Element("div",{class:"col-xs-12 text-right"}).insert({bottom:new Element("i",{class:"btn btn-sm btn-success btn-new-rule right-panel"}).update("Confirm").observe("click",function(a){c.me._priceMatchRule=c.me._collectFormData($(this).up(".modal-body"),"match_rule"),c.me._selected=null===c.product?c.selected:c.product,c.me._postIndex=0,c.me.postNewRule($(this))})}).insert({bottom:new Element("i",{class:"btn btn-sm btn-danger btn-del-rule right-panel"}).update('<i class="glyphicon glyphicon-trash"></i>').observe("click",function(a){c.me._priceMatchRule=c.me._collectFormData($(this).up(".modal-body"),"match_rule"),c.me._selected=null===c.product?c.selected:c.product,c.me._postIndex=0,c.me.postNewRule($(this),!0)})})}),c.newDiv},_showProductInfoOnRightPanel:function(a){var b={};return b.me=this,b.infoPanel=b.me._getInfoPanel(a),b.infoPanel.down(".price-trend-div iframe").writeAttribute("src","/statics/product/pricetrend.html?productid="+a.id),b.me.postAjax(b.me.getCallbackId("priceMatching"),{id:a.id},{onLoading:function(){b.infoPanel.down(".price-match-div .price-match-listing").replace(new Element("div",{class:"panel-body price-match-listing"}).update(b.me.getLoadingImg()))},onSuccess:function(c,d){try{if(b.result=b.me.getResp(d,!1,!0),!b.result)return;0!==jQuery(".popover .col-md-4").find(".panel").length&&0!==jQuery(".popover .col-md-3").find(".panel").length&&($("info_panel_"+a.id)&&$("info_panel_"+a.id).down(".price-match-div .price-match-listing").replace(b.me._displayPriceMatchResult(b.result,a)),$("info_panel_"+a.id).down(".price-match-div .panel-competator-price").replace(b.me._displayCompetatorPrice(b.result,a)),b.me._bindPriceInput())}catch(a){b.me.showModalBox("Error",a,!0)}}}),b.infoPanel},deSelectProduct:function(){var a={};return a.me=this,jQuery(".product_item.success",jQuery("#"+a.me.resultDivId)).removeClass("success").popover("hide"),jQuery("#spacetr").addClass("spacetr"),a.me._showRightPanel=!1,a.me},getResults:function(a,b,c,d){var e={};e.me=this,e.reset=a||!1,e.auto=c||!1,e.tickNew=d||!1,e.resultDiv=$(e.me.resultDivId),!0===e.reset&&(e.me._pagination.pageNo=1),!0===e.auto&&$$(".btn-show-more").length>0&&(e.me._autoLoading=!0,e.me._pagination.pageNo=1*e.me._pagination.pageNo+1),e.me._pagination.pageSize=b||e.me._pagination.pageSize,e.me.postAjax(e.me.getCallbackId("getItems"),{pagination:e.me._pagination,searchCriteria:e.me._searchCriteria},{onLoading:function(){jQuery("#"+e.me.searchDivId+" .btn").button("loading"),jQuery("#"+e.me.searchDivId+" input").prop("disabled",!0),jQuery("#"+e.me.searchDivId+" select").prop("disabled",!0),!0===e.reset&&e.resultDiv.update(new Element("tr").update(new Element("td").update(e.me.getLoadingImg()))),$(e.me.totalQtyId).update(0),$(e.me.totalValueId).update(e.me.getCurrency(0))},onSuccess:function(a,b){try{if(e.result=e.me.getResp(b,!1,!0),!e.result)return;$(e.me.totalNoOfItemsId).update(e.result.pageStats.totalRows),$(e.me.totalQtyId).update(e.result.totalStockOnHand),$(e.me.totalValueId).update(e.me.getCurrency(e.result.totalOnHandValue)),!0===e.reset&&e.resultDiv.update(e.me._getResultRow(e.me._getTitleRowData(),!0).wrap(new Element("thead"))),e.resultDiv.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),e.tbody=$(e.resultDiv).down("tbody"),e.tbody||$(e.resultDiv).insert({bottom:e.tbody=new Element("tbody")}),e.result.items.each(function(a){e.tbody.insert({bottom:e.newRow=e.me._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)}),e.me._tickAll&&e.newRow.down(".product-selected").click()}),!0!==e.me._singleProduct?e.result.pageStats.pageNumber<e.result.pageStats.totalPages&&e.resultDiv.insert({bottom:e.me._getNextPageBtn().addClassName("paginWrapper")}):e.result.items.size()>0&&e.me._displaySelectedProduct(e.result.items[0]),e.me._bindPriceInput(),!0===e.auto&&$$(".btn-show-more").length>0?e.me.getResults(!1,e.me._pagination.pageSize,!0):(e.me._autoLoading=!1,e.me.hideModalBox(),jQuery("#"+e.me.searchDivId+" .btn").button("reset"),jQuery("#"+e.me.searchDivId+" input").prop("disabled",!1),jQuery("#"+e.me.searchDivId+" select").prop("disabled",!1)),e.me._getSelection()}catch(a){e.resultDiv.insert({bottom:e.me.getAlertBox("Error",a).addClassName("alert-danger")})}},onComplete:function(){!0!==e.auto&&(jQuery("#"+e.me.searchDivId+" .btn").button("reset"),jQuery("#"+e.me.searchDivId+" input").prop("disabled",!1),jQuery("#"+e.me.searchDivId+" select").prop("disabled",!1))}})},_displaySelectedProduct:function(a){var b={};return b.me=this,a.id!==jQuery("#spacetr").attr("space_id")?(jQuery("#spacetr").remove(),jQuery(".product_item").removeClass("popover-loaded")):jQuery("#spacetr").toggleClass("spacetr"),b.me._showRightPanel=!0,jQuery(".product_item.success",jQuery("#"+b.me.resultDivId)).removeClass("success").popover("hide"),b.selectedRow=jQuery('[product_id="'+a.id+'"]',jQuery("#"+b.me.resultDivId)).addClass("success"),b.selectedRow.hasClass("popover-loaded")||(b.selectedRow.after('"<tr id="spacetr" space_id="'+a.id+'"><td><div id="spacediv" class="row"></div></td></tr>'),b.selectedRow.on("shown.bs.popover",function(c){0!==jQuery(".popover .col-md-4").find(".panel").length&&0!==jQuery(".popover .col-md-3").find(".panel").length&&(b.me._getPriceMatchCompanySelect2(jQuery('.rightPanel[match_rule="company_id"]'),null,a),b.container=$$(".btn-new-rule.right-panel").first().up(".panel-body"),$$(".btn-new-rule.right-panel").first().observe("click",function(c){b.me._priceMatchRule=b.me._collectFormData($(this).up(".panel-body"),"match_rule"),b.me._selected=[a],b.me._postIndex=0,b.me.postNewRule($(this))}),$$(".btn-del-rule.right-panel").first().observe("click",function(c){b.me._priceMatchRule=b.me._collectFormData($(this).up(".panel-body"),"match_rule"),b.me._selected=[a],b.me._postIndex=0,b.me.postNewRule($(this),!0)}),a.priceMatchRule&&a.priceMatchRule.id&&jQuery.isNumeric(a.priceMatchRule.id)||$$(".btn-del-rule.right-panel").first().hide(),b.container.down('[match_rule="price_from"]').observe("keyup",function(a){$(this).up(".panel-body").down('[match_rule="price_to"]').value=$F($(this))}).observe("keydown",function(a){b.txtBox=this,b.me.keydown(a,function(){Event.stop(a),$(b.txtBox).up(".panel-body").down('[match_rule="offset"]').focus(),$(b.txtBox).up(".panel-body").down('[match_rule="offset"]').select()},function(){},Event.KEY_TAB)}))}).popover({title:'<div class="row"><div class="col-xs-2"><div class="btn-group pull-right"><a class="btn btn-primary btn-sm" href="/product/'+a.id+'.html" target="_BLANK"><span class="glyphicon glyphicon-pencil"></span></a><span class="btn btn-danger btn-sm" onclick="pageJs.deSelectProduct();"><span class="glyphicon glyphicon-remove"></span></span></div></div></div>',html:!0,placement:"bottom",container:"#spacediv",trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return b.rightPanel=b.me._showProductInfoOnRightPanel(a).wrap(new Element("div")).innerHTML},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 1; width: 100%;left: 0px !important"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded")),b.selectedRow.popover("show"),jQuery("#spacetr").height(393),jQuery(".popover-title").hide(),jQuery("html,body").animate({scrollTop:b.selectedRow.offset().top-jQuery(".panel-default").offset().top+40}),b.me},toggleSellOnWeb:function(a,b,c){var d={};return d.me=this,d.me.postAjax(d.me.getCallbackId("toggleSellOnWeb"),{productId:b.id,isSellOnWeb:a},{onSuccess:function(e,f){try{if(d.result=d.me.getResp(f,!1,!0),!d.result||!d.result.item)return;$$(".product_item[product_id="+b.id+"]").size()>0&&$$(".product_item[product_id="+b.id+"]").first().replace(d.me._getResultRow(d.result.item,!1)),d.me._bindPriceInput()}catch(b){$(c).checked=!a,d.me.showModalBox("ERROR",b,!0)}}}),d.me},toggleActive:function(a,b){var c={};return c.me=this,c.me.postAjax(c.me.getCallbackId("toggleActive"),{productId:b.id,active:a},{onSuccess:function(a,d){try{if(c.result=c.me.getResp(d,!1,!0),!c.result||!c.result.item)return;$$(".product_item[product_id="+b.id+"]").size()>0&&$$(".product_item[product_id="+b.id+"]").first().replace(c.me._getResultRow(c.result.item,!1)),c.me._bindPriceInput()}catch(a){c.me.showModalBox("ERROR",a,!0)}}}),c.me},toggleIsKit:function(a,b){var c={};return c.me=this,c.me.postAjax(c.me.getCallbackId("toggleIsKit"),{productId:b.id,isKit:a},{onSuccess:function(a,d){c.newProduct=b;try{if(c.result=c.me.getResp(d,!1,!0),!c.result||!c.result.item)return;c.newProduct=c.result.item}catch(a){c.me.showModalBox("ERROR",a,!0)}$$(".product_item[product_id="+b.id+"]").size()>0&&$$(".product_item[product_id="+b.id+"]").first().replace(c.me._getResultRow(c.newProduct,!1)),c.me._bindPriceInput()}}),c.me},toggleManualFeed:function(a,b){var c={};return c.me=this,c.me.postAjax(c.me.getCallbackId("toggleManualFeed"),{productId:b.id,isManualFeed:a},{onSuccess:function(a,d){c.newProduct=b;try{if(c.result=c.me.getResp(d,!1,!0),!c.result||!c.result.item)return;c.newProduct=c.result.item}catch(a){c.me.showModalBox("ERROR",a,!0)}$$(".product_item[product_id="+b.id+"]").size()>0&&$$(".product_item[product_id="+b.id+"]").first().replace(c.me._getResultRow(c.newProduct,!1)),c.me._bindPriceInput()}}),c.me},_updatePrice:function(a,b,c,d){var e={};return e.me=this,e.isSpecial="1"===d?1:0,e.me.postAjax(e.me.getCallbackId("updatePrice"),{productId:a,newPrice:e.me.getValueFromCurrency(b),isSpecial:e.isSpecial},{onLoading:function(){},onSuccess:function(d,f){try{if(e.result=e.me.getResp(f,!1,!0),!e.result||!e.result.item||!e.result.item.id)return;jQuery(".price-input[product-id="+e.result.item.id+"]").attr("original-price",e.me.getValueFromCurrency(b))}catch(b){e.me.showModalBox('<strong class="text-danger">Error When Update Price:</strong>',"<strong>"+b+"</strong>"),jQuery(".price-input[product-id="+a+"]").val(e.me.getCurrency(c))}}}),e.me},_updateStockLevel:function(a,b,c,d){var e={};return e.me=this,"stockMinLevel"!==d&&"stockReorderLevel"!==d&&e.me.showModalBox("Error","Invalid type passin to tmp.me._updateStockLevel"),e.me.postAjax(e.me.getCallbackId("updateStockLevel"),{productId:a,newValue:b,type:d},{onLoading:function(){},onSuccess:function(f,g){try{if(e.result=e.me.getResp(g,!1,!0),!e.result||!e.result.item||!e.result.item.id)return;jQuery("."+d+"-input[product-id="+e.result.item.id+"]").attr("original-"+d,b),e.row=$(e.me.resultDivId).down(".product_item[product_id="+e.result.item.id+"]"),e.row&&(e.row.replace(e.me._getResultRow(e.result.item,!1)),e.me._bindPriceInput())}catch(b){e.me.showModalBox('<strong class="text-danger">Error When Update '+d+":</strong>","<strong>"+b+"</strong>"),jQuery("."+d+"-input[product-id="+a+"]").val(c)}}}),e.me},_bindPriceInput:function(){var a={};return a.me=this,jQuery('.price-input[product-id]:not(".price-input-binded")').click(function(){jQuery(this).attr("original-price",a.me.getValueFromCurrency(jQuery(this).val())).select()}).keydown(function(b){a.inputBox=jQuery(this),a.me.keydown(b,function(){a.inputBox.blur()})}).focusout(function(){a.value=a.me.getValueFromCurrency(jQuery(this).val()),jQuery(this).val(a.me.getCurrency(a.value))}).change(function(){a.me._updatePrice(jQuery(this).attr("product-id"),jQuery(this).val(),a.me.getValueFromCurrency(jQuery(this).attr("original-price")),jQuery(this).attr("isSpecial"))}).addClass("price-input-binded"),jQuery(".stockMinLevel-input[product-id]").not(".stockMinLevel-input-binded").click(function(){jQuery(this).attr("original-stockMinLevel",jQuery(this).val()).select()}).keydown(function(b){a.inputBox=jQuery(this),a.me.keydown(b,function(){a.inputBox.blur()})}).focusout(function(){a.value=jQuery(this).val(),jQuery(this).val(a.value)}).change(function(){a.me._updateStockLevel(jQuery(this).attr("product-id"),jQuery(this).val(),jQuery(this).attr("original-stockMinLevel"),"stockMinLevel")}).addClass("stockMinLevel-input-binded"),jQuery(".stockReorderLevel-input[product-id]").not(".stockReorderLevel-input-binded").click(function(){jQuery(this).attr("original-stockReorderLevel",jQuery(this).val()).select()}).keydown(function(b){a.inputBox=jQuery(this),a.me.keydown(b,function(){a.inputBox.blur()})}).focusout(function(){a.value=jQuery(this).val(),jQuery(this).val(a.value)}).change(function(){a.me._updateStockLevel(jQuery(this).attr("product-id"),jQuery(this).val(),jQuery(this).attr("original-stockReorderLevel"),"stockReorderLevel")}).addClass("stockReorderLevel-input-binded"),a.me},_getNextPageBtn:function(){var a={};return a.me=this,a.totalQty=$("total-found-count").innerHTML,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:a.me._nextPageColSpan,class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary btn-show-more","data-loading-text":"Fetching more results ..."}).update("Next Page").observe("click",function(){a.me._pagination.pageNo=1*a.me._pagination.pageNo+1,jQuery(this).button("loading"),a.me.deSelectProduct(),a.me.getResults(!1,a.me._pagination.pageSize,!1,!0)})}).insert({bottom:new Element("span",{class:"btn btn-warning btn-show-more","data-loading-text":"Fetching more results ..."}).update("<b>Show ALL Pages</b>").setStyle("margin-left: 10px; color: black;").observe("click",function(){a.totalQty>1e3?a.me.showModalBox("Warning","<h3>There are "+a.totalQty+" products for current search conditions. <br/>Please narrow down the search"):(a.me.deSelectProduct(),a.me.getResults(!1,a.me._pagination.pageSize,!0))})})})})},_getOtherStocks:function(a){var b={},c={};return ret="",b.stockString=[],a&&a.stock&&a.stock.storeId?(currentStoreId=a.stock.storeId.id,c=a.stocks,c.each(function(a){a.storeId.id!=currentStoreId&&b.stockString.push(a.stockOnHand)}),b.stockString.join(", ")):ret},_getResultRow:function(a,b){var c={};if(c.me=this,c.tag=!0===c.isTitle?"th":"td",c.isTitle=b||!1,c.price="",c.specilaPrice="",c.srp="",a.prices&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)?(c.price=Number(a.price),c.updatedDate=a.updated):a.type&&2===parseInt(a.type.id)?c.specilaPrice=Number(a.price):a.type&&7===parseInt(a.type.id)&&(c.srp=Number(a.price))}),tiers=a.tierprices,c.tierStrings=[],tiers&&tiers.length>0?tiers.each(function(a){warning=!1,Number(a.unitCost)>0?(1==a.tierPriceType.id?tierPrice=Number(1.1*(a.unitCost*(a.value/100)+a.unitCost)).toFixed(2):tierPrice=Number(a.value).toFixed(2),c.srp&&tierPrice>c.srp&&(warning=!0),c.price&&tierPrice>c.price&&(warning=!0)):tierPrice=0,c.tierStrings.push("<div "+(warning?'style="color : red;"':"")+">"+(tierPrice>0?c.me.getCurrency(tierPrice):"N/A")+(a.quantity>0?': <abbr title="Quantity" >'+a.quantity+" </abbr>":"</div>"))}):c.tierStrings.push("N/A"),color=";",a.costtrends?0==a.costtrends.order?color="orange;":1==a.costtrends.order?color="red;":-1==a.costtrends.order&&(color="green;"):color=";",buyinPrice=c.tierStrings.join(""),c.row=new Element("tr",{class:"visible-xs visible-md visible-lg visible-sm "+(!0===c.isTitle?"":"product_item "+(parseInt(a.stockOnHand,10)<=parseInt(a.stockMinLevel,10)?"danger":parseInt(a.stockOnHand,10)<=parseInt(a.stockReorderLevel,10)?"warning":"")),product_id:a.id}).store("data",a).insert({bottom:new Element(c.tag,{class:"sku",title:a.name}).addClassName("col-xs-1").observe("click",function(a){if(c.me._signRandID($(this)),"INPUT"!=a.target.nodeName){if(jQuery("#"+$(this).id).find(":checkbox").prop("disabled"))return;jQuery("#"+$(this).id).find(":checkbox").prop("checked",!jQuery("#"+$(this).id).find(":checkbox").prop("checked")),!0===c.isTitle&&(c.checked=jQuery("#"+$(this).id).find(":checkbox").prop("checked"),c.me._tickAll=c.checked,$(c.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(a){a.checked=c.checked}))}c.me._getSelection()}).insert({bottom:new Element("span").setStyle("margin: 0 5px 0 0").insert({bottom:c.skucbx=new Element("input",{type:"checkbox",class:"product-selected"}).observe("click",function(a){c.checked=this.checked,!0===c.isTitle&&(c.me._tickAll=c.checked,$(c.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(a){a.checked=c.checked})),c.me._getSelection()})})}).insert({bottom:!0===c.isTitle?a.sku:new Element("a",{href:"javascript: void(0);",class:"sku-link truncate"}).observe("click",function(b){Event.stop(b),c.selectedRow=jQuery('[product_id="'+a.id+'"]',jQuery("#"+c.me.resultDivId)),c.selectedRow.hasClass("success")?c.me.deSelectProduct():c.me._displaySelectedProduct(a)}).update(a.sku).setStyle(!1===a.sellOnWeb?"color: red;":"color: blue;")})}).insert({bottom:new Element(c.tag,{class:"product_name hidden-xs hide-when-info hidden-sm"}).addClassName("col-xs-2").setStyle(c.me._showRightPanel?"display: none":"").update(!0===c.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-1"}).update("")}).insert({bottom:new Element("div",{class:"col-sm-9"}).update("Product Name")}).insert({bottom:1!=c.me._storeId?"":new Element("div",{class:"col-sm-2"}).update("IsKit?")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-1"}).setStyle("padding: 0px;").insert({bottom:!0===c.isTitle?"":new Element("div",{class:"col-sm-1"}).insert({bottom:new Element("a",{class:"btn btn-primary btn-xs",href:"/product/"+a.id+".html",target:"_BLANK"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-pencil"})})})})}).insert({bottom:new Element("div",{class:"col-sm-9"}).update(""===c.srp?a.name:'<abbr title="SRP: '+c.me.getCurrency(c.srp)+'">'+a.name+"</abbr>")}).setStyle(""===c.srp?";":"color: green;").insert({bottom:1!=c.me._storeId?"":new Element("div",{class:"col-sm-2"}).update(c.kitcbx=new Element("input",{type:"checkbox",checked:a.isKit}).observe("click",function(b){c.btn=this,c.checked=$(c.btn).checked,confirm(!0===c.checked?"You are about to set this product to a KIT, which you can NOT PICK or SHIP without providing a KIT barcode.\n Continue?":"You are about to set this product to NOT a KIT, which you can PICK or SHIP without providing a KIT barcode\n Continue?")?c.me.toggleIsKit(c.checked,a):$(c.btn).checked=!c.checked}))}))}).insert({bottom:new Element(c.tag,{class:"hidden-xs hide-when-info hidden-sm row"}).addClassName("col-xs-2").setStyle(c.me._showRightPanel?"display: none":"").insert({bottom:new Element("div",{class:"col-sm-6"}).update(!0===c.isTitle?"Price":c.txtprice=new Element("input",{class:"click-to-edit price-input",value:c.me.getCurrency(c.price),"product-id":a.id}).setStyle("width: 80%"))}).insert({bottom:new Element("div",{class:"col-sm-6"}).update(!0===c.isTitle?"Special Price":c.txtsp=new Element("input",{class:"click-to-edit price-input",value:c.me.getCurrency(c.specilaPrice),"product-id":a.id,isSpecial:"1"}).setStyle("width: 80%"))})}).insert({bottom:c.match=new Element(c.tag,{class:"match"+a.id+" hide-when-info hidden-sm",style:"width:5%"}).addClassName("col-xs-1").update().insert({bottom:new Element("div",{class:"col-sm-12"}).update(!0===c.isTitle?"Match":new Element("span").update(a.priceMatchRule&&a.priceMatchRule.priceMatchCompany?'<abbr title="Updated: '+c.updatedDate+'">'+a.priceMatchRule.priceMatchCompany.companyName+"</abbr>":"").setStyle("width: 100%"))})}).insert({bottom:new Element(c.tag,{class:"locations hide-when-info hidden-sm",style:"width:8%"}).addClassName("col-xs-1").update(a.locations?c.me._getLocations(a.locations,b):"")}).insert({bottom:1!=c.me._storeId?"":new Element(c.tag,{class:"sellonweb hide-when-info hidden-sm ",style:"width:1%"}).addClassName("col-xs-1").insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-sm-3 text-right"}).insert({bottom:!0===c.isTitle?"SOW?":c.sowcbx=new Element("input",{type:"checkbox",checked:a.sellOnWeb,disabled:1==a.localOnly}).observe("click",function(b){c.btn=this,c.checked=$(c.btn).checked,confirm(!0===c.checked?"You are about to sell this product on web again.\n Continue?":"You are NOT about to sell this product on web.\n Continue?")?c.me.toggleSellOnWeb(c.checked,a,c.btn):$(c.btn).checked=!c.checked})})})})}).insert({bottom:new Element(c.tag,{class:"manufacturer hide-when-info",style:"width:5%"}).addClassName("col-xs-1").update(a.manufacturer?a.manufacturer.name:"")}).insert({bottom:new Element(c.tag,{class:"supplier hide-when-info hidden-sm",style:"width:5%"}).addClassName("col-xs-1").update(a.supplierCodes?c.me._getSupplierCodes(a.supplierCodes,b):"")}).insert({bottom:new Element(c.tag,{class:"qty hidden-sm"}).addClassName("col-xs-1").update(!0===c.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-4",title:"Stock on Hand"}).update("SH")}).insert({bottom:new Element("div",{class:"col-xs-4 hide-when-info",title:"Stock On PO"}).update("SP")}).insert({bottom:new Element("div",{class:"col-xs-4",title:"Average Cost"}).update("Cost")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-4",title:"Stock on Hand"}).update(new Element("a",{href:"/productqtylog.html?productid="+a.id,target:"_BLANK"}).update(a.stockOnHand))}).insert({bottom:new Element("div",{class:"col-xs-4 hide-when-info",title:"Stock On PO"}).update(new Element("a",{href:"/productqtylog.html?productid="+a.id,target:"_BLANK"}).update(a.stockOnPO))}).insert({bottom:new Element("div",{class:"col-xs-4",title:"Average Cost"}).update(c.avgCostEl=new Element("a",{href:"javascript:void(0);",style:"color: "+color}).update(0!=a.totalOnHandValue&&0!=a.stockOnHand?c.me.getCurrency(a.totalOnHandValue/a.stockOnHand):"N/A"))}))}).insert({bottom:1==c.me._storeId?"":new Element(c.tag,{class:"buyinprice hide-when-info"}).addClassName("col-xs-1").update(!0===c.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-6  text-right",title:"Stock of Mount Waverley"}).update("SSH")}).insert({bottom:new Element("div",{class:"col-xs-6  text-right",title:"Buyin price from Mount Waverley"}).update("Buyin")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-6  text-right",title:"Stock of Mount Waverley"}).update(c.me._getOtherStocks(a))}).insert({bottom:new Element("div",{class:"col-xs-6  text-right",title:"Buyin price from Mount Waverley"}).update(buyinPrice)}))}).insert({bottom:new Element(c.tag,{class:"product_active hide-when-info hidden-sm ",style:"width:4%"}).addClassName("col-xs-1").insert({bottom:new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-2 text-right"}).insert({bottom:!0===c.isTitle?"Act?":c.actcbx=new Element("input",{type:"checkbox",checked:a.active}).observe("click",function(b){c.btn=this,c.checked=$(c.btn).checked,confirm(!0===c.checked?"You are about to ReACTIVATE this product.\n Continue?":"You are about to deactivate this product.\n Continue?")&&c.me.toggleActive(c.checked,a)})})}).insert({bottom:new Element("div",{class:"col-xs-2"}).setStyle("padding: 0px;").insert({bottom:!0===c.isTitle?"":new Element("a",{href:"/serialnumbers.html?productid="+a.id,target:"_BLANK",title:"Serial Numbers."}).update("SN")})})})}),c.avgCostEl&&c.me.observeClickNDbClick(c.avgCostEl,function(){c.me.showHistoryBuyin(a)},function(){c.me.showHistoryBuyin(a)}),!c.isTitle&&a.priceMatchRule&&c.updatedDate){var d=c.updatedDate,e=new Date(d.substr(0,4),d.substr(5,2)-1,d.substr(8,2),d.substr(11,2),d.substr(14,2),d.substr(17,2));e.setHours(e.getHours()+10);var f=new Date,g=f.getTime()-e.getTime(),h=g/864e5;h<1?jQuery(c.match).css({"background-color":"green"}):h<2?jQuery(c.match).css({"background-color":"yellow"}):jQuery(c.match).css({"background-color":"orange"})}return c.me._readOnlyMode&&(jQuery(c.skucbx).prop("disabled",!0),jQuery(c.kitcbx).prop("disabled",!0),jQuery(c.txtprice).prop("disabled",!0),jQuery(c.txtsp).prop("disabled",!0),jQuery(c.mancbx).prop("disabled",!0),jQuery(c.sowcbx).prop("disabled",!0),jQuery(c.actcbx).prop("disabled",!0)),c.row},showHistoryBuyin:function(a){var b={};return b.me=this,a.costtrends&&a.costtrends.trends&&0!=a.costtrends.trends.length?(b.newDiv=new Element("table",{class:"table table-striped table-hover buyin-price-listing"}).insert({bottom:new Element("thead").insert({bottom:new Element("tr").insert({bottom:new Element("th").update("PurchaseOrderNo")}).insert({bottom:new Element("th").update("Buyin Price")}).insert({bottom:new Element("th").update("Purchase Date")})})}).insert({bottom:b.body=new Element("tbody")}),a.costtrends.trends.each(function(a){b.newRow=new Element("tr").insert({bottom:new Element("td").update(a.purchaseOrderNo)}).insert({bottom:new Element("td").update(b.me.getCurrency(a.unitPrice))}).insert({bottom:new Element("td").update(a.updated)}),b.body.insert({bottom:b.newRow})}),b.me.showModalBox("Hisotry buyin cost for "+a.sku,b.newDiv)):b.me.showModalBox("Hisotry buyin cost for "+a.sku,"No purchase history!"),b.newDiv},readOnlyMode:function(a,b,c){var d={};d.me=this,d.me._readOnlyMode=!a,d.me._storeId=b,d.me._roleId=c,(d.me._readOnlyMode||1!=d.me._storeId)&&(jQuery("#newProductBtn").hide(),jQuery("#newPriceMatchRuleBtn").hide())},_getCostTrend:function(a){var b={};b.me=this,b.productId=a||null;var b={};return b.me=this,b.me.postAjax(b.me.getCallbackId("getCostTrend"),{productId:a},{onLoading:function(){},onSuccess:function(c,d){try{if(b.result=b.me.getResp(d,!1,!0),!b.result||!b.result.item||!b.result.item.id)return;jQuery("."+type+"-input[product-id="+b.result.item.id+"]").attr("original-"+type,newValue),b.row=$(b.me.resultDivId).down(".product_item[product_id="+b.result.item.id+"]"),b.row&&(b.row.replace(b.me._getResultRow(b.result.item,!1)),b.me._bindPriceInput())}catch(c){b.me.showModalBox('<strong class="text-danger">Error When Update '+type+":</strong>","<strong>"+c+"</strong>"),jQuery("."+type+"-input[product-id="+a+"]").val(originalValue)}}}),b.me}});