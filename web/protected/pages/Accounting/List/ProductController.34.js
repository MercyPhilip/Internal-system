var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],suppliers:[],productCategories:[],productStatuses:[],_showRightPanel:!1,_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",assetAccNo:"Asset Acc #",revenueAccNo:"Revenue Acc #",costAccNo:"Cost Acc #",locations:"Locations",invenAccNo:"AccNo.",manufacturer:{name:"Brand"},supplierCodes:[{supplier:{name:"Supplier"},code:""}],active:"act?",stockOnOrder:"OnOrder",stockOnHand:"OnHand",stockOnPO:"OnPO"}},toggleSearchPanel:function(b){$(b).toggle();
this.deSelectProduct();return this},_loadManufactures:function(b){this.manufactures=b;var c;c=$(this.searchDivId).down('[search_field="pro.manufacturerIds"]');this.manufactures.each(function(a){c.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});return this},_loadProductStatuses:function(b){this.productStatuses=b;var c;c=$(this.searchDivId).down('[search_field="pro.productStatusIds"]');this.productStatuses.each(function(a){c.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});
return this},_loadSuppliers:function(b){this.suppliers=b;var c;c=$(this.searchDivId).down('[search_field="pro.supplierIds"]');this.suppliers.each(function(a){c.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});return this},_loadCategories:function(b){this.categories=b;var c;c=$(this.searchDivId).down('[search_field="pro.productCategoryIds"]');this.categories.sort(function(a,b){return a.namePath>b.namePath}).each(function(a){c.insert({bottom:(new Element("option",{value:a.id})).update(a.namePath)})});
return this},_loadChosen:function(){jQuery(".chosen").chosen({search_contains:!0,inherit_select_classes:!0,no_results_text:"Oops, nothing found!",width:"95%"});return this},_bindSearchKey:function(){var b;b=this;$$("#searchBtn").first().observe("click",function(c){$$("#showSearch").first().checked?(b.deSelectProduct(),b.getSearchCriteria().getResults(!0,b._pagination.pageSize)):$$("#showSearch").first().click()});$("searchDiv").getElementsBySelector("[search_field]").each(function(c){c.observe("keydown",
function(a){b.keydown(a,function(){$(b.searchDivId).down("#searchBtn").click()})})});return this},_getSupplierCodes:function(b,c){var a;a=[];b.each(function(b){a.push(!0===c?"Supplier":'<abbr title="Code: '+b.code+'">'+b.supplier.name+"</abbr>")});return a.join(", ")},_getLocations:function(b,c){var a;if(!0===c)return"Locations";a=[];b.each(function(b){a.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+b.type.name+': </strong><abbr title="Type: '+b.type.name+'">'+b.value+"</abbr></small></div>")});
return a.join("")},_displayPriceMatchResult:function(b){var c,a,e,f,d;c=this;a=0;e=new Element("tbody");$H(b.companyPrices).each(function(b){0!==parseInt(b.value.price)&&(0===parseInt(a)&&0<parseFloat(b.value.price)||parseFloat(b.value.price)<parseFloat(a))&&(a=b.value.price);e.insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:3})).update(b.key)}).insert({bottom:(new Element("td")).update(b.value.priceURL&&!b.value.priceURL.blank()?(new Element("a",{href:b.value.priceURL,
target:"__blank"})).update(c.getCurrency(b.value.price)):c.getCurrency(b.value.price))})})});f=parseFloat(b.myPrice)-parseFloat(a);d="";0!==parseInt(a)&&(0<parseInt(f)?d="label label-danger":0>parseInt(f)&&(d="label label-success"));return(new Element("table",{"class":"table table-striped table-hover price-match-listing"})).insert({bottom:(new Element("thead")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("th")).update("SKU")}).insert({bottom:(new Element("th")).update("My Price")}).insert({bottom:(new Element("th",
{"class":"price_diff"})).update("Price Diff.")}).insert({bottom:(new Element("th")).update("Min Price")})})}).insert({bottom:(new Element("tbody")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td")).update(b.sku)}).insert({bottom:(new Element("td")).update(c.getCurrency(b.myPrice))}).insert({bottom:(new Element("td",{"class":"price_diff"})).update((new Element("span",{"class":""+d})).update(c.getCurrency(f)))}).insert({bottom:(new Element("td",{"class":"price_min"})).update(c.getCurrency(a))})})}).insert({bottom:(new Element("thead")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("th",
{colspan:3})).update("Company")}).insert({bottom:(new Element("th")).update("Price")})})}).insert({bottom:e})},_getInfoPanel:function(b){return(new Element("div",{id:"info_panel_"+b.id})).insert({bottom:(new Element("div",{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default price-match-div"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).update("<strong>Price Match</strong>")}).insert({bottom:(new Element("div",{"class":"panel-body price-match-listing"})).update(this.getLoadingImg())})})}).insert({bottom:(new Element("div",
{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default price-trend-div"})).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:new Element("iframe",{frameborder:"0",scrolling:"auto",width:"100%",height:"400px"})})})})}).insert({bottom:(new Element("div",{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-body"})).update("<h4>Reserved for Next Phase of Developing</h4>")})})}).insert({bottom:(new Element("div",
{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-body"})).update("<h4>Reserved for Next Phase of Developing</h4>")})})})},_showProductInfoOnRightPanel:function(b){var c,a,e;c=this;a=c._getInfoPanel(b);a.down(".price-trend-div iframe").writeAttribute("src","/statics/product/pricetrend.html?productid="+b.id);c.postAjax(c.getCallbackId("priceMatching"),{id:b.id},{onCreate:function(){a.down(".price-match-div .price-match-listing").replace((new Element("div",
{"class":"panel-body price-match-listing"})).update(c.getLoadingImg()))},onSuccess:function(a,d){try{(e=c.getResp(d,!1,!0))&&$("info_panel_"+b.id)&&$("info_panel_"+b.id).down(".price-match-div .price-match-listing").replace(c._displayPriceMatchResult(e))}catch(g){c.showModalBox("Error",g,!0)}}});return a},deSelectProduct:function(){jQuery(".product_item.success",jQuery("#"+this.resultDivId)).removeClass("success").popover("hide");$(this.resultDivId).up(".list-panel").removeClassName("col-xs-4").addClassName("col-xs-12");
jQuery(".hide-when-info",jQuery("#"+this.resultDivId)).show();this._showRightPanel=!1;return this},getResults:function(b,c){var a,e,f,d,g;a=this;e=b||!1;f=$(a.resultDivId);!0===e&&(a._pagination.pageNo=1);a._pagination.pageSize=c||a._pagination.pageSize;a.postAjax(a.getCallbackId("getItems"),{pagination:a._pagination,searchCriteria:a._searchCriteria},{onCreate:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("loading");!0===e&&f.update((new Element("tr")).update((new Element("td")).update(a.getLoadingImg())))},
onSuccess:function(b,c){try{if(d=a.getResp(c,!1,!0))$(a.totalNoOfItemsId).update(d.pageStats.totalRows),!0===e&&f.update(a._getResultRow(a._getTitleRowData(),!0).wrap(new Element("thead"))),f.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(g=$(f).down("tbody"))||$(f).insert({bottom:g=new Element("tbody")}),d.items.each(function(b){g.insert({bottom:a._getResultRow(b).addClassName("item_row").writeAttribute("item_id",b.id)})}),!0!==a._singleProduct?d.pageStats.pageNumber<d.pageStats.totalPages&&
f.insert({bottom:a._getNextPageBtn().addClassName("paginWrapper")}):0<d.items.size()&&a._displaySelectedProduct(d.items[0])}catch(h){f.insert({bottom:a.getAlertBox("Error",h).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("reset")}})},_displaySelectedProduct:function(b){var c,a;c=this;$(c.resultDivId).up(".list-panel").removeClassName("col-xs-12").addClassName("col-xs-4");jQuery(".hide-when-info",jQuery("#"+c.resultDivId)).hide();c._showRightPanel=
!0;jQuery(".product_item.success",jQuery("#"+c.resultDivId)).removeClass("success").popover("hide");a=jQuery('[product_id="'+b.id+'"]',jQuery("#"+c.resultDivId)).addClass("success");a.hasClass("popover-loaded")||a.popover({title:'<div class="row"><div class="col-xs-10">Details for: '+b.sku+'</div><div class="col-xs-2"><span class="btn btn-danger pull-right btn-sm" onclick="pageJs.deSelectProduct();"><span class="glyphicon glyphicon-remove"></span></span></div></div>',html:!0,placement:"right",container:"body",
trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return c._showProductInfoOnRightPanel(b).wrap(new Element("div")).innerHTML},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded");a.popover("toggle");return c},_openProductDetails:function(b){window.open("/product/"+("new"==b?b:b.id)+".html","Product Details for: "+
b.sku,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no").focus()},toggleActive:function(b,c){var a,e;a=this;a.postAjax(a.getCallbackId("toggleActive"),{productId:c.id,active:b},{onSuccess:function(b,d){try{(e=a.getResp(d,!1,!0))&&e.item&&0<$$(".product_item[product_id="+c.id+"]").size()&&$$(".product_item[product_id="+c.id+"]").first().replace(a._getResultRow(e.item,!1))}catch(g){a.showModalBox("ERROR",g,!0)}}});return a},_getResultRow:function(b,
c){var a={me:this};a.tag=!0===a.isTitle?"th":"td";a.isTitle=c||!1;a.price="";b.prices&&b.prices.each(function(b){b.type&&1===parseInt(b.type.id)&&(a.price=b.price)});a.row=(new Element("tr",{"class":"visible-xs visible-md visible-lg visible-sm "+(!0===a.isTitle?"":"product_item"),product_id:b.id})).store("data",b).insert({bottom:(new Element(a.tag,{"class":"sku",title:b.name})).insert({bottom:(new Element("span",{style:"margin: 0 5px 0 0;"})).insert({bottom:(new Element("input",{type:"checkbox","class":"product-selected"})).observe("click",
function(){a.checked=this.checked;!0===a.isTitle&&$(a.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(b){b.checked=a.checked})})})}).insert({bottom:!0===a.isTitle?b.sku:(new Element("a",{href:"javascript: void(0);","class":"sku-link"})).update(b.sku)})}).insert({bottom:(new Element(a.tag,{"class":"product_name hidden-xs hide-when-info hidden-sm",style:a.me._showRightPanel?"display: none":""})).update(b.name)}).insert({bottom:(new Element(a.tag,{"class":"product_price hidden-xs hide-when-info hidden-sm",
style:a.me._showRightPanel?"display: none":""})).update(!0===a.isTitle?"Price":a.price.blank()?"":a.me.getCurrency(a.price))}).insert({bottom:(new Element(a.tag,{"class":"assetAccNo col-xs-1 hide-when-info"})).update(b.assetAccNo?b.assetAccNo:"")}).insert({bottom:(new Element(a.tag,{"class":"revenueAccNo col-xs-1 hide-when-info"})).update(b.revenueAccNo?b.revenueAccNo:"")}).insert({bottom:(new Element(a.tag,{"class":"costAccNo col-xs-1 hide-when-info"})).update(b.costAccNo?b.costAccNo:"")}).insert({bottom:(new Element(a.tag,
{"class":"product_active col-xs-1 hide-when-info hidden-sm"})).insert({bottom:!0===a.isTitle?b.active:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-4"})).insert({bottom:new Element("input",{type:"checkbox",disabled:!0,checked:b.active})})}).insert({bottom:(new Element("div",{"class":"col-xs-8"})).insert({bottom:(new Element("div",{"class":"btn-group"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-xs"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-pencil"})})}).observe("click",function(c){Event.stop(c);a.me._openProductDetails(b)}).insert({bottom:!0===b.active?(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(c){Event.stop(c);a.btn=this;confirm("You are about to deactivate this product.\n Continue?")&&a.me.toggleActive(!1,b)}):(new Element("span",{"class":"btn btn-success btn-xs"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-repeat"})}).observe("click",function(c){Event.stop(c);a.btn=this;confirm("You are about to ReACTIVATE this product.\n Continue?")&&a.me.toggleActive(!0,b)})})})})})});!1===a.isTitle&&a.me.observeClickNDbClick(a.row,function(){a.me._displaySelectedProduct(b)},function(){!0!==a.me._singleProduct&&a.me._openProductDetails(b)});return a.row}});