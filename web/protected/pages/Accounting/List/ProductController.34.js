var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],suppliers:[],productCategories:[],productStatuses:[],storeId:null,_showRightPanel:!1,_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",assetAccNo:"Asset Acc #",revenueAccNo:"Revenue Acc #",costAccNo:"Cost Acc #",locations:"Locations",invenAccNo:"AccNo.",manufacturer:{name:"Brand"},supplierCodes:[{supplier:{name:"Supplier"},code:""}],active:"act?",stockOnOrder:"OnOrder",stockOnHand:"OnHand",stockOnPO:"OnPO"}},toggleSearchPanel:function(a){$(a).toggle();
this.deSelectProduct();return this},_loadManufactures:function(a){this.manufactures=a;var c;c=$(this.searchDivId).down('[search_field="pro.manufacturerIds"]');this.manufactures.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});return this},_loadProductStatuses:function(a){this.productStatuses=a;var c;c=$(this.searchDivId).down('[search_field="pro.productStatusIds"]');this.productStatuses.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});
return this},_loadSuppliers:function(a){this.suppliers=a;var c;c=$(this.searchDivId).down('[search_field="pro.supplierIds"]');this.suppliers.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});return this},_loadCategories:function(a){this.categories=a;var c;c=$(this.searchDivId).down('[search_field="pro.productCategoryIds"]');this.categories.sort(function(b,a){return b.namePath>a.namePath}).each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.namePath)})});
return this},_loadChosen:function(){jQuery(".chosen").chosen({search_contains:!0,inherit_select_classes:!0,no_results_text:"Oops, nothing found!",width:"95%"});return this},_bindSearchKey:function(){var a;a=this;$$("#searchBtn").first().observe("click",function(c){$$("#showSearch").first().checked?(a.deSelectProduct(),a.getSearchCriteria().getResults(!0,a._pagination.pageSize,a.storeId)):$$("#showSearch").first().click()});$("searchDiv").getElementsBySelector("[search_field]").each(function(c){c.observe("keydown",
function(b){a.keydown(b,function(){$(a.searchDivId).down("#searchBtn").click()})})});return this},_getSupplierCodes:function(a,c){var b;b=[];a.each(function(a){b.push(!0===c?"Supplier":'<abbr title="Code: '+a.code+'">'+a.supplier.name+"</abbr>")});return b.join(", ")},_getLocations:function(a,c){var b;if(!0===c)return"Locations";b=[];a.each(function(a){b.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+a.type.name+': </strong><abbr title="Type: '+a.type.name+'">'+a.value+"</abbr></small></div>")});
return b.join("")},_displayPriceMatchResult:function(a){var c,b,d,g,e;c=this;b=0;d=new Element("tbody");$H(a.companyPrices).each(function(a){0!==parseInt(a.value.price)&&(0===parseInt(b)&&0<parseFloat(a.value.price)||parseFloat(a.value.price)<parseFloat(b))&&(b=a.value.price);d.insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:3})).update(a.key)}).insert({bottom:(new Element("td")).update(a.value.priceURL&&!a.value.priceURL.blank()?(new Element("a",{href:a.value.priceURL,
target:"__blank"})).update(c.getCurrency(a.value.price)):c.getCurrency(a.value.price))})})});g=parseFloat(a.myPrice)-parseFloat(b);e="";0!==parseInt(b)&&(0<parseInt(g)?e="label label-danger":0>parseInt(g)&&(e="label label-success"));return(new Element("table",{"class":"table table-striped table-hover price-match-listing"})).insert({bottom:(new Element("thead")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("th")).update("SKU")}).insert({bottom:(new Element("th")).update("My Price")}).insert({bottom:(new Element("th",
{"class":"price_diff"})).update("Price Diff.")}).insert({bottom:(new Element("th")).update("Min Price")})})}).insert({bottom:(new Element("tbody")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td")).update(a.sku)}).insert({bottom:(new Element("td")).update(c.getCurrency(a.myPrice))}).insert({bottom:(new Element("td",{"class":"price_diff"})).update((new Element("span",{"class":""+e})).update(c.getCurrency(g)))}).insert({bottom:(new Element("td",{"class":"price_min"})).update(c.getCurrency(b))})})}).insert({bottom:(new Element("thead")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("th",
{colspan:3})).update("Company")}).insert({bottom:(new Element("th")).update("Price")})})}).insert({bottom:d})},_getInfoPanel:function(a){return(new Element("div",{id:"info_panel_"+a.id})).insert({bottom:(new Element("div",{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default price-match-div"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).update("<strong>Price Match</strong>")}).insert({bottom:(new Element("div",{"class":"panel-body price-match-listing"})).update(this.getLoadingImg())})})}).insert({bottom:(new Element("div",
{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default price-trend-div"})).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:new Element("iframe",{frameborder:"0",scrolling:"auto",width:"100%",height:"400px"})})})})}).insert({bottom:(new Element("div",{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-body"})).update("<h4>Reserved for Next Phase of Developing</h4>")})})}).insert({bottom:(new Element("div",
{"class":"col-md-6"})).insert({bottom:(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",{"class":"panel-body"})).update("<h4>Reserved for Next Phase of Developing</h4>")})})})},_showProductInfoOnRightPanel:function(a){var c,b,d;c=this;b=c._getInfoPanel(a);b.down(".price-trend-div iframe").writeAttribute("src","/statics/product/pricetrend.html?productid="+a.id);c.postAjax(c.getCallbackId("priceMatching"),{id:a.id},{onLoading:function(){b.down(".price-match-div .price-match-listing").replace((new Element("div",
{"class":"panel-body price-match-listing"})).update(c.getLoadingImg()))},onSuccess:function(b,e){try{(d=c.getResp(e,!1,!0))&&$("info_panel_"+a.id)&&$("info_panel_"+a.id).down(".price-match-div .price-match-listing").replace(c._displayPriceMatchResult(d))}catch(f){c.showModalBox("Error",f,!0)}}});return b},deSelectProduct:function(){jQuery(".product_item.success",jQuery("#"+this.resultDivId)).removeClass("success").popover("hide");$(this.resultDivId).up(".list-panel").removeClassName("col-xs-4").addClassName("col-xs-12");
jQuery(".hide-when-info",jQuery("#"+this.resultDivId)).show();this._showRightPanel=!1;return this},getResults:function(a,c,b){var d,g,e,f,h;d=this;g=a||!1;e=$(d.resultDivId);d.storeId=b?b:d.storeId;!0===g&&(d._pagination.pageNo=1);d._pagination.pageSize=c||d._pagination.pageSize;d.postAjax(d.getCallbackId("getItems"),{pagination:d._pagination,searchCriteria:d._searchCriteria},{onLoading:function(){jQuery("#"+d.searchDivId+" #searchBtn").button("loading");!0===g&&e.update((new Element("tr")).update((new Element("td")).update(d.getLoadingImg())))},
onSuccess:function(a,b){try{if(f=d.getResp(b,!1,!0))$(d.totalNoOfItemsId).update(f.pageStats.totalRows),!0===g&&e.update(d._getResultRow(d._getTitleRowData(),!0).wrap(new Element("thead"))),e.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(h=$(e).down("tbody"))||$(e).insert({bottom:h=new Element("tbody")}),f.items.each(function(a){h.insert({bottom:d._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)})}),!0!==d._singleProduct?f.pageStats.pageNumber<f.pageStats.totalPages&&
e.insert({bottom:d._getNextPageBtn().addClassName("paginWrapper")}):0<f.items.size()&&d._displaySelectedProduct(f.items[0])}catch(k){e.insert({bottom:d.getAlertBox("Error",k).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+d.searchDivId+" #searchBtn").button("reset")}})},_displaySelectedProduct:function(a){var c,b;c=this;$(c.resultDivId).up(".list-panel").removeClassName("col-xs-12").addClassName("col-xs-4");jQuery(".hide-when-info",jQuery("#"+c.resultDivId)).hide();c._showRightPanel=
!0;jQuery(".product_item.success",jQuery("#"+c.resultDivId)).removeClass("success").popover("hide");b=jQuery('[product_id="'+a.id+'"]',jQuery("#"+c.resultDivId)).addClass("success");b.hasClass("popover-loaded")||b.popover({title:'<div class="row"><div class="col-xs-10">Details for: '+a.sku+'</div><div class="col-xs-2"><span class="btn btn-danger pull-right btn-sm" onclick="pageJs.deSelectProduct();"><span class="glyphicon glyphicon-remove"></span></span></div></div>',html:!0,placement:"right",container:"body",
trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return c._showProductInfoOnRightPanel(a).wrap(new Element("div")).innerHTML},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded");b.popover("toggle");return c},_openProductDetails:function(a){window.open("/product/"+("new"==a?a:a.id)+".html","Product Details for: "+
a.sku,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no").focus()},toggleActive:function(a,c){var b,d;b=this;b.postAjax(b.getCallbackId("toggleActive"),{productId:c.id,active:a},{onSuccess:function(a,e){try{(d=b.getResp(e,!1,!0))&&d.item&&0<$$(".product_item[product_id="+c.id+"]").size()&&$$(".product_item[product_id="+c.id+"]").first().replace(b._getResultRow(d.item,!1))}catch(f){b.showModalBox("ERROR",f,!0)}}});return b},_getResultRow:function(a,
c){var b={me:this};b.tag=!0===b.isTitle?"th":"td";b.isTitle=c||!1;b.price="";a.prices&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)&&(b.price=a.price)});b.row=(new Element("tr",{"class":"visible-xs visible-md visible-lg visible-sm "+(!0===b.isTitle?"":"product_item"),product_id:a.id})).store("data",a).insert({bottom:(new Element(b.tag,{"class":"sku",title:a.name})).insert({bottom:(new Element("span",{style:"margin: 0 5px 0 0;"})).insert({bottom:(new Element("input",{type:"checkbox","class":"product-selected"})).observe("click",
function(){b.checked=this.checked;!0===b.isTitle&&$(b.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(a){a.checked=b.checked})})})}).insert({bottom:!0===b.isTitle?a.sku:(new Element("a",{href:"javascript: void(0);","class":"sku-link"})).update(a.sku)})}).insert({bottom:(new Element(b.tag,{"class":"product_name hidden-xs hide-when-info hidden-sm",style:b.me._showRightPanel?"display: none":""})).update(a.name)}).insert({bottom:(new Element(b.tag,{"class":"product_price hidden-xs hide-when-info hidden-sm",
style:b.me._showRightPanel?"display: none":""})).update(!0===b.isTitle?"Price":b.price.blank()?"":b.me.getCurrency(b.price))}).insert({bottom:(new Element(b.tag,{"class":"assetAccNo col-xs-1 hide-when-info"})).update(a.assetAccNo?a.assetAccNo:"")}).insert({bottom:(new Element(b.tag,{"class":"revenueAccNo col-xs-1 hide-when-info"})).update(a.revenueAccNo?a.revenueAccNo:"")}).insert({bottom:(new Element(b.tag,{"class":"costAccNo col-xs-1 hide-when-info"})).update(a.costAccNo?a.costAccNo:"")}).insert({bottom:(new Element(b.tag,
{"class":"product_active col-xs-1 hide-when-info hidden-sm"})).insert({bottom:!0===b.isTitle?a.active:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-4"})).insert({bottom:new Element("input",{type:"checkbox",disabled:!0,checked:a.active})})}).insert({bottom:1!=jQuery("#storeId").attr("value")?"":(new Element("div",{"class":"col-xs-8"})).insert({bottom:(new Element("div",{"class":"btn-group"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-xs"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-pencil"})})}).observe("click",function(c){Event.stop(c);b.me._openProductDetails(a)}).insert({bottom:!0===a.active?(new Element("span",{"class":"btn btn-danger btn-xs toggleActiveBtn"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(c){Event.stop(c);b.btn=this;confirm("You are about to deactivate this product.\n Continue?")&&b.me.toggleActive(!1,a)}):(new Element("span",{"class":"btn btn-success btn-xs toggleActiveBtn"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-repeat"})}).observe("click",function(c){Event.stop(c);b.btn=this;confirm("You are about to ReACTIVATE this product.\n Continue?")&&b.me.toggleActive(!0,a)})})})})})});1!==b.me.storeId&&jQuery(".toggleActiveBtn").hide();return b.row}});