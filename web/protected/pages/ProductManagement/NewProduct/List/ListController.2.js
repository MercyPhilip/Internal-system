var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{id:"ID",sku:"Sku",name:"Name",category:"Category",price:"Price",stock:"Stock Level",status:"Processing Status",localOnly:"Local Only"}},_loadNewProductStatuses:function(a){this.productStatuses=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productStatusIds"]'),b.me.productStatuses.each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.name)})}),this},_loadCategories:function(a){this.categories=a;var b={};return b.me=this,b.selectionBox=$(b.me.searchDivId).down('[search_field="pro.productCategoryIds"]'),b.me.categories.sort(function(a,b){return a.namePath>b.namePath}).each(function(a){b.selectionBox.insert({bottom:new Element("option",{value:a.id}).update(a.namePath)})}),this},_loadChosen:function(){return jQuery(".select2").select2({minimumResultsForSearch:1/0}),this},_bindSearchKey:function(){var a={};return a.me=this,$$("#searchBtn").first().observe("click",function(b){a.me.getSearchCriteria().getResults(!0,a.me._pagination.pageSize)}),$("searchPanel").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(b){a.me.keydown(b,function(){$(a.me.searchDivId).down("#searchBtn").click()})})}),this},genReport:function(a){var b={};return b.me=this,b.data={},$$("[search_field]").each(function(a){b.data[a.readAttribute("search_field")]=$F(a)}),b.me.postAjax(b.me.getCallbackId("genReportmBtn"),b.data,{onLoading:function(){jQuery(a).button("loading")},onSuccess:function(a,c){try{if(b.result=b.me.getResp(c,!1,!0),!b.result||!b.result.url)return;if(b.newWind=window.open(b.result.url),!b.newWind)throw'You browser is blocking the popup window, please click <a class="btn btn-xs btn-primary" href="'+b.result.url+'" target="__BLANK">here</a> to open it manually.'}catch(a){b.me.showModalBox("<b>Error:</b>",'<b class="text-danger">'+a+"</b>")}},onComplete:function(){jQuery(a).button("reset")}}),b.me},_getEditPanel:function(a){var b={};return b.me=this,b.categories="",a.product&&a.product.categories&&a.product.categories.each(function(a){b.categories=""==b.categories?a.name:b.categories+","+a.name}),b.price="",a.product&&a.product.prices&&a.product.prices.each(function(a){a.type&&1===parseInt(a.type.id)&&(b.price=a.price)}),b.newDiv=new Element("tr",{class:"save-item-panel info"}).store("data",a).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{disabled:!0,class:"form-control","save-item-panel":"id",value:a.id?a.id:""})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("div",{class:"col-sm-12"}).insert({bottom:new Element("input",{required:!0,disabled:!!a.id,class:"form-control input-sm ",placeholder:"The SKU","save-item-panel":"sku",value:a.product&&a.product.sku?a.product.sku:""})})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("div",{class:"col-sm-12"}).insert({bottom:new Element("input",{class:"form-control input-sm ",placeholder:"The Name","save-item-panel":"name",value:a.product&&a.product.name?a.product.name:""})})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{class:"chosen form-control input-sm",entityName:"ProductCategory",placeholder:"The Category","save-item-panel":"category",rowid:a.id?a.id:"",value:a.product&&a.product.categories?a.product.categories:""})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{class:"form-control",placeholder:"The Price",validate_currency:!0,"save-item-panel":"price",value:b.price?b.me._getCurrency(b.price):""})}).observe("change",function(){b.me._currencyInputChanged(b.newDiv.down("[save-item-panel=price]"))})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{class:"chosen form-control input-sm",entityName:"ProductStatus",placeholder:"The Stock Level","save-item-panel":"stock",value:a.product&&a.product.status?a.product.status.name:""})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{disabled:!a.id,class:"chosen form-control input-sm",entityName:"NewProductStatus",placeholder:"The Status","save-item-panel":"status",value:a.status&&a.status.name?a.status.name:""})})}).insert({bottom:new Element("td",{class:"form-group"}).insert({bottom:new Element("input",{type:"checkbox",disabled:!a.id,class:"chosen form-control input-sm","save-item-panel":"localOnly",checked:!1})})}).insert({bottom:new Element("td",{class:"text-right"}).insert({bottom:new Element("span",{class:"btn-group btn-group-sm"}).insert({bottom:new Element("span",{class:"btn btn-success",title:"Save"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-ok"})}).observe("click",function(){b.btn=this,b.data=b.me._saveItem(b.btn,$(b.btn).up(".save-item-panel"),"save-item-panel"),b.data&&jQuery(".tooltip")&&jQuery(".tooltip").remove()})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-remove"})}).observe("click",function(){a.id?$(this).up(".save-item-panel").replace(b.me._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)):$(this).up(".save-item-panel").remove(),jQuery(".tooltip")&&jQuery(".tooltip").remove()})})})}),b.newDiv},_getResultRow:function(a,b){var c={};return c.me=this,c.tag=!0===c.isTitle?"th":"td",c.isTitle=b||!1,c.categories="",a.product&&a.product.categories&&a.product.categories.each(function(a){c.categories=""==c.categories?a.name:c.categories+","+a.name}),c.price="",a.product&&a.product.prices&&a.product.prices.each(function(a){a.type&&1===parseInt(a.type.id)&&(c.price=a.price)}),c.row=new Element("tr",{class:!0===c.isTitle?"":"btn-hide-row"}).store("data",a).insert({bottom:new Element(c.tag,{class:"name"}).update((c.isTitle,a.id))}).insert({bottom:new Element(c.tag,{class:"name col-xs-1"}).update(!0===c.isTitle?a.sku:a.product.sku)}).insert({bottom:new Element(c.tag,{class:"name col-xs-3"}).update(!0===c.isTitle?a.name:a.product.name)}).insert({bottom:new Element(c.tag,{class:"name col-xs-3"}).update(!0===c.isTitle?a.category:c.categories)}).insert({bottom:new Element(c.tag,{class:"name col-xs-1"}).update(!0===c.isTitle?a.price:c.me._getCurrency(c.price))}).insert({bottom:new Element(c.tag,{class:"name col-xs-1"}).update(!0===c.isTitle?a.stock:a.product.status?a.product.status.name:"")}).insert({bottom:new Element(c.tag,{class:"name col-xs-1"}).update(!0===c.isTitle?a.status:a.status.name)}).insert({bottom:new Element(c.tag,{class:"name"}).update(!0===c.isTitle?a.localOnly:new Element("input",{disabled:!0,class:"localOnly",type:"checkbox",checked:a.product.localOnly}))}).insert({bottom:new Element(c.tag,{class:"text-right col-xs-1 "}).update(!0===c.isTitle?new Element("span",{class:"btn btn-primary btn-xs",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:c.newEditEl=c.me._getEditPanel({})}),c.newEditEl.down(".form-control[save-item-panel]").focus(),c.newEditEl.down(".form-control[save-item-panel]").select(),c.newEditEl.getElementsBySelector(".form-control[save-item-panel]").each(function(a){a.observe("keydown",function(a){return c.me.keydown(a,function(){c.newEditEl.down(".btn-success span").click()}),!1})}),c.me._loadSelectOptions(null,c.newEditEl)}):new Element("span",{class:"btn-group btn-group-xs"}).insert({bottom:new Element("span",{class:"btn btn-default",title:"Edit"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-pencil"})}).observe("click",function(){$(this).up(".item_row").replace(c.editEl=c.me._getEditPanel(a)),c.editEl.down(".form-control[save-item-panel]").focus(),c.editEl.down(".form-control[save-item-panel]").select(),c.editEl.getElementsBySelector(".form-control[save-item-panel]").each(function(a){a.observe("keydown",function(a){return c.me.keydown(a,function(){c.editEl.down(".btn-success span").click()}),!1})}),c.me._loadSelectOptions(a,c.editEl)})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to delete this item?"))return!1;c.me._deleteItem(a)})}).insert({bottom:new Element("a",{class:"btn btn-success",title:"Full Edit",href:"/product/"+a.product.id+".html",target:"_BLANK"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-edit"})})}))}),c.row},_deleteItem:function(a){var b={};return b.me=this,b.row=$(b.me.resultDivId).down("tbody").down(".item_row[item_id="+a.id+"]"),b.me.postAjax(b.me.getCallbackId("deleteItems"),{id:a.id},{onLoading:function(){b.row&&b.row.hide()},onSuccess:function(a,c){try{if(b.result=b.me.getResp(c,!1,!0),!b.result)return;b.count=1*$(b.me.totalNoOfItemsId).innerHTML-1,$(b.me.totalNoOfItemsId).update(b.count<=0?0:b.count),b.row&&b.row.remove()}catch(a){b.me.showModalBox('<span class="text-danger">ERROR</span>',a,!0),b.row&&b.row.show()}}}),b.me},_getCurrency:function(a,b,c,d,e){var f={};return f.decimal=isNaN(c=Math.abs(c))?2:c,f.dollar=void 0==b?"$":b,f.decimalPoint=void 0==d?".":d,f.thousandPoint=void 0==e?",":e,f.sign=a<0?"-":"",f.Int=parseInt(a=Math.abs(+a||0).toFixed(f.decimal))+"",f.j=(f.j=f.Int.length)>3?f.j%3:0,f.dollar+f.sign+(f.j?f.Int.substr(0,f.j)+f.thousandPoint:"")+f.Int.substr(f.j).replace(/(\d{3})(?=\d)/g,"$1"+f.thousandPoint)+(f.decimal?f.decimalPoint+Math.abs(a-f.Int).toFixed(f.decimal).slice(2):"")},_getValueFromCurrency:function(a){return a?(a+"").replace(/\s*/g,"").replace(/\$/g,"").replace(/,/g,""):""},_markFormGroupError:function(a,b){var c={};return c.me=this,a.up(".form-group")&&(a.store("clearErrFunc",function(b){a.up(".form-group").removeClassName("has-error"),jQuery("#"+a.id).tooltip("hide").tooltip("destroy").show()}).up(".form-group").addClassName("has-error"),c.me._signRandID(a),jQuery("#"+a.id).tooltip({trigger:"manual",placement:"auto",container:"body",placement:"bottom",html:!0,title:b,content:b}).tooltip("show"),$(a).observe("change",function(){c.func=$(a).retrieve("clearErrFunc"),"function"==typeof c.func&&c.func()})),c.me},_currencyInputChanged:function(a){var b={};return b.me=this,!$F(a).blank()&&(b.inputValue=b.me._getValueFromCurrency($F(a)),null===b.inputValue.match(/^(-)?\d+(\.\d{1,4})?$/)?(b.me._markFormGroupError(a,"Invalid currency format provided!"),!1):($(a).value=b.me._getCurrency(b.inputValue),!0))},_loadSelectOptions:function(a,b){var c={};c.me=this;var d=b.down('.chosen[save-item-panel="category"]'),e=b.down('.chosen[save-item-panel="status"]'),f=b.down('.chosen[save-item-panel="stock"]');return c.me._signRandID(d),c.me._signRandID(e),c.me._signRandID(f),jQuery("#"+d.id).select2({multiple:!0,allowClear:!0,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,type:"POST",data:function(a,b){return{searchTxt:"name like ?",searchParams:["%"+a+"%"],entityName:"ProductCategory",pageNo:b}},results:function(a,b,d){return c.result=[],a.resultData&&a.resultData.items&&a.resultData.items.each(function(a){c.result.push({id:a.id,text:a.name,data:a})}),{results:c.result,more:a.resultData&&a.resultData.pagination&&a.resultData.pagination.totalPages&&b<a.resultData.pagination.totalPages}},cache:!0},formatResult:function(a){return a?'<div class="row"><div class="col-xs-12">'+a.data.namePath+"</div></div>":""},formatSelection:function(a){return a?(c.text=a.text,c.newDiv=new Element("div").update(c.text),c.newDiv):""},escapeMarkup:function(a){return a}}),jQuery("#"+e.id).select2({multiple:!1,allowClear:!0,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,type:"POST",data:function(a,b){return{searchTxt:"name like ?",searchParams:["%"+a+"%"],entityName:"NewProductStatus",pageNo:b}},results:function(a,b,d){return c.result=[],a.resultData&&a.resultData.items&&a.resultData.items.each(function(a){c.result.push({id:a.id,text:a.name,data:a})}),{results:c.result,more:a.resultData&&a.resultData.pagination&&a.resultData.pagination.totalPages&&b<a.resultData.pagination.totalPages}},cache:!0},formatResult:function(a){return a?'<div class="row"><div class="col-xs-12">'+a.data.name+"</div></div>":""},formatSelection:function(a){return a?(c.text=a.text,c.newDiv=new Element("div").update(c.text),c.newDiv):""},escapeMarkup:function(a){return a}}),jQuery("#"+f.id).select2({multiple:!1,allowClear:!0,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,type:"POST",data:function(a,b){return{searchTxt:"name like ? and id in (2,4,5,8)",searchParams:["%"+a+"%"],entityName:"ProductStatus",pageNo:b}},results:function(a,b,d){return c.result=[],a.resultData&&a.resultData.items&&a.resultData.items.each(function(a){c.result.push({id:a.id,text:a.name,data:a})}),{results:c.result,more:a.resultData&&a.resultData.pagination&&a.resultData.pagination.totalPages&&b<a.resultData.pagination.totalPages}},cache:!0},formatResult:function(a){return a?'<div class="row"><div class="col-xs-12">'+a.data.name+"</div></div>":""},formatSelection:function(a){return a?(c.text=a.text,c.newDiv=new Element("div").update(c.text),c.newDiv):""},escapeMarkup:function(a){return a}}),a&&(a.product&&a.product.categories&&(c.categories=[],a.product.categories.each(function(a){c.categories.push({id:a.id,text:a.name})}),jQuery("#"+d.id).select2("data",c.categories)),a.status&&jQuery("#"+e.id).select2("data",{id:a.status.id,text:a.status.name}),a.product&&a.product.status&&jQuery("#"+f.id).select2("data",{id:a.product.status.id,text:a.product.status.name})),c.me}});