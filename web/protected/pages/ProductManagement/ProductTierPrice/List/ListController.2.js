var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],productCategories:[],_tierLevels:[],_tierPriceTypes:[],_nextPageColSpan:9,_tierPriceRule:null,_autoLoading:!1,_postIndex:null,_selected:null,newRuleResultContainerId:"new_rule_result_container",_getTitleRowData:function(){return{sku:"SKU",manufacturer:{name:"Brand"},category:{name:"Category"},tier:"Tier Price"}},setPreData:function(a,c){this._tierLevels=a;this._tierPriceTypes=c;return this},_loadManufactures:function(a){this.manufactures=a;
var c;c=$(this.searchDivId).down('[search_field="pro.manufacturerIds"]');this.manufactures.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});return this},_loadCategories:function(a){this.categories=a;var c;c=$(this.searchDivId).down('[search_field="pro.productCategoryIds"]');this.categories.sort(function(b,a){return b.namePath>a.namePath}).each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.namePath)})});return this},_loadProductStatuses:function(a){this.productStatuses=
a;var c;c=$(this.searchDivId).down('[search_field="pro.productStatusIds"]');this.productStatuses.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});return this},_loadSuppliers:function(a){this.suppliers=a;var c;c=$(this.searchDivId).down('[search_field="pro.supplierIds"]');this.suppliers.each(function(b){c.insert({bottom:(new Element("option",{value:b.id})).update(b.name)})});return this},_loadChosen:function(){jQuery(".chosen").select2({minimumResultsForSearch:Infinity});
return this},_bindSearchKey:function(){var a;a=this;$$("#searchBtn").first().observe("click",function(c){a._tickAll=!1;a.getSearchCriteria().getResults(!0,a._pagination.pageSize)});$("searchDiv").getElementsBySelector("[search_field]").each(function(c){c.observe("keydown",function(b){a.keydown(b,function(){$(a.searchDivId).down("#searchBtn").click()})})});return this},_bindNewRuleBtn:function(a,c){var b,e,d,f,g,h;b=this;e=c||null;d=a||$("newRuleBtn");b.observeClickNDbClick(d,function(){f=b._getSelection();
g=$("total-found-count").innerHTML;null===e&&null!==f&&0<f.length?(h=(new Element("div")).insert({bottom:(new Element("h3",{"class":"col-lg-12"})).update("only <b>"+f.length+"</b> out of <b>"+g+"</b> is selected, Contrinue?")}).insert({bottom:(new Element("i",{"class":"btn btn-danger btn-lg"})).update("No").observe("click",function(){b.hideModalBox()})}).insert({bottom:(new Element("i",{"class":"btn btn-success btn-lg pull-right"})).update("Yes").setStyle(0===f.length?"display: none;":"").observe("click",
function(){jQuery("#select2-drop-mask").select2("close");$(this).up(".modal-body").update("").insert({bottom:b._getTierPriceRuleEl(null,f)}).insert({bottom:new Element("div",{"class":"row",id:b.newRuleResultContainerId})})})}),b.showModalBox("Tier Price Rule",h,!1,null,null,!0)):e&&jQuery.isNumeric(e.id)},null);return b},_getTierPriceRuleEl:function(a,c){var b,e,d;b=this;e=a||null;d=c||null;return(new Element("div",{"class":""})).insert({bottom:(new Element("div",{"class":"col-xs-12"})).insert({bottom:(new Element("div",
{"class":"form-group col-xs-12"})).insert({bottom:(new Element("span",{"class":"tierrule"})).insert({bottom:b._getListPanel("TierPrice:",[],{tier:"TierLevel",quantity:"Quantity",type:"TierPriceType",value:"value"},b._tierPriceTypes,b._tierLevels).wrap(new Element("div",{"class":"tierprices-panel"}))})})})}).insert({bottom:(new Element("div",{"class":"col-xs-12 text-right"})).insert({bottom:(new Element("i",{"class":"btn btn-sm btn-success btn-new-rule right-panel"})).update("Confirm").observe("click",
function(a){b._tierPriceRule=b._collectFormData($(this).up(".modal-body"),"list-panel-row","list-item");b._selected=null===e?d:e;b._postIndex=0;b.postNewRule($(this))})}).insert({bottom:(new Element("i",{"class":"btn btn-sm btn-danger btn-del-rule right-panel"})).update('<i class="glyphicon glyphicon-trash"></i>').observe("click",function(a){b._tierPriceRule=b._collectFormData($(this).up(".modal-body"),"list-panel-row","list-item");b._selected=null===e?d:e;b._postIndex=0;b.postNewRule($(this),!0)})})})},
postNewRule:function(a,c){var b,e,d,f,g;b=this;e=a||null;d=c||!1;null!==e&&b._signRandID(e);active=!0===d?!1:!0;b._selected[b._postIndex]?(window.onbeforeunload=function(){return"Processing... Please Do not close"},(f=$(b.modalId))&&f.down(".modal-header").update('<h4 style="color:red;">Processing... Please Do NOT close</h4>'),b.postAjax(b.getCallbackId("newRule"),{productId:b._selected[b._postIndex].id,rule:b._tierPriceRule,active:active},{onLoading:function(){null!==e&&jQuery(".right-panel.btn").button("loading")},
onSuccess:function(a,c){try{(g=b.getResp(c,!1,!0))&&$(b.newRuleResultContainerId).insert({bottom:(new Element("d",{"class":"col-xs-9"})).update(b._selected[b._postIndex].sku)}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update("done")})}catch(e){$(b.newRuleResultContainerId).insert({top:b.getAlertBox("",e).addClassName("alert-danger col-xs-12").insert({top:(new Element("b",{"class":"col-xs-12"})).update("SKU: "+b._selected[b._postIndex].sku)})})}},onComplete:function(){window.onbeforeunload=
null;null!==e&&jQuery(".right-panel.btn").button("reset");b._postIndex+=1;b.postNewRule(e,d)}})):($(b.newRuleResultContainerId).insert({top:(new Element("div",{"class":"col-xs-12"})).update("All Done!")}),b.hideModalBox(),jQuery("#"+b.modalId).remove(),$("searchBtn").click())},getResults:function(a,c,b,e){var d,f,g,h,k,l,n;d=this;f=a||!1;g=b||!1;h=$(d.resultDivId);!0===f&&(d._pagination.pageNo=1);!0===g&&0<$$(".btn-show-more").length&&(d._autoLoading=!0,d._pagination.pageNo=1*d._pagination.pageNo+
1);d._pagination.pageSize=c||d._pagination.pageSize;d.postAjax(d.getCallbackId("getItems"),{pagination:d._pagination,searchCriteria:d._searchCriteria},{onLoading:function(){jQuery("#"+d.searchDivId+" .btn").button("loading");jQuery("#"+d.searchDivId+" input").prop("disabled",!0);jQuery("#"+d.searchDivId+" select").prop("disabled",!0);!0===f&&h.update((new Element("tr")).update((new Element("td")).update(d.getLoadingImg())))},onSuccess:function(b,a){try{if(k=d.getResp(a,!1,!0))$(d.totalNoOfItemsId).update(k.pageStats.totalRows),
!0===f&&h.update(d._getResultRow(d._getTitleRowData(),!0).wrap(new Element("thead"))),h.getElementsBySelector(".paginWrapper").each(function(b){b.remove()}),(l=$(h).down("tbody"))||$(h).insert({bottom:l=new Element("tbody")}),k.items.each(function(b){l.insert({bottom:n=d._getResultRow(b).addClassName("item_row").writeAttribute("item_id",b.id)});d._tickAll&&n.down(".product-selected").click()}),!0!==d._singleProduct&&k.pageStats.pageNumber<k.pageStats.totalPages&&h.insert({bottom:d._getNextPageBtn().addClassName("paginWrapper")}),
!0===g&&0<$$(".btn-show-more").length?d.getResults(!1,d._pagination.pageSize,!0):(d._autoLoading=!1,d.hideModalBox(),jQuery("#"+d.searchDivId+" .btn").button("reset"),jQuery("#"+d.searchDivId+" input").prop("disabled",!1),jQuery("#"+d.searchDivId+" select").prop("disabled",!1)),d._getSelection()}catch(c){h.insert({bottom:d.getAlertBox("Error",c).addClassName("alert-danger")})}},onComplete:function(){!0!==g&&(jQuery("#"+d.searchDivId+" .btn").button("reset"),jQuery("#"+d.searchDivId+" input").prop("disabled",
!1),jQuery("#"+d.searchDivId+" select").prop("disabled",!1))}})},_getNextPageBtn:function(){var a,c;a=this;c=$("total-found-count").innerHTML;return(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:a._nextPageColSpan,"class":"text-center"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-show-more","data-loading-text":"Fetching more results ..."})).update("Next Page").observe("click",function(){a._pagination.pageNo=1*a._pagination.pageNo+
1;jQuery(this).button("loading");a.getResults(!1,a._pagination.pageSize,!1,!0)})}).insert({bottom:(new Element("span",{"class":"btn btn-warning btn-show-more","data-loading-text":"Fetching more results ..."})).update("<b>Show ALL Pages</b>").setStyle("margin-left: 10px; color: black;").observe("click",function(){1E3<c?a.showModalBox("Warning","<h3>There are "+c+" products for current search conditions. <br/>Please narrow down the search"):a.getResults(!1,a._pagination.pageSize,!0)})})})})},_getTierPrices:function(a){var c,
b,e,d;c=this;tiers=a.tierprices;unitCost=0!=a.totalOnHandValue&&0!=a.stockOnHand?a.totalOnHandValue/a.stockOnHand:0;e=b="";warning=!1;a.prices&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)?b=Number(a.price):a.type&&2===parseInt(a.type.id)||a.type&&7===parseInt(a.type.id)&&(e=Number(a.price))});if(!tiers||!unitCost)return"";d=[];tiers.each(function(a){warning=!1;tierPrice=1==a.tierPriceType.id?Number(1.1*(a.value/100*unitCost+unitCost)).toFixed(2):Number(a.value).toFixed(2);e&&tierPrice>
e&&(warning=!0);b&&tierPrice>b&&(warning=!0);d.push("<div "+(warning?'style="color : red;"':"")+'><small><strong class="hidden-xs hide-when-info hidden-sm">'+a.tierLevel.name+": </strong>"+c.getCurrency(tierPrice)+': <abbr title="Quantity" >'+(0<a.quantity?a.quantity:"")+" </abbr></small></div>")});return d.join("")},_getTierPriceRules:function(a){var c;if(!a)return"";c=[];a.each(function(b){c.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+b.tierLevel.name+': </strong><abbr title="Type: '+
b.tierPriceType.name+'">'+Number(b.value).toFixed(2)+': </abbr><abbr title="Quantity" >'+(0<b.quantity?b.quantity:"")+" </abbr></small></div>")});return c.join("")},_getSelection:function(){var a,c,b;a=[];$("item-list").getElementsBySelector(".product_item.item_row").each(function(e){c=e.down('input.product-selected[type="checkbox"]').checked;b=e.readAttribute("product_id");!0===c&&!0===jQuery.isNumeric(b)&&a.push(e.retrieve("data"))});$("total-selected-count").update(a.length);return a},_getResultRow:function(a,
c){var b={me:this};b.tag=!0===b.isTitle?"th":"td";b.isTitle=c||!1;b.categories="";a.categories&&a.categories.each(function(a){b.categories=""==b.categories?a.name:b.categories+";"+a.name});b.price="";b.specilaPrice="";b.srp="";a.prices&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)?b.price=a.price:a.type&&2===parseInt(a.type.id)?b.specilaPrice=a.price:a.type&&7===parseInt(a.type.id)&&(b.srp=a.price)});b.row=(new Element("tr",{"class":!0===b.isTitle?"":"product_item btn-hide-row",product_id:a.id})).store("data",
a).insert({bottom:(new Element(b.tag,{"class":"sku",title:a.name})).addClassName("col-xs-1").insert({bottom:(new Element("span")).setStyle("margin: 0 5px 0 0").insert({bottom:(new Element("input",{type:"checkbox","class":"product-selected"})).observe("click",function(a){b.checked=this.checked;!0===b.isTitle&&(b.me._tickAll=b.checked,$(b.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(a){a.checked=b.checked}));b.me._getSelection()})})}).insert({bottom:!0===b.isTitle?
a.sku:(new Element("a",{href:"/product/"+a.id+".html",target:"_BLANK","class":"sku-link truncate"})).update(a.sku)})}).insert({bottom:(new Element(b.tag,{"class":"manufacturer hidden-xs hide-when-info hidden-sm",style:"width:5%"})).addClassName("col-xs-1").update(a.manufacturer?a.manufacturer.name:"")}).insert({bottom:(new Element(b.tag,{"class":"category"})).addClassName("col-xs-2").update(!0===b.isTitle?(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12"})).update("Category")}):
(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12"})).update(b.categories)}))}).insert({bottom:(new Element(b.tag,{"class":"prices"})).addClassName("col-xs-3").update(!0===b.isTitle?(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).update("SOH")}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update("RRP(Inc)")}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update("Cost(Ex)")}).insert({bottom:(new Element("div",
{"class":"col-xs-4"})).update("Tier Prices(Inc)")}):(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).update(a.stockOnHand)}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update(b.srp?b.me.getCurrency(b.srp):b.me.getCurrency(b.price))}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update(0!=a.totalOnHandValue&&0!=a.stockOnHand?b.me.getCurrency(a.totalOnHandValue/a.stockOnHand):"N/A")}).insert({bottom:(new Element("div",{"class":"col-xs-4"})).update(b.me._getTierPrices(a))}))}).insert({bottom:(new Element(b.tag,
{"class":"stock"})).addClassName("col-xs-4").update(!0===b.isTitle?(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12"})).update("Tier Price Rules")}):(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12"})).update(b.me._getTierPriceRules(a.tierprices))}))}).insert({bottom:(new Element(b.tag,{"class":"text-right col-xs-1 "})).update(!0===b.isTitle?"":(new Element("span",{"class":"btn-group btn-group-xs"})).insert({bottom:(new Element("span",
{"class":"btn btn-default",title:"Edit"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){$(this).up(".item_row").replace(b.editEl=b.me._getEditPanel(a));b.editEl.getElementsBySelector(".form-control[save-item-panel]").each(function(a){a.observe("keydown",function(a){b.me.keydown(a,function(){b.editEl.down(".btn-success span").click()});return!1})})})}).insert({bottom:(new Element("span",{"class":"btn btn-danger",title:"Delete"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to delete this item?"))return!1;b.me._deleteItem(a)})}))});return b.row},_getEditPanel:function(a){var c,b,e,d,f,g;c=this;b="";a.categories&&a.categories.each(function(a){b=""==b?a.name:b+";"+a.name});d=e="";a.prices&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)?e=a.price:a.type&&2===parseInt(a.type.id)||!a.type||7!==parseInt(a.type.id)||(d=a.price)});return(new Element("tr",{"class":"save-item-panel info"})).store("data",
a).insert({bottom:(new Element("td",{"class":"form-group col-xs-1 "})).insert({bottom:(new Element("span",{"class":" productId"})).update(a.sku)}).insert({bottom:new Element("input",{"class":"",type:"hidden","save-item-panel":"id",value:a.id?a.id:""})})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-1 hidden-xs hide-when-info hidden-sm "})).insert({bottom:(new Element("span",{"class":"brand"})).update(a.manufacturer?a.manufacturer.name:"")})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-2"})).insert({bottom:(new Element("span",
{"class":"row category"})).update(b)})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-3"})).insert({bottom:(new Element("div",{"class":"row prices"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).update(a.stockOnHand)}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update(d?c.getCurrency(d):c.getCurrency(e))}).insert({bottom:(new Element("div",{"class":"col-xs-3"})).update(0!=a.totalOnHandValue&&0!=a.stockOnHand?c.getCurrency(a.totalOnHandValue/a.stockOnHand):
"N/A")}).insert({bottom:(new Element("div",{"class":"col-xs-4"})).update(c._getTierPrices(a))})})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-4"})).insert({bottom:(new Element("span",{"class":"tierrule"})).insert({bottom:c._getListPanel("TierPrice:",a.tierprices,{tier:"TierLevel",quantity:"Quantity",type:"TierPriceType",value:"value"},c._tierPriceTypes,c._tierLevels).wrap(new Element("div",{"class":"tierprices-panel"}))})})}).insert({bottom:(new Element("td",{"class":"form-group text-right col-xs-1"})).insert({bottom:(new Element("span",
{"class":"btn-group btn-group-sm"})).insert({bottom:(new Element("span",{"class":"btn btn-success",title:"Save"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}).observe("click",function(){f=this;(g=c._saveItem(f,$(f).up(".save-item-panel"),"save-item-panel"))&&jQuery(".tooltip")&&jQuery(".tooltip").remove()})}).insert({bottom:(new Element("span",{"class":"btn btn-danger",title:"Delete"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",
function(){a.id?$(this).up(".save-item-panel").replace(c._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)):$(this).up(".save-item-panel").remove();jQuery(".tooltip")&&jQuery(".tooltip").remove()})})})})},_getSelBox:function(a,c){var b;b=new Element("select");a.each(function(a){b.insert({bottom:(new Element("option",{value:a.id,selected:c&&a.id===c?!0:!1})).update(a.name)})});return b},_getListPanelRow:function(a,c,b,e,d,f){var g,h,k,l,n,m;d=d||!1;g=!0===d?"th":"td";h=e.tier.charAt(0).toLowerCase()+
e.tier.slice(1);k=e.quantity.toLowerCase();l=e.type.charAt(0).toLowerCase()+e.type.slice(1);n=e.value.toLowerCase();m="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now();k=(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("input",{type:"number","class":"form-control","list-panel-row":"quantity",value:0<Number(a[k])?a[k]:""})).writeAttribute("list-item",a.id?a.id:m)}).observe("click",function(a){$(this).down("input").select()});c=(new Element("tr")).insert({bottom:(new Element(g)).setStyle("width: 20%").update(!0===
d?e.tier:this._getSelBox(b,a[h]&&a[h].id?a[h].id:"").addClassName("form-control input-sm ").writeAttribute("list-panel-row","tierId").writeAttribute("required",!0).writeAttribute("list-item",a.id?a.id:m).observe("change",function(a){"function"===typeof f&&f(a)}).wrap(new Element("div",{"class":"form-group"})))}).insert({bottom:(new Element(g)).setStyle("width: 20%").update(!0===d?e.quantity:k.wrap(new Element("div",{"class":"form-group"})))}).insert({bottom:(new Element(g)).setStyle("width: 30%").update(!0===
d?e.type:this._getSelBox(c,a[l]&&a[l].id?a[l].id:"").addClassName("form-control input-sm ").writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",a.id?a.id:m).observe("change",function(a){"function"===typeof f&&f(a)}).wrap(new Element("div",{"class":"form-group"})))});a.id&&c.insert({bottom:(new Element("input",{type:"hidden","class":"form-control","list-panel-row":"id",value:a.id})).writeAttribute("list-item",a.id?a.id:m)});k=(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("input",
{type:"text","class":"form-control","list-panel-row":"value",required:!0,value:a[n]?Number(a[n]).toFixed(2):""})).writeAttribute("list-item",a.id?a.id:m)}).insert({bottom:(new Element("input",{type:"hidden","class":"form-control","list-panel-row":"active",value:"1"})).writeAttribute("list-item",a.id?a.id:m)}).insert({bottom:(new Element("span",{"class":"btn btn-danger input-group-addon"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){a.id?($(this).up(".input-group").down("[list-panel-row=active]").value=
"0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):$(this).up(".list-panel-row").remove()})});c.insert({bottom:(new Element(g)).update(!0===d?e.value:k.wrap(new Element("div",{"class":"form-group"})))});return c},_getListPanel:function(a,c,b,e,d,f){var g,h,k,l;g=this;a=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-xs pull-right",title:"New"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){h=$(this).up(".panel");k={};h.down(".table tbody").insert({bottom:g._getListPanelRow(k,e,d,b,!1,f).addClassName("list-panel-row").writeAttribute("item_id","")});h.down(".list-div").show()})}).insert({bottom:(new Element("div",{"class":"list-div table-responsive"})).insert({bottom:(new Element("table",{"class":"table table-condensed",style:"width : auto"})).insert({bottom:(new Element("thead")).update(g._getListPanelRow(b,
e,d,b,!0,f))}).insert({bottom:l=new Element("tbody")})})});c&&c.each(function(a){l.insert({bottom:g._getListPanelRow(a,e,d,b,!1,f).addClassName("list-panel-row").writeAttribute("item_id",a.id)})});return a},_saveItem:function(a,c,b){var e,d,f,g,h;e=this;d=e._collectFormData(c,b);if(null!==d&&(d.tierprices=e._collectFormData(c.down(".tierprices-panel"),"list-panel-row","list-item"),null!==d.tierprices))return e.postAjax(e.getCallbackId("saveItem"),{item:d},{onLoading:function(){d.id&&c.addClassName("item_row").writeAttribute("item_id",
d.id);c.hide()},onSuccess:function(a,b){try{(f=e.getResp(b,!1,!0))&&f.item&&(g=$(e.resultDivId).down("tbody").down(".item_row[item_id="+f.item.id+"]"),h=e._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",f.item.id),g?g.replace(h):(c.remove(),$(e.resultDivId).down("tbody").insert({top:h}),$(e.totalNoOfItemsId).update(1*$(e.totalNoOfItemsId).innerHTML+1)))}catch(d){e.showModalBox('<span class="text-danger">ERROR:</span>',d,!0),c.show()}}}),e},_deleteItem:function(a){var c,b,e,
d;c=this;b=$(c.resultDivId).down("tbody").down(".item_row[item_id="+a.id+"]");c.postAjax(c.getCallbackId("deleteItems"),{id:a.id},{onLoading:function(){b&&b.hide()},onSuccess:function(a,g){try{(e=c.getResp(g,!1,!0))&&e.item&&(d=c._getResultRow(e.item).addClassName("item_row").writeAttribute("item_id",e.item.id),b&&b.replace(d))}catch(h){c.showModalBox('<span class="text-danger">ERROR</span>',h,!0),b&&b.show()}}});return c},clearAll:function(a){var c,b,e,d,f;c=this;reset=!0;pageSize=c._pagination.pageSize;
b=reset||!1;e=$(c.resultDivId);confirm("You are about to clear all tier prices.\n Continue?")&&(!0===b&&(c._pagination.pageNo=1),c._pagination.pageSize=pageSize||c._pagination.pageSize,c.postAjax(c.getCallbackId("clearAllBtn"),{pagination:c._pagination,searchCriteria:c._searchCriteria},{onLoading:function(){jQuery("#"+c.searchDivId+" #searchBtn").button("loading");!0===b&&e.update((new Element("tr")).update((new Element("td")).update(c.getLoadingImg())))},onSuccess:function(a,h){try{if(d=c.getResp(h,
!1,!0))$(c.totalNoOfItemsId).update(d.pageStats.totalRows),!0===b&&(e.update(c._getResultRow(c._getTitleRowData(),!0).wrap(new Element("thead"))),d.items&&0!==d.items.size()||e.insert({bottom:c.getAlertBox("Nothing found.","").addClassName("alert-warning")})),e.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(f=$(e).down("tbody"))||$(e).insert({bottom:f=new Element("tbody")}),d.items.each(function(a){f.insert({bottom:c._getResultRow(a).addClassName("item_row").writeAttribute("item_id",
a.id)})}),d.pageStats.pageNumber<d.pageStats.totalPages&&e.insert({bottom:c._getNextPageBtn().addClassName("paginWrapper")})}catch(k){e.insert({bottom:c.getAlertBox("Error",k).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+c.searchDivId+" #searchBtn").button("reset")}}))}});