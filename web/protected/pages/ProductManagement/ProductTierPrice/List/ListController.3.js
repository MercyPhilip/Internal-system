var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],productCategories:[],_tierLevels:[],_tierPriceTypes:[],_nextPageColSpan:9,_tierPriceRule:null,_autoLoading:!1,_postIndex:null,_selected:null,newRuleResultContainerId:"new_rule_result_container",_getTitleRowData:function(){return{sku:"SKU",category:{name:"Category"},manufacturer:{name:"Brand"},tier:"Tier Price"}},setPreData:function(e,t){return this._tierLevels=e,this._tierPriceTypes=t,this},_loadManufactures:function(e){this.manufactures=e;var t={};return t.me=this,t.selectionBox=$(t.me.searchDivId).down('[search_field="pro.manufacturerIds"]'),t.me.manufactures.each(function(e){t.selectionBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},_loadCategories:function(e){this.categories=e;var t={};return t.me=this,t.selectionBox=$(t.me.searchDivId).down('[search_field="pro.productCategoryIds"]'),t.me.categories.sort(function(e,t){return e.namePath>t.namePath}).each(function(e){t.selectionBox.insert({bottom:new Element("option",{value:e.id}).update(e.namePath)})}),this},_loadProductStatuses:function(e){this.productStatuses=e;var t={};return t.me=this,t.selectionBox=$(t.me.searchDivId).down('[search_field="pro.productStatusIds"]'),t.me.productStatuses.each(function(e){t.selectionBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},_loadSuppliers:function(e){this.suppliers=e;var t={};return t.me=this,t.selectionBox=$(t.me.searchDivId).down('[search_field="pro.supplierIds"]'),t.me.suppliers.each(function(e){t.selectionBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},_loadChosen:function(){return jQuery(".chosen").select2({minimumResultsForSearch:1/0}),this},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(t){e.me._tickAll=!1,e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize)}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$(e.me.searchDivId).down("#searchBtn").click()})})}),this},_bindNewRuleBtn:function(e,t){var n={};return n.me=this,n.product=t||null,n.btn=e||$("newRuleBtn"),n.me.observeClickNDbClick(n.btn,function(){n.selected=n.me._getSelection(),n.totalQty=$("total-found-count").innerHTML,null===n.product&&null!==n.selected&&n.selected.length>0?(n.tierLayer=new Element("div").insert({bottom:new Element("h3",{class:"col-lg-12"}).update("only <b>"+n.selected.length+"</b> out of <b>"+n.totalQty+"</b> is selected, Contrinue?")}).insert({bottom:new Element("i",{class:"btn btn-danger btn-lg"}).update("No").observe("click",function(){n.me.hideModalBox()})}).insert({bottom:new Element("i",{class:"btn btn-success btn-lg pull-right"}).update("Yes").setStyle(0===n.selected.length?"display: none;":"").observe("click",function(){jQuery("#select2-drop-mask").select2("close"),jQuery("#"+n.me.modalId).on("hidden.bs.modal",function(){jQuery(".tooltip")&&jQuery(".tooltip").remove()}),$(this).up(".modal-body").update("").insert({bottom:n.ruleContainer=n.me._getTierPriceRuleEl(null,n.selected)}).insert({bottom:new Element("div",{class:"row",id:n.me.newRuleResultContainerId})})})}),n.me.showModalBox("Tier Price Rule",n.tierLayer,!1,null,null,!0)):n.product&&jQuery.isNumeric(n.product.id)},null),n.me},_getTierPriceRuleEl:function(e,t){var n={};return n.me=this,n.product=e||null,n.selected=t||null,n.newDiv=new Element("div",{class:""}).insert({bottom:new Element("div",{class:"col-xs-12"}).insert({bottom:new Element("div",{class:"form-group col-xs-12"}).insert({bottom:new Element("span",{class:"tierrule"}).insert({bottom:n.me._getListPanel("TierPrice:",[],{tier:"TierLevel",quantity:"Quantity",type:"TierPriceType",value:"value"},n.me._tierPriceTypes,n.me._tierLevels).wrap(new Element("div",{class:"tierprices-panel"}))})})})}).insert({bottom:new Element("div",{class:"col-xs-12 text-right"}).insert({bottom:new Element("i",{class:"btn btn-sm btn-success btn-new-rule right-panel"}).update("Confirm").observe("click",function(e){n.me._tierPriceRule=n.me._collectFormData($(this).up(".modal-body"),"list-panel-row","list-item"),null!=n.me._tierPriceRule&&(n.me._selected=null===n.product?n.selected:n.product,n.me._postIndex=0,n.me.postNewRule($(this)))})}).insert({bottom:new Element("i",{class:"btn btn-sm btn-danger btn-del-rule right-panel"}).update('<i class="glyphicon glyphicon-trash"></i>').observe("click",function(e){n.me._tierPriceRule=n.me._collectFormData($(this).up(".modal-body"),"list-panel-row","list-item"),n.me._selected=null===n.product?n.selected:n.product,n.me._postIndex=0,n.me.postNewRule($(this),!0)})})}),n.newDiv},postNewRule:function(e,t){var n={};n.me=this,n.btn=e||null,n.del=t||!1,null!==n.btn&&n.me._signRandID(n.btn),active=!0!==n.del,n.me._selected[n.me._postIndex]?(window.onbeforeunload=function(){return"Processing... Please Do not close"},n.ModalBox=$(n.me.modalId),n.ModalBox&&n.ModalBox.down(".modal-header").update('<h4 style="color:red;">Processing... Please Do NOT close</h4>'),n.me.postAjax(n.me.getCallbackId("newRule"),{productId:n.me._selected[n.me._postIndex].id,rule:n.me._tierPriceRule,active:active},{onLoading:function(){null!==n.btn&&jQuery(".right-panel.btn").button("loading")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;$(n.me.newRuleResultContainerId).insert({bottom:new Element("d",{class:"col-xs-9"}).update(n.me._selected[n.me._postIndex].sku)}).insert({bottom:new Element("div",{class:"col-xs-3"}).update("done")})}catch(e){$(n.me.newRuleResultContainerId).insert({top:n.me.getAlertBox("",e).addClassName("alert-danger col-xs-12").insert({top:new Element("b",{class:"col-xs-12"}).update("SKU: "+n.me._selected[n.me._postIndex].sku)})})}},onComplete:function(){window.onbeforeunload=null,null!==n.btn&&jQuery(".right-panel.btn").button("reset"),n.me._postIndex=n.me._postIndex+1,n.me.postNewRule(n.btn,n.del)}})):($(n.me.newRuleResultContainerId).insert({top:new Element("div",{class:"col-xs-12"}).update("All Done!")}),n.me.hideModalBox(),jQuery("#"+n.me.modalId).remove(),$("searchBtn").click())},getResults:function(e,t,n,i){var s={};s.me=this,s.reset=e||!1,s.auto=n||!1,s.tickNew=i||!1,s.resultDiv=$(s.me.resultDivId),!0===s.reset&&(s.me._pagination.pageNo=1),!0===s.auto&&$$(".btn-show-more").length>0&&(s.me._autoLoading=!0,s.me._pagination.pageNo=1*s.me._pagination.pageNo+1),s.me._pagination.pageSize=t||s.me._pagination.pageSize,s.me.postAjax(s.me.getCallbackId("getItems"),{pagination:s.me._pagination,searchCriteria:s.me._searchCriteria},{onLoading:function(){jQuery("#"+s.me.searchDivId+" .btn").button("loading"),jQuery("#"+s.me.searchDivId+" input").prop("disabled",!0),jQuery("#"+s.me.searchDivId+" select").prop("disabled",!0),!0===s.reset&&s.resultDiv.update(new Element("tr").update(new Element("td").update(s.me.getLoadingImg())))},onSuccess:function(e,t){try{if(s.result=s.me.getResp(t,!1,!0),!s.result)return;$(s.me.totalNoOfItemsId).update(s.result.pageStats.totalRows),!0===s.reset&&s.resultDiv.update(s.me._getResultRow(s.me._getTitleRowData(),!0).wrap(new Element("thead"))),s.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),s.tbody=$(s.resultDiv).down("tbody"),s.tbody||$(s.resultDiv).insert({bottom:s.tbody=new Element("tbody")}),s.result.items.each(function(e){s.tbody.insert({bottom:s.newRow=s.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)}),s.me._tickAll&&s.newRow.down(".product-selected").click()}),!0!==s.me._singleProduct&&s.result.pageStats.pageNumber<s.result.pageStats.totalPages&&s.resultDiv.insert({bottom:s.me._getNextPageBtn().addClassName("paginWrapper")}),!0===s.auto&&$$(".btn-show-more").length>0?s.me.getResults(!1,s.me._pagination.pageSize,!0):(s.me._autoLoading=!1,s.me.hideModalBox(),jQuery("#"+s.me.searchDivId+" .btn").button("reset"),jQuery("#"+s.me.searchDivId+" input").prop("disabled",!1),jQuery("#"+s.me.searchDivId+" select").prop("disabled",!1)),s.me._getSelection()}catch(e){s.resultDiv.insert({bottom:s.me.getAlertBox("Error",e).addClassName("alert-danger")})}},onComplete:function(){!0!==s.auto&&(jQuery("#"+s.me.searchDivId+" .btn").button("reset"),jQuery("#"+s.me.searchDivId+" input").prop("disabled",!1),jQuery("#"+s.me.searchDivId+" select").prop("disabled",!1))}})},_getNextPageBtn:function(){var e={};return e.me=this,e.totalQty=$("total-found-count").innerHTML,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:e.me._nextPageColSpan,class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary btn-show-more","data-loading-text":"Fetching more results ..."}).update("Next Page").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults(!1,e.me._pagination.pageSize,!1,!0)})}).insert({bottom:new Element("span",{class:"btn btn-warning btn-show-more","data-loading-text":"Fetching more results ..."}).update("<b>Show ALL Pages</b>").setStyle("margin-left: 10px; color: black;").observe("click",function(){e.totalQty>1e3?e.me.showModalBox("Warning","<h3>There are "+e.totalQty+" products for current search conditions. <br/>Please narrow down the search"):e.me.getResults(!1,e.me._pagination.pageSize,!0)})})})})},_getTierPrices:function(e){var t={};return t.me=this,tiers=e.tierprices,unitCost=0!=e.totalOnHandValue&&0!=e.stockOnHand?e.totalOnHandValue/e.stockOnHand:Number(e.buyinprice),t.price="",t.specilaPrice="",t.srp="",warning=!1,e.prices&&e.prices.each(function(e){e.type&&1===parseInt(e.type.id)?t.price=Number(e.price):e.type&&2===parseInt(e.type.id)?t.specilaPrice=Number(e.price):e.type&&7===parseInt(e.type.id)&&(t.srp=Number(e.price))}),!tiers||!unitCost&&tiers.length>0&&1==tiers[0].tierPriceType.id?"":(t.tierStrings=[],tiers.each(function(e){warning=!1,1==e.tierPriceType.id?tierPrice=Number(1.1*(unitCost*(e.value/100)+unitCost)).toFixed(2):tierPrice=Number(e.value).toFixed(2),t.srp&&tierPrice>t.srp&&(warning=!0),t.price&&tierPrice>t.price&&(warning=!0),t.tierStrings.push("<div "+(warning?'style="color : red;"':"")+'><small><strong class="hidden-xs hide-when-info hidden-sm">'+e.tierLevel.name+": </strong>"+t.me.getCurrency(tierPrice)+': <abbr title="Quantity" >'+(e.quantity>0?e.quantity:"")+" </abbr></small></div>")}),t.tierStrings.join(""))},_getTierPriceRules:function(e){var t={};return t.me=this,e?(t.tierStrings=[],e.each(function(e){t.tierStrings.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+e.tierLevel.name+': </strong><abbr title="Type: '+e.tierPriceType.name+'">'+Number(e.value).toFixed(2)+': </abbr><abbr title="Quantity" >'+(e.quantity>0?e.quantity:"")+" </abbr></small></div>")}),t.tierStrings.join("")):""},_getSelection:function(){var e={};return e.me=this,e.products=[],e.itemList=$("item-list"),e.itemList.getElementsBySelector(".product_item.item_row").each(function(t){e.checked=t.down('input.product-selected[type="checkbox"]').checked,e.productId=t.readAttribute("product_id"),!0===e.checked&&!0===jQuery.isNumeric(e.productId)&&e.products.push(t.retrieve("data"))}),$("total-selected-count").update(e.products.length),e.products},_getResultRow:function(e,t){var n={};return n.me=this,n.tag=!0===n.isTitle?"th":"td",n.isTitle=t||!1,n.categories="",e.categories&&e.categories.each(function(e){n.categories=""==n.categories?e.name:n.categories+";"+e.name}),n.price="",n.specilaPrice="",n.srp="",e.prices&&e.prices.each(function(e){e.type&&1===parseInt(e.type.id)?n.price=e.price:e.type&&2===parseInt(e.type.id)?n.specilaPrice=e.price:e.type&&7===parseInt(e.type.id)&&(n.srp=e.price)}),n.row=new Element("tr",{class:!0===n.isTitle?"":"product_item btn-hide-row",product_id:e.id}).store("data",e).insert({bottom:new Element(n.tag,{class:"sku",title:e.name}).addClassName("col-xs-1").insert({bottom:new Element("span").setStyle("margin: 0 5px 0 0").insert({bottom:new Element("input",{type:"checkbox",class:"product-selected"}).observe("click",function(e){n.checked=this.checked,!0===n.isTitle&&(n.me._tickAll=n.checked,$(n.me.resultDivId).getElementsBySelector(".product_item .product-selected").each(function(e){e.checked=n.checked})),n.me._getSelection()})})}).insert({bottom:!0===n.isTitle?e.sku:new Element("a",{href:"/product/"+e.id+".html",target:"_BLANK",class:"sku-link truncate"}).update(e.sku)})}).insert({bottom:new Element(n.tag,{class:"category"}).addClassName("col-xs-2").update(!0===n.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-12"}).update("Category")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-12"}).update(n.categories)}))}).insert({bottom:new Element(n.tag,{class:"manufacturer hidden-xs hide-when-info hidden-sm",style:"width:5%"}).addClassName("col-xs-1").update(e.manufacturer?e.manufacturer.name:"")}).insert({bottom:new Element(n.tag,{class:"prices"}).addClassName("col-xs-3").update(!0===n.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-2"}).update("SOH")}).insert({bottom:new Element("div",{class:"col-xs-3"}).update("RRP(Ex)")}).insert({bottom:new Element("div",{class:"col-xs-3"}).update("Cost(Ex)")}).insert({bottom:new Element("div",{class:"col-xs-4"}).update("Tier Prices(Ex)")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-2"}).update(e.stockOnHand)}).insert({bottom:new Element("div",{class:"col-xs-3"}).update(n.srp?n.me.getCurrency(n.srp):n.me.getCurrency(n.price))}).insert({bottom:new Element("div",{class:"col-xs-3"}).update(0!=e.totalOnHandValue&&0!=e.stockOnHand?n.me.getCurrency(e.totalOnHandValue/e.stockOnHand):e.buyinprice?n.me.getCurrency(e.buyinprice):"N/A")}).insert({bottom:new Element("div",{class:"col-xs-4"}).update(n.me._getTierPrices(e))}))}).insert({bottom:new Element(n.tag,{class:"stock"}).addClassName("col-xs-4").update(!0===n.isTitle?new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-12"}).update("Tier Price Rules")}):new Element("div",{class:"row"}).insert({bottom:new Element("div",{class:"col-xs-12"}).update(n.me._getTierPriceRules(e.tierprices))}))}).insert({bottom:new Element(n.tag,{class:"text-right col-xs-1 "}).update(!0===n.isTitle?"":new Element("span",{class:"btn-group btn-group-xs"}).insert({bottom:new Element("span",{class:"btn btn-default",title:"Edit"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-pencil"})}).observe("click",function(){$(this).up(".item_row").replace(n.editEl=n.me._getEditPanel(e)),n.editEl.getElementsBySelector(".form-control[save-item-panel]").each(function(e){e.observe("keydown",function(e){return n.me.keydown(e,function(){n.editEl.down(".btn-success span").click()}),!1})})})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to delete this item?"))return!1;n.me._deleteItem(e)})}))}),n.row},_getEditPanel:function(e){var t={};return t.me=this,t.categories="",e.categories&&e.categories.each(function(e){t.categories=""==t.categories?e.name:t.categories+";"+e.name}),t.price="",t.specilaPrice="",t.srp="",e.prices&&e.prices.each(function(e){e.type&&1===parseInt(e.type.id)?t.price=e.price:e.type&&2===parseInt(e.type.id)?t.specilaPrice=e.price:e.type&&7===parseInt(e.type.id)&&(t.srp=e.price)}),t.newDiv=new Element("tr",{class:"save-item-panel info"}).store("data",e).insert({bottom:new Element("td",{class:"form-group col-xs-1 "}).insert({bottom:new Element("span",{class:" productId"}).update(e.sku)}).insert({bottom:new Element("input",{class:"",type:"hidden","save-item-panel":"id",value:e.id?e.id:""})})}).insert({bottom:new Element("td",{class:"form-group col-xs-2"}).insert({bottom:new Element("span",{class:"row category"}).update(t.categories)})}).insert({bottom:new Element("td",{class:"form-group col-xs-1 hidden-xs hide-when-info hidden-sm "}).insert({bottom:new Element("span",{class:"brand"}).update(e.manufacturer?e.manufacturer.name:"")})}).insert({bottom:new Element("td",{class:"form-group col-xs-3"}).insert({bottom:new Element("div",{class:"row prices"}).insert({bottom:new Element("div",{class:"col-xs-2"}).update(e.stockOnHand)}).insert({bottom:new Element("div",{class:"col-xs-3"}).update(t.srp?t.me.getCurrency(t.srp):t.me.getCurrency(t.price))}).insert({bottom:new Element("div",{class:"col-xs-3"}).update(0!=e.totalOnHandValue&&0!=e.stockOnHand?t.me.getCurrency(e.totalOnHandValue/e.stockOnHand):"N/A")}).insert({bottom:new Element("div",{class:"col-xs-4"}).update(t.me._getTierPrices(e))})})}).insert({bottom:new Element("td",{class:"form-group col-xs-4"}).insert({bottom:new Element("span",{class:"tierrule"}).insert({bottom:t.me._getListPanel("TierPrice:",e.tierprices,{tier:"TierLevel",quantity:"Quantity",type:"TierPriceType",value:"value"},t.me._tierPriceTypes,t.me._tierLevels).wrap(new Element("div",{class:"tierprices-panel"}))})})}).insert({bottom:new Element("td",{class:"form-group text-right col-xs-1"}).insert({bottom:new Element("span",{class:"btn-group btn-group-sm"}).insert({bottom:new Element("span",{class:"btn btn-success",title:"Save"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-ok"})}).observe("click",function(){t.btn=this,t.data=t.me._saveItem(t.btn,$(t.btn).up(".save-item-panel"),"save-item-panel"),t.data&&jQuery(".tooltip")&&jQuery(".tooltip").remove()})}).insert({bottom:new Element("span",{class:"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-remove"})}).observe("click",function(){e.id?$(this).up(".save-item-panel").replace(t.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)):$(this).up(".save-item-panel").remove(),jQuery(".tooltip")&&jQuery(".tooltip").remove()})})})}),t.newDiv},_getSelBox:function(e,t){var n={};return n.me=this,n.selBox=new Element("select"),e.each(function(e){n.selBox.insert({bottom:new Element("option",{value:e.id,selected:!(!t||e.id!==t)}).update(e.name)})}),n.selBox},_getListPanelRow:function(e,t,n,i,s,r){var o={};return o.me=this,o.isTitle=s||!1,o.tag=!0===o.isTitle?"th":"td",o.tierString=i.tier.charAt(0).toLowerCase()+i.tier.slice(1),o.qtyString=i.quantity.toLowerCase(),o.typeString=i.type.charAt(0).toLowerCase()+i.type.slice(1),o.valueString=i.value.toLowerCase(),o.randId="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now(),o.inputBoxDiv=new Element("div",{class:"input-group input-group-sm"}).insert({bottom:new Element("input",{type:"number",class:"form-control","list-panel-row":"quantity",value:Number(e[o.qtyString])>0?e[o.qtyString]:""}).writeAttribute("list-item",e.id?e.id:o.randId)}).observe("click",function(e){$(this).down("input").select()}),o.newRow=new Element("tr").insert({bottom:new Element(o.tag).setStyle("width: 20%").update(!0===o.isTitle?i.tier:o.me._getSelBox(n,e[o.tierString]&&e[o.tierString].id?e[o.tierString].id:"").addClassName("form-control input-sm ").writeAttribute("list-panel-row","tierId").writeAttribute("required",!0).writeAttribute("list-item",e.id?e.id:o.randId).observe("change",function(e){"function"==typeof r&&r(e)}).wrap(new Element("div",{class:"form-group"})))}).insert({bottom:new Element(o.tag).setStyle("width: 20%").update(!0===o.isTitle?i.quantity:o.inputBoxDiv.wrap(new Element("div",{class:"form-group"})))}).insert({bottom:new Element(o.tag).setStyle("width: 30%").update(!0===o.isTitle?i.type:o.me._getSelBox(t,e[o.typeString]&&e[o.typeString].id?e[o.typeString].id:"").addClassName("form-control input-sm ").writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",e.id?e.id:o.randId).observe("change",function(e){"function"==typeof r&&r(e)}).wrap(new Element("div",{class:"form-group"})))}),e.id&&o.newRow.insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"id",value:e.id}).writeAttribute("list-item",e.id?e.id:o.randId)}),o.inputBoxDiv=new Element("div",{class:"input-group input-group-sm"}).insert({bottom:new Element("input",{type:"text",class:"form-control","list-panel-row":"value",required:!0,value:e[o.valueString]?Number(e[o.valueString]).toFixed(2):""}).writeAttribute("list-item",e.id?e.id:o.randId)}).insert({bottom:new Element("input",{type:"hidden",class:"form-control","list-panel-row":"active",value:"1"}).writeAttribute("list-item",e.id?e.id:o.randId)}).insert({bottom:new Element("span",{class:"btn btn-danger input-group-addon"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-trash"})}).observe("click",function(){e.id?($(this).up(".input-group").down("[list-panel-row=active]").value="0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):$(this).up(".list-panel-row").remove(),jQuery(".tooltip")&&jQuery(".tooltip").remove()})}),o.newRow.insert({bottom:new Element(o.tag).update(!0===o.isTitle?i.value:o.inputBoxDiv.wrap(new Element("div",{class:"form-group"})))}),o.newRow},_getListPanel:function(e,t,n,i,s,r){var o={};return o.me=this,o.newDiv=new Element("div",{class:"panel panel-default"}).insert({bottom:new Element("span",{class:"btn btn-primary btn-xs pull-right",title:"New"}).insert({bottom:new Element("span",{class:"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){o.parentPanel=$(this).up(".panel"),o.newData={},o.parentPanel.down(".table tbody").insert({bottom:o.me._getListPanelRow(o.newData,i,s,n,!1,r).addClassName("list-panel-row").writeAttribute("item_id","")}),o.parentPanel.down(".list-div").show()})}).insert({bottom:new Element("div",{class:"list-div table-responsive"}).insert({bottom:new Element("table",{class:"table table-condensed",style:"width : auto"}).insert({bottom:new Element("thead").update(o.me._getListPanelRow(n,i,s,n,!0,r))}).insert({bottom:o.listDiv=new Element("tbody")})})}),t&&t.each(function(e){o.listDiv.insert({bottom:o.me._getListPanelRow(e,i,s,n,!1,r).addClassName("list-panel-row").writeAttribute("item_id",e.id)})}),o.newDiv},_saveItem:function(e,t,n){var i={};if(i.me=this,i.data=i.me._collectFormData(t,n),null!==i.data&&(i.data.tierprices=i.me._collectFormData(t.down(".tierprices-panel"),"list-panel-row","list-item"),null!==i.data.tierprices))return i.me.postAjax(i.me.getCallbackId("saveItem"),{item:i.data},{onLoading:function(){i.data.id&&t.addClassName("item_row").writeAttribute("item_id",i.data.id),t.hide()},onSuccess:function(e,n){try{if(i.result=i.me.getResp(n,!1,!0),!i.result||!i.result.item)return;i.row=$(i.me.resultDivId).down("tbody").down(".item_row[item_id="+i.result.item.id+"]"),i.newRow=i.me._getResultRow(i.result.item).addClassName("item_row").writeAttribute("item_id",i.result.item.id),i.row?i.row.replace(i.newRow):(t.remove(),$(i.me.resultDivId).down("tbody").insert({top:i.newRow}),$(i.me.totalNoOfItemsId).update(1*$(i.me.totalNoOfItemsId).innerHTML+1))}catch(e){i.me.showModalBox('<span class="text-danger">ERROR:</span>',e,!0),t.show()}}}),i.me},_deleteItem:function(e){var t={};return t.me=this,t.row=$(t.me.resultDivId).down("tbody").down(".item_row[item_id="+e.id+"]"),t.me.postAjax(t.me.getCallbackId("deleteItems"),{id:e.id},{onLoading:function(){t.row&&t.row.hide()},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result||!t.result.item)return;t.newRow=t.me._getResultRow(t.result.item).addClassName("item_row").writeAttribute("item_id",t.result.item.id),t.row&&t.row.replace(t.newRow)}catch(e){t.me.showModalBox('<span class="text-danger">ERROR</span>',e,!0),t.row&&t.row.show()}}}),t.me},clearAll:function(e){var t={};t.me=this,reset=!0,pageSize=t.me._pagination.pageSize,t.reset=reset||!1,t.resultDiv=$(t.me.resultDivId),confirm("You are about to clear all tier prices.\n Continue?")&&(!0===t.reset&&(t.me._pagination.pageNo=1),t.me._pagination.pageSize=pageSize||t.me._pagination.pageSize,t.me.postAjax(t.me.getCallbackId("clearAllBtn"),{pagination:t.me._pagination,searchCriteria:t.me._searchCriteria},{onLoading:function(){jQuery("#"+t.me.searchDivId+" #searchBtn").button("loading"),!0===t.reset&&t.resultDiv.update(new Element("tr").update(new Element("td").update(t.me.getLoadingImg())))},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result)return;$(t.me.totalNoOfItemsId).update(t.result.pageStats.totalRows),!0===t.reset&&(t.resultDiv.update(t.me._getResultRow(t.me._getTitleRowData(),!0).wrap(new Element("thead"))),t.result.items&&0!==t.result.items.size()||t.resultDiv.insert({bottom:t.me.getAlertBox("Nothing found.","").addClassName("alert-warning")})),t.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),t.tbody=$(t.resultDiv).down("tbody"),t.tbody||$(t.resultDiv).insert({bottom:t.tbody=new Element("tbody")}),t.result.items.each(function(e){t.tbody.insert({bottom:t.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})}),t.result.pageStats.pageNumber<t.result.pageStats.totalPages&&t.resultDiv.insert({bottom:t.me._getNextPageBtn().addClassName("paginWrapper")})}catch(e){t.resultDiv.insert({bottom:t.me.getAlertBox("Error",e).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+t.me.searchDivId+" #searchBtn").button("reset")}}))}});