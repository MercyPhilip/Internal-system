var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{manufactures:[],suppliers:[],productCategories:[],productStatuses:[],_locationTypes:[],_nextPageColSpan:9,_autoLoading:!1,_getTitleRowData:function(){return{sku:"SKU",name:"Product Name",manufacturer:{name:"Brand"},supplierCodes:[{supplier:{name:"Supplier"},code:""}],stockOnHand:"SOH"}},setPreData:function(a){this._locationTypes=a;return this},_loadManufactures:function(a){this.manufactures=a;var b;b=$(this.searchDivId).down('[search_field="pro.manufacturerIds"]');this.manufactures.each(function(a){b.insert({bottom:(new Element("option",
{value:a.id})).update(a.name)})});return this},_loadProductStatuses:function(a){this.productStatuses=a;var b;b=$(this.searchDivId).down('[search_field="pro.productStatusIds"]');this.productStatuses.each(function(a){b.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});return this},_loadSuppliers:function(a){this.suppliers=a;var b;b=$(this.searchDivId).down('[search_field="pro.supplierIds"]');this.suppliers.each(function(a){b.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});
return this},_loadCategories:function(a){this.categories=a;var b;b=$(this.searchDivId).down('[search_field="pro.productCategoryIds"]');this.categories.sort(function(a,b){return a.namePath>b.namePath}).each(function(a){b.insert({bottom:(new Element("option",{value:a.id})).update(a.namePath)})});return this},_loadChosen:function(){jQuery(".chosen").select2({minimumResultsForSearch:Infinity});return this},_bindSearchKey:function(){var a;a=this;$$("#searchBtn").first().observe("click",function(b){a.getSearchCriteria().getResults(!0,
a._pagination.pageSize)});$("searchDiv").getElementsBySelector("[search_field]").each(function(b){b.observe("keydown",function(b){a.keydown(b,function(){$(a.searchDivId).down("#searchBtn").click()})})});return this},_getSupplierCodes:function(a,b){var c;c=[];a.each(function(a){c.push(!0===b?"Supplier":'<abbr title="Code: '+a.code+'">'+(a.supplier&&a.supplier.name?a.supplier.name:"")+"</abbr>")});return c.join(", ")},getResults:function(a,b,c,e){var d,f,g,h,k,l;d=this;f=a||!1;g=c||!1;h=$(d.resultDivId);
!0===f&&(d._pagination.pageNo=1);!0===g&&0<$$(".btn-show-more").length&&(d._autoLoading=!0,d._pagination.pageNo=1*d._pagination.pageNo+1);d._pagination.pageSize=b||d._pagination.pageSize;d.postAjax(d.getCallbackId("getItems"),{pagination:d._pagination,searchCriteria:d._searchCriteria},{onLoading:function(){jQuery("#"+d.searchDivId+" .btn").button("loading");jQuery("#"+d.searchDivId+" input").prop("disabled",!0);jQuery("#"+d.searchDivId+" select").prop("disabled",!0);!0===f&&h.update((new Element("tr")).update((new Element("td")).update(d.getLoadingImg())))},
onSuccess:function(a,b){try{if(k=d.getResp(b,!1,!0))$(d.totalNoOfItemsId).update(k.pageStats.totalRows),!0===f&&h.update(d._getResultRow(d._getTitleRowData(),!0).wrap(new Element("thead"))),h.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(l=$(h).down("tbody"))||$(h).insert({bottom:l=new Element("tbody")}),k.items.each(function(a){l.insert({bottom:d._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)})}),!0!==d._singleProduct&&k.pageStats.pageNumber<k.pageStats.totalPages&&
h.insert({bottom:d._getNextPageBtn().addClassName("paginWrapper")}),!0===g&&0<$$(".btn-show-more").length?d.getResults(!1,d._pagination.pageSize,!0):(d._autoLoading=!1,d.hideModalBox(),jQuery("#"+d.searchDivId+" .btn").button("reset"),jQuery("#"+d.searchDivId+" input").prop("disabled",!1),jQuery("#"+d.searchDivId+" select").prop("disabled",!1))}catch(c){h.insert({bottom:d.getAlertBox("Error",c).addClassName("alert-danger")})}},onComplete:function(){!0!==g&&(jQuery("#"+d.searchDivId+" .btn").button("reset"),
jQuery("#"+d.searchDivId+" input").prop("disabled",!1),jQuery("#"+d.searchDivId+" select").prop("disabled",!1))}})},_getNextPageBtn:function(){var a,b;a=this;b=$("total-found-count").innerHTML;return(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:a._nextPageColSpan,"class":"text-center"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-show-more","data-loading-text":"Fetching more results ..."})).update("Next Page").observe("click",
function(){a._pagination.pageNo=1*a._pagination.pageNo+1;jQuery(this).button("loading");a.getResults(!1,a._pagination.pageSize,!1,!0)})}).insert({bottom:(new Element("span",{"class":"btn btn-warning btn-show-more","data-loading-text":"Fetching more results ..."})).update("<b>Show ALL Pages</b>").setStyle("margin-left: 10px; color: black;").observe("click",function(){1E3<b?a.showModalBox("Warning","<h3>There are "+b+" products for current search conditions. <br/>Please narrow down the search"):a.getResults(!1,
a._pagination.pageSize,!0)})})})})},_getLocations:function(a){var b;if(!a)return"";b=[];a.each(function(a){b.push('<div><small><strong class="hidden-xs hide-when-info hidden-sm">'+a.type.name+': </strong><abbr title="Type: '+a.type.name+'">'+a.value+": </abbr>"+a.counting+" </small></div>")});return b.join("")},_getTotalCounting:function(a){var b;if(!a)return"";b=0;a.each(function(a){b=parseInt(b)+parseInt(a.counting)});return b},_getResultRow:function(a,b){var c={me:this};c.tag=!0===c.isTitle?"th":
"td";c.isTitle=b||!1;c.row=(new Element("tr",{"class":!0===c.isTitle?"":"btn-hide-row",product_id:a.id})).store("data",a).insert({bottom:(new Element(c.tag,{"class":"sku",title:a.name})).addClassName("col-xs-1").insert({bottom:!0===c.isTitle?a.sku:(new Element("a",{href:"/product/"+a.id+".html",target:"_BLANK","class":"sku-link truncate"})).update(a.sku)})}).insert({bottom:(new Element(c.tag,{"class":"manufacturer hidden-xs hide-when-info hidden-sm",style:"width:5%"})).addClassName("col-xs-1").update(a.manufacturer?
a.manufacturer.name:"")}).insert({bottom:(new Element(c.tag,{"class":"stock"})).addClassName("col-xs-1").update(!0===c.isTitle?(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12",title:"Current Stock on Hand"})).update("Current SOH")}):(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-12",title:"Current Stock on Hand"})).update(a.stockOnHand)}))}).insert({bottom:(new Element(c.tag,{"class":"stock"})).addClassName("col-xs-8").update(!0===
c.isTitle?(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-3",title:"Stock Counting"})).update("Totoal Counting")}).insert({bottom:(new Element("div",{"class":"col-xs-9 ",title:"Locations"})).update("Locations")}):(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-3",title:"TotalQuantity"})).update(c.me._getTotalCounting(a.locations))}).insert({bottom:(new Element("div",{"class":"col-xs-9",title:"Locations"})).update(c.me._getLocations(a.locations))}))}).insert({bottom:(new Element(c.tag,
{"class":"text-right col-xs-1 "})).update(!0===c.isTitle?"":(new Element("span",{"class":"btn-group btn-group-xs"})).insert({bottom:(new Element("span",{"class":"btn btn-default",title:"Edit"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){$(this).up(".item_row").replace(c.editEl=c.me._getEditPanel(a));c.editEl.getElementsBySelector(".form-control[save-item-panel]").each(function(a){a.observe("keydown",function(a){c.me.keydown(a,function(){c.editEl.down(".btn-success span").click()});
return!1})})})}))});return c.row},_getEditPanel:function(a){var b,c,e;b=this;return(new Element("tr",{"class":"save-item-panel info"})).store("data",a).insert({bottom:(new Element("td",{"class":"form-group col-xs-1 "})).insert({bottom:(new Element("span",{"class":" sku"})).insert({bottom:a.sku})}).insert({bottom:new Element("input",{"class":"",type:"hidden","save-item-panel":"id",value:a.id})})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-1 hidden-xs hide-when-info hidden-sm "})).insert({bottom:(new Element("span",
{"class":"brand"})).insert({bottom:a.manufacturer?a.manufacturer.name:""})})}).insert({bottom:(new Element("td",{"class":"form-group col-xs-1"})).update((new Element("div",{"class":"row"})).insert({bottom:(new Element("span",{"class":" col-xs-12 stockOnHand"})).insert({bottom:a.stockOnHand?a.stockOnHand:0})}))}).insert({bottom:(new Element("td",{"class":"form-group col-xs-8"})).update((new Element("div",{"class":"row"})).insert({bottom:(new Element("span",{"class":" col-xs-3 quantity"})).insert({bottom:b._getTotalCounting(a.locations)})}).insert({bottom:(new Element("span",
{"class":" col-xs-9 locations"})).insert({bottom:b._getListPanel("Locations:",a.locations,{counting:"Counting",type:"Type",value:"value"},b._locationTypes).wrap(new Element("div",{"class":"col-xs-12 locations-panel"}))})}))}).insert({bottom:(new Element("td",{"class":"form-group text-right col-xs-1"})).insert({bottom:(new Element("span",{"class":"btn-group btn-group-sm"})).insert({bottom:(new Element("span",{"class":"btn btn-success",title:"Save"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}).observe("click",
function(){c=this;(e=b._saveItem(c,$(c).up(".save-item-panel"),"save-item-panel"))&&jQuery(".tooltip")&&jQuery(".tooltip").remove()})}).insert({bottom:(new Element("span",{"class":"btn btn-danger",title:"Delete"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){a.id?$(this).up(".save-item-panel").replace(b._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)):$(this).up(".save-item-panel").remove();jQuery(".tooltip")&&jQuery(".tooltip").remove()})}).insert({bottom:(new Element("span",
{"class":"btn btn-primary",title:"Apply"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-saved"})}).observe("click",function(){c=this;(e=b._applystockonhand(c,$(c).up(".save-item-panel"),"save-item-panel"))&&jQuery(".tooltip")&&jQuery(".tooltip").remove()})})})})},_getSelBox:function(a,b){var c;c=new Element("select");a.each(function(a){c.insert({bottom:(new Element("option",{value:a.id,selected:b&&a.id===b?!0:!1})).update(a.name)})});return c},_getListPanelRow:function(a,b,c,e,
d){var f,g,h,k,l;e=e||!1;f=!0===e?"th":"td";g=c.counting.toLowerCase();h=c.type.toLowerCase();k=c.value.toLowerCase();l="NEW_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now();g=(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("input",{type:"number","class":"form-control","list-panel-row":"counting",required:!0,value:a[g]?a[g]:""})).writeAttribute("list-item",a.id?a.id:l)}).observe("click",function(a){$(this).down("input").select()});b=(new Element("tr")).insert({bottom:(new Element(f)).update(!0===
e?c.counting:g.wrap(new Element("div",{"class":"form-group"})))}).insert({bottom:(new Element(f)).update(!0===e?c.type:this._getSelBox(b,a[h]&&a[h].id?a[h].id:"").addClassName("form-control input-sm ").writeAttribute("list-panel-row","typeId").writeAttribute("required",!0).writeAttribute("list-item",a.id?a.id:l).observe("change",function(a){"function"===typeof d&&d(a)}).wrap(new Element("div",{"class":"form-group"})))});a.id&&b.insert({bottom:(new Element("input",{type:"hidden","class":"form-control",
"list-panel-row":"id",value:a.id})).writeAttribute("list-item",a.id?a.id:l)});g=(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("input",{type:"text","class":"form-control","list-panel-row":"value",required:!0,value:a[k]?a[k]:""})).writeAttribute("list-item",a.id?a.id:l)}).insert({bottom:(new Element("input",{type:"hidden","class":"form-control","list-panel-row":"active",value:"1"})).writeAttribute("list-item",a.id?a.id:l)}).insert({bottom:(new Element("span",
{"class":"btn btn-danger input-group-addon"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){a.id?($(this).up(".input-group").down("[list-panel-row=active]").value="0",$(this).up(".input-group").down("[list-panel-row=value]").writeAttribute("required",!1),$(this).up(".list-panel-row").hide()):$(this).up(".list-panel-row").remove()})});b.insert({bottom:(new Element(f)).update(!0===e?c.value:g.wrap(new Element("div",{"class":"form-group"})))});
return b},_getListPanel:function(a,b,c,e,d){var f,g,h,k;f=this;a=(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("span",{"class":"btn btn-primary btn-xs pull-right",title:"New"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){g=$(this).up(".panel");h={};g.down(".table tbody").insert({bottom:f._getListPanelRow(h,e,c,!1,d).addClassName("list-panel-row").writeAttribute("item_id","")});g.down(".list-div").show()})}).insert({bottom:(new Element("div",
{"class":"list-div table-responsive"})).insert({bottom:(new Element("table",{"class":"table table-condensed",style:"width : auto"})).insert({bottom:(new Element("thead")).update(f._getListPanelRow(c,e,c,!0,d))}).insert({bottom:k=new Element("tbody")})})});b&&b.each(function(a){k.insert({bottom:f._getListPanelRow(a,e,c,!1,d).addClassName("list-panel-row").writeAttribute("item_id",a.id)})});return a},_saveItem:function(a,b,c){var e,d,f,g,h;e=this;d=e._collectFormData(b,c);if(null!==d&&(d.locations=
e._collectFormData(b.down(".locations-panel"),"list-panel-row","list-item"),null!==d.locations))return e.postAjax(e.getCallbackId("saveItem"),{item:d},{onLoading:function(){d.id&&b.addClassName("item_row").writeAttribute("item_id",d.id);b.hide()},onSuccess:function(a,c){try{(f=e.getResp(c,!1,!0))&&f.item&&(g=$(e.resultDivId).down("tbody").down(".item_row[item_id="+f.item.id+"]"),h=e._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",f.item.id),g?g.replace(h):($(e.resultDivId).down("tbody").insert({top:h}),
b.remove(),$(e.totalNoOfItemsId).update(1*$(e.totalNoOfItemsId).innerHTML+1)))}catch(d){e.showModalBox('<span class="text-danger">ERROR:</span>',d,!0),b.show()}}}),e},_applystockonhand:function(a,b,c){var e,d,f,g,h;e=this;d=e._collectFormData(b,c);if(null!==d&&(d.locations=e._collectFormData(b.down(".locations-panel"),"list-panel-row","list-item"),null!==d.locations))return e.postAjax(e.getCallbackId("applyStockOnHandBtn"),{item:d},{onLoading:function(){d.id&&b.addClassName("item_row").writeAttribute("item_id",
d.id);b.hide()},onSuccess:function(a,c){try{(f=e.getResp(c,!1,!0))&&f.item&&(g=$(e.resultDivId).down("tbody").down(".item_row[item_id="+f.item.id+"]"),h=e._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",f.item.id),g?g.replace(h):($(e.resultDivId).down("tbody").insert({top:h}),b.remove(),$(e.totalNoOfItemsId).update(1*$(e.totalNoOfItemsId).innerHTML+1)))}catch(d){e.showModalBox('<span class="text-danger">ERROR:</span>',d,!0),b.show()}}}),e}});