var CRUDPageJs=new Class.create;CRUDPageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_nextPageColSpan:5,setHTMLIds:function(a,b,c){return this.resultDivId=a,this.searchDivId=b,this.totalNoOfItemsId=c,this},getSearchCriteria:function(){var a={};return a.me=this,null===a.me._searchCriteria&&(a.me._searchCriteria={}),a.nothingTosearch=!0,$(a.me.searchDivId).getElementsBySelector("[search_field]").each(function(b){a.me._searchCriteria[b.readAttribute("search_field")]=$F(b),($F(b)instanceof Array&&$F(b).size()>0||"string"==typeof $F(b)&&!$F(b).blank())&&(a.nothingTosearch=!1)}),a.nothingTosearch===!0&&(a.me._searchCriteria=null),this},getResults:function(a,b,c){var d={};d.me=this,d.reset=a||!1,d.resultDiv=$(d.me.resultDivId),d.reset===!0&&(d.me._pagination.pageNo=1),d.me._pagination.pageSize=b||d.me._pagination.pageSize,d.me.postAjax(d.me.getCallbackId("getItems"),{pagination:d.me._pagination,searchCriteria:d.me._searchCriteria},{onLoading:function(){jQuery("#"+d.me.searchDivId+" #searchBtn").button("loading"),d.reset===!0&&d.resultDiv.update(new Element("tr").update(new Element("td").update(d.me.getLoadingImg())))},onSuccess:function(a,b){try{if(d.result=d.me.getResp(b,!1,!0),!d.result)return;$(d.me.totalNoOfItemsId).update(d.result.pageStats.totalRows),d.reset===!0&&(d.result.items.length>0&&d.result.items[0].hasOwnProperty("message")?d.resultDiv.update(d.me._getResultRow(d.me._getTitleRowData(d.result.items[0].message),!0).wrap(new Element("thead"))):d.resultDiv.update(d.me._getResultRow(d.me._getTitleRowData(),!0).wrap(new Element("thead"))),d.result.items&&0!==d.result.items.size()||d.resultDiv.insert({bottom:d.me.getAlertBox("Nothing found.","").addClassName("alert-warning")})),d.resultDiv.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),d.tbody=$(d.resultDiv).down("tbody"),d.tbody||$(d.resultDiv).insert({bottom:d.tbody=new Element("tbody")}),d.result.items.each(function(a){d.tbody.insert({bottom:d.me._getResultRow(a).addClassName("item_row").writeAttribute("item_id",a.id)})}),d.result.pageStats.pageNumber<d.result.pageStats.totalPages&&d.result.pageStats.totalPages>1&&d.resultDiv.insert({bottom:d.me._getNextPageBtn().addClassName("paginWrapper")})}catch(a){d.resultDiv.insert({bottom:d.me.getAlertBox("Error",a).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+d.me.searchDivId+" #searchBtn").button("reset")}},c)},_getNextPageBtn:function(){var a={};return a.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:a.me._nextPageColSpan,class:"text-center"}).insert({bottom:new Element("span",{class:"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){a.me._pagination.pageNo=1*a.me._pagination.pageNo+1,jQuery(this).button("loading"),a.me.getResults()})})})})},_saveItem:function(a,b,c){var d={};if(d.me=this,d.data=d.me._collectFormData(b,c),null!==d.data)return d.me.postAjax(d.me.getCallbackId("saveItem"),{item:d.data},{onLoading:function(){d.data.id&&b.addClassName("item_row").writeAttribute("item_id",d.data.id),b.hide()},onSuccess:function(a,c){try{if(d.result=d.me.getResp(c,!1,!0),!d.result||!d.result.item)return;d.row=$(d.me.resultDivId).down("tbody").down(".item_row[item_id="+d.result.item.id+"]"),d.newRow=d.me._getResultRow(d.result.item).addClassName("item_row").writeAttribute("item_id",d.result.item.id),d.row?d.row.replace(d.newRow):($(d.me.resultDivId).down("tbody").insert({top:d.newRow}),b.remove(),$(d.me.totalNoOfItemsId).update(1*$(d.me.totalNoOfItemsId).innerHTML+1))}catch(a){d.me.showModalBox('<span class="text-danger">ERROR:</span>',a,!0),b.show()}}}),d.me},_deleteItem:function(a){var b={};return b.me=this,b.row=$(b.me.resultDivId).down("tbody").down(".item_row[item_id="+a.id+"]"),b.me.postAjax(b.me.getCallbackId("deleteItems"),{ids:[a.id]},{onLoading:function(){b.row&&b.row.hide()},onSuccess:function(a,c){try{if(b.result=b.me.getResp(c,!1,!0),!b.result)return;b.count=1*$(b.me.totalNoOfItemsId).innerHTML-1,$(b.me.totalNoOfItemsId).update(b.count<=0?0:b.count),b.row&&b.row.remove()}catch(a){b.me.showModalBox('<span class="text-danger">ERROR</span>',a,!0),b.row&&b.row.show()}}}),b.me}});