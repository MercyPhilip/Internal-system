var CRUDPageJs=new Class.create;
CRUDPageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_nextPageColSpan:5,setHTMLIds:function(c,b,d){this.resultDivId=c;this.searchDivId=b;this.totalNoOfItemsId=d;return this},getSearchCriteria:function(){var c,b;c=this;null===c._searchCriteria&&(c._searchCriteria={});b=!0;$(c.searchDivId).getElementsBySelector("[search_field]").each(function(d){c._searchCriteria[d.readAttribute("search_field")]=$F(d);
if($F(d)instanceof Array&&0<$F(d).size()||"string"===typeof $F(d)&&!$F(d).blank())b=!1});!0===b&&(c._searchCriteria=null);return this},getResults:function(c,b,d){var a,e,f,g,h;a=this;e=c||!1;f=$(a.resultDivId);!0===e&&(a._pagination.pageNo=1);a._pagination.pageSize=b||a._pagination.pageSize;a.postAjax(a.getCallbackId("getItems"),{pagination:a._pagination,searchCriteria:a._searchCriteria},{onLoading:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("loading");!0===e&&f.update((new Element("tr")).update((new Element("td")).update(a.getLoadingImg())))},
onSuccess:function(b,c){try{if(g=a.getResp(c,!1,!0))$(a.totalNoOfItemsId).update(g.pageStats.totalRows),!0===e&&(f.update(a._getResultRow(a._getTitleRowData(),!0).wrap(new Element("thead"))),g.items&&0!==g.items.size()||f.insert({bottom:a.getAlertBox("Nothing found.","").addClassName("alert-warning")})),f.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(h=$(f).down("tbody"))||$(f).insert({bottom:h=new Element("tbody")}),g.items.each(function(b){h.insert({bottom:a._getResultRow(b).addClassName("item_row").writeAttribute("item_id",
b.id)})}),g.pageStats.pageNumber<g.pageStats.totalPages&&1<g.pageStats.totalPages&&f.insert({bottom:a._getNextPageBtn().addClassName("paginWrapper")})}catch(d){f.insert({bottom:a.getAlertBox("Error",d).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("reset")}},d)},_getNextPageBtn:function(){var c;c=this;return(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:c._nextPageColSpan,"class":"text-center"})).insert({bottom:(new Element("span",
{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."})).update("Show More").observe("click",function(){c._pagination.pageNo=1*c._pagination.pageNo+1;jQuery(this).button("loading");c.getResults()})})})})},_saveItem:function(c,b,d){var a,e,f,g,h;a=this;e=a._collectFormData(b,d);if(null!==e)return a.postAjax(a.getCallbackId("saveItem"),{item:e},{onLoading:function(){e.id&&b.addClassName("item_row").writeAttribute("item_id",e.id);b.hide()},onSuccess:function(c,d){try{(f=a.getResp(d,
!1,!0))&&f.item&&(g=$(a.resultDivId).down("tbody").down(".item_row[item_id="+f.item.id+"]"),h=a._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",f.item.id),g?g.replace(h):($(a.resultDivId).down("tbody").insert({top:h}),b.remove(),$(a.totalNoOfItemsId).update(1*$(a.totalNoOfItemsId).innerHTML+1)))}catch(e){a.showModalBox('<span class="text-danger">ERROR:</span>',e,!0),b.show()}}}),a},_deleteItem:function(c){var b,d,a,e;b=this;d=$(b.resultDivId).down("tbody").down(".item_row[item_id="+
c.id+"]");b.postAjax(b.getCallbackId("deleteItems"),{ids:[c.id]},{onLoading:function(){d&&d.hide()},onSuccess:function(c,g){try{if(a=b.getResp(g,!1,!0))e=1*$(b.totalNoOfItemsId).innerHTML-1,$(b.totalNoOfItemsId).update(0>=e?0:e),d&&d.remove()}catch(h){b.showModalBox('<span class="text-danger">ERROR</span>',h,!0),d&&d.show()}}});return b}});